import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{q as E,u as H}from"./query-client.zrB8z_yM.js";import{r as N}from"./index.Z3BHPS3u.js";import{U as re}from"./UpgradeAccountModal.Bl29I556.js";import{a as oe}from"./ai-course.m2sFB2uK.js";import{u as ge,b as fe}from"./billing.Dog7Gwv_.js";import{A as he}from"./AITutorLayout.C8UE3Ki9.js";import{g as be}from"./browser.3c2kCsRM.js";import{r as ye,i as we}from"./jwt.1xGNZsvU.js";import{L as ne}from"./LoadingChip.D-JeWbx4.js";import{g as je}from"./ai-questions.CsV5uBnQ.js";import{g as ve,a as ie}from"./ai-quiz.CvRgTtfI.js";import{c as p}from"./classname.y9b8gBZq.js";import{m as V}from"./markdown.CL3gtrVM.js";import{C as _}from"./check.DflWYpXj.js";import{X as W}from"./x.BOdyWiWF.js";import{I as Ne}from"./info.Cr2knUfd.js";import{S as Se,R as Ce}from"./skip-forward.BFtmlcix.js";import{T as ke}from"./triangle-alert.D3x2YB55.js";import"./js.cookie.Cz0CWeBA.js";import{r as ze}from"./chat.C-0TRz4N.js";import{r as K}from"./index.BlPpvBlM.js";import{L as ae}from"./loader-circle.DfB4mNyf.js";import{C as Ae}from"./chevron-left.DdnmjL-W.js";import{C as Qe}from"./chevron-right.B-RYTm0N.js";import{g as le}from"./number.DnDLgi2j.js";import{A as qe}from"./arrow-right.BkJRCAfQ.js";import{M as ce}from"./minus.9vrPWxU4.js";import{C as Z}from"./circle-alert.DQNBwVc5.js";import{c as Le}from"./createLucideIcon.BSLrQS80.js";import{Z as Ie}from"./zap.BNbCfd_G.js";import{B as Re}from"./book-open.Dsgc4gH7.js";import{F as Te}from"./file-text.BpqfdBL4.js";import{a as Oe}from"./query-http.Bohx3EqF.js";import{u as Fe}from"./useMutation.BxVH4XRI.js";import"./use-toast.BdCcSTJE.js";import"./toast.DlejBBdi.js";import"./index.3whys8t3.js";import"./Modal.NtjGPDbq.js";import"./use-outside-click.DYGsxgbd.js";import"./use-keydown.r409VyJJ.js";import"./UpdatePlanConfirmation.NT5hFl0c.js";import"./VerifyUpgrade.B0n18ihL.js";import"./circle-check-big.CnV0y9bI.js";import"./message-circle.C1uJbl19.js";import"./map.DuWy2ZcB.js";import"./AILimitsPopup.D5_oZcjJ.js";import"./gift.C1ExsHI3.js";import"./use-auth.Bw1nhFr_.js";import"./auth.Blx_4y9V.js";import"./popup.CdCAhVM2.js";import"./DropdownMenu.DLecQPzF.js";import"./Combination.CkJeYjFl.js";import"./floating-ui.dom.BG6dflv2.js";import"./fp.esm.CznIeghd.js";import"./circle.D81F4kBU.js";import"./chevron-down.pBq1owZr.js";import"./user-round.D2mOPNuO.js";import"./credit-card.bcfoan7u.js";import"./settings.Dhc_ymfO.js";import"./log-out.DpAdf0Mt.js";import"./UpgradeSidebarCard.D8r3kRrD.js";import"./plus.CstxCH0M.js";import"./swords.C6qRCXus.js";import"./star.B-cQRnHp.js";import"./RoadmapLogo.CJwoV5Wp.js";import"./menu.B2j5jEPR.js";import"./index.browser.OxPLOBIU.js";import"./preload-helper.BlTxHScW.js";import"./index.Bbp-6C1p.js";/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Me=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]],Ue=Le("chart-column",Me);function Ee(a){const{children:n}=a;return e.jsx(he,{activeTab:"quiz",wrapperClassName:"flex-row p-0 lg:p-0 relative overflow-hidden bg-white",containerClassName:"h-[calc(100vh-49px)] overflow-hidden relative",children:n})}const J="prose prose-base prose-p:mb-3 prose-p:text-base prose-p:font-normal prose-pre:my-5 prose-p:prose-code:whitespace-nowrap prose-p:prose-code:text-sm prose-p:prose-code:px-2 prose-p:prose-code:py-1 prose-p:prose-code:rounded-md prose-p:prose-code:border prose-p:prose-code:border-gray-300 prose-p:prose-code:bg-gray-50 text-left text-gray-800";function $e(a){const{question:n,questionState:t,setSelectedOptions:i,onSubmit:l,onSkip:s,onNext:r,isLastQuestion:o,onComplete:u}=a,{title:f,options:x,answerExplanation:m}=n,{isSubmitted:c,selectedOptions:y=[]}=t,h=x.filter(b=>b.isCorrect).length>1,S=b=>{if(c)return;if(!h){i([b]);return}const j=y.includes(b)?y.filter(g=>g!==b):[...y,b];i(j)},d=()=>{if(c){o?u():r();return}const b=y.every(j=>x[j].isCorrect)&&y.length===x.filter(j=>j.isCorrect).length;l(b?"correct":"incorrect")},I=y.length>0||t.status==="skipped";return e.jsxs("div",{className:"mx-auto max-w-4xl",children:[e.jsx(de,{title:f}),e.jsx("div",{className:"mt-8",children:x.map((b,j)=>{const g=y.includes(j),A=b.isCorrect,z=c&&g&&A,v=c&&g&&!A,C=c&&!g&&A,q=V(b.title,!1),F=c&&!g&&!A;return e.jsxs("button",{className:p("group flex w-full items-start gap-4 rounded-lg py-2 text-left",g&&!c&&"",c&&z&&"border-green-500 text-green-700",c&&v&&"border-red-500 text-red-700",c&&C&&"border-green-500 text-green-700",F&&"cursor-not-allowed opacity-50"),onClick:()=>S(j),disabled:F,children:[e.jsxs("div",{className:p("flex size-6.5 shrink-0 items-center justify-center rounded-lg border-2 border-gray-300",g&&!c&&"border-black bg-black text-white",z&&"border-green-500 bg-green-500 text-white",v&&"border-red-500 bg-red-500 text-white",C&&"border-green-500 bg-green-500 text-white",!g&&!c&&"group-hover:border-gray-300 group-hover:bg-gray-200"),children:[g&&!c&&e.jsx("div",{className:"size-5 bg-black"}),z&&e.jsx(_,{className:"size-5"}),v&&e.jsx(W,{className:"size-5"}),C&&e.jsx(_,{className:"size-5"})]}),e.jsx("div",{className:p(J,"flex-1"),dangerouslySetInnerHTML:{__html:q}})]},b.id)})}),c&&m&&e.jsx(ue,{explanation:m,status:t.status}),e.jsxs("div",{className:"mt-8 flex justify-between",children:[e.jsx("button",{onClick:s,disabled:c,className:"rounded-xl bg-gray-100 px-8 py-3 text-base font-medium text-gray-800 hover:bg-gray-200 disabled:cursor-not-allowed disabled:opacity-50",children:"Skip Question"}),e.jsx("button",{className:p("rounded-xl bg-black px-8 py-3 text-base font-medium text-white hover:bg-gray-800 disabled:cursor-not-allowed disabled:opacity-50"),onClick:d,disabled:!I,children:c?o?"Finish Quiz":"Next Question":"Check Answer"})]})]})}function de(a){const{title:n}=a,t=V(n,!1);return e.jsx("div",{className:"prose prose-xl prose-headings:text-3xl prose-headings:font-bold prose-headings:text-black prose-headings:mb-6 prose-p:text-3xl prose-p:font-semibold prose-p:leading-normal prose-p:text-black prose-p:mb-0 prose-pre:my-5 prose-p:prose-code:whitespace-nowrap prose-p:prose-code:relative prose-p:prose-code:top-[-5px] prose-p:prose-code:text-xl prose-p:prose-code:px-3 prose-p:prose-code:py-1 prose-p:prose-code:rounded-md prose-p:prose-code:border prose-p:prose-code:border-gray-300 prose-p:prose-code:bg-gray-100 prose-p:prose-code:font-medium mb-2 text-left",dangerouslySetInnerHTML:{__html:t}})}function ue(a){const{explanation:n,title:t,status:i}=a,l=V(n,!1),r=(()=>{switch(i){case"correct":return{bgColor:"bg-green-50",borderColor:"border-green-200",iconBgColor:"bg-green-500",textColor:"text-green-800",icon:_,defaultTitle:"Correct Answer"};case"incorrect":return{bgColor:"bg-red-50",borderColor:"border-red-200",iconBgColor:"bg-red-500",textColor:"text-red-800",icon:W,defaultTitle:"Incorrect Answer"};case"can_be_improved":return{bgColor:"bg-yellow-50",borderColor:"border-yellow-200",iconBgColor:"bg-yellow-500",textColor:"text-yellow-800",icon:ke,defaultTitle:"Can Be Improved"};case"skipped":return{bgColor:"bg-gray-50",borderColor:"border-gray-200",iconBgColor:"bg-gray-500",textColor:"text-gray-800",icon:Se,defaultTitle:"Question Skipped"};default:return{bgColor:"bg-blue-50",borderColor:"border-blue-200",iconBgColor:"bg-blue-500",textColor:"text-blue-800",icon:Ne,defaultTitle:"Explanation"}}})(),o=r.icon,u=t||r.defaultTitle;return e.jsxs("div",{className:p("mt-6 rounded-xl border-2 p-6 transition-all duration-200",r.bgColor,r.borderColor),children:[e.jsxs("div",{className:"mb-4 flex items-center gap-3",children:[e.jsx("div",{className:p("flex size-8 items-center justify-center rounded-full text-white",r.iconBgColor),children:e.jsx(o,{className:"size-4",strokeWidth:2.5})}),e.jsx("h3",{className:p("text-lg font-semibold",r.textColor),children:u})]}),e.jsx("div",{className:p(J,"leading-relaxed text-gray-700"),dangerouslySetInnerHTML:{__html:l}})]})}function Be(a){const{quizSlug:n,question:t,userAnswer:i,onError:l,onFinish:s}=a,r=N.useRef(null),o=N.useRef(null),[u,f]=N.useState(null),[x,m]=N.useState("idle"),c=N.useCallback(async()=>{try{m("loading"),r.current?.abort(),r.current=new AbortController;const h=await fetch(`undefined/v1-verify-quiz-answer/${n}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({question:t,userAnswer:i}),signal:r.current?.signal,credentials:"include"});if(!h.ok){const d=await h.json();throw m("error"),d.status===401&&(ye(),window.location.reload()),new Error(d?.message||"Something went wrong")}const S=h.body;if(!S)throw m("error"),new Error("Something went wrong");if(await ze(S,{onMessage:async d=>{K.flushSync(()=>{m("streaming"),o.current=Pe(d),f(o.current)})},onMessageEnd:async()=>{K.flushSync(()=>{m("ready")})}}),m("idle"),r.current=null,!o.current)throw m("error"),new Error("Something went wrong");s?.(o.current)}catch(h){if(r.current?.signal.aborted)return;l?.(h),m("error")}},[n,t,i,l]),y=N.useCallback(()=>{r.current&&(r.current.abort(),r.current=null)},[]);return{data:u,status:x,stop:y,verifyAnswer:c}}function Pe(a){const n=/<status>(.*?)<\/status>/,t=a.match(n)?.[1]?.trim(),i=a.replace(n,"").trim();return{status:t,feedback:i}}function _e(a){const{quizSlug:n,question:t,questionState:i,onSubmit:l,onNext:s,setUserAnswer:r,setCorrectAnswer:o,isLastQuestion:u,onComplete:f,onSkip:x}=a,{title:m}=t,{isSubmitted:c,userAnswer:y="",correctAnswer:h="",status:S}=i,{verifyAnswer:d,data:k,status:I}=Be({quizSlug:n,question:m,userAnswer:y,onFinish:C=>{if(!C||!C.status){console.error("No data or status",C),l("incorrect");return}o(C.feedback||""),l(C?.status||"incorrect")}}),b=async()=>{if(v){u?f():s();return}await d()},j=y.trim().length>0,g=I==="loading"||I==="streaming",A=k?.feedback||h,z=k?.status||S,v=c&&S!=="skipped";return e.jsxs("div",{children:[e.jsx(de,{title:m}),e.jsx("div",{className:"mt-6",children:e.jsx("textarea",{className:p("min-h-[200px] w-full resize-none rounded-xl border border-gray-200 p-4 text-lg","focus:border-gray-400 focus:ring-0 focus:outline-none",v&&"bg-gray-50",v&&z==="correct"&&"border-green-500 bg-green-50",v&&z==="incorrect"&&"border-red-500 bg-red-50",v&&z==="can_be_improved"&&"border-yellow-500 bg-yellow-50"),placeholder:"Type your answer here...",value:y,onChange:C=>r(C.target.value),disabled:v||g})}),A&&e.jsx(ue,{explanation:A,status:z}),e.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[e.jsx("button",{onClick:x,disabled:c,className:"rounded-xl bg-gray-100 px-8 py-3 text-base font-medium text-gray-800 hover:bg-gray-200 disabled:cursor-not-allowed disabled:opacity-50",children:"Skip Question"}),e.jsx("button",{className:p("rounded-xl bg-black px-8 py-3 text-base font-medium text-white hover:bg-gray-800 disabled:cursor-not-allowed disabled:opacity-50"),onClick:b,disabled:!j||g,children:g?e.jsx(ae,{className:"size-4 animate-spin stroke-[2.5]"}):v?u?"Finish Quiz":"Next Question":"Verify Answer"})]})]})}function De(a){const{activeQuestionIndex:n,totalQuestions:t,progressPercentage:i,onPrevious:l,onNext:s,onSkip:r,isStreaming:o=!1}=a;return e.jsxs("div",{className:"mb-8 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-center lg:justify-between",children:[e.jsxs("div",{className:"flex w-full items-center gap-3",children:[e.jsx(ee,{disabled:n===0,onClick:l,icon:Ae}),e.jsxs("span",{className:"text-center text-sm font-medium text-gray-600 max-lg:w-full",children:["Question"," ",e.jsx("span",{className:"text-black",children:n+1})," of"," ",t]}),e.jsx(ee,{disabled:!1,onClick:r,icon:Qe})]}),!o&&e.jsxs("div",{className:p("hidden flex-shrink-0 text-sm font-medium text-gray-500 min-lg:flex"),children:[Math.round(i),"% complete"]}),o&&e.jsx("div",{className:"text-sm font-medium text-gray-500",children:e.jsx(ae,{className:"size-4 animate-spin stroke-[2.5]"})})]}),e.jsxs("div",{className:"relative h-2 overflow-hidden rounded-full bg-gray-100 shadow-inner",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 rounded-full bg-black transition-all duration-300 ease-out",style:{width:`${i}%`}}),e.jsx("div",{className:"absolute inset-y-0 left-0 rounded-full bg-gradient-to-r from-transparent via-white/20 to-transparent transition-all duration-300 ease-out",style:{width:`${i}%`}})]})]})}function ee(a){const{disabled:n,onClick:t,icon:i}=a;return e.jsx("button",{className:"flex size-8 items-center justify-center rounded-lg border border-gray-200 bg-white text-gray-400 transition-all duration-150 hover:border-gray-300 hover:text-gray-600 disabled:cursor-not-allowed disabled:opacity-40 disabled:hover:border-gray-200 disabled:hover:text-gray-400 disabled:hover:shadow-sm",disabled:n,onClick:t,children:e.jsx(i,{className:"size-4"})})}function He(a){const{activeQuestionIndex:n,questionStates:t,onReview:i,onComplete:l}=a,s=Object.values(t);return e.jsx("div",{className:"border-t border-gray-200 bg-white p-3",children:e.jsxs("div",{className:"flex flex-col items-center justify-between gap-2 md:flex-row",children:[e.jsx("div",{className:"flex w-full flex-wrap gap-1",children:s.map((r,o)=>e.jsx(me,{state:r,quizIndex:o,isActive:o===n,onReview:i,variant:"small"},o))}),e.jsxs("button",{className:"flex w-full shrink-0 items-center justify-center gap-2 rounded-xl bg-black px-4 py-2 text-white hover:bg-gray-900 disabled:opacity-70 md:w-auto md:justify-start",onClick:l,children:["Show Results ",e.jsx(qe,{className:"h-4 w-4"})]})]})})}function me(a){const{state:n,quizIndex:t,isActive:i,onReview:l,className:s,variant:r="default"}=a,{status:o}=n,u=o==="correct",f=o==="incorrect",x=o==="skipped",m=o==="can_be_improved";return e.jsxs("button",{onClick:()=>l?.(t),className:p("flex aspect-square flex-col items-center justify-center rounded-xl border p-1 hover:opacity-80",u&&"border-green-700 bg-green-700 text-white",f&&"border-red-700 bg-red-700 text-white",x&&"border-gray-400 bg-gray-400 text-white",m&&"border-yellow-700 bg-yellow-700 text-white",!i&&"opacity-50",r==="small"&&"rounded-lg",s),children:[u&&e.jsx(_,{className:p("size-6.5",r==="small"&&"size-5")}),f&&e.jsx(W,{className:p("size-6.5",r==="small"&&"size-5")}),x&&e.jsx(ce,{className:p("size-6.5 fill-current",r==="small"&&"size-5")}),m&&e.jsx(Z,{className:p("size-6.5",r==="small"&&"size-5")})]},t)}function Ve(a){const{accuracy:n,color:t,size:i="md"}=a,l=2*Math.PI*45,s=l-n/100*l,r={sm:"h-16 w-16",md:"h-20 w-20 md:h-24 md:w-24",lg:"h-28 w-28 md:h-32 md:w-32"},o={sm:"text-base font-bold",md:"text-lg md:text-xl font-bold",lg:"text-xl md:text-2xl font-bold"};return e.jsxs("div",{className:"relative flex max-md:hidden flex-shrink-0 self-center",children:[e.jsxs("svg",{className:p(r[i],"-rotate-90 transform"),viewBox:"0 0 100 100",children:[e.jsx("circle",{cx:"50",cy:"50",r:"45",stroke:"currentColor",strokeWidth:"8",fill:"transparent",className:"text-gray-200"}),e.jsx("circle",{cx:"50",cy:"50",r:"45",stroke:"currentColor",strokeWidth:"8",fill:"transparent",strokeDasharray:l,strokeDashoffset:s,className:p("transition-all duration-1000 ease-out",t==="emerald"&&"text-emerald-500",t==="green"&&"text-green-500",t==="blue"&&"text-blue-500",t==="orange"&&"text-orange-500",t==="red"&&"text-red-500"),strokeLinecap:"round"})]}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("span",{className:p(o[i],"text-gray-900"),children:[n,"%"]})})]})}function We(a){const{questionStates:n,totalQuestions:t,onRetry:i,onNewQuiz:l,onReview:s,isFeedbackLoading:r,feedback:o}=a,u=Object.values(n),f=u.filter(d=>d.status==="correct").length,x=u.filter(d=>d.status==="incorrect").length,m=u.filter(d=>d.status==="skipped").length,c=le(f,t),h=c>=90?{level:"Excellent",color:"emerald"}:c>=75?{level:"Great",color:"green"}:c>=60?{level:"Good",color:"blue"}:c>=40?{level:"Fair",color:"orange"}:{level:"Needs Work",color:"red"},S=s&&u.some(d=>d.isSubmitted);return e.jsxs("div",{className:"mx-auto mt-8 max-w-4xl space-y-6",children:[e.jsx("div",{className:"relative overflow-hidden rounded-2xl border border-gray-200 bg-gradient-to-br from-gray-50 to-white p-6 md:p-8",children:e.jsxs("div",{className:"flex flex-col gap-6 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 md:text-3xl",children:"Quiz Complete!"}),e.jsx("p",{className:p("text-lg font-semibold",h.color==="emerald"&&"text-emerald-600",h.color==="green"&&"text-green-600",h.color==="blue"&&"text-blue-600",h.color==="orange"&&"text-orange-600",h.color==="red"&&"text-red-600"),children:h.level}),e.jsxs("p",{className:"text-sm text-gray-600 md:text-base",children:["You scored ",f," out of ",t," questions correctly"]})]}),e.jsx(Ve,{accuracy:c,color:h.color})]})}),e.jsxs("div",{className:"rounded-xl border border-gray-200 bg-white p-4 md:p-6",children:[e.jsx("h3",{className:"mb-4 text-sm font-semibold text-gray-900 md:text-base",children:"Results Breakdown"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(Y,{icon:e.jsx(_,{className:"h-4 w-4"}),label:"Correct",value:f,total:t,color:"green"}),e.jsx(Y,{icon:e.jsx(W,{className:"h-4 w-4"}),label:"Incorrect",value:x,total:t,color:"red"}),e.jsx(Y,{icon:e.jsx(ce,{className:"h-4 w-4"}),label:"Skipped",value:m,total:t,color:"gray"})]})]}),S&&t<=20&&e.jsxs("div",{className:"rounded-xl border border-gray-200 bg-white p-4 md:p-6",children:[e.jsxs("div",{className:"mb-4 flex flex-col gap-2 sm:flex-row sm:items-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ue,{className:"h-5 w-5 text-gray-600"}),e.jsx("h3",{className:"text-sm font-semibold text-gray-900 md:text-base",children:"Question Breakdown"})]}),e.jsx("span",{className:"text-sm text-gray-500 sm:ml-auto",children:"Click to review"})]}),e.jsx("div",{className:p("grid gap-2",t<=8?"grid-cols-4 sm:grid-cols-8":t<=12?"grid-cols-4 sm:grid-cols-6":"grid-cols-5"),children:u.map((d,k)=>e.jsx(me,{state:d,quizIndex:k,isActive:!0,onReview:s,className:"p-2 transition-transform duration-200"},k))})]}),e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row",children:[e.jsx(te,{variant:"secondary",icon:e.jsx(Ce,{className:"h-4 w-4"}),onClick:i,children:"Try Again"}),e.jsx(te,{variant:"secondary",icon:e.jsx(Ie,{className:"h-4 w-4"}),onClick:l,children:"New Quiz"})]}),o&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"rounded-xl border border-gray-200 bg-gray-50",children:[o.summary&&e.jsxs("div",{className:"border-b border-gray-200 p-4 md:p-6",children:[e.jsx("h4",{className:"mb-2 flex items-center text-sm font-semibold text-gray-900 md:text-base",children:"Summary of your quiz"}),e.jsx("div",{dangerouslySetInnerHTML:{__html:V(o.summary,!1)},className:p(J,"prose-sm prose-p:text-sm prose-p:leading-relaxed prose-p:text-balance")})]}),o.guideTopics?.length&&o.courseTopics?.length&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"p-4 md:p-6",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"mb-1 flex items-center text-sm font-semibold text-gray-900 md:text-base",children:"Suggested Resources"}),e.jsx("p",{className:"text-sm leading-relaxed text-balance text-gray-600",children:"You can follow these courses or guides to improve your understanding of the topic you missed in the quiz"})]}),e.jsxs("div",{className:"grid gap-2 sm:grid-cols-2",children:[o.courseTopics?.map((d,k)=>e.jsx(se,{icon:e.jsx(Re,{className:"h-5 w-5"}),title:d,type:"course",href:`/ai/course?term=${encodeURIComponent(d)}&format=course`},`course-${k}`)),o.guideTopics?.map((d,k)=>e.jsx(se,{icon:e.jsx(Te,{className:"h-5 w-5"}),title:d,type:"guide",href:`/ai/guide?term=${encodeURIComponent(d)}&format=guide`},`guide-${k}`))]})]})})]})}),r&&e.jsx("div",{className:"rounded-xl border border-gray-200 bg-white p-4 md:p-6",children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsxs("div",{className:"flex items-center gap-3 text-gray-600",children:[e.jsx("div",{className:"h-5 w-5 animate-spin rounded-full border-2 border-gray-300 border-t-gray-600"}),e.jsx("span",{className:"text-sm md:text-base",children:"Generating personalized feedback..."})]})})})]})}function Y(a){const{icon:n,label:t,value:i,total:l,color:s}=a,r=l>0?Math.round(i/l*100):0;return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:p("rounded-md p-1.5",s==="green"&&"bg-green-100 text-green-600",s==="red"&&"bg-red-100 text-red-600",s==="gray"&&"bg-gray-100 text-gray-600"),children:n}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:t})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1 text-sm text-gray-500",children:[e.jsx("span",{className:"font-semibold text-gray-900",children:i}),e.jsxs("span",{children:["(",r,"%)"]})]}),e.jsx("div",{className:"h-2 w-16 rounded-full bg-gray-200",children:e.jsx("div",{className:p("h-2 rounded-full transition-all duration-500",s==="green"&&"bg-green-500",s==="red"&&"bg-red-500",s==="gray"&&"bg-gray-400"),style:{width:`${r}%`}})})]})]})}function te(a){const{variant:n,icon:t,onClick:i,children:l}=a;return e.jsxs("button",{onClick:i,className:p("flex flex-1 items-center justify-center gap-2 rounded-xl px-4 py-3 font-medium transition-all duration-200 md:px-6",n==="primary"&&"bg-black text-white hover:bg-gray-800",n==="secondary"&&"border-2 border-gray-300 bg-white text-gray-700 hover:border-gray-400 hover:bg-gray-50"),children:[t,l]})}function se(a){const{icon:n,title:t,type:i,href:l}=a;return e.jsx("a",{href:l,className:"block rounded-lg border border-gray-200 bg-white p-2.5 text-left hover:border-gray-400 hover:bg-gray-100",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-gray-500",children:n}),e.jsx("div",{className:"truncate text-sm text-gray-900",children:t})]})})}const P={isSubmitted:!1,selectedOptions:[],userAnswer:"",correctAnswer:"",status:"pending"};function pe(a){const{quizSlug:n,questions:t,isLoading:i,isStreaming:l=!1}=a,[s,r]=N.useState(0),o=t[s],[u,f]=N.useState({}),[x,m]=N.useState("answering"),c=u[s]??P,y=s===t.length-1,{mutate:h,isPending:S,data:d,status:k,reset:I}=Fe({mutationKey:["user-quiz-result-feedback",n],mutationFn:w=>Oe(`/v1-ai-quiz-result-feedback/${n}`,w)},E),b=w=>{const Q=u[s]??P,L={...u,[s]:{...Q,isSubmitted:!0,status:w}};return f(L),L},j=w=>{f(Q=>{const L=Q[s]??P;return{...Q,[s]:{...L,userAnswer:w}}})},g=w=>{K.flushSync(()=>{f(Q=>{const L=Q[s]??P;return{...Q,[s]:{...L,correctAnswer:w}}})})},A=w=>{f(Q=>{const L=Q[s]??P;return{...Q,[s]:{...L,selectedOptions:w}}})},z=()=>{r(0),f({}),m("answering"),I()},v=s<t.length-1,C=s>0,q=t?.length??0,F=Object.values(u).filter(w=>w.status!=="pending").length===q,M=i?0:le(s+1,q),D=x==="answering"||x==="reviewing",U=()=>{if(!v){m(F?"submitted":"reviewing");return}r(s+1)},$=()=>{const w=u[s]?.status??"pending",Q=b(w==="pending"?"skipped":w);v?U():G(Q)},G=w=>{const Q=w??u;m("submitted");const L=t.map((R,X)=>{const O=Q[X];let T=`## Question ${X+1} (${R.type==="mcq"?"MCQ":"Open Ended"}): ${R.title}`;return R.type==="mcq"?(T+=`
### Options:`,R?.options?.forEach((B,xe)=>{T+=`
${xe+1}. ${B.title} (${B.isCorrect?"Correct":"Incorrect"})`}),O?.selectedOptions?.length&&(T+=`
### User Selected Answer:`,O?.selectedOptions?.forEach(B=>{T+=`
${B+1}. ${R.options[B].title}`}))):(O?.userAnswer&&(T+=`
### User Answer: ${O?.userAnswer}`),O?.correctAnswer&&(T+=`
### AI Feedback: ${O?.correctAnswer}`)),T+=`
### Final Status: ${O?.status}`,T}).join(`

`);k==="idle"&&h({questionsWithAnswers:L})};return e.jsxs("div",{className:p("flex h-full w-full flex-col",{"animate-pulse cursor-progress":l}),children:[e.jsx("div",{className:p("relative flex h-full flex-col overflow-y-auto",{"pointer-events-none":l}),children:e.jsx("div",{className:"absolute inset-0 z-10",children:e.jsxs("div",{className:"mx-auto max-w-2xl bg-white px-4 py-10",children:[D&&e.jsx(De,{activeQuestionIndex:s,totalQuestions:q,progressPercentage:M,onSkip:$,isStreaming:l,onPrevious:()=>{C&&r(s-1)},onNext:U}),x==="submitted"&&e.jsx(We,{questionStates:u,totalQuestions:q,onRetry:z,onNewQuiz:()=>{window.location.href="/ai/quiz"},onReview:w=>{r(w),m("reviewing")},isFeedbackLoading:S,feedback:d}),D&&e.jsxs(e.Fragment,{children:[o&&o.type==="mcq"&&e.jsx($e,{question:o,questionState:c,setSelectedOptions:A,onSubmit:b,onNext:U,onSkip:$,isLastQuestion:y,onComplete:G}),o&&o.type==="open-ended"&&e.jsx(_e,{quizSlug:n??"",question:o,questionState:c,onSubmit:b,onNext:U,setUserAnswer:j,setCorrectAnswer:g,isLastQuestion:y,onComplete:G,onSkip:$},o.id)]})]})})}),x==="reviewing"&&e.jsx(He,{activeQuestionIndex:s,questionStates:u,onReview:w=>{r(w),m("reviewing")},onComplete:()=>{m("submitted")}})]})}function Ge(a){const{onQuizSlugChange:n}=a,[t,i]=N.useState(!0),[l,s]=N.useState(!1),[r,o]=N.useState(""),[u,f]=N.useState([]),x=N.useRef([]),[m,c]=N.useState(!1),{isPaidUser:y,isLoading:h}=ge(),{data:S,isLoading:d}=H(oe(),E),k=h||d;N.useEffect(()=>{if(k)return;if(!y&&S&&S?.quiz?.used>=S?.quiz?.limit){o("You have reached the limit for this format"),i(!1),c(!0);return}const j=be(),g=j?.term,A=j?.format;if(j?.src,!g)return;let z=[];const v=j?.id;v&&(z=je(v)),I({term:g,format:A,questionAndAnswers:z})},[k,y]);const I=async j=>{const{term:g,format:A,isForce:z,prompt:v,questionAndAnswers:C}=j;if(!we()){window.location.href="/ai";return}await ve({term:g,format:A,isForce:z,prompt:v,questionAndAnswers:C,onDetailsChange:q=>{const{quizId:F,quizSlug:M,title:D,userId:U}=q,$={_id:F,userId:U,title:D,slug:M,keyword:g,format:A,content:"",questionAndAnswers:C||[],questions:x.current||[],viewCount:0,lastVisitedAt:new Date,createdAt:new Date,updatedAt:new Date};E.setQueryData(ie(M).queryKey,$),n?.(M),window.history.replaceState(null,"",`/ai/quiz/${M}`)},onLoadingChange:i,onError:o,onStreamingChange:s,onQuestionsChange:q=>{f(q),x.current=q}})},b=m?e.jsx(re,{onClose:()=>{window.location.href="/ai/quiz"}}):null;return r?e.jsxs(e.Fragment,{children:[b,e.jsx("div",{className:"absolute inset-0 z-20 flex h-full flex-col items-center justify-center bg-white",children:e.jsxs("div",{className:"flex flex-col items-center justify-center gap-2",children:[e.jsx(Z,{className:"size-10 text-gray-500"}),e.jsx("p",{className:"text-center",children:r})]})})]}):t?e.jsxs(e.Fragment,{children:[b,e.jsx("div",{className:"flex h-full w-full items-center justify-center",children:e.jsx(ne,{message:"Please wait..."})})]}):e.jsxs(e.Fragment,{children:[b,e.jsx(pe,{isStreaming:l,questions:u})]})}function us(a){const{quizSlug:n}=a,[t,i]=N.useState(n),[l,s]=N.useState(!1),[r,o]=N.useState(!1),{data:u,isLoading:f,error:x}=H(ie(t),E),{data:m,isLoading:c,refetch:y}=H(oe(),E),{data:h,isLoading:S}=H(fe(),E),d=f||r||c||S;return e.jsxs(Ee,{children:[l&&e.jsx(re,{onClose:()=>s(!1)}),e.jsxs("div",{className:"relative grow",children:[d&&e.jsx("div",{className:"absolute inset-0 z-20 flex h-full flex-col items-center justify-center bg-white",children:e.jsx(ne,{message:"Loading Quiz"})}),!d&&x&&e.jsx("div",{className:"absolute inset-0 z-20 flex h-full flex-col items-center justify-center bg-white",children:e.jsxs("div",{className:"flex flex-col items-center justify-center gap-2",children:[e.jsx(Z,{className:"size-10 text-gray-500"}),e.jsx("p",{className:"text-center",children:x?.message||"Something went wrong"})]})}),t&&!x&&e.jsx(pe,{quizSlug:t,questions:u?.questions??[],isLoading:d}),!t&&!x&&e.jsx(Ge,{onQuizSlugChange:i})]})]})}export{us as AIQuiz};
