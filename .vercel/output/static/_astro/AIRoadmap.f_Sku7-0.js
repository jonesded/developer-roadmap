import{j as e}from"./jsx-runtime.D_zvdyIk.js";/* empty css                                 */import{u as H,q as h}from"./query-client.zrB8z_yM.js";import{r as t}from"./index.Z3BHPS3u.js";import{r as se}from"./index.BlPpvBlM.js";import{u as G}from"./use-toast.BdCcSTJE.js";import{A as me}from"./AITutorLayout.C8UE3Ki9.js";import{U as K}from"./UpgradeAccountModal.Bl29I556.js";import{a as E,g as oe}from"./ai-roadmap.Drk75MKl.js";import{g as de}from"./browser.3c2kCsRM.js";import{i as S}from"./jwt.1xGNZsvU.js";import{L as X}from"./LoadingChip.D-JeWbx4.js";import{g as ce}from"./ai-questions.CsV5uBnQ.js";import{c as ae}from"./classname.y9b8gBZq.js";import{u as ue}from"./use-outside-click.DYGsxgbd.js";import{M as pe,U as ge}from"./UpdatePreferences.CHMvPXOt.js";import{u as W}from"./useMutation.BxVH4XRI.js";import{a as Z}from"./query-http.Bohx3EqF.js";import{generateAIRoadmapFromText as fe}from"./index.Dgut0sTl.js";import{s as A}from"./popup.CdCAhVM2.js";import{u as he}from"./use-auth.Bw1nhFr_.js";import{S as V}from"./square-pen.CCkK4Twl.js";import{S as xe}from"./settings.Dhc_ymfO.js";import{R as we}from"./refresh-ccw.C3KtdZ75.js";import{S as je}from"./save.DQvlv1cT.js";import{L as be}from"./loader-circle.DfB4mNyf.js";import{u as ye,b as re}from"./billing.Dog7Gwv_.js";import{a as Y}from"./ai-course.m2sFB2uK.js";import{u as ve}from"./use-chat.vjZ8OmFF.js";import{a as O,C as Se}from"./UpdatePersonaModal.DDvWJn3q.js";import{C as ee}from"./RoadmapFloatingChat.C08qZFUn.js";import{m as Ce}from"./markdown.CL3gtrVM.js";import{g as Ne}from"./is-mobile.CWj1ep7V.js";import{M as ke}from"./message-circle.C1uJbl19.js";import{B as Le}from"./bot.CQ2bIWO6.js";import{X as Re}from"./x.BOdyWiWF.js";import{T as Ae}from"./trash-2.CIQaIo_h.js";import{A as Ie}from"./arrow-down.By3C5FNs.js";import{L as te}from"./lock.C0C-BW9S.js";import{S as Ue}from"./send.BVE6djDn.js";import{C as Te}from"./circle-alert.DQNBwVc5.js";import"./index.Bbp-6C1p.js";import"./toast.DlejBBdi.js";import"./index.3whys8t3.js";import"./AILimitsPopup.D5_oZcjJ.js";import"./Modal.NtjGPDbq.js";import"./use-keydown.r409VyJJ.js";import"./number.DnDLgi2j.js";import"./gift.C1ExsHI3.js";import"./createLucideIcon.BSLrQS80.js";import"./auth.Blx_4y9V.js";import"./DropdownMenu.DLecQPzF.js";import"./Combination.CkJeYjFl.js";import"./floating-ui.dom.BG6dflv2.js";import"./fp.esm.CznIeghd.js";import"./chevron-right.B-RYTm0N.js";import"./check.DflWYpXj.js";import"./circle.D81F4kBU.js";import"./chevron-down.pBq1owZr.js";import"./user-round.D2mOPNuO.js";import"./credit-card.bcfoan7u.js";import"./log-out.DpAdf0Mt.js";import"./UpgradeSidebarCard.D8r3kRrD.js";import"./zap.BNbCfd_G.js";import"./plus.CstxCH0M.js";import"./swords.C6qRCXus.js";import"./map.DuWy2ZcB.js";import"./book-open.Dsgc4gH7.js";import"./star.B-cQRnHp.js";import"./RoadmapLogo.CJwoV5Wp.js";import"./menu.B2j5jEPR.js";import"./UpdatePlanConfirmation.NT5hFl0c.js";import"./VerifyUpgrade.B0n18ihL.js";import"./circle-check-big.CnV0y9bI.js";import"./ai.DmXEK0i3.js";import"./index.browser.OxPLOBIU.js";import"./chat.C-0TRz4N.js";import"./js.cookie.Cz0CWeBA.js";import"./QuestionAnswerChat.BBebMkga.js";import"./CheckIcon.D4OhQ5l1.js";import"./Tooltip.CCudSue-.js";import"./Popover.j-Qljcb0.js";import"./ListChatHistory.B5hG0Bws.js";/* empty css                          */import"./use-copy-text.D2rWbbuk.js";import"./copy.CgTXj779.js";import"./roadmap-tree.CTIkvlIr.js";import"./resource-progress.BKggaGKm.js";import"./http.BJhNQusg.js";import"./roadmap.DwTTnFhR.js";import"./index.BHh4vvK5.js";import"./page.DyYQD7MX.js";import"./share.CLihwtJm.js";import"./datetime.BHfGb2kO.js";import"./use-debounce.CXZLeMbB.js";import"./search.CUAljTEc.js";import"./ellipsis-vertical.Di0fjBX0.js";import"./Spinner.CPY-6wbR.js";import"./dom.B_TnKQIa.js";import"./slugger.rj1cS6co.js";import"./TopicDetail.DY0BfPvF.js";import"./GitHubIcon.NZCYHAdm.js";import"./vue.BIhB9hsv.js";import"./transition.MUZrSsh7.js";import"./head.CbjsIJ-A.js";import"./earth.ApD3nwNq.js";import"./wand-sparkles.8eLpe3am.js";import"./react-textarea-autosize.browser.esm.CREEQHIU.js";import"./AICourseLessonChat.TSA60raE.js";/* empty css                        */import"./list.CXlwBFwN.js";import"./book-open-text.BTmii8Os.js";import"./brain.DU33CjMf.js";import"./file-text.BpqfdBL4.js";import"./heart-handshake.ChP6KiKS.js";import"./ban.BRPE8iYC.js";import"./person-standing.DxKAUQm4.js";import"./preload-helper.BlTxHScW.js";function Me(x){const{onRegenerate:a,roadmapSlug:s}=x,m=G(),[g,d]=t.useState(!1),[l,C]=t.useState(!1),[w,j]=t.useState(!1),[c,b]=t.useState(!1),f=he(),v=t.useRef(null);ue(v,()=>d(!1));const{data:i}=H(E(s),h),{mutate:N,isPending:I}=W({mutationFn:o=>Z(`/v1-update-ai-roadmap-preferences/${s}`,{questionAndAnswers:o}),onSuccess:(o,p)=>{h.setQueryData(E(s).queryKey,n=>n&&{...n,questionAndAnswers:p}),b(!1),d(!1),a()}},h),k=async()=>{const{nodes:o,edges:p}=fe(i?.data||"");return Z(`/v1-save-ai-roadmap/${i?._id}`,{title:i?.term,nodes:o.map(n=>({...n,width:void 0,height:void 0,style:{...n.style,width:void 0,height:void 0},measured:{width:void 0,height:void 0}})),edges:p})},{mutate:T,isPending:U}=W({mutationFn:k,onSuccess:o=>{if(!o?.roadmapId){m.error("Something went wrong");return}window.location.href=`/r/${o?.roadmapSlug}`}},h),{mutate:M,isPending:R}=W({mutationFn:k,onSuccess:o=>{if(!o?.roadmapId){m.error("Something went wrong");return}window.open(`undefined/${o?.roadmapId}`,"_blank")}},h),y=f?.id===i?.userId,u=i?.questionAndAnswers&&i.questionAndAnswers.length>0&&y;return e.jsxs(e.Fragment,{children:[l&&e.jsx(K,{onClose:()=>{C(!1)}}),w&&e.jsx(pe,{description:"Pass additional information to the AI to generate a roadmap.",onClose:()=>j(!1),onSubmit:o=>{j(!1),a(o)}}),c&&e.jsx(ge,{onClose:()=>b(!1),questionAndAnswers:i?.questionAndAnswers,term:i?.term||"",format:"roadmap",onUpdatePreferences:o=>{N(o)},isUpdating:I}),e.jsxs("div",{ref:v,className:"relative flex items-stretch",children:[e.jsx("button",{className:ae("rounded-md px-2.5 text-gray-400 hover:text-black",{"text-black":g}),onClick:()=>d(!g),children:e.jsx(V,{className:"text-current",size:16,strokeWidth:2.5})}),g&&e.jsxs("div",{className:"absolute top-full right-0 min-w-[190px] translate-y-1 overflow-hidden rounded-md border border-gray-200 bg-white shadow-md",children:[y&&e.jsxs(e.Fragment,{children:[u&&e.jsx($,{onClick:()=>{if(!S()){A();return}d(!1),b(!0)},icon:xe,label:"Update Preferences"}),e.jsx($,{onClick:()=>{if(!S()){A();return}d(!1),a()},icon:we,label:"Regenerate"}),e.jsx($,{onClick:()=>{if(!S()){A();return}d(!1),j(!0)},icon:V,label:"Modify Prompt"}),e.jsx("hr",{className:"my-1 border-gray-200"})]}),e.jsx($,{onClick:()=>{if(!S()){A();return}T()},icon:je,label:"Start Learning",isLoading:U}),e.jsx($,{onClick:()=>{if(!S()){A();return}M()},icon:V,label:"Edit in Editor",isLoading:R})]})]})]})}function $(x){const{onClick:a,isLoading:s,icon:m,label:g}=x;return e.jsxs("button",{className:"flex w-full items-center gap-2.5 px-3 py-2 text-left text-sm text-gray-600 hover:bg-gray-100",onClick:a,disabled:s,children:[s?e.jsx(be,{className:"animate-spin",size:16,strokeWidth:2.5}):e.jsx(m,{size:16,className:"text-gray-400",strokeWidth:2.5}),g]})}function Pe(x){const a=x?.closest("g")||{},s=a?.dataset?.nodeId,m=a?.dataset?.type,g=a?.dataset?.title,d=a?.dataset?.parentTitle,l=a?.dataset?.parentId;return!s||!m?null:{nodeId:s,nodeType:m,targetGroup:a,nodeTitle:g,parentTitle:d,parentId:l}}const De=["topic","subtopic","button","link-item"];function ie(x){const{isLoading:a,svgHtml:s,onRegenerate:m,roadmapSlug:g,onNodeClick:d}=x,l=t.useCallback(C=>{if(a)return;const w=C.target,{nodeId:j,nodeType:c,targetGroup:b,nodeTitle:f,parentTitle:v}=Pe(w)||{};if(!(!j||!c||!De.includes(c)||!f)){if(c==="button"||c==="link-item"){const i=b?.dataset?.link||"";i.startsWith("http")?window.open(i,"_blank"):window.location.href=i;return}d?.({nodeId:j,nodeType:c,nodeTitle:f,...c==="subtopic"&&{parentTitle:v}})}},[a,d]);return e.jsxs("div",{className:ae("relative mx-auto w-full max-w-7xl",a&&"min-h-full"),children:[e.jsx("div",{id:"roadmap-container",className:"relative min-h-[400px] [&>svg]:mx-auto",dangerouslySetInnerHTML:{__html:s},onClick:l}),a&&!s&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx(X,{message:"Please wait..."})}),m&&!a&&g&&e.jsx("div",{className:"absolute top-4 right-4",children:e.jsx(Me,{onRegenerate:m,roadmapSlug:g})})]})}function Ee(x){const{onRoadmapSlugChange:a}=x,[s,m]=t.useState(!0),[g,d]=t.useState(!1),[l,C]=t.useState(""),[w,j]=t.useState(!1),[c,b]=t.useState(""),[f,v]=t.useState(""),i=t.useRef(null),{isPaidUser:N,isLoading:I}=ye(),{data:k,isLoading:T}=H(Y(),h),U=I||T;t.useEffect(()=>{if(U)return;if(!N&&k&&k?.roadmap?.used>=k?.roadmap?.limit){C("You have reached the limit for this format"),m(!1),j(!0);return}const y=de(),u=y?.term;if(y?.src,!u)return;let o=[];const p=y?.id;p&&(o=ce(p)),M({term:u,questionAndAnswers:o})},[U,N]);const M=async y=>{const{term:u,isForce:o,prompt:p,questionAndAnswers:n}=y;if(!S()){window.location.href="/ai";return}await oe({term:u,isForce:o,prompt:p,questionAndAnswers:n,onDetailsChange:P=>{const{roadmapId:F,roadmapSlug:q,title:z,userId:Q}=P,B={_id:F,userId:Q,title:z,term:u,data:f,questionAndAnswers:n,viewCount:0,svgHtml:i.current||"",lastVisitedAt:new Date,createdAt:new Date,updatedAt:new Date};h.setQueryData(E(q).queryKey,B),a?.(q),window.history.replaceState(null,"",`/ai-roadmaps/${q}`)},onLoadingChange:m,onError:C,onStreamingChange:d,onRoadmapSvgChange:P=>{const F=P.outerHTML;i.current=F,b(F)}})},R=w?e.jsx(K,{onClose:()=>{window.location.href="/ai"}}):null;return l?e.jsxs(e.Fragment,{children:[R,e.jsx("div",{className:"text-red-500",children:l})]}):s?e.jsxs(e.Fragment,{children:[R,e.jsx("div",{className:"flex h-full w-full items-center justify-center",children:e.jsx(X,{message:"Please wait..."})})]}):e.jsxs(e.Fragment,{children:[R,e.jsx(ie,{isLoading:s,svgHtml:c})]})}function He(x){const{roadmapSlug:a,isRoadmapLoading:s,onUpgrade:m,aiChatActionsRef:g}=x,d=G(),l=t.useRef(null),C=t.useRef(null),[w,j]=t.useState(""),[c,b]=t.useState(!1),[f,v]=t.useState(!0),[i,N]=t.useState(!1),{data:I,isLoading:k,refetch:T}=H(Y(),h),{data:U,isLoading:M}=H(re(),h),R=(I?.used||0)>=(I?.limit||0),y=U?.status==="active",{messages:u,status:o,streamedMessageHtml:p,sendMessages:n,setMessages:P,stop:F}=ve({endpoint:"undefined/v1-ai-roadmap-chat",onError:r=>{console.error(r),d.error(r?.message||"Something went wrong")},data:{aiRoadmapSlug:a},onFinish:()=>{T()}}),q=t.useCallback((r="smooth")=>{l.current?.scrollTo({top:l.current.scrollHeight,behavior:r})},[l]),z=o==="streaming",Q=u.length>0,B=t.useCallback(r=>{const L=r||w;if(!S()){A();return}if(z)return;const D=[...u,{role:"user",content:L,html:Ce(L)}];se.flushSync(()=>{P(D)}),n(D),j(""),setTimeout(()=>{q("smooth")},0)},[w,z,u,n,P]),_=t.useCallback(()=>{const r=l.current;if(!r)return;const{scrollTop:L,scrollHeight:D,clientHeight:ne}=r,le=L+ne>=D-50;b(!le&&u.length>0)},[u.length]);t.useEffect(()=>{const r=l.current;if(r)return r.addEventListener("scroll",_),()=>r.removeEventListener("scroll",_)},[_]);const J=s||k||M;return t.useLayoutEffect(()=>{const r=Ne(),L=["sm","md"].includes(r);if(L)v(!L);else{const D=localStorage.getItem("chat-history-sidebar-open");v(D===null?!0:D==="true")}N(L)},[]),t.useEffect(()=>{i||localStorage.setItem("chat-history-sidebar-open",f.toString())},[f,i]),t.useImperativeHandle(g,()=>({handleNodeClick:r=>{B(`Explain what is "${r.nodeTitle}" topic in detail.`)}})),f?e.jsxs("div",{className:"absolute inset-0 flex h-full w-full max-w-full flex-col overflow-hidden border-l border-gray-200 bg-white md:relative md:max-w-[40%]",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 border-b border-gray-200 bg-white p-2",children:[e.jsxs("h2",{className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(Le,{className:"h-4 w-4"}),"AI Roadmap"]}),e.jsx("button",{className:"mr-2 flex size-5 items-center justify-center rounded-md text-gray-500 hover:bg-gray-300 md:hidden",onClick:()=>{v(!1)},children:e.jsx(Re,{className:"h-3.5 w-3.5"})})]}),J&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-100",children:e.jsx(X,{message:"Loading..."})}),!J&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"relative grow overflow-y-auto",ref:l,children:e.jsx("div",{className:"absolute inset-0 flex flex-col",children:e.jsx("div",{className:"relative flex grow flex-col justify-end",children:e.jsxs("div",{className:"flex flex-col justify-end gap-2 px-3 py-2",children:[e.jsx(O,{role:"assistant",html:"Hello, how can I help you today?",isIntro:!0}),u.map((r,L)=>e.jsx(O,{...r},`chat-${L}`)),o==="streaming"&&!p&&e.jsx(O,{role:"assistant",html:"Thinking..."}),o==="streaming"&&p&&e.jsx(O,{role:"assistant",html:p})]})})})}),(Q||c)&&e.jsxs("div",{className:"flex flex-row justify-between gap-2 border-t border-gray-200 px-3 py-2",children:[e.jsx(ee,{icon:e.jsx(Ae,{className:"h-3.5 w-3.5"}),className:"rounded-md bg-gray-200 py-1 pr-2 pl-1.5 text-gray-500 hover:bg-gray-300",onClick:()=>{P([])},children:"Clear"}),c&&e.jsx(ee,{icon:e.jsx(Ie,{className:"h-3.5 w-3.5"}),className:"rounded-md bg-gray-200 py-1 pr-2 pl-1.5 text-gray-500 hover:bg-gray-300",onClick:()=>{q("smooth")},children:"Scroll to bottom"})]}),e.jsxs("div",{className:"relative flex items-center border-t border-gray-200 text-sm",children:[R&&S()&&e.jsxs("div",{className:"absolute inset-0 z-10 flex items-center justify-center gap-2 bg-black text-white",children:[e.jsx(te,{className:"size-4 cursor-not-allowed",strokeWidth:2.5}),e.jsxs("p",{className:"cursor-not-allowed",children:["Limit reached for today",y?". Please wait until tomorrow.":""]}),!y&&e.jsx("button",{onClick:()=>{m?.()},className:"rounded-md bg-white px-2 py-1 text-xs font-medium text-black hover:bg-gray-300",children:"Upgrade for more"})]}),!S()&&e.jsxs("div",{className:"absolute inset-0 z-10 flex items-center justify-center gap-2 bg-black text-white",children:[e.jsx(te,{className:"size-4 cursor-not-allowed",strokeWidth:2.5}),e.jsx("p",{className:"cursor-not-allowed",children:"Please login to continue"}),e.jsx("button",{onClick:()=>{A()},className:"rounded-md bg-white px-2 py-1 text-xs font-medium text-black hover:bg-gray-300",children:"Login / Register"})]}),e.jsx("input",{ref:C,type:"text",value:w,onChange:r=>j(r.target.value),autoFocus:!0,onKeyDown:r=>{if(r.key==="Enter"){if(r.preventDefault(),z)return;B()}},placeholder:"Ask me anything about this roadmap...",className:"w-full resize-none px-3 py-4 outline-none"}),e.jsx("button",{className:"absolute top-1/2 right-2 -translate-y-1/2 p-1 text-zinc-500 hover:text-black disabled:opacity-50",onClick:()=>{if(!S()){A();return}if(o!=="idle"){F();return}B()},children:z?e.jsx(Se,{className:"h-4 w-4"}):e.jsx(Ue,{className:"h-4 w-4"})})]})]})]}):e.jsx("div",{className:"absolute inset-x-0 bottom-0 flex justify-center p-2",children:e.jsxs("button",{className:"flex items-center justify-center gap-2 rounded-full bg-black px-4 py-2 text-white shadow",onClick:()=>{v(!0)},children:[e.jsx(ke,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:"Open Chat"})]})})}function Gs(x){const{roadmapSlug:a}=x,[s,m]=t.useState(a),g=G(),[d,l]=t.useState(!1),[C,w]=t.useState(!1),[j,c]=t.useState(null),b=t.useRef(null),{data:f,isLoading:v,error:i}=H(E(s),h),{data:N,isLoading:I,refetch:k}=H(Y(),h),{data:T,isLoading:U}=H(re(),h),M=(N?.used||0)>=(N?.limit||0),R=T?.status==="active",y=async p=>{if(!S()){A();return}if(!R&&M){l(!0);return}se.flushSync(()=>{w(!0),c(null)}),h.cancelQueries(E(s)),h.setQueryData(E(s).queryKey,n=>n&&{...n,data:"",svgHtml:""}),c(""),await oe({roadmapSlug:f?.slug||"",term:f?.term||"",prompt:p,isForce:!0,onStreamingChange:w,onRoadmapSvgChange:n=>{c(n.outerHTML)},onError:n=>{g.error(n)},onFinish:()=>{w(!1),k(),h.invalidateQueries(E(s))}})},u=v||C||I||U,o=t.useCallback(p=>{b.current?.handleNodeClick(p)},[b]);return e.jsxs(me,{wrapperClassName:"flex-row p-0 lg:p-0 overflow-hidden relative bg-white",containerClassName:"h-[calc(100vh-49px)] overflow-hidden relative",children:[d&&e.jsx(K,{onClose:()=>l(!1)}),!u&&i&&e.jsx("div",{className:"absolute inset-0 z-10 flex h-full flex-col items-center justify-center bg-white",children:e.jsxs("div",{className:"flex flex-col items-center justify-center gap-2",children:[e.jsx(Te,{className:"size-10 text-gray-500"}),e.jsx("p",{className:"text-center",children:i?.message||"Something went wrong"})]})}),e.jsxs("div",{className:"grow overflow-y-auto p-4 pt-0",children:[s&&!i&&e.jsx(ie,{svgHtml:j??f?.svgHtml??"",isLoading:u,onRegenerate:y,roadmapSlug:s,onNodeClick:o}),!s&&!i&&e.jsx(Ee,{onRoadmapSlugChange:m})]}),e.jsx(He,{roadmapSlug:s,isRoadmapLoading:!f,onUpgrade:()=>l(!0),aiChatActionsRef:b})]})}export{Gs as AIRoadmap};
