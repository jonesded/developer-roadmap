import{O as c}from"./index.gjAxZpWu.js";import{i as d}from"./jwt.1xGNZsvU.js";import{a as h,u as p,r as u,b as l}from"./resource-progress.BKggaGKm.js";import{p as o}from"./page.DyYQD7MX.js";import{s as g}from"./popup.CdCAhVM2.js";import{r as m}from"./dom.B_TnKQIa.js";import{s as f}from"./browser.3c2kCsRM.js";import"./js.cookie.Cz0CWeBA.js";import"./http.BJhNQusg.js";import"./fp.esm.CznIeghd.js";import"./roadmap.DwTTnFhR.js";import"./index.BHh4vvK5.js";import"./index.3whys8t3.js";class T{resourceId;resourceType;jsonUrl;loaderHTML;containerId;loaderId;constructor(){this.resourceId="",this.resourceType="",this.jsonUrl="",this.loaderHTML=null,this.containerId="resource-svg-wrap",this.loaderId="resource-loader",this.init=this.init.bind(this),this.onDOMLoaded=this.onDOMLoaded.bind(this),this.jsonToSvg=this.jsonToSvg.bind(this),this.handleSvgClick=this.handleSvgClick.bind(this),this.handleSvgRightClick=this.handleSvgRightClick.bind(this),this.prepareConfig=this.prepareConfig.bind(this),this.switchRoadmap=this.switchRoadmap.bind(this),this.updateTopicStatus=this.updateTopicStatus.bind(this)}get loaderEl(){return document.getElementById(this.loaderId)}get containerEl(){return document.getElementById(this.containerId)}prepareConfig(){if(!this.containerEl)return!1;this.loaderHTML=this.loaderEl?.innerHTML;const t=this.containerEl.dataset;return this.resourceType=t.resourceType,this.resourceId=t.resourceId,!0}jsonToSvg(t){return t?this.containerEl?(this.containerEl.innerHTML=this.loaderHTML,fetch(t).then(e=>e.json()).then(e=>c(e,{fontURL:"/fonts/balsamiq.woff2"})).then(e=>{m(this.containerEl,e)}).then(()=>h(this.resourceType,this.resourceId)).catch(e=>{if(!this.containerEl)return;const r=`
          <strong>There was an error.</strong><br>
          
          Try loading the page again. or submit an issue on GitHub with following:<br><br>

          ${e.message} <br /> ${e.stack}
        `;this.containerEl.innerHTML=`<div class="error py-5 text-center text-red-600 mx-auto">${r}</div>`})):null:(console.error("jsonUrl not defined in frontmatter"),null)}onDOMLoaded(){if(!this.prepareConfig())return;const e=new URLSearchParams(window.location.search).get("r");e?this.switchRoadmap(`/${e}.json`):this.jsonToSvg(this.resourceType==="roadmap"?`/${this.resourceId}.json`:`/best-practices/${this.resourceId}.json`)}switchRoadmap(t){this.containerEl?.setAttribute("style","");const e=t.split("/").pop()?.replace(".json",""),r=this.resourceType[0];f({[r]:e}),this.jsonToSvg(t)?.then(()=>{})}updateTopicStatus(t,e){if(!d()){g();return}/^check:/.test(t)&&(t=t.replace("check:","")),o.set("Updating progress"),p({resourceId:this.resourceId,resourceType:this.resourceType,topicId:t},e).then(()=>{u(t,e),l()}).catch(r=>{alert("Something went wrong, please try again."),console.error(r)}).finally(()=>{o.set("")})}handleSvgRightClick(t){const e=t.target?.closest("g")||{},r=e.dataset?e.dataset.groupId:"";if(!r||e.classList.contains("removed"))return;t.preventDefault();const i=e.classList.contains("done"),n=r.replace(/^\d+-/,"");n.startsWith("ext_link:")||this.updateTopicStatus(n,i?"pending":"done")}handleSvgClick(t){const e=t.target?.closest("g")||{},r=e.dataset?e.dataset.groupId:"";if(!r||(t.stopImmediatePropagation(),e.classList.contains("removed")))return;if(/^ext_link/.test(r)){const s=r.replace("ext_link:","");s.startsWith("roadmap.sh")?window.location.href=`https://${s}`:(window.fireEvent({category:"RoadmapExternalLink",action:`${this.resourceType} / ${this.resourceId}`,label:s}),window.open(`https://${s}`));return}if(/^json:/.test(r)){const s=r.replace("json:","");this.switchRoadmap(s);return}if(/^check:/.test(r)){window.dispatchEvent(new CustomEvent(`${this.resourceType}.topic.toggle`,{detail:{topicId:r.replace("check:",""),resourceType:this.resourceType,resourceId:this.resourceId}}));return}const i=r.replace(/^\d+-/,""),n=e.classList.contains("learning"),a=e.classList.contains("skipped");if(t.shiftKey){t.preventDefault(),this.updateTopicStatus(i,n?"pending":"learning");return}if(t.altKey){t.preventDefault(),this.updateTopicStatus(i,a?"pending":"skipped");return}window.dispatchEvent(new CustomEvent(`${this.resourceType}.topic.click`,{detail:{topicId:i,resourceId:this.resourceId,resourceType:this.resourceType}}))}init(){window.addEventListener("DOMContentLoaded",this.onDOMLoaded),window.addEventListener("click",this.handleSvgClick),window.addEventListener("contextmenu",this.handleSvgRightClick)}}const w=new T;w.init();
