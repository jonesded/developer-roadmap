import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{Q as me,i as Y,e as pe,f as he,j as ge,a as z,q as S,u as _}from"./query-client.zrB8z_yM.js";import{h as R,a as ae,b as xe}from"./query-http.BQfMbvYq.js";import{i as H,r as fe}from"./jwt.1xGNZsvU.js";import{a as U,m as ye}from"./markdown.CL3gtrVM.js";/* empty css                          */import{r as u}from"./index.Z3BHPS3u.js";import{r as Q}from"./index.BlPpvBlM.js";import{c as P}from"./classname.y9b8gBZq.js";import{u as ne}from"./use-copy-text.D2rWbbuk.js";import{T as be}from"./Tooltip.CCudSue-.js";import{C as oe}from"./check.DflWYpXj.js";import{C as je}from"./copy.CgTXj779.js";import{c as $}from"./createLucideIcon.BSLrQS80.js";import{M as ve}from"./Modal.NtjGPDbq.js";import{C as we}from"./chevron-down.pBq1owZr.js";import{u as B}from"./useMutation.BxVH4XRI.js";import{u as q}from"./use-toast.BdCcSTJE.js";import{s as Ne}from"./popup.CdCAhVM2.js";import{L as M}from"./loader-circle.DfB4mNyf.js";import{M as Ce}from"./message-circle.C1uJbl19.js";import{n as D}from"./index.browser.OxPLOBIU.js";import{a as Z}from"./ai-course.DbIkPj3f.js";import{u as W,r as ie}from"./roadmap-tree.4A86E_mN.js";import{g as Se}from"./number.DnDLgi2j.js";import{r as le,u as ke}from"./resource-progress.DnX2IG6-.js";import{p as ce}from"./page.DyYQD7MX.js";import{C as E}from"./CheckIcon.D4OhQ5l1.js";import{C as de}from"./chevron-right.B-RYTm0N.js";import{u as Ie}from"./use-auth.Bw1nhFr_.js";import{S as Pe}from"./share.CLihwtJm.js";import{renderFlowJSON as Le}from"./index.Dgut0sTl.js";import{r as Me}from"./chat.C-0TRz4N.js";import{C as Te}from"./circle-alert.DQNBwVc5.js";import{g as Re}from"./is-mobile.CWj1ep7V.js";import{D as ee}from"./datetime.BHfGb2kO.js";import{u as Fe}from"./use-debounce.CXZLeMbB.js";import{S as Oe}from"./search.CUAljTEc.js";import{X as De}from"./x.BOdyWiWF.js";import{D as ze,a as He,b as Ae,c as te}from"./DropdownMenu.DLecQPzF.js";import"./js.cookie.Cz0CWeBA.js";import"./roadmap.DwTTnFhR.js";import{E as Ee}from"./ellipsis-vertical.Di0fjBX0.js";import{T as $e}from"./trash-2.CIQaIo_h.js";import{P as se}from"./plus.CstxCH0M.js";import{L as qe}from"./lock.C0C-BW9S.js";var Ue=class extends me{constructor(s,t){super(s,t)}bindMethods(){super.bindMethods(),this.fetchNextPage=this.fetchNextPage.bind(this),this.fetchPreviousPage=this.fetchPreviousPage.bind(this)}setOptions(s){super.setOptions({...s,behavior:Y()})}getOptimisticResult(s){return s.behavior=Y(),super.getOptimisticResult(s)}fetchNextPage(s){return this.fetch({...s,meta:{fetchMore:{direction:"forward"}}})}fetchPreviousPage(s){return this.fetch({...s,meta:{fetchMore:{direction:"backward"}}})}createResult(s,t){const{state:n}=s,a=super.createResult(s,t),{isFetching:r,isRefetching:o,isError:l,isRefetchError:i}=a,c=n.fetchMeta?.fetchMore?.direction,p=l&&c==="forward",m=r&&c==="forward",h=l&&c==="backward",b=r&&c==="backward";return{...a,fetchNextPage:this.fetchNextPage,fetchPreviousPage:this.fetchPreviousPage,hasNextPage:he(t,n.data),hasPreviousPage:pe(t,n.data),isFetchNextPageError:p,isFetchingNextPage:m,isFetchPreviousPageError:h,isFetchingPreviousPage:b,isRefetchError:i&&!p&&!h,isRefetching:o&&!m&&!b}}};function _e(s,t){return ge(s,Ue,t)}/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Be=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"m16 15-3-3 3-3",key:"14y99z"}]],Qe=$("panel-left-close",Be);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 3v18",key:"fh3hqa"}]],Ge=$("panel-left",Ke);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Je=[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]],We=$("rotate-cw",Je);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ve=[["path",{d:"M21 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h6",key:"y09zxi"}],["path",{d:"m21 3-9 9",key:"mpx6sq"}],["path",{d:"M15 3h6v6",key:"1q9fwt"}]],Xe=$("square-arrow-out-up-right",Ve);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ye=[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}]],Ze=$("trash",Ye),hs=u.memo(s=>{const{chatHistory:t,onDelete:n,isStreamingMessage:a,streamedMessage:r,onRegenerate:o}=s;return e.jsx("div",{className:"flex grow flex-col",children:e.jsx("div",{className:"relative flex grow flex-col justify-end",children:e.jsxs("div",{className:"flex grow flex-col justify-end gap-14 py-5",children:[t.map((l,i)=>e.jsx(u.Fragment,{children:e.jsx(K,{...l,onDelete:()=>{n?.(i)},onRegenerate:()=>{o?.(i)}})},`chat-${i}`)),a&&!r&&e.jsx(K,{role:"assistant",content:"",html:"<p>Thinking...</p>",showActions:!1}),r&&e.jsx(K,{role:"assistant",content:"",jsx:r,showActions:!1})]})})})}),K=u.memo(s=>{const{role:t,content:n,jsx:a,html:r,showActions:o=!0,onDelete:l,onRegenerate:i}=s,{copyText:c,isCopied:p}=ne();return e.jsxs("div",{className:P("group/content relative flex w-full flex-col",t==="user"?"items-end":"items-start"),children:[e.jsxs("div",{className:P("flex max-w-full items-start gap-2.5 rounded-lg",t==="user"?"max-w-[70%] bg-gray-200 p-3":"w-full"),children:[!!a&&a,!!r&&e.jsx("div",{className:"course-content course-ai-content prose prose-sm overflow-hidden text-sm",dangerouslySetInnerHTML:{__html:r}})]}),o&&e.jsxs("div",{className:P("absolute -bottom-2 flex translate-y-full items-center gap-1",t==="user"?"right-0":"left-0"),children:[e.jsx(G,{icon:p?oe:je,onClick:()=>c(n??""),tooltip:p?"Copied":"Copy"}),t==="assistant"&&i&&e.jsx(G,{icon:We,onClick:i,tooltip:"Regenerate"}),l&&e.jsx(G,{icon:Ze,onClick:l,tooltip:"Delete"})]})]})});function G(s){const{icon:t,onClick:n,tooltip:a}=s;return e.jsxs("div",{className:"group relative",children:[e.jsx("button",{className:"flex size-8 items-center justify-center rounded-lg opacity-0 transition-opacity group-hover/content:opacity-100 hover:bg-gray-200",onClick:n,children:e.jsx(t,{className:"size-4 stroke-[2.5]"})}),a&&e.jsx(be,{position:"top-center",additionalClass:"-translate-y-1",children:a})]})}function re(s){const{className:t,children:n,...a}=s;return e.jsxs("div",{className:"relative flex",children:[e.jsx("select",{"data-slot":"select-native",className:P("peer inline-flex w-full cursor-pointer appearance-none items-center rounded-lg border border-gray-200 text-sm text-black outline-none focus-visible:border-gray-500 disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 has-[option[disabled]:checked]:text-gray-500 aria-invalid:border-red-500 aria-invalid:ring-red-500/20 dark:aria-invalid:ring-red-500/40",s.multiple?"[&_option:checked]:bg-accent py-1 *:px-3 *:py-1":"h-9 ps-3 pe-8",t),...a,children:n}),!s.multiple&&e.jsx("span",{className:"pointer-events-none absolute inset-y-0 end-0 flex h-full w-9 items-center justify-center text-gray-500/80 peer-disabled:opacity-50 peer-aria-invalid:text-red-500/80",children:e.jsx(we,{size:16,"aria-hidden":"true"})})]})}function gs(s){return z({queryKey:["user-persona",s],queryFn:async()=>R(`/v1-user-roadmap-persona/${s}`),enabled:!!s&&H(),refetchOnMount:!1})}function et(){return z({queryKey:["user-persona"],queryFn:async()=>R("/v1-user-persona"),enabled:!!H(),refetchOnMount:!1})}const xs=u.memo(s=>{const{defaultValues:t,onClose:n}=s,a=q(),[r,o]=u.useState(t?.expertise??""),[l,i]=u.useState(t?.about??""),[c,p]=u.useState(t?.specialInstructions??""),m=["Finding a job","Learning for fun","Building a side project","Switching careers","Getting a promotion","Filling knowledge gaps","Other"],h=()=>{if(!t?.goal)return"";for(const d of m.slice(0,-1))if(t.goal.startsWith(d))return d;return"Other"},[b,j]=u.useState(h()),[v,C]=u.useState(t?.goal??""),g=u.useId(),N=u.useId(),k=u.useId(),L=u.useId(),f=u.useId(),T=u.useRef(null),A=d=>{j(d),d==="Other"?(C(""),setTimeout(()=>{T.current?.focus()},0)):C(d)},{mutate:F,isPending:x}=B({mutationFn:d=>ae("/v1-set-chat-preferences",d),onSuccess:()=>{n(),S.invalidateQueries(et())},onError:d=>{a.error(d?.message??"Something went wrong")}},S),w=d=>{if(d.preventDefault(),!H()){Ne();return}F({expertise:r,goal:v,about:l,specialInstructions:c})},y=!!r&&!!v&&!!l;return e.jsx(ve,{onClose:n,children:e.jsx("div",{className:"p-4",children:e.jsxs("form",{onSubmit:w,className:P("space-y-8"),children:[e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",htmlFor:g,children:"Rate your Experience"}),e.jsxs(re,{id:g,value:r,defaultValue:r,onChange:d=>o(d.target.value),className:"h-[40px] border-gray-300 text-sm focus:border-gray-500 focus:ring-1 focus:ring-gray-500",children:[e.jsx("option",{value:"",children:"Select your expertise"}),["No experience (just starting out)","Beginner (less than 1 year of experience)","Intermediate (1-3 years of experience)","Expert (3-5 years of experience)","Master (5+ years of experience)"].map(d=>e.jsx("option",{value:d,children:d},d))]})]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",htmlFor:k,children:"What is your goal?"}),e.jsxs(re,{id:k,value:b,onChange:d=>A(d.target.value),className:"h-[40px] border-gray-300 text-sm focus:border-gray-500 focus:ring-1 focus:ring-gray-500",children:[e.jsx("option",{value:"",children:"Select your goal"}),m.map(d=>e.jsx("option",{value:d,children:d},d))]}),b==="Other"&&e.jsx("textarea",{ref:T,id:N,className:"block min-h-24 w-full resize-none rounded-lg border border-gray-300 bg-white px-4 py-3 text-sm outline-none placeholder:text-gray-400 focus:border-gray-500 focus:ring-1 focus:ring-gray-500",placeholder:"e.g. need to find a job as soon as possible",value:v,onChange:d=>C(d.target.value)})]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",htmlFor:L,children:"Tell us more about yourself"}),e.jsx("textarea",{id:L,className:"block min-h-24 w-full resize-none rounded-lg border border-gray-300 bg-white px-4 py-3 text-sm outline-none placeholder:text-gray-400 focus:border-gray-500 focus:ring-1 focus:ring-gray-500",placeholder:"e.g. I'm a software engineer with 5 years of experience",value:l,onChange:d=>i(d.target.value)})]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",htmlFor:f,children:"Special Instructions"}),e.jsx("textarea",{id:f,className:"block min-h-24 w-full resize-none rounded-lg border border-gray-300 bg-white px-4 py-3 text-sm outline-none placeholder:text-gray-400 focus:border-gray-500 focus:ring-1 focus:ring-gray-500",placeholder:"e.g. Prefer concise responses with code examples",value:c,onChange:d=>p(d.target.value)})]}),e.jsx("button",{disabled:!y||x,type:"submit",className:"mt-6 flex h-11 w-full items-center justify-center gap-2 rounded-lg bg-black px-6 py-2 text-sm text-white transition-all hover:bg-gray-900 disabled:pointer-events-none disabled:opacity-50",children:x?e.jsx(M,{className:"size-4 animate-spin stroke-[2.5]"}):e.jsxs(e.Fragment,{children:[e.jsx(Ce,{className:"size-4"}),t?"Update Preferences":"Set Preferences"]})})]})})})});async function tt(s,t,n={isLoading:!1}){const a=[],r=Object.keys(t);if(r.length>0){const p=r.join("|");s=s.replace(new RegExp(`\`\`\`\\w*?\\n+?<(${p})>`,"g"),"<$1>"),s=s.replace(new RegExp(`<\\/(${p})>\\n+?\`\`\``,"g"),"</$1>")}if(r.length===0){const p=await U(s);return a.push({id:D(),type:"html",content:p}),a}const o=r.join("|"),l=new RegExp(`<(${o})>(.*?)</\\1>`,"gs");let i=0,c;for(;(c=l.exec(s))!==null;){const[p,m,h]=c;if(c.index>i){const j=s.slice(i,c.index),v=await U(j);a.push({id:D(),type:"html",content:v})}const b=t[m]({content:h,isLoading:n.isLoading});a.push({id:D(),type:"html",content:b}),i=l.lastIndex}for(const p of r){const m=`<${p}>`,h=s.indexOf(m,i),b=`</${p}>`,j=s.indexOf(b,i);if(h!==-1&&j===-1){if(h>i){const g=s.slice(i,h),N=await U(g);a.push({id:D(),type:"html",content:N})}const v=s.slice(h+m.length),C=t[p]({content:v,isLoading:n.isLoading});return a.push({id:D(),type:"html",content:C}),a}}if(i<s.length){const p=s.slice(i),m=await U(p);a.push({id:D(),type:"html",content:m})}return a}async function J(s,t,n={isLoading:!1}){const a=await tt(s,t,n);return e.jsx("div",{className:"max-w-[calc(100%-38px)] w-full",children:a.map(r=>{if((r.type==="html"||r.type==="text")&&typeof r.content=="string"){const o=r.content.trim();return o?e.jsx("div",{className:"course-content course-ai-content prose prose-sm mt-0.5 max-w-full overflow-hidden text-sm",dangerouslySetInnerHTML:{__html:o}},r.id):null}return r.type==="html"&&typeof r.content=="object"?e.jsx(u.Fragment,{children:r.content},r.id):null})})}function fs(s){return z({queryKey:["roadmap-json",s],queryFn:async()=>{const n=await R(`undefined/${s}.json`),a=await Le();return{json:n,svg:a}},refetchOnMount:!1})}function st(){return z({queryKey:["built-in-roadmaps"],queryFn:()=>R("undefined/pages.json"),select:s=>s.filter(t=>t?.group?.toLowerCase()==="roadmaps").map(t=>({id:t.id,title:t.title,url:t.url,renderer:t.renderer})),refetchOnMount:!1})}function ys(s){return z({queryKey:["roadmap-details",s],queryFn:async()=>{const a=(await R("undefined/pages.json")).find(r=>r?.group?.toLowerCase()==="roadmaps"&&r.id===s);if(!a)throw new Error("Roadmap details not found");return a},refetchOnMount:!1})}function rt(s){const t=[],n=/<roadmap-slug>.*?<\/roadmap-slug>/gs,a=s.match(n);if(!a)return t;for(const r of a){const o=/<roadmap-slug>(.*?)<\/roadmap-slug>/,l=r.match(o)?.[1]?.trim();l&&t.push({roadmapSlug:l})}return t}function at(s){const{content:t}=s,n=rt(t),{data:a}=_(st(),S),r=u.useMemo(()=>n.map(o=>{const l=a?.find(i=>i.id===o.roadmapSlug);return{...o,title:l?.title}}),[n,a]);return e.jsx(e.Fragment,{children:e.jsx("div",{className:"relative my-6 flex flex-wrap gap-1 first:mt-0 last:mb-0",children:r.map(o=>e.jsxs("a",{href:`/${o.roadmapSlug}/ai`,target:"_blank",className:"group flex items-center gap-2 rounded-lg border border-gray-200 bg-white px-2.5 py-1.5 text-left text-sm text-gray-700 transition-all hover:border-gray-400 hover:text-black active:bg-gray-100",children:[o.title,e.jsx(Xe,{className:"size-3.5 ml-1 text-gray-400 transition-transform group-hover:text-gray-600"})]},o.roadmapSlug))})})}function nt(s){const{totalTopicCount:t,roadmapId:n}=s,{data:a}=_(W("roadmap",n),S),r=a?.done?.length??0,o=a?.skipped?.length??0,l=r+o,i=Se(l,t);return e.jsxs("div",{className:"relative my-6 flex flex-col gap-3 rounded-xl border border-gray-200 bg-white p-4 first:mt-0 last:mb-0",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Progress"}),e.jsxs("span",{className:"rounded-full bg-gray-100 px-2 py-0.5 text-xs font-medium text-gray-700",children:[i,"%"]})]}),e.jsxs("span",{className:"hidden text-sm font-medium text-gray-600 md:block",children:[l," / ",t," topics"]})]}),e.jsx("div",{className:"relative h-2 w-full overflow-hidden rounded-full bg-gray-100",children:e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-green-500 to-green-600 transition-all duration-300",style:{width:`${i}%`}})}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-500",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"h-2 w-2 rounded-full bg-green-500"}),e.jsxs("span",{children:["Completed: ",r]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"h-2 w-2 rounded-full bg-gray-400"}),e.jsxs("span",{children:["Skipped: ",o]})]})]})]})}function ot(s){const t=[],n=/<update-progress-item>.*?<\/update-progress-item>/gs,a=s.match(n);if(!a)return t;for(const r of a){const o=/<topic-id>(.*?)<\/topic-id>/,l=r.match(o)?.[1]?.trim(),i=/<topic-action>(.*?)<\/topic-action>/,c=r.match(i)?.[1].trim()?.toLowerCase();!l||!c||t.push({id:l,action:c})}return t}function it(s){const{roadmapId:t,content:n,isLoading:a=!1}=s,r=q(),o=ot(n),{data:l}=_(ie(t),S),{mutate:i,isPending:c,isSuccess:p}=B({mutationFn:g=>ae(`/v1-bulk-update-resource-progress/${t}`,g),onSuccess:()=>(o.forEach(g=>{le(g.id,g.action)}),S.invalidateQueries(W("roadmap",t))),onSettled:()=>{ce.set("")},onError:g=>{r.error(g?.message??"Something went wrong, please try again.")}},S),m=u.useMemo(()=>o.map(g=>{const N=l?.find(k=>k.nodeId===g.id);return{...g,text:(N?.text||g.id)?.split(" > ").slice(1).join(" > ")}}),[o,l]),[h,b]=u.useState(!1),j=4,v=h?m:m.slice(0,j),C=m.length>j;return e.jsx("div",{className:"relative my-6 w-full first:mt-0 last:mb-0",children:e.jsxs("div",{className:"relative flex flex-col gap-0.5",children:[v.map(g=>e.jsx(lt,{roadmapId:t,topicId:g.id,text:g.text,action:g.action,isStreaming:a,isBulkUpdating:c,isBulkUpdateSuccess:p},g.id)),C&&e.jsxs("div",{className:"relative mt-1 flex items-center justify-between gap-2",children:[e.jsxs("button",{className:"z-50 flex items-center gap-1 rounded-md bg-gray-400 px-2 py-1 text-xs font-medium text-white hover:opacity-80 disabled:cursor-not-allowed disabled:opacity-70",onClick:()=>b(!h),disabled:a,children:[a&&e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"size-3 animate-spin"}),m.length," loaded .."]}),!a&&e.jsx(e.Fragment,{children:h?"- Show Less":`+ Show ${m.length-j} More`})]}),e.jsxs("button",{className:"z-50 flex items-center gap-1 rounded-md bg-green-600 px-2 py-1 text-xs font-medium text-white hover:bg-green-700 disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-70",disabled:c||a||p,onClick:()=>{const g=o.filter(f=>f.action==="done").map(f=>f.id),N=o.filter(f=>f.action==="learning").map(f=>f.id),k=o.filter(f=>f.action==="skipped").map(f=>f.id),L=o.filter(f=>f.action==="pending").map(f=>f.id);i({done:g,learning:N,skipped:k,pending:L})},children:[c&&e.jsx(M,{className:"size-3 animate-spin"}),!c&&e.jsx(E,{additionalClasses:"size-3"}),"Apply All"]})]})]})})}function lt(s){const{roadmapId:t,topicId:n,text:a,action:r,isStreaming:o,isBulkUpdating:l,isBulkUpdateSuccess:i}=s,c=q(),{mutate:p,isSuccess:m,isPending:h}=B({mutationFn:v=>ke({resourceId:t,resourceType:"roadmap",topicId:n},v),onMutate:()=>{},onSuccess:()=>{le(n,r)},onError:()=>{c.error("Something went wrong, please try again.")},onSettled:()=>(ce.set(""),S.invalidateQueries(W("roadmap",t)))},S),b=a.split(" > "),j=b.length-1;return e.jsxs("div",{className:"flex min-h-[40px] items-center justify-between gap-2 rounded-lg border border-gray-200 bg-white py-1 pr-1 pl-3",children:[e.jsx("span",{className:"flex items-center gap-1 truncate text-sm text-gray-500",children:b.map((v,C)=>e.jsxs(u.Fragment,{children:[v,C!==j&&e.jsxs("span",{className:"text-gray-500",children:[e.jsx(de,{className:"size-3 shrink-0"})," "]})]},C))}),!m&&!i&&e.jsxs(e.Fragment,{children:[!o&&e.jsxs("button",{className:P("flex shrink-0 items-center gap-1.5 rounded-md border border-gray-200 px-2 py-1 text-xs disabled:pointer-events-none disabled:opacity-40",{"bg-green-100 hover:border-green-300 hover:bg-green-200":r==="done","bg-yellow-100 hover:border-yellow-300 hover:bg-yellow-200":r==="learning","bg-gray-800 text-white hover:border-black hover:bg-black":r==="skipped","bg-gray-100 hover:border-gray-300 hover:bg-gray-200":r==="pending"}),onClick:()=>p(r),disabled:o||h||l,children:[(h||l)&&e.jsx(M,{className:"size-4 animate-spin"}),!h&&!l&&e.jsxs(e.Fragment,{children:[e.jsx(oe,{strokeWidth:3,className:"size-3"}),"Mark it as ",r]})]}),o&&e.jsx("span",{className:"flex size-[30px] items-center justify-center text-gray-300",children:e.jsx(M,{className:"size-4 animate-spin"})})]}),(m||i)&&e.jsx("span",{className:"flex size-[30px] items-center justify-center text-green-500",children:e.jsx(E,{additionalClasses:"size-4"})})]})}function ct(s){const t=[],n=/<topic-id>.*?<\/topic-id>/gs,a=s.match(n);if(!a)return t;for(const r of a){const o=/<topic-id>(.*?)<\/topic-id>/,l=r.match(o)?.[1]?.trim();l&&t.push({topicId:l})}return t}function dt(s){const{roadmapId:t,content:n,onTopicClick:a}=s,r=ct(n),{data:o}=_(ie(t),S),l=u.useMemo(()=>r.map(i=>{const c=o?.find(p=>p.nodeId===i.topicId);return{...i,text:(c?.text||i.topicId)?.split(" > ").slice(1).join(" > ")}}),[r,o]);return e.jsx("div",{className:"relative my-6 flex flex-wrap gap-1 first:mt-0 last:mb-0",children:l.map(i=>{const c=i.text.split(" > ").slice(-2),p=c.length;return e.jsx("button",{className:"collapse-if-empty flex items-center gap-1 rounded-lg border border-gray-200 bg-white p-1 px-2 text-left text-sm hover:bg-gray-50",onClick:()=>{a?.(i.topicId,i.text)},children:c.map((m,h)=>e.jsxs(u.Fragment,{children:[e.jsx("span",{children:m}),h<p-1&&e.jsx(de,{className:"size-3 text-gray-400",strokeWidth:2.5})]},h))},i.topicId)})})}function ut(s){const{roadmapId:t}=s,n=Ie(),{copyText:a,isCopied:r}=ne(),o=()=>{const l=`undefined/${t}?s=${n?.id}`;a(l)};return e.jsx("div",{className:"relative my-6 flex flex-wrap gap-1 first:mt-0 last:mb-0",children:e.jsxs("button",{className:P("flex items-center gap-1.5 rounded-lg border border-gray-200 bg-white p-1 px-1.5 text-left text-sm",r&&"text-green-500"),onClick:o,children:[!r&&e.jsxs(e.Fragment,{children:[e.jsx(Pe,{className:"h-4 w-4"}),"Share Progress"]}),r&&e.jsxs(e.Fragment,{children:[e.jsx(E,{additionalClasses:"h-4 w-4"}),"Copied"]})]})})}function mt(s){const{totalTopicCount:t,roadmapId:n,onSelectTopic:a}=s;return{"user-progress":()=>e.jsx(nt,{totalTopicCount:t,roadmapId:n}),"update-progress":r=>e.jsx(it,{roadmapId:n,...r}),"roadmap-topics":r=>e.jsx(dt,{roadmapId:n,onTopicClick:(o,l)=>{const i=l.split(" > ").pop();i&&a(o,i)},...r}),"resource-progress-link":()=>e.jsx(ut,{roadmapId:n}),"roadmap-recommendations":r=>e.jsx(at,{...r})}}function bs(s){const{activeChatHistoryId:t,roadmapId:n,totalTopicCount:a,scrollareaRef:r,onSelectTopic:o,onChatHistoryIdChange:l}=s,i=q(),[c,p]=u.useState([]),[m,h]=u.useState(!1),[b,j]=u.useState(null),[v,C]=u.useState(!1),g=u.useRef(null),N=u.useCallback((x="smooth")=>{r.current?.scrollTo({top:r.current.scrollHeight,behavior:x})},[r]),k=u.useCallback(()=>{const x=r.current;if(!x)return;const{scrollTop:w,scrollHeight:y,clientHeight:d}=x,I=w+d>=y-50;C(!I&&c.length>0)},[c.length]);u.useEffect(()=>{const x=r.current;if(x)return x.addEventListener("scroll",k),()=>x.removeEventListener("scroll",k)},[k]),u.useEffect(()=>{if(m||b){const x=r.current;if(!x)return;const{scrollTop:w,scrollHeight:y,clientHeight:d}=x;w+d>=y-100&&(N("instant"),C(!1))}},[m,b,N]);const L=u.useMemo(()=>mt({roadmapId:n,totalTopicCount:a,onSelectTopic:o}),[n,o,a]),f=async(x,w)=>{try{const y=await fetch("https://api.roadmap.sh/v1-chat-roadmap",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",signal:w?.signal,body:JSON.stringify({roadmapId:n,messages:x,...t?{chatHistoryId:t}:{}})});if(!y.ok){const I=await y.json();i.error(I?.message||"Something went wrong"),p(x.slice(0,-1)),h(!1),I.status===401&&(fe(),window.location.reload()),S.invalidateQueries(Z());return}const d=y.body;if(!d){h(!1),i.error("Something went wrong");return}await Me(d,{onMessage:async I=>{if(w?.signal.aborted)return;const O=await J(I,L,{isLoading:!0});Q.flushSync(()=>{j(O)})},onMessageEnd:async I=>{if(w?.signal.aborted)return;const O=await J(I,L,{isLoading:!1}),ue=[...x,{role:"assistant",content:I,jsx:O}];Q.flushSync(()=>{j(null),h(!1),p(ue)}),S.invalidateQueries(Z()),S.invalidateQueries({predicate:X=>X.queryKey[0]==="list-chat-history"&&X.queryKey[1]?.roadmapId===n})},onDetails:I=>{const O=I?.chatHistoryId;O&&l?.(O)}}),h(!1),g.current=null}catch{h(!1),j(null),g.current=null,w?.signal.aborted||i.error("Something went wrong")}},T=u.useCallback((x,w)=>{if(!x||m||w||g.current)return;g.current=new AbortController;const y=V(x),d=[...c,{role:"user",json:x,html:y}];h(!0),Q.flushSync(()=>p(d)),N("instant"),f(d,g.current)},[c,m,N]),A=u.useCallback(()=>{g.current?.abort(),g.current=null,h(!1),j(null),p(c.slice(0,-1))},[c]),F=u.useCallback(()=>{p([]),j(null),h(!1),N("instant"),C(!1)},[]);return{aiChatHistory:c,isStreamingMessage:m,streamedMessage:b,showScrollToBottom:v,setShowScrollToBottom:C,abortControllerRef:g,handleChatSubmit:T,handleAbort:A,clearChat:F,scrollToBottom:N,setAiChatHistory:p}}function V(s){const t=s.content;let n="";for(const a of t||[])switch(a.type){case"text":n+=a.text;break;case"paragraph":n+=`<p>${V(a)}</p>`;break;case"variable":const r=a?.attrs?.label||"";n+=`<span class="chat-variable">${r}</span>`;break}return n}function js(s,t){return z({queryKey:["chat-history-details",s],queryFn:async()=>{const n=await R(`/v1-chat-history/${s}`);n.title&&(document.title=n.title);const a=[];for(const r of n.messages)a.push({role:r.role,content:r.content,...r.role==="user"&&!r?.json&&{html:ye(r.content)},...r.role==="user"&&r?.json&&{html:V(r.json)},...r.role==="assistant"&&{jsx:await J(r.content,t??{},{isLoading:!1})}});return{...n,messages:a}},enabled:!!H()&&!!s})}function pt(s={query:"",roadmapId:""}){return{queryKey:["list-chat-history",s],queryFn:({pageParam:t})=>R("/v1-list-chat-history",{...s?.query?{query:s.query}:{},...s?.roadmapId?{roadmapId:s.roadmapId}:{},...t?{currPage:t}:{},perPage:"21"}),enabled:!!H(),getNextPageParam:(t,n)=>t.currPage<t.totalPages?t.currPage+1:void 0,initialPageParam:1}}function ht(){return e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between gap-2",children:[e.jsx("div",{className:"h-6 w-1/2 animate-pulse rounded bg-gray-200"}),e.jsx("div",{className:"size-8 animate-pulse rounded-md bg-gray-200"})]}),e.jsx("div",{className:"h-9 w-full animate-pulse rounded-lg bg-gray-200"}),e.jsx("div",{className:"relative mt-2",children:e.jsx("div",{className:"h-9 w-full animate-pulse rounded-lg bg-gray-200"})})]}),e.jsx("div",{className:"scrollbar-track-transparent scrollbar-thin scrollbar-thumb-gray-300 -mx-2 mt-6 grow space-y-4 overflow-y-scroll px-2",children:["Today","Last 7 Days","Older"].map(s=>e.jsxs("div",{children:[e.jsx("div",{className:"h-4 w-16 animate-pulse rounded bg-gray-200"}),e.jsx("ul",{className:"mt-1 space-y-0.5",children:[1,2,3].map(t=>e.jsx("li",{className:"h-9 animate-pulse rounded-lg bg-gray-100"},t))})]},s))})]})}function gt(s){const{error:t,className:n}=s;return e.jsxs("div",{className:P("mt-10 flex max-w-md flex-col items-center justify-center text-center",n),children:[e.jsx(Te,{className:"h-8 w-8 text-red-500"}),e.jsx("h3",{className:"mt-4 text-sm font-medium text-gray-900",children:"Something went wrong"}),e.jsx("p",{className:"mt-0.5 text-xs text-balance text-gray-500",children:t?.message})]})}function xt(s){const t=ee.now().startOf("day");return s?.reduce((n,a)=>{const r=ee.fromJSDate(new Date(a.updatedAt)).startOf("day"),o=Math.abs(r.diff(t,"days").days);return o===0?n.today.histories.push(a):o<=7?n.last7Days.histories.push(a):n.older.histories.push(a),n},{today:{title:"Today",histories:[]},last7Days:{title:"Last 7 Days",histories:[]},older:{title:"Older",histories:[]}})}function ft(s){const{onSearch:t,isLoading:n,className:a,inputClassName:r}=s,[o,l]=u.useState(""),i=Fe(o,300);return u.useEffect(()=>{t(i)},[i,t]),e.jsxs("form",{className:P("relative mt-2 flex grow items-center",a),onSubmit:c=>{c.preventDefault(),t(o)},children:[e.jsx("input",{type:"text",placeholder:"Search folder by name",className:P("block h-9 w-full rounded-lg border border-gray-200 bg-white px-3 py-2 pr-7 pl-8 text-sm outline-none placeholder:text-zinc-500 focus:border-zinc-500",r),required:!0,minLength:3,maxLength:255,value:o,onChange:c=>l(c.target.value)}),e.jsx("div",{className:"absolute top-1/2 left-2.5 -translate-y-1/2",children:n?e.jsx(M,{className:"size-4 animate-spin text-gray-500"}):e.jsx(Oe,{className:"size-4 text-gray-500"})}),o&&e.jsx("div",{className:"absolute inset-y-0 right-1 flex items-center",children:e.jsx("button",{onClick:()=>{l("")},className:"rounded-lg p-1 hover:bg-gray-100",children:e.jsx(De,{className:"size-4 text-gray-500"})})})]})}function yt(s){const{chatHistoryId:t,onDelete:n}=s,a=q(),[r,o]=u.useState(!1),[l,i]=u.useState(!1),{mutate:c,isPending:p}=B({mutationFn:m=>xe(`/v1-delete-chat/${m}`),onSettled:()=>S.invalidateQueries({predicate:m=>m.queryKey[0]==="list-chat-history"}),onSuccess:()=>{a.success("Chat history deleted"),o(!1),n?.()},onError:m=>{a.error(m?.message||"Failed to delete chat history")}},S);return e.jsxs(ze,{open:r,onOpenChange:o,children:[e.jsx(He,{className:"rounded-lg p-2 opacity-0 group-hover/item:opacity-100 hover:bg-gray-100 focus:outline-none data-[state=open]:bg-gray-100 data-[state=open]:opacity-100",children:e.jsx(Ee,{className:"h-4 w-4"})}),e.jsxs(Ae,{align:"end",className:"z-[9999]",children:[!l&&e.jsx(te,{className:"cursor-pointer text-red-500 focus:bg-red-50 focus:text-red-500",onSelect:m=>{m.preventDefault(),i(!0)},disabled:p,children:p?e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"h-4 w-4 animate-spin"}),"Deleting..."]}):e.jsxs(e.Fragment,{children:[e.jsx($e,{className:"h-4 w-4"}),"Delete"]})}),l&&e.jsx(te,{asChild:!0,className:"focus:bg-transparent",onSelect:m=>{m.preventDefault()},disabled:p,children:e.jsxs("div",{className:"flex w-full items-center justify-between gap-1.5",children:["Are you sure?",e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{c(t),i(!1)},className:"cursor-pointer text-red-500 underline hover:text-red-800",disabled:p,children:"Yes"}),e.jsx("button",{onClick:()=>i(!1),className:"cursor-pointer text-red-500 underline hover:text-red-800",disabled:p,children:"No"})]})]})})]})]})}function bt(s){const{chatHistory:t,isActive:n,onChatHistoryClick:a,onDelete:r}=s;return e.jsxs("li",{className:"group/item relative text-sm",children:[e.jsx("button",{className:"block w-full truncate rounded-lg p-2 pr-10 text-left hover:bg-gray-100 data-[active=true]:bg-gray-100","data-active":n,onClick:()=>a(t._id),children:t.title}),e.jsx("div",{className:"absolute inset-y-0 right-2 flex items-center",children:e.jsx(yt,{chatHistoryId:t._id,onDelete:r})})]},t._id)}function jt(s){const{title:t,histories:n,activeChatHistoryId:a,onChatHistoryClick:r,onDelete:o}=s;return e.jsxs("div",{children:[e.jsx("h2",{className:"ml-2 text-xs text-gray-500",children:t}),e.jsx("ul",{className:"mt-1 space-y-0.5",children:n.map(l=>e.jsx(bt,{chatHistory:l,isActive:a===l._id,onChatHistoryClick:r,onDelete:()=>{o?.(l._id)}},l._id))})]})}function vs(s){const{activeChatHistoryId:t,onChatHistoryClick:n,onDelete:a,isPaidUser:r,onUpgrade:o}=s,[l,i]=u.useState(!0),[c,p]=u.useState(!0),[m,h]=u.useState(!1);u.useLayoutEffect(()=>{const w=Re(),y=["sm","md"].includes(w);if(y)i(!y);else{const d=localStorage.getItem("chat-history-sidebar-open");i(d===null?!0:d==="true")}h(y)},[]),u.useEffect(()=>{m||localStorage.setItem("chat-history-sidebar-open",l.toString())},[l,m]);const[b,j]=u.useState(""),{data:v,fetchNextPage:C,hasNextPage:g,isFetchingNextPage:N,isError:k,error:L,isLoading:f}=_e(pt({query:b}),S);u.useEffect(()=>{v&&p(!1)},[v?.pages]);const T=u.useMemo(()=>{const w=v?.pages?.flatMap(y=>y.data);return xt(w??[])},[v?.pages]);if(!H())return null;if(!l)return e.jsxs("div",{className:"absolute top-2 left-2 z-20 flex items-center gap-1",children:[e.jsx("button",{className:"flex size-8 items-center justify-center rounded-lg p-1 hover:bg-gray-200",onClick:()=>{i(!0)},children:e.jsx(Ge,{className:"h-4.5 w-4.5"})}),e.jsx("button",{className:"flex size-8 items-center justify-center rounded-lg p-1 hover:bg-gray-200",onClick:()=>{m&&i(!1),n(null)},children:e.jsx(se,{className:"h-4.5 w-4.5"})})]});const A=Object.values(T??{}).every(w=>w.histories.length===0),F=P("flex w-[255px] shrink-0 flex-col justify-start border-r border-gray-200 bg-white p-2","max-md:absolute max-md:inset-0 max-md:z-20 max-md:w-full",!l&&"hidden"),x=e.jsx("button",{className:"flex size-8 items-center justify-center rounded-lg p-1 text-gray-500 hover:bg-gray-100 hover:text-black",onClick:()=>{i(!1)},children:e.jsx(Qe,{className:"h-4.5 w-4.5"})});return r?e.jsxs("div",{className:F,children:[c&&e.jsx(ht,{}),!c&&k&&e.jsx(gt,{error:L}),!c&&!k&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsx("h1",{className:"font-medium text-gray-900",children:"Chat History"}),x]}),e.jsxs("button",{className:"flex w-full items-center justify-center gap-2 rounded-lg bg-black p-2 text-sm text-white hover:opacity-80",onClick:()=>{m&&i(!1),n(null)},children:[e.jsx(se,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:"New Chat"})]}),e.jsx(ft,{onSearch:j,isLoading:f})]}),e.jsxs("div",{className:"scrollbar-track-transparent scrollbar-thin scrollbar-thumb-gray-300 -mx-2 mt-6 grow space-y-4 overflow-y-scroll px-2",children:[A&&!f&&e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("p",{className:"text-sm text-gray-500",children:"No chat history"})}),Object.entries(T??{}).map(([w,y])=>y.histories.length===0?null:e.jsx(jt,{title:y.title,histories:y.histories,activeChatHistoryId:t,onChatHistoryClick:d=>{m&&i(!1),n(d)},onDelete:d=>{a?.(d)}},w)),g&&e.jsx("div",{className:"mt-4",children:e.jsxs("button",{className:"flex w-full items-center justify-center gap-2 text-sm text-gray-500 hover:text-black",onClick:()=>{C()},disabled:N,children:[N&&e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"h-4 w-4 animate-spin"}),"Loading more..."]}),!N&&"Load More"]})})]})]})]}):e.jsx(vt,{className:F,closeButton:x,onUpgrade:o})}function vt(s){const{className:t,onUpgrade:n,closeButton:a}=s;return e.jsxs("div",{className:P("relative flex flex-col",t),children:[e.jsx("div",{className:"mb-4 flex items-center justify-between",children:a}),e.jsxs("div",{className:"flex grow flex-col items-center justify-center px-4",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"mb-3 rounded-full bg-yellow-100 p-3",children:e.jsx(qe,{className:"size-6 text-yellow-600"})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Unlock History"}),e.jsx("p",{className:"mt-2 text-center text-sm text-balance text-gray-600",children:"Save conversations and pick up right where you left off."})]}),e.jsxs("div",{className:"my-5 w-full space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 rounded-lg border border-gray-200 bg-gray-50 px-3 py-2",children:[e.jsx(E,{additionalClasses:"size-4 text-green-500"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Unlimited history"})]}),e.jsxs("div",{className:"flex items-center gap-2 rounded-lg border border-gray-200 bg-gray-50 px-3 py-2",children:[e.jsx(E,{additionalClasses:"size-4 text-green-500"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Search old chats"})]})]}),e.jsx("button",{type:"button",className:"w-full cursor-pointer rounded-lg bg-yellow-400 px-4 py-2 text-sm font-medium text-black hover:bg-yellow-500",onClick:()=>{n?.()},children:"Upgrade to Pro"})]})]})}export{jt as C,vs as L,xs as P,at as R,Xe as S,Ze as T,vt as U,fs as a,_e as b,js as c,ft as d,re as e,gs as f,xt as g,et as h,hs as i,J as j,gt as k,pt as l,ys as m,mt as r,bs as u};
