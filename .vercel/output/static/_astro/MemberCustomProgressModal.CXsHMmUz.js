import{j as e}from"./jsx-runtime.D_zvdyIk.js";/* empty css                       *//* empty css                       */import{r as c}from"./index.Z3BHPS3u.js";import{O as K}from"./index.gjAxZpWu.js";import{S as U}from"./Spinner.CPY-6wbR.js";import{u as q}from"./use-outside-click.DYGsxgbd.js";import{u as _}from"./use-keydown.r409VyJJ.js";import{a as M}from"./http.BJhNQusg.js";import{r as x,u as z}from"./resource-progress.BKggaGKm.js";import{u as B}from"./use-toast.BdCcSTJE.js";import{u as A}from"./use-auth.Bw1nhFr_.js";import{p as I}from"./page.DyYQD7MX.js";import{r as O}from"./dom.B_TnKQIa.js";import{renderFlowJSON as J,ReadonlyEditor as V}from"./index.Dgut0sTl.js";import"./vue.BIhB9hsv.js";import{X as G}from"./x.BOdyWiWF.js";async function W(y,n){const{error:i,response:l}=await M("/pages.json");if(i||!l)return null;const h=l.find(p=>y==="roadmap"?p.url===`/${n}`:y==="best-practice"?p.url===`/best-practices/${n}`:!1);return h||null}function H(y){const{progress:n,member:i,resourceId:l,isLoading:h,onShowMyProgress:p,isCurrentUser:f}=y,S=n?.removed||[],d=n?.done.filter(m=>!S.includes(m)).length||0,g=n?.learning.filter(m=>!S.includes(m)).length||0,j=n?.skipped.filter(m=>!S.includes(m)).length||0,w=i.progress.find(m=>m.resourceId===l)?.total||0,k=Math.round(d/w*100);return e.jsxs(e.Fragment,{children:[f&&e.jsxs("div",{className:"sticky top-1 z-50 mx-1 mb-0 mt-1 rounded-xl bg-gray-900 p-4 text-gray-300",children:[e.jsx("h2",{className:"mb-1.5 text-base",children:"Follow the Instructions below to update your progress"}),e.jsxs("ul",{className:"flex flex-col gap-1",children:[e.jsxs("li",{className:"leading-loose",children:[e.jsx("kbd",{className:"rounded-md bg-yellow-200 px-2 py-1.5 text-xs text-gray-900",children:"Right Mouse Click"})," ","on a topic to mark as"," ",e.jsx("span",{className:"font-medium text-white",children:"Done"}),"."]}),e.jsxs("li",{className:"leading-loose",children:[e.jsx("kbd",{className:"rounded-md bg-yellow-200 px-2 py-1.5 text-xs text-gray-900",children:"Shift"})," ","+"," ",e.jsx("kbd",{className:"rounded-md bg-yellow-200 px-2 py-1.5 text-xs text-gray-900",children:"Click"})," ","on a topic to mark as"," ",e.jsx("span",{className:"font-medium text-white",children:"In progress"}),"."]})]})]}),e.jsxs("div",{className:"p-4",children:[!f&&e.jsxs("div",{className:"mb-5 mt-0 text-left md:mt-4 md:text-center",children:[e.jsxs("h2",{className:"mb-1 text-lg font-bold md:text-2xl",children:[i.name,"'s Progress"]}),e.jsxs("p",{className:"hidden text-xs text-gray-500 sm:text-sm md:block md:text-base",children:["You are looking at ",i.name,"'s progress."," ",e.jsx("button",{className:"text-blue-600 underline",onClick:p,children:"View your progress"}),"."]}),e.jsx("p",{className:"block text-gray-500 md:hidden",children:e.jsx("button",{className:"text-blue-600 underline",onClick:p,children:"View your progress."})})]}),e.jsxs("p",{className:`-mx-4 mb-3 flex items-center justify-start border-b border-t px-4 py-2 text-sm sm:hidden ${h?"striped-loader":""}`,children:[e.jsxs("span",{className:"mr-2.5 block rounded-xs bg-yellow-200 px-1 py-0.5 text-xs font-medium uppercase text-yellow-900",children:[e.jsx("span",{children:k}),"% Done"]}),e.jsxs("span",{children:[e.jsx("span",{children:d})," of ",e.jsx("span",{children:w})," done"]})]}),e.jsxs("p",{className:`-mx-4 mb-3 hidden items-center justify-center border-b border-t py-2 text-sm sm:flex ${h?"striped-loader":""}`,children:[e.jsxs("span",{className:"mr-2.5 block rounded-xs bg-yellow-200 px-1 py-0.5 text-xs font-medium uppercase text-yellow-900",children:[e.jsx("span",{children:k}),"% Done"]}),e.jsxs("span",{children:[e.jsx("span",{children:d})," completed"]}),e.jsx("span",{className:"mx-1.5 text-gray-400",children:"·"}),e.jsxs("span",{children:[e.jsx("span",{"data-progress-learning":"",children:g})," in progress"]}),j>0&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"mx-1.5 text-gray-400",children:"·"}),e.jsxs("span",{children:[e.jsx("span",{"data-progress-skipped":"",children:j})," skipped"]})]}),e.jsx("span",{className:"mx-1.5 text-gray-400",children:"·"}),e.jsxs("span",{children:[e.jsx("span",{"data-progress-total":"",children:w})," Total"]})]})]})]})}function pe(y){const{resourceId:n,member:i,resourceType:l,onShowMyProgress:h,teamId:p,onClose:f}=y,d=A()?.email===i.email,g=c.useRef(null),j=c.useRef(null),[L,w]=c.useState(!1),[k,m]=c.useState(),[P,N]=c.useState(!0),C=B(),[D,E]=c.useState("balsamiq");async function T(s,r,t,a){const{error:u,response:b}=await M(`undefined/v1-get-member-resource-progress/${s}/${r}?resourceType=${t}&resourceId=${a}`);if(u||!b){C.error(u?.message||"Failed to get member progress");return}return m(b),b}async function F(){const s=await W(l,n);if(!s){C.error("Resource not found");return}const r=s.renderer||"balsamiq";E(r);let t="https://roadmap.sh";l==="roadmap"&&r==="balsamiq"?t+=`/${n}.json`:l==="roadmap"&&r==="editor"?t=`undefined/v1-official-roadmap/${n}`:t+=`/best-practices/${n}.json`;const u=await(await fetch(t,{})).json(),b=r==="editor"?await J():await K(u,{fontURL:"/fonts/balsamiq.woff2"});O(g.current,b)}_("Escape",()=>{L||f()}),q(j,()=>{L||f()}),c.useEffect(()=>{!g.current||!n||!l||!p||(N(!0),Promise.all([F(),T(p,i._id,l,n)]).then(([s,r={}])=>{const{removed:t=[],done:a=[],learning:u=[],skipped:b=[]}=r;a.forEach(v=>x(v,"done")),u.forEach(v=>x(v,"learning")),b.forEach(v=>x(v,"skipped")),t.forEach(v=>x(v,"removed"))}).catch(s=>{console.error(s),C.error(s?.message||"Something went wrong. Please try again!")}).finally(()=>{N(!1)}))},[i]);function $(s,r){!n||!l||!d||(I.set("Updating progress"),z({resourceId:n,resourceType:l,topicId:s},r).then(()=>{x(s,r),T(p,i._id,l,n).then(t=>{m(t)})}).catch(t=>{alert("Something went wrong, please try again."),console.error(t)}).finally(()=>{I.set("")}))}async function R(s){const r=s.target?.closest("g");if(!r)return;const t=r.dataset?r.dataset.groupId:"";if(!t)return;const a=t.replace(/^\d+-/,"");if(r.classList.contains("removed")){s.preventDefault();return}s.preventDefault();const u=r?.classList.contains("done");$(a,u?"pending":"done")}async function o(s){const r=s.target?.closest("g");if(!r)return;const t=r.dataset?r.dataset.groupId:"";if(!t)return;const a=t.replace(/^\d+-/,"");if(r.classList.contains("removed"))return;s.preventDefault();const u=r.classList.contains("learning"),b=r.classList.contains("skipped");if(s.shiftKey){s.preventDefault(),$(a,u?"pending":"learning");return}if(s.altKey){s.preventDefault(),$(a,b?"pending":"skipped");return}}return c.useEffect(()=>{if(!(!i||!g.current))return g.current?.addEventListener("contextmenu",R),g.current?.addEventListener("click",o),()=>{g.current?.removeEventListener("contextmenu",R),g.current?.removeEventListener("click",o)}},[i]),e.jsx("div",{className:"fixed top-0 right-0 left-0 z-100 h-full items-center justify-center overflow-x-hidden overflow-y-auto overscroll-contain bg-black/50",children:e.jsx("div",{id:D==="editor"?void 0:"customized-roadmap",className:"relative mx-auto h-full w-full max-w-4xl p-4 md:h-auto",children:e.jsxs("div",{ref:j,className:"popup-body relative rounded-lg bg-white pt-[1px] shadow-sm",children:[e.jsx(H,{resourceId:n,member:i,progress:k,isCurrentUser:d,onShowMyProgress:h,isLoading:P}),e.jsx("div",{id:"resource-svg-wrap",ref:g,className:"px-4 pb-2"}),P&&e.jsx("div",{className:"flex w-full justify-center",children:e.jsx(U,{isDualRing:!1,className:"mt-2 mb-4 h-4 w-4 animate-spin fill-blue-600 text-gray-200 sm:h-8 sm:w-8"})}),e.jsxs("button",{type:"button",className:`absolute top-3 right-2.5 ml-auto inline-flex items-center rounded-lg bg-transparent p-1.5 text-sm text-gray-400 hover:text-gray-900 lg:hidden ${d?"hover:bg-gray-800":"hover:bg-gray-100"}`,onClick:f,children:[e.jsx(G,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close modal"})]})]})})})}function ge(y){const{resourceId:n,member:i,resourceType:l,onShowMyProgress:h,teamId:p,onClose:f}=y,d=A()?.email===i.email,g=c.useRef(null),[j,L]=c.useState(null),[w,k]=c.useState(),[m,P]=c.useState(!0),N=B();_("Escape",()=>f()),q(g,()=>f());async function C(o,s,r,t){const{error:a,response:u}=await M(`undefined/v1-get-member-resource-progress/${o}/${s}?resourceType=${r}&resourceId=${t}`);if(a||!u){N.error(a?.message||"Failed to get member progress");return}return k(u),u}async function D(){const{response:o,error:s}=await M(`undefined/v1-get-roadmap/${n}`);if(s||!o){N.error(s?.message||"Failed to load roadmap");return}return L(o),o}c.useEffect(()=>{!n||!l||!p||(P(!0),Promise.all([D(),C(p,i._id,l,n)]).then(()=>{}).catch(o=>{console.error(o),N.error(o?.message||"Something went wrong. Please try again!")}).finally(()=>{P(!1)}))},[i]);function E(o,s){!n||!l||!d||(I.set("Updating progress"),z({resourceId:n,resourceType:l,topicId:o},s).then(()=>{x(o,s),C(p,i._id,l,n).then(r=>{k(r)})}).catch(r=>{alert("Something went wrong, please try again."),console.error(r)}).finally(()=>{I.set("")}))}const T=c.useCallback((o,s)=>{if(!d)return;const r=s?.type==="todo"?document.querySelector(`[data-id="${s.id}"]`):o?.currentTarget;if(!r)return;const t=r?.classList.contains("done");E(s.id,t?"pending":"done")},[]),F=c.useCallback((o,s)=>{if(!d)return;const r=o?.currentTarget;if(!r)return;const t=r?.classList.contains("learning");E(s.id,t?"pending":"learning")},[]),$=c.useCallback((o,s)=>{if(!d)return;const r=o?.currentTarget;if(!r)return;const t=r?.classList.contains("skipped");E(s.id,t?"pending":"skipped")},[]),R=c.useCallback((o,s)=>{if(!s||!d)return;s.startsWith("http")?window.open(s,"_blank"):window.location.href=s},[]);return e.jsx("div",{className:"fixed left-0 right-0 top-0 z-100 h-full items-center justify-center overflow-y-auto overflow-x-hidden overscroll-contain bg-black/50",children:e.jsx("div",{id:"original-roadmap",className:"relative mx-auto h-full w-full max-w-4xl p-4 md:h-auto",children:e.jsxs("div",{className:"relative rounded-lg bg-white pt-[1px] shadow-sm",ref:g,children:[e.jsx(H,{resourceId:n,member:i,progress:w,isCurrentUser:d,onShowMyProgress:h,isLoading:m}),!m&&j&&e.jsx("div",{className:"px-4 pb-2",children:e.jsx(V,{variant:"modal",roadmap:j,className:"min-h-[400px]",onRendered:()=>{const{removed:o=[],done:s=[],learning:r=[],skipped:t=[]}=w||{};s.forEach(a=>x(a,"done")),r.forEach(a=>x(a,"learning")),t.forEach(a=>x(a,"skipped")),o.forEach(a=>x(a,"removed"))},onTopicRightClick:T,onTopicShiftClick:F,onTopicAltClick:$,onButtonNodeClick:R,onLinkClick:R,fontFamily:"Balsamiq Sans",fontURL:"/fonts/balsamiq.woff2"})}),m&&e.jsx("div",{className:"flex w-full justify-center",children:e.jsx(U,{isDualRing:!1,className:"mb-4 mt-2 h-4 w-4 animate-spin fill-blue-600 text-gray-200 sm:h-8 sm:w-8"})}),e.jsxs("button",{type:"button",className:`absolute right-2.5 top-3 z-50 ml-auto inline-flex items-center rounded-lg bg-transparent p-1.5 text-sm text-gray-400 hover:text-gray-900 lg:hidden ${d?"hover:bg-gray-800":"hover:bg-gray-100"}`,onClick:f,children:[e.jsx(G,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close modal"})]})]})})})}export{pe as M,ge as a};
