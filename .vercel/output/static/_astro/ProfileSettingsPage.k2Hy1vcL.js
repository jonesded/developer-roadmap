import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as o}from"./index.Z3BHPS3u.js";import{b as y,h as S,a as k}from"./http.BJhNQusg.js";import{p as c}from"./page.DyYQD7MX.js";import{u as j}from"./use-toast.BdCcSTJE.js";import{c as E}from"./classname.y9b8gBZq.js";import"./js.cookie.Cz0CWeBA.js";import"./fp.esm.CznIeghd.js";import"./jwt.1xGNZsvU.js";import"./index.3whys8t3.js";import"./toast.DlejBBdi.js";function F(g){const{authProvider:i,currentEmail:u,newEmail:f="",onSendVerificationCode:h,onVerificationCancel:d}=g,l=j(),[t,s]=o.useState(!1),[r,m]=o.useState(f!==""),[a,n]=o.useState(f),[w,b]=o.useState(!1),v=async p=>{if(p.preventDefault(),!a||!a.includes("@")||r)return;s(!0),c.set("Sending verification code");const{response:x,error:N}=await y("https://api.roadmap.sh/v1-update-user-email",{email:a});if(N||!x){l.error(N?.message||"Something went wrong"),s(!1),c.set("");return}c.set(""),s(!1),m(!0),h?.(a)},P=async()=>{if(w){l.error("You have already resent the verification code");return}s(!0),c.set("Resending verification code");const{response:p,error:x}=await y("https://api.roadmap.sh/v1-resend-email-verification-code",{email:a});if(x||!p){l.error(x?.message||"Something went wrong"),s(!1),c.set("");return}l.success("Verification code has been resent"),c.set(""),b(!0),s(!1)},C=async()=>{s(!0),c.set("Cancelling email verification");const{response:p,error:x}=await y("https://api.roadmap.sh/v1-cancel-email-verification",{});if(x||!p){l.error(x?.message||"Something went wrong"),s(!1),c.set("");return}c.set(""),d?.(),m(!1),n(""),s(!1)};return i&&i!=="email"?e.jsxs("div",{className:"block",children:[e.jsx("h2",{className:"text-xl font-bold sm:text-2xl",children:"Update Email"}),e.jsxs("p",{className:"mt-2 text-gray-400",children:["You have used ",i," when signing up. Please set your password first."]}),e.jsxs("div",{className:"mt-4 flex w-full flex-col",children:[e.jsx("label",{htmlFor:"current-email",className:"text-sm leading-none text-slate-500",children:"Current Email"}),e.jsx("input",{type:"email",name:"current-email",id:"current-email",autoComplete:"current-email",className:"mt-2 block w-full rounded-lg border border-gray-300 px-3 py-2 shadow-xs outline-hidden placeholder:text-gray-400 focus:ring-2 focus:ring-black focus:ring-offset-1",required:!0,disabled:!0,value:u})]}),e.jsx("p",{className:"mt-3 rounded-lg border border-red-600 px-2 py-1 text-red-600",children:"Please set your password first to update your email."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-8 block",children:[e.jsx("h2",{className:"text-xl font-bold sm:text-2xl",children:"Update Email"}),e.jsx("p",{className:"mt-2 text-gray-400",children:"Use the form below to update your email."})]}),e.jsxs("form",{onSubmit:v,className:"space-y-4",children:[e.jsxs("div",{className:"flex w-full flex-col",children:[e.jsx("label",{htmlFor:"current-email",className:"text-sm leading-none text-slate-500",children:"Current Email"}),e.jsx("input",{type:"email",name:"current-email",id:"current-email",autoComplete:"current-email",className:"mt-2 block w-full rounded-lg border border-gray-300 px-3 py-2 shadow-xs outline-hidden placeholder:text-gray-400 focus:ring-2 focus:ring-black focus:ring-offset-1",required:!0,disabled:!0,value:u})]}),e.jsxs("div",{className:E("flex w-full flex-col",{"rounded-lg border border-green-500 p-3":r}),children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("label",{htmlFor:"new-email",className:"text-sm leading-none text-slate-500",children:"New Email"}),r&&e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("button",{type:"button",onClick:P,disabled:t||w,className:"flex items-center gap-1 text-sm font-medium leading-none text-green-600 transition-colors hover:text-green-700",children:[e.jsx("span",{className:"hidden sm:block",children:"Resend Verification Link"}),e.jsx("span",{className:"sm:hidden",children:"Resend Code"})]})})]}),e.jsx("input",{type:"email",name:"new-email",id:"new-email",autoComplete:"new-email",className:"mt-2 block w-full rounded-lg border border-gray-300 px-3 py-2 shadow-xs outline-hidden placeholder:text-gray-400 focus:ring-2 focus:ring-black focus:ring-offset-1",required:!0,placeholder:"Enter new email",value:a,onChange:p=>n(p.target.value),disabled:r}),!r&&e.jsx("button",{type:"submit",disabled:t||!a||!a.includes("@")||r,className:"mt-3 inline-flex w-full items-center justify-center rounded-lg bg-black p-2 py-3 text-sm font-medium text-white outline-hidden focus:ring-2 focus:ring-black focus:ring-offset-1 disabled:bg-gray-400",children:t?"Please wait...":"Send Verification Link"}),r&&e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",onClick:C,disabled:t,className:"font-regular mt-4 w-full rounded-lg border border-red-600 py-2 text-sm text-red-600 outline-hidden transition-colors hover:bg-red-500 hover:text-white focus:ring-2 focus:ring-red-500 focus:ring-offset-1",children:"Cancel Update"}),e.jsx("div",{className:"mt-3 flex items-center gap-2 rounded-lg bg-green-100 p-4",children:e.jsxs("span",{className:"text-sm text-green-800",children:["A verification link has been sent to your"," ",e.jsx("span",{children:"new email address"}),". Please follow the instructions in email to verify and update your email."]})})]})]})]})]})}function V(g){const{authProvider:i}=g,u=j(),[f,h]=o.useState(""),[d,l]=o.useState(""),[t,s]=o.useState(""),[r,m]=o.useState(!1),a=async n=>{if(n.preventDefault(),m(!0),d!==t){u.error("Passwords do not match"),m(!1);return}const{response:w,error:b}=await S("https://api.roadmap.sh/v1-update-password",{oldPassword:i==="email"?f:"social-auth",password:d,confirmPassword:t});if(b||!w){u.error(b?.message||"Something went wrong"),m(!1);return}h(""),l(""),s(""),u.success("Password updated successfully"),m(!1),setTimeout(()=>{window.location.reload()},1e3)};return e.jsxs("form",{onSubmit:a,children:[e.jsxs("div",{className:"mb-8 hidden md:block",children:[e.jsx("h2",{className:"text-3xl font-bold sm:text-4xl",children:"Password"}),e.jsx("p",{className:"mt-2 text-gray-400",children:"Use the form below to update your password."})]}),e.jsxs("div",{className:"space-y-4",children:[i==="email"&&e.jsxs("div",{className:"flex w-full flex-col",children:[e.jsx("label",{htmlFor:"current-password",className:"text-sm leading-none text-slate-500",children:"Current Password"}),e.jsx("input",{disabled:i!=="email",type:"password",name:"current-password",id:"current-password",autoComplete:"current-password",className:"mt-2 block w-full rounded-lg border border-gray-300 px-3 py-2 shadow-xs outline-hidden placeholder:text-gray-400 focus:ring-2 focus:ring-black focus:ring-offset-1 disabled:bg-gray-100",required:!0,minLength:6,placeholder:"Current password",value:f,onInput:n=>h(n.target.value)})]}),e.jsxs("div",{className:"flex w-full flex-col",children:[e.jsx("label",{htmlFor:"new-password",className:"text-sm leading-none text-slate-500",children:"New Password"}),e.jsx("input",{type:"password",name:"new-password",id:"new-password",autoComplete:"new-password",className:"mt-2 block w-full rounded-lg border border-gray-300 px-3 py-2 shadow-xs outline-hidden placeholder:text-gray-400 focus:ring-2 focus:ring-black focus:ring-offset-1",required:!0,minLength:6,placeholder:"New password",value:d,onInput:n=>l(n.target.value)})]}),e.jsxs("div",{className:"flex w-full flex-col",children:[e.jsx("label",{htmlFor:"new-password-confirmation",className:"text-sm leading-none text-slate-500",children:"Confirm New Password"}),e.jsx("input",{type:"password",name:"new-password-confirmation",id:"new-password-confirmation",className:"mt-2 block w-full rounded-lg border border-gray-300 px-3 py-2 shadow-xs outline-hidden placeholder:text-gray-400 focus:ring-2 focus:ring-black focus:ring-offset-1",autoComplete:"new-password",required:!0,minLength:6,placeholder:"Confirm New Password",value:t,onInput:n=>s(n.target.value)})]}),e.jsx("button",{type:"submit",disabled:r||!d||d!==t,className:"inline-flex w-full items-center justify-center rounded-lg bg-black p-2 py-3 text-sm font-medium text-white outline-hidden focus:ring-2 focus:ring-black focus:ring-offset-1 disabled:bg-gray-400",children:r?"Please wait...":"Update Password"})]})]})}function M(){const g=j(),[i,u]=o.useState(""),[f,h]=o.useState(""),[d,l]=o.useState(""),t=async()=>{const{error:s,response:r}=await k("https://api.roadmap.sh/v1-me");if(s||!r){g.error(s?.message||"Something went wrong");return}const{authProvider:m,email:a,newEmail:n}=r;u(m),h(a),l(n||"")};return o.useEffect(()=>{t().finally(()=>{c.set("")})},[]),e.jsxs(e.Fragment,{children:[e.jsx(V,{authProvider:i}),e.jsx("hr",{className:"my-8"}),e.jsx(F,{authProvider:i,currentEmail:f,newEmail:d,onSendVerificationCode:s=>{l(s),t().finally(()=>{})},onVerificationCancel:()=>{t().finally(()=>{})}},d)]})}export{M as ProfileSettingsPage};
