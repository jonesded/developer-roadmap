import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as d}from"./index.Z3BHPS3u.js";import{u as f}from"./useMutation.BxVH4XRI.js";import{a as S,q as c,u as k}from"./query-client.zrB8z_yM.js";import{M as h}from"./Modal.NtjGPDbq.js";import{h as w,a as y}from"./query-http.Bohx3EqF.js";import{u as b}from"./use-toast.BdCcSTJE.js";import"./js.cookie.Cz0CWeBA.js";import{L as C}from"./loader-circle.DfB4mNyf.js";import{c as u}from"./classname.y9b8gBZq.js";import{i as F}from"./jwt.1xGNZsvU.js";import{s as A}from"./popup.CdCAhVM2.js";import{g as j}from"./date.2wIYh-wy.js";import{P as I}from"./play.-yCdF7S0.js";import{C as L}from"./check.DflWYpXj.js";import"./use-outside-click.DYGsxgbd.js";import"./use-keydown.r409VyJJ.js";import"./x.BOdyWiWF.js";import"./createLucideIcon.BSLrQS80.js";import"./fp.esm.CznIeghd.js";import"./toast.DlejBBdi.js";import"./index.3whys8t3.js";function g(r){return S({queryKey:["project-status",r],queryFn:()=>w(`undefined/v1-project-status/${r}`,{})})}function $(r){const{onClose:t,projectId:s}=r,o=b(),{mutate:n,isPending:i}=f({mutationFn:()=>y(`undefined/v1-start-project/${s}`,{}),onSettled:()=>{c.invalidateQueries(g(s))},onSuccess:()=>{t()},onError:a=>{o.error(a?.message||"Failed to start project")}},c);return e.jsxs(h,{onClose:t,bodyClassName:"h-auto p-4",children:[e.jsx("h2",{className:"mb-2 flex items-center gap-2.5 text-xl font-semibold",children:"Start Project"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Are you sure you want to start this project?"}),e.jsxs("div",{className:"mt-4 grid grid-cols-2 gap-2",children:[e.jsx("button",{onClick:t,className:"rounded-lg bg-gray-100 px-4 py-2 text-sm font-medium text-gray-500 hover:bg-gray-200",children:"Cancel"}),e.jsx("button",{onClick:()=>n(),className:"flex h-9 items-center justify-center gap-2 rounded-lg bg-purple-600 px-4 py-2 text-sm font-medium text-white hover:bg-purple-700",children:i?e.jsx(C,{className:"h-4 w-4 animate-spin stroke-[2.5]"}):"Start Project"})]})]})}function q(r){const{onClose:t,projectId:s}=r,o=b(),{mutate:n,isPending:i}=f({mutationFn:()=>y(`undefined/v1-mark-as-done-project/${s}`,{}),onSettled:()=>{c.invalidateQueries(g(s))},onError:a=>{o.error(a?.message||"Failed to start project")},onSuccess:()=>{t()}},c);return e.jsxs(h,{onClose:t,bodyClassName:"h-auto p-4",children:[e.jsx("h2",{className:"mb-2 flex items-center gap-2.5 text-xl font-semibold",children:"Complete Project"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Are you sure you want to mark this project as completed?"}),e.jsxs("div",{className:"mt-4 grid grid-cols-2 gap-2",children:[e.jsx("button",{onClick:t,className:"rounded-lg bg-gray-100 px-4 py-2 text-sm font-medium text-gray-500 hover:bg-gray-200",children:"Cancel"}),e.jsx("button",{onClick:()=>n(),className:"flex h-9 items-center justify-center gap-2 rounded-lg bg-green-600 px-4 py-2 text-sm font-medium text-white hover:bg-green-700",children:i?e.jsx(C,{className:"h-4 w-4 animate-spin stroke-[2.5]"}):"Complete Project"})]})]})}function se(r){const{projectId:t}=r,{data:s}=k(g(t),c),[o,n]=d.useState(!0),[i,a]=d.useState(!1),[v,x]=d.useState(!1);d.useEffect(()=>{s&&n(!1)},[s]);const{startedAt:l,submittedAt:p}=s||{},N=l?j(l):"",P=p?j(p):"",m=!!p;return e.jsxs(e.Fragment,{children:[i&&e.jsx($,{onClose:()=>a(!1),projectId:t}),v&&e.jsx(q,{onClose:()=>x(!1),projectId:t}),!l&&e.jsxs("button",{onClick:()=>{if(!F()){A();return}a(!0)},className:u("relative flex items-center gap-1.5 overflow-hidden rounded-full bg-purple-600 py-1 pr-2.5 pl-2 text-sm text-white hover:bg-purple-700",o&&"bg-white text-gray-500"),disabled:o,children:[e.jsx(I,{size:13}),e.jsx("span",{children:"Start Working"}),o&&e.jsx("div",{className:u("striped-loader absolute inset-0 z-10 bg-white")})]}),l&&!o&&e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("button",{onClick:()=>x(!0),className:u("relative flex items-center gap-1.5 overflow-hidden rounded-full bg-green-600 py-1 pr-2.5 pl-2 text-sm text-white hover:bg-green-700",m&&"cursor-default bg-gray-200 text-gray-500 hover:bg-gray-200"),disabled:m,children:[e.jsx(L,{size:13,className:"stroke-[2.5]"}),m?e.jsx("span",{children:"Completed"}):e.jsx("span",{children:"Mark as Completed"})]}),e.jsx("div",{className:"text-end text-xs text-gray-500",children:m?e.jsxs(e.Fragment,{children:["Completed"," ",e.jsx("span",{className:"font-medium",children:P})]}):e.jsxs(e.Fragment,{children:["Started working"," ",e.jsx("span",{className:"font-medium",children:N})]})})]})]})}export{se as ProjectTrackingActions};
