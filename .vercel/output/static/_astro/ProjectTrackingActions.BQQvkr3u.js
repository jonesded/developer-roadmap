import{j as t}from"./jsx-runtime.D_zvdyIk.js";import{r as p}from"./index.Z3BHPS3u.js";import{u as h}from"./useMutation.BxVH4XRI.js";import{a as S,q as m,u as k}from"./query-client.zrB8z_yM.js";import{M as f}from"./Modal.NtjGPDbq.js";import{h as w,a as y}from"./query-http.BQfMbvYq.js";import{u as b}from"./use-toast.BdCcSTJE.js";import"./js.cookie.Cz0CWeBA.js";import{L as C}from"./loader-circle.DfB4mNyf.js";import{c as u}from"./classname.y9b8gBZq.js";import{i as F}from"./jwt.1xGNZsvU.js";import{s as A}from"./popup.CdCAhVM2.js";import{g as j}from"./date.2wIYh-wy.js";import{P as I}from"./play.-yCdF7S0.js";import{C as L}from"./check.DflWYpXj.js";import"./use-outside-click.DYGsxgbd.js";import"./use-keydown.r409VyJJ.js";import"./x.BOdyWiWF.js";import"./createLucideIcon.BSLrQS80.js";import"./fp.esm.CznIeghd.js";import"./toast.DlejBBdi.js";import"./index.3whys8t3.js";function g(r){return S({queryKey:["project-status",r],queryFn:()=>w(`https://api.roadmap.sh/v1-project-status/${r}`,{})})}function $(r){const{onClose:e,projectId:s}=r,o=b(),{mutate:n,isPending:i}=h({mutationFn:()=>y(`https://api.roadmap.sh/v1-start-project/${s}`,{}),onSettled:()=>{m.invalidateQueries(g(s))},onSuccess:()=>{e()},onError:a=>{o.error(a?.message||"Failed to start project")}},m);return t.jsxs(f,{onClose:e,bodyClassName:"h-auto p-4",children:[t.jsx("h2",{className:"mb-2 flex items-center gap-2.5 text-xl font-semibold",children:"Start Project"}),t.jsx("p",{className:"text-sm text-gray-500",children:"Are you sure you want to start this project?"}),t.jsxs("div",{className:"mt-4 grid grid-cols-2 gap-2",children:[t.jsx("button",{onClick:e,className:"rounded-lg bg-gray-100 px-4 py-2 text-sm font-medium text-gray-500 hover:bg-gray-200",children:"Cancel"}),t.jsx("button",{onClick:()=>n(),className:"flex h-9 items-center justify-center gap-2 rounded-lg bg-purple-600 px-4 py-2 text-sm font-medium text-white hover:bg-purple-700",children:i?t.jsx(C,{className:"h-4 w-4 animate-spin stroke-[2.5]"}):"Start Project"})]})]})}function q(r){const{onClose:e,projectId:s}=r,o=b(),{mutate:n,isPending:i}=h({mutationFn:()=>y(`https://api.roadmap.sh/v1-mark-as-done-project/${s}`,{}),onSettled:()=>{m.invalidateQueries(g(s))},onError:a=>{o.error(a?.message||"Failed to start project")},onSuccess:()=>{e()}},m);return t.jsxs(f,{onClose:e,bodyClassName:"h-auto p-4",children:[t.jsx("h2",{className:"mb-2 flex items-center gap-2.5 text-xl font-semibold",children:"Complete Project"}),t.jsx("p",{className:"text-sm text-gray-500",children:"Are you sure you want to mark this project as completed?"}),t.jsxs("div",{className:"mt-4 grid grid-cols-2 gap-2",children:[t.jsx("button",{onClick:e,className:"rounded-lg bg-gray-100 px-4 py-2 text-sm font-medium text-gray-500 hover:bg-gray-200",children:"Cancel"}),t.jsx("button",{onClick:()=>n(),className:"flex h-9 items-center justify-center gap-2 rounded-lg bg-green-600 px-4 py-2 text-sm font-medium text-white hover:bg-green-700",children:i?t.jsx(C,{className:"h-4 w-4 animate-spin stroke-[2.5]"}):"Complete Project"})]})]})}function st(r){const{projectId:e}=r,{data:s}=k(g(e),m),[o,n]=p.useState(!0),[i,a]=p.useState(!1),[v,x]=p.useState(!1);p.useEffect(()=>{s&&n(!1)},[s]);const{startedAt:c,submittedAt:d}=s||{},N=c?j(c):"",P=d?j(d):"",l=!!d;return t.jsxs(t.Fragment,{children:[i&&t.jsx($,{onClose:()=>a(!1),projectId:e}),v&&t.jsx(q,{onClose:()=>x(!1),projectId:e}),!c&&t.jsxs("button",{onClick:()=>{if(!F()){A();return}a(!0)},className:u("relative flex items-center gap-1.5 overflow-hidden rounded-full bg-purple-600 py-1 pr-2.5 pl-2 text-sm text-white hover:bg-purple-700",o&&"bg-white text-gray-500"),disabled:o,children:[t.jsx(I,{size:13}),t.jsx("span",{children:"Start Working"}),o&&t.jsx("div",{className:u("striped-loader absolute inset-0 z-10 bg-white")})]}),c&&!o&&t.jsxs("div",{className:"flex flex-col gap-1",children:[t.jsxs("button",{onClick:()=>x(!0),className:u("relative flex items-center gap-1.5 overflow-hidden rounded-full bg-green-600 py-1 pr-2.5 pl-2 text-sm text-white hover:bg-green-700",l&&"cursor-default bg-gray-200 text-gray-500 hover:bg-gray-200"),disabled:l,children:[t.jsx(L,{size:13,className:"stroke-[2.5]"}),l?t.jsx("span",{children:"Completed"}):t.jsx("span",{children:"Mark as Completed"})]}),t.jsx("div",{className:"text-end text-xs text-gray-500",children:l?t.jsxs(t.Fragment,{children:["Completed"," ",t.jsx("span",{className:"font-medium",children:P})]}):t.jsxs(t.Fragment,{children:["Started working"," ",t.jsx("span",{className:"font-medium",children:N})]})})]})]})}export{st as ProjectTrackingActions};
