import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{a as Q,u as T,q as I}from"./query-client.zrB8z_yM.js";import{h as F}from"./query-http.BQfMbvYq.js";import{r as l}from"./index.Z3BHPS3u.js";import{c as C}from"./classname.y9b8gBZq.js";import{r as L}from"./index.BlPpvBlM.js";import{C as O}from"./CheckIcon.D4OhQ5l1.js";import{T as D}from"./Tooltip.CCudSue-.js";import{L as K}from"./loader-circle.DfB4mNyf.js";import{R as G}from"./refresh-ccw.C3KtdZ75.js";import{T as k}from"./trash-2.CIQaIo_h.js";import{S as B}from"./send.BVE6djDn.js";function H(t,r){return Q({queryKey:["ai-question-suggestions",t],queryFn:()=>r?{questions:r}:F("/v1-ai-question-suggestions",t),enabled:!!t.term&&!!t.format&&!!t.from,refetchOnMount:!1})}function te(t){const{term:r,format:g,defaultQuestions:c,questionAnswerChatMessages:a,setQuestionAnswerChatMessages:i,type:u="create",className:x="",from:d="content"}=t,[b,h]=l.useState(c?.length??0),[p,m]=l.useState(""),[M,f]=l.useState("answering"),w=l.useRef(null),j=l.useRef(null),{data:q,isLoading:y}=T(H({term:r,format:g,from:d},c),I),n=q?.questions[b],A=()=>{w.current&&w.current.scrollTo({top:w.current.scrollHeight,behavior:"instant"})},v=s=>{const o=s.trim();if(!n||!o)return;const N=[...a,{role:"assistant",...n},{role:"user",answer:o}];if(i(N),m(""),!(b<q.questions.length-1)){f("done");return}L.flushSync(()=>{h(b+1),f("answering"),j.current?.focus()}),A()},z=()=>{i([]),h(0),f("answering")},E=s=>{const o=s-1,N=a.slice(0,o);i(N);const S=Math.floor(o/2);h(S),f("answering"),m(""),setTimeout(()=>{j.current?.focus()},0)};return l.useEffect(()=>{A()},[c,u]),e.jsx(e.Fragment,{children:e.jsxs("div",{className:C("relative h-[350px] w-full overflow-hidden rounded-xl border border-gray-200 bg-white",x),children:[y&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-white",children:e.jsxs("div",{className:"flex animate-pulse items-center gap-2 rounded-full border border-gray-200 bg-gray-50 p-2 px-4 text-sm",children:[e.jsx(K,{className:"size-4 animate-spin"}),e.jsx("span",{children:"Generating personalized questions..."})]})}),!y&&M==="done"&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-white",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(O,{additionalClasses:"size-12"}),e.jsx("p",{className:"mt-3 text-lg font-semibold",children:"Preferences saved"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["You can now start generating ",g]}),e.jsxs("button",{className:"mt-4 flex items-center gap-2 rounded-lg bg-gray-100 px-4 py-1.5 text-sm text-gray-500 hover:bg-gray-200 focus:outline-none",onClick:z,children:[e.jsx(G,{className:"size-3.5"}),"Reanswer questions"]})]})}),!y&&M==="answering"&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex h-full w-full flex-col bg-white",children:[e.jsx("div",{ref:w,className:"relative h-full w-full grow overflow-y-auto",children:e.jsx("div",{className:"absolute inset-0 flex flex-col",children:e.jsxs("div",{className:"flex w-full grow flex-col justify-end gap-2 p-2",children:[a.map((s,o)=>e.jsx(R,{role:s.role,question:s.role==="assistant"?s.question:void 0,answer:s.role==="user"?s.answer:void 0,onEdit:s.role==="user"?()=>E(o):void 0},o)),n&&e.jsx(R,{role:"assistant",question:n?.question??"",possibleAnswers:n.possibleAnswers,onAnswerSelect:v})]})})}),!n&&u==="update"&&e.jsx("div",{className:"p-2",children:e.jsxs("button",{className:"flex w-full items-center justify-center gap-2 rounded-lg border border-gray-200 bg-gray-200 p-2 hover:bg-gray-300",onClick:()=>{i([]),h(0),f("answering")},children:[e.jsx(k,{className:"size-4"}),"Reanswer all questions"]})}),n&&e.jsx("div",{className:"p-2",children:e.jsx("div",{className:"rounded-lg border border-gray-200 bg-white",children:e.jsxs("div",{className:"flex w-full items-center justify-between gap-2 p-2",children:[e.jsx("input",{ref:j,value:p,onChange:s=>m(s.target.value),className:"w-full bg-transparent text-sm focus:outline-none",placeholder:n.possibleAnswers?"Type your answer...":"Or type your own answer...",autoFocus:!0,onKeyDown:s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),v(p),m(""))}}),e.jsx("button",{type:"button",className:"flex size-7 shrink-0 items-center justify-center rounded-md hover:bg-gray-100 focus:outline-none disabled:cursor-not-allowed disabled:opacity-50",disabled:!p,onClick:()=>{v(p),m("")},children:e.jsx(B,{className:"size-4"})})]})})})]})})]})})}function R(t){const{role:r,question:g,answer:c,possibleAnswers:a,onAnswerSelect:i,onEdit:u}=t,x=a&&a.length>0;return e.jsxs("div",{className:C("flex w-fit items-center gap-2 rounded-lg border p-2 text-pretty",r==="user"&&"self-end border-gray-200 bg-gray-300/30",r==="assistant"&&"border-yellow-200 bg-yellow-300/30"),children:[r==="assistant"&&e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:C(x&&"mb-2"),children:g}),x&&i&&e.jsx("div",{className:"mt-2",children:e.jsx("div",{className:"flex flex-wrap gap-1.5",children:a.map(d=>e.jsx("button",{type:"button",className:"cursor-pointer rounded-md border border-yellow-300/50 bg-white/70 px-2 py-1 text-xs text-gray-700 hover:bg-white hover:shadow-sm focus:outline-none",onClick:()=>{i(d)},children:d},d))})})]}),r==="user"&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-sm",children:c}),u&&e.jsxs("div",{className:"group relative",children:[e.jsx("button",{type:"button",className:"flex size-6 shrink-0 items-center justify-center rounded-md text-gray-500 opacity-70 hover:bg-gray-100 hover:opacity-100 focus:outline-none",onClick:u,children:e.jsx(k,{className:"size-4"})}),e.jsx(D,{additionalClass:"-translate-y-2",position:"top-right",children:"Reanswer after this point"})]})]})]})}export{te as Q};
