import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{g as w}from"./jwt.1xGNZsvU.js";import{r as p}from"./index.Z3BHPS3u.js";import{u as C}from"./use-outside-click.DYGsxgbd.js";import{u as N}from"./use-keydown.r409VyJJ.js";import{ProgressShareButton as k}from"./ProgressShareButton.OUQB_89_.js";import{h as $}from"./http.BJhNQusg.js";import{u as I}from"./use-toast.BdCcSTJE.js";import{E as P}from"./ellipsis-vertical.Di0fjBX0.js";import{X as R}from"./x.BOdyWiWF.js";import{c as S}from"./classname.y9b8gBZq.js";import{g as E}from"./number.DnDLgi2j.js";function A(c){const{userId:u,resourceType:r,resourceId:s,isCustomResource:o,showClearButton:f=!0,onCleared:x}=c,d=I(),t=p.useRef(null),[m,a]=p.useState(!1),[h,l]=p.useState(!1),[g,n]=p.useState(!1);async function b(){l(!0);const{error:i,response:j}=await $("https://api.imoogleai.xyz/v1-clear-resource-progress",{resourceId:s,resourceType:r});if(i||!j){d.error("Error clearing progress. Please try again."),console.error(i),l(!1);return}localStorage.removeItem(`${r}-${s}-${u}-favorite`),localStorage.removeItem(`${r}-${s}-${u}-progress`),l(!1),n(!1),x&&x()}return C(t,()=>{a(!1)}),N("Escape",()=>{a(!1)}),e.jsxs("div",{className:"relative h-full",ref:t,children:[e.jsx("button",{className:"h-full text-gray-400 hover:text-gray-700",onClick:()=>a(!m),children:e.jsx(P,{size:16})}),m&&e.jsxs("div",{className:"absolute right-0 top-8 z-10 w-48 overflow-hidden rounded-md border border-gray-200 bg-white shadow-lg",children:[e.jsx(k,{resourceType:r,resourceId:s,isCustomResource:o,className:"w-full gap-1.5 p-2 hover:bg-gray-100"}),f&&e.jsxs(e.Fragment,{children:[!g&&e.jsx("button",{className:"flex w-full items-center gap-1.5 p-2 text-sm font-medium text-gray-500 hover:bg-gray-100 hover:text-black disabled:cursor-not-allowed disabled:opacity-70",onClick:()=>n(!0),disabled:h,children:h?"Processing...":e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"h-3.5 w-3.5"}),"Clear Progress"]})}),g&&e.jsxs("span",{className:"flex w-full items-center justify-between gap-1.5 p-2 text-sm font-medium text-gray-500 hover:bg-gray-100 hover:text-black disabled:cursor-not-allowed disabled:opacity-70",children:["Are you sure?",e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:b,className:"text-red-500 underline hover:text-red-800",children:"Yes"}),e.jsx("button",{onClick:()=>n(!1),className:"text-red-500 underline hover:text-red-800",children:"No"})]})]})]})]})]})}function q(c){const{showClearButton:u=!0,isCustomResource:r,showActions:s=!0,onResourceClick:o}=c,f=w()?.id,{updatedAt:x,resourceType:d,resourceId:t,title:m,totalCount:a,learningCount:h,doneCount:l,skippedCount:g,onCleared:n,roadmapSlug:b}=c;let i=d==="roadmap"?`/${t}`:`/best-practices/${t}`;r&&(i=`/r/${b}`);const j=l+g,v=E(j,a),y=o?"button":"a";return e.jsxs("div",{className:"relative",children:[e.jsxs(y,{...o?{onClick:o}:{href:i,target:"_blank"},className:S("group relative flex w-full items-center justify-between overflow-hidden rounded-md border border-gray-300 bg-white px-3 py-2 text-left text-sm transition-all hover:border-gray-400",s?"pr-7":""),children:[e.jsx("span",{className:"grow truncate",children:m}),e.jsxs("span",{className:"text-xs text-gray-400",children:[parseInt(v,10),"%"]}),e.jsx("span",{className:"absolute left-0 top-0 block h-full cursor-pointer rounded-tl-md bg-black/5 transition-colors group-hover:bg-black/10",style:{width:`${v}%`}})]}),s&&e.jsx("div",{className:"absolute right-2 top-0 flex h-full items-center",children:e.jsx(A,{userId:f,resourceType:d,resourceId:t,isCustomResource:r,onCleared:n,showClearButton:u})})]})}export{q as R};
