import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{a as oe,u as p,q as f}from"./query-client.zrB8z_yM.js";import{r as o}from"./index.Z3BHPS3u.js";import{r as re}from"./index.BlPpvBlM.js";import{u as ne}from"./use-keydown.r409VyJJ.js";import{c as ie,r as le,u as ce,S as de,a as me}from"./ListChatHistory.CAZ6Cv4y.js";import{c as g}from"./classname.y9b8gBZq.js";import{l as Q}from"./dom.B_TnKQIa.js";import{i as k}from"./jwt.1xGNZsvU.js";import{s as O}from"./popup.CdCAhVM2.js";import{s as xe}from"./slugger.rj1cS6co.js";import{a as ue}from"./ai-course.DKL-z0Ix.js";import{b as he}from"./billing.CL3NoBuc.js";import{h as pe}from"./query-http.DqGTNWG7.js";import{U as fe}from"./UpgradeAccountModal.DvmOKAPu.js";import{U as ge,R as ye,a as S,C as je}from"./UpdatePersonaModal.Bz0_EciZ.js";import{C as V}from"./TopicDetail.DG59Z_qP.js";import{L as be}from"./loader-circle.DfB4mNyf.js";import{B as we}from"./book-open.Dsgc4gH7.js";import{P as Ne}from"./plus.CstxCH0M.js";import{X as ve}from"./x.BOdyWiWF.js";import{C as Ce}from"./chevron-down.pBq1owZr.js";import{P as ke}from"./person-standing.DxKAUQm4.js";import{T as Se}from"./trash-2.CIQaIo_h.js";import{S as Ie}from"./send.BVE6djDn.js";import{W as J}from"./wand-sparkles.8eLpe3am.js";import{c as Ue}from"./createLucideIcon.BSLrQS80.js";/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]],Le=Ue("message-circle-plus",Te);function Ae(n){return oe({queryKey:["roadmap-questions",n],queryFn:()=>pe(`/v1-official-roadmap-questions/${n}`),refetchOnMount:!1})}function x(n){const{onClick:t,href:r,icon:a,children:i,className:y,target:u}=n,m=g("flex shrink-0 items-center gap-1.5 text-xs text-gray-600 transition-colors hover:text-gray-900 min-w-8",y);return!t&&!r?e.jsxs("span",{className:m,children:[a,i&&e.jsx("span",{className:"hidden sm:block",children:i})]}):r?e.jsxs("a",{href:r,target:u,rel:"noopener noreferrer",className:m,children:[a,i&&e.jsx("span",{className:"hidden sm:block",children:i})]}):e.jsxs("button",{onClick:t,className:m,children:[a,i&&e.jsx("span",{className:"hidden sm:block",children:i})]})}function Ee(n){const{onUpgradeClick:t}=n;return e.jsx("div",{className:"border-t border-gray-200 bg-black px-3 py-3",children:e.jsxs("div",{className:"flex items-center gap-2.5",children:[e.jsx(J,{className:"h-4 w-4 flex-shrink-0 text-white"}),e.jsxs("div",{className:"flex-1 text-sm",children:[e.jsx("p",{className:"mb-1 font-medium text-white",children:"You've reached your AI usage limit"}),e.jsx("p",{className:"text-xs text-gray-300",children:"Upgrade to Pro for relaxed limits and advanced features"})]}),e.jsx("button",{className:"flex-shrink-0 rounded-md bg-white px-3 py-1.5 text-xs font-medium text-black transition-colors hover:bg-gray-100",onClick:t,children:"Upgrade to Pro"})]})})}function Me(n){const{percentageUsed:t,onUpgradeClick:r}=n;return e.jsxs("button",{onClick:r,className:"flex items-center gap-2 rounded-md px-3 py-1.5 text-xs font-medium transition-all hover:bg-yellow-200",children:[e.jsxs("div",{className:"hidden items-center gap-1.5 sm:flex",children:[e.jsx("div",{className:"h-1.5 w-6 overflow-hidden rounded-full bg-gray-200",children:e.jsx("div",{className:g("h-full transition-all duration-300",t>=90?"bg-red-500":t>=70?"bg-yellow-500":"bg-green-500"),style:{width:`${Math.min(t,100)}%`}})}),e.jsxs("span",{className:"text-yellow-700",children:[t,"% used"]})]}),e.jsx("span",{className:"font-semibold text-yellow-800 underline underline-offset-2",children:"Upgrade"})]})}function cs(n){const{roadmapId:t}=n,[r,a]=o.useState(!1),i=o.useRef(null),[y,u]=o.useState(""),m=o.useRef(null),[H,P]=o.useState(!1),[W,h]=o.useState(!1),{data:j}=p(Ae(t),f),R=o.useMemo(()=>!j?.questions||j.questions.length===0?[]:[...j.questions].sort(()=>.5-Math.random()).slice(0,4),[j]),{data:q,isLoading:I}=p(me(t),f),D=k(),{data:b,isLoading:Oe}=p(ue(),f),d=D&&(b?.used||0)>=(b?.limit||0),Y=Math.round((b?.used||0)/(b?.limit||0)*100),{data:G,isLoading:He}=p(he(),f),U=G?.status==="active",z=o.useMemo(()=>{const s=["topic","subtopic","todo"];return q?.json?.nodes.filter(c=>s.includes(c.type||"")).length??0},[q]),B=(s,c)=>{const ae=xe(c)+"@"+s;window.dispatchEvent(new CustomEvent("roadmap.node.click",{detail:{resourceType:"roadmap",resourceId:t,topicId:ae,isCustomResource:!1}})),re.flushSync(()=>{a(!0)})},[X,w]=o.useState(!0),[l,N]=o.useState(),{data:v}=p(ie(l,le({roadmapId:t,totalTopicCount:z,onSelectTopic:B})),f),{aiChatHistory:T,isStreamingMessage:C,streamedMessage:L,showScrollToBottom:Z,setShowScrollToBottom:A,handleChatSubmit:F,handleAbort:ee,scrollToBottom:E,clearChat:se,setAiChatHistory:M}=ce({activeChatHistoryId:l,roadmapId:t,totalTopicCount:z,scrollareaRef:i,onSelectTopic:B,onChatHistoryIdChange:s=>{N(s)}});o.useEffect(()=>{v&&(M(v?.messages??[]),w(!1),setTimeout(()=>{E("instant")},0))},[v]),o.useEffect(()=>{l||(M([]),w(!1))},[l,M,w]),o.useEffect(()=>{Q(r)},[r]),ne("Escape",()=>{a(!1)}),o.useEffect(()=>{const s=()=>{Q(r)};return window.addEventListener(V,s),()=>{window.removeEventListener(V,s)}},[r,H]);function $(s){return{type:"doc",content:[{type:"paragraph",content:[{type:"text",text:s}]}]}}const _=()=>{if(!k()){a(!1),O();return}const s=y.trim();if(!s)return;const c=$(s);u(""),F(c,I)},K=T.length>0,te=`/${t}/ai${l?`?chatId=${l}`:""}`;return e.jsxs(e.Fragment,{children:[r&&e.jsx("div",{onClick:()=>{a(!1)},className:"fixed inset-0 z-50 bg-black opacity-50"}),W&&e.jsx(fe,{onClose:()=>{h(!1)}}),H&&e.jsx(ge,{roadmapId:t,onClose:()=>{P(!1)}}),e.jsxs("div",{className:g("animate-fade-slide-up fixed bottom-5 left-1/2 max-h-[95vh] max-w-[968px] -translate-x-1/4 transform flex-col gap-1.5 overflow-hidden px-4 duration-300 sm:max-h-[50vh] lg:flex",r?"z-91 h-full w-full":"z-40 w-auto"),children:[r&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"relative flex h-full w-full flex-col overflow-hidden rounded-lg bg-white shadow-lg",children:[X&&e.jsx("div",{className:"absolute inset-0 z-50 flex items-center justify-center bg-white",children:e.jsxs("div",{className:"flex items-center rounded-md border border-gray-200 py-2 pr-3 pl-2",children:[e.jsx(be,{className:"size-4 animate-spin stroke-[2.5] text-gray-400"}),e.jsx("span",{className:"ml-2 text-sm text-gray-500",children:"Loading history.."})]})}),e.jsxs("div",{className:"flex items-center justify-between px-3 py-2",children:[e.jsx("div",{className:"flex",children:e.jsx(x,{icon:e.jsx(we,{className:"h-3.5 w-3.5"}),className:"pointer-events-none text-sm",children:v?.title||"AI Tutor"})}),e.jsxs("div",{className:"flex gap-1.5",children:[U&&l&&e.jsx(x,{onClick:()=>{N(void 0),m.current?.focus()},icon:e.jsx(Ne,{className:"h-3.5 w-3.5"}),className:"justify-center rounded-md bg-gray-200 px-2 py-1 text-xs text-black hover:bg-gray-300"}),e.jsx(ye,{roadmapId:t,activeChatHistoryId:l,onChatHistoryClick:s=>{w(!0),N(s),A(!1)},onDelete:s=>{l===s&&N(void 0)},onUpgrade:()=>{h(!0)}}),e.jsx(x,{href:te,target:"_blank",icon:e.jsx(de,{className:"h-3.5 w-3.5"}),className:"hidden justify-center rounded-md bg-gray-200 px-1 py-1 text-gray-500 hover:bg-gray-300 sm:flex"}),e.jsx(x,{onClick:()=>a(!1),icon:e.jsx(ve,{className:"h-3.5 w-3.5"}),className:"flex items-center justify-center rounded-md bg-red-100 px-1 py-1 text-red-500 hover:bg-red-200"})]})]}),e.jsxs("div",{className:"flex flex-1 flex-grow flex-col overflow-y-auto px-3 py-2",ref:i,children:[e.jsxs("div",{className:"flex flex-col gap-2 text-sm",children:[e.jsx(S,{role:"assistant",jsx:e.jsx("span",{className:"mt-[2px]",children:"Hey, I am your AI tutor. How can I help you today? ðŸ‘‹"}),isIntro:!0}),T.length===0&&R.length>0&&e.jsxs("div",{className:"mt-0.5 mb-1",children:[e.jsx("p",{className:"mb-2 text-xs font-normal text-gray-500",children:"Some questions you might have about this roadmap:"}),e.jsx("div",{className:"flex flex-col justify-end gap-1",children:R.map((s,c)=>e.jsx("button",{className:"flex h-full self-start rounded-md bg-yellow-500/10 px-3 py-2 text-left text-sm text-black hover:bg-yellow-500/20",onClick:()=>{if(!k()){a(!1),O();return}if(d){h(!0),a(!1);return}F($(s),I)},children:s},`default-question-${c}`))})]}),T.map((s,c)=>e.jsx(o.Fragment,{children:e.jsx(S,{...s})},`chat-${c}`)),C&&!L&&e.jsx(S,{role:"assistant",html:"Thinking..."}),L&&e.jsx(S,{role:"assistant",jsx:L})]}),Z&&e.jsxs("button",{onClick:()=>{E("instant"),A(!1)},className:"sticky bottom-0 mx-auto mt-2 flex items-center gap-1.5 rounded-full bg-gray-900 px-3 py-1.5 text-xs text-white shadow-lg transition-all hover:bg-gray-800",children:[e.jsx(Ce,{className:"h-3 w-3"}),"Scroll to bottom"]})]}),d&&e.jsx(Ee,{onUpgradeClick:()=>{h(!0),a(!1)}}),!d&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-row justify-between border-t border-gray-200 px-3 pt-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(x,{onClick:()=>{if(!k()){a(!1),O();return}P(!0)},icon:e.jsx(ke,{className:"h-3.5 w-3.5"}),className:"rounded-md bg-gray-200 py-1 pr-2 pl-1.5 text-gray-500 hover:bg-gray-300",children:"Personalize"}),!U&&D&&e.jsx(Me,{percentageUsed:Y,onUpgradeClick:()=>{h(!0),a(!1)}})]}),K&&!U&&e.jsx(x,{onClick:()=>{u(""),se()},icon:e.jsx(Se,{className:"h-3.5 w-3.5"}),className:"rounded-md bg-gray-200 py-1 pr-2 pl-1.5 text-gray-500 hover:bg-gray-300",children:"Clear"})]}),e.jsxs("div",{className:"relative flex items-center text-sm",children:[e.jsx("input",{ref:m,type:"text",value:y,onChange:s=>u(s.target.value),autoFocus:!0,disabled:d,onKeyDown:s=>{if(s.key==="Enter"){if(s.preventDefault(),C)return;_()}},placeholder:d?"You have reached the usage limit for today..":"Ask me anything about this roadmap...",className:g("w-full resize-none px-3 py-4 outline-none",d&&"bg-gray-100 text-gray-400")}),e.jsx("button",{className:"absolute top-1/2 right-2 -translate-y-1/2 p-1 text-zinc-500 hover:text-black disabled:opacity-50",disabled:I||d,onClick:()=>{if(C){ee();return}_()},children:C?e.jsx(je,{className:"h-4 w-4"}):e.jsx(Ie,{className:"h-4 w-4"})})]})]})]})}),!r&&e.jsx("button",{className:g("relative mx-auto flex w-max flex-shrink-0 cursor-pointer items-center justify-center gap-2 rounded-full bg-stone-900 py-2.5 pr-8 pl-6 text-center text-white shadow-2xl transition-all duration-300 hover:scale-101 hover:bg-stone-800"),onClick:()=>{a(!0),setTimeout(()=>{E("instant"),A(!1)},0)},children:K?e.jsxs(e.Fragment,{children:[e.jsx(Le,{className:"size-5 text-yellow-400"}),e.jsx("span",{className:"mr-1 text-sm font-medium text-white",children:"Continue chatting.."})]}):e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"h-4 w-4 text-yellow-400"}),e.jsx("span",{className:"mr-1 text-sm font-semibold text-yellow-400",children:"AI Tutor"}),e.jsx("span",{className:"hidden text-white sm:block",children:"Have a question? Type here"}),e.jsx("span",{className:"block text-white sm:hidden",children:"Ask anything"})]})})]})]})}export{x as C,cs as R};
