import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as u}from"./index.Z3BHPS3u.js";import{u as M}from"./use-toast.BdCcSTJE.js";import{g as q}from"./browser.3c2kCsRM.js";import{a as D}from"./http.BJhNQusg.js";import{p as $}from"./page.DyYQD7MX.js";import{g as z}from"./date.2wIYh-wy.js";import{A as y,C as U,a as L}from"./ActivityTopicTitles.DLMiyJNa.js";import{c as S}from"./classname.y9b8gBZq.js";import{u as R}from"./index.BlfZEqDn.js";import{a as W}from"./team.D9_M1CfW.js";import"./js.cookie.Cz0CWeBA.js";import{M as E}from"./Modal.NtjGPDbq.js";import{A as O}from"./arrow-up-right.CWJoE-FU.js";import{C as I}from"./check.DflWYpXj.js";import{B as H}from"./book-open.Dsgc4gH7.js";import{L as B}from"./list-todo.DNwZsq61.js";import{P as G}from"./Pagination.DomnIFR-.js";import{c as V}from"./createLucideIcon.BSLrQS80.js";import"./toast.DlejBBdi.js";import"./index.3whys8t3.js";import"./fp.esm.CznIeghd.js";import"./jwt.1xGNZsvU.js";import"./index.BHh4vvK5.js";import"./use-outside-click.DYGsxgbd.js";import"./use-keydown.r409VyJJ.js";import"./x.BOdyWiWF.js";import"./number.DnDLgi2j.js";import"./ellipsis.BcvtAoad.js";/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=[["path",{d:"M8 6h10",key:"9lnwnk"}],["path",{d:"M6 12h9",key:"1g9pqf"}],["path",{d:"M11 18h7",key:"c8dzvl"}]],K=V("chart-no-axes-gantt",J);function Q(j){const{user:n,onTopicClick:T,teamId:a}=j,{activities:m}=n,v=R(W),[x,g]=u.useState(!1),o=t=>{const{resourceId:c,resourceTitle:d,resourceType:r,isCustomResource:p,resourceSlug:s}=t,i=r==="question"?`/questions/${c}`:r==="best-practice"?`/best-practices/${c}`:p&&r==="roadmap"?`/r/${s}`:`/${c}`;return e.jsx("a",{className:"font-medium underline transition-colors hover:cursor-pointer hover:text-black",target:"_blank",href:`${i}?t=${a}`,children:d})},l=t=>e.jsx("span",{className:"ml-1 text-xs text-gray-400",children:z(new Date(t).toISOString(),!0)}),w=n.avatar?`https://dodrc8eu8m09s.cloudfront.net/avatars/${n.avatar}`:"/images/default-avatar.png",N=v?.personalProgressOnly&&v.role==="member"&&n.memberId!==v.memberId,h=e.jsxs("a",{href:`/team/member?t=${a}&m=${n?.memberId}`,className:S("inline-flex items-center gap-1.5 underline underline-offset-2 hover:underline",N?"pointer-events-none cursor-default no-underline":""),onClick:t=>{N&&t.preventDefault()},"aria-disabled":N,children:[e.jsx("img",{className:"inline-block h-5 w-5 rounded-full",src:w,alt:n.name}),e.jsx("span",{className:"font-medium",children:n?.name||"Unknown"})]});if(m.length===1){const t=m[0],{actionType:c,topicTitles:d}=t,r=d?.length||0;return e.jsxs("li",{className:"flex flex-wrap items-center gap-1 rounded-md border px-2 py-2.5 text-sm bg-white",children:[c==="in_progress"&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"mb-1 flex w-full flex-wrap items-center",children:[h," started ",r," topic",r>1?"s":""," in ",o(t)," ",l(t.updatedAt)]}),e.jsx(y,{className:"pl-5",topicTitles:d||[]})]}),c==="done"&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"mb-1 flex w-full flex-wrap items-center",children:[h," completed ",r," topic",r>1?"s":""," in ",o(t)," ",l(t.updatedAt)]}),e.jsx(y,{className:"pl-5",topicTitles:d||[]})]}),c==="answered"&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"mb-1 flex w-full flex-wrap items-center",children:[h," answered ",r," question",r>1?"s":""," in ",o(t)," ",l(t.updatedAt)]}),e.jsx(y,{className:"pl-5",topicTitles:d||[]})]})]},n._id)}const A=new Set(m.map(t=>t.resourceId)).size,C=x?m.length:5;return e.jsxs("li",{className:"overflow-hidden bg-white rounded-md border",children:[e.jsxs("h3",{className:"flex flex-wrap items-center gap-1 bg-gray-100 px-2 py-2.5 text-sm",children:[h," has ",m.length," updates in ",A," resource(s)"]}),e.jsxs("div",{className:"py-3",children:[e.jsx("ul",{className:"ml-2 flex flex-col divide-y pr-2 sm:ml-[36px]",children:m.slice(0,C).map((t,c)=>{const{actionType:d,topicTitles:r}=t,p=r?.length||0;return e.jsxs("li",{className:S("text-sm text-gray-600",c===0?"pb-2.5":"py-2.5",c===m.length-1?"pb-0":""),children:[d==="in_progress"&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"mb-1",children:["Started ",p," topic",p>1?"s":""," in ",o(t)," ",l(t.updatedAt)]}),e.jsx(y,{topicTitles:r||[]})]}),d==="done"&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"mb-1",children:["Completed ",p," topic",p>1?"s":""," in ",o(t)," ",l(t.updatedAt)]}),e.jsx(y,{topicTitles:r||[]})]}),d==="answered"&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"mb-1",children:["Answered ",p," question",p>1?"s":""," in ",o(t)," ",l(t.updatedAt)]}),e.jsx(y,{topicTitles:r||[]})]})]},t._id)})}),m.length>5&&e.jsx("button",{className:"ml-2 mt-3 flex items-center gap-2 rounded-md border border-gray-300 p-1 text-xs uppercase tracking-wide text-gray-600 transition-colors hover:border-black hover:bg-black hover:text-white sm:ml-[36px]",onClick:()=>g(!x),children:x?e.jsxs(e.Fragment,{children:[e.jsx(U,{size:14}),"Show less"]}):e.jsxs(e.Fragment,{children:[e.jsx(L,{size:14}),"Show more"]})})]})]},n._id)}function X(j){const{activity:n,onClose:T}=j,{resourceId:a,resourceType:m,isCustomResource:v,topicTitles:x=[],actionType:g}=n;let o="";return m==="roadmap"?o=v?`/r/${a}`:`/${a}`:m==="best-practice"?o=`/best-practices/${a}`:o=`/questions/${a}`,e.jsx(E,{onClose:()=>{T()},children:e.jsxs("div",{className:"popup-body relative rounded-lg bg-white p-4 shadow-sm",children:[e.jsxs("span",{className:"mb-2 flex items-center justify-between text-lg font-semibold capitalize",children:[e.jsx("span",{className:"flex items-center gap-2",children:g.replace("_"," ")}),e.jsxs("a",{href:o,target:"_blank",className:"flex items-center gap-1 rounded-md border border-transparent py-0.5 pl-2 pr-1 text-sm font-normal text-gray-400 transition-colors hover:border-black hover:bg-black hover:text-white",children:["Visit Page"," ",e.jsx(O,{size:16,strokeWidth:2,className:"relative top-px"})]})]}),e.jsx("ul",{className:"flex max-h-[50vh] flex-col gap-1 overflow-y-auto max-md:max-h-full",children:x.map(l=>{const w=g==="done"?I:g==="in_progress"?H:I;return e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(w,{strokeWidth:3,className:"relative top-[4px] text-green-500",size:16}),l]},l)})})]})})}function Y(j){const{teamId:n}=j;return e.jsx("div",{className:"rounded-md",children:e.jsxs("div",{className:"flex flex-col items-center p-7 text-center sm:p-14",children:[e.jsx(B,{className:"mb-4 h-14 w-14 opacity-10"}),e.jsx("h2",{className:"text-lg font-semibold sm:text-lg",children:"No Activity"}),e.jsx("p",{className:"my-1 max-w-[400px] text-balance text-sm text-gray-500 sm:my-2 sm:text-base",children:"Team activity will appear here once members start tracking their progress."})]})})}function Pe(j){const{teamId:n,canManageCurrentTeam:T=!1}=j,{t:a=n}=q(),m=M(),[v,x]=u.useState(!0),[g,o]=u.useState(null),[l,w]=u.useState({data:{users:[],activities:[]},totalCount:0,totalPages:0,currPage:1,perPage:21}),[N,h]=u.useState(1),A=async(s=1)=>{const{response:i,error:k}=await D(`https://api.imoogleai.xyz/v1-get-team-activity/${a}`,{currPage:s});if(k||!i){m.error(k?.message||"Failed to get team activity");return}w(i),h(i.currPage)};u.useEffect(()=>{a&&(x(!0),w({data:{users:[],activities:[]},totalCount:0,totalPages:0,currPage:1,perPage:21}),h(1),A().then(()=>{$.set(""),x(!1)}))},[a]);const{users:C,activities:t}=l?.data,c=u.useMemo(()=>t?.filter(s=>s.activity.length>0&&s.activity.some(i=>(i?.topicTitles?.length||0)>0)),[t]),d=u.useMemo(()=>new Set(c?.map(s=>new Date(s.createdAt).setHours(0,0,0,0)).sort((s,i)=>new Date(i).getTime()-new Date(s).getTime())),[c]),r=u.useMemo(()=>{const s=[];for(const i of d){const k=c.filter(f=>new Date(f.createdAt).setHours(0,0,0,0)===i),_=C.map(f=>{const P=k.filter(b=>b.userId===f._id).flatMap(b=>b.activity).filter(b=>(b?.topicTitles?.length||0)>0).sort((b,F)=>new Date(F.updatedAt).getTime()-new Date(b.updatedAt).getTime());return{...f,activities:P}}).filter(f=>f.activities.length>0).sort((f,P)=>new Date(P.activities[0].updatedAt).getTime()-new Date(f.activities[0].updatedAt).getTime());s.push(..._)}return s},[C,t]),p=e.jsxs("h3",{className:"mb-3 flex h-[20px] w-full items-center justify-between text-xs uppercase text-gray-400",children:["Team Activity",e.jsx("span",{className:"mx-3 h-[1px] grow bg-gray-200"}),T&&e.jsxs("a",{href:`/team/progress?t=${a}`,className:"flex flex-row items-center rounded-full bg-gray-400 px-2.5 py-0.5 text-xs text-white transition-colors hover:bg-black",children:[e.jsx(K,{className:"mr-1.5 size-3",strokeWidth:2.5}),"Progresses"]})]});if(v)return e.jsxs(e.Fragment,{children:[p,e.jsx("div",{className:"flex flex-col gap-2",children:Array.from({length:4}).map((s,i)=>e.jsx("div",{className:"h-[70px] w-full animate-pulse rounded-lg border bg-gray-100"},i))})]});if(!a)if(typeof window<"u")window.location.href="/";else return null;return e.jsxs(e.Fragment,{children:[g&&e.jsx(X,{activity:g,onClose:()=>o(null)}),r.length>0?e.jsxs(e.Fragment,{children:[p,e.jsx("ul",{className:"mb-4 mt-2 flex flex-col gap-3",children:r.map((s,i)=>e.jsx(Q,{user:s,teamId:a,onTopicClick:o},`${s._id}-${i}`))}),e.jsx(G,{currPage:N,totalPages:l.totalPages,totalCount:l.totalCount,perPage:l.perPage,onPageChange:s=>{h(s),$.set("Loading..."),A(s).finally(()=>{$.set("")})}})]}):e.jsxs(e.Fragment,{children:[p,e.jsx("div",{className:"rounded-lg border bg-white p-4",children:e.jsx(Y,{teamId:a})})]})]})}export{Pe as TeamActivityPage};
