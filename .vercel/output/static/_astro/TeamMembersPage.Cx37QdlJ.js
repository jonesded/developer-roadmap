import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as l}from"./index.Z3BHPS3u.js";import{d as U,c as V,a as C,b as k}from"./http.BJhNQusg.js";import{u as O}from"./use-auth.Bw1nhFr_.js";import{p}from"./page.DyYQD7MX.js";import{u as _}from"./use-team-id.DuJRAVKZ.js";import{u as R}from"./use-outside-click.DYGsxgbd.js";import{I as B}from"./InviteMemberPopup.AuxaQ80C.js";import{g as A}from"./browser.3c2kCsRM.js";import{R as z}from"./RoleDropdown.DDwwSyDi.js";import{u as M}from"./index.BlfZEqDn.js";import{a as F,b as L}from"./team.D9_M1CfW.js";import{u as Y}from"./use-toast.BdCcSTJE.js";import{M as q}from"./MoreVerticalIcon.C41XtKgl.js";import{c as E}from"./classname.y9b8gBZq.js";import"./js.cookie.Cz0CWeBA.js";import"./fp.esm.CznIeghd.js";import"./jwt.1xGNZsvU.js";import"./index.3whys8t3.js";import"./ChevronDownIcon.CJEYWQ-F.js";import"./index.BHh4vvK5.js";import"./toast.DlejBBdi.js";function $(r){const{role:s,className:n}=r;return e.jsx("span",{className:E(`items-center rounded-full px-2 py-0.5 text-xs capitalize sm:flex ${["admin"].includes(s)?"bg-blue-100 text-blue-700 ":"bg-gray-100 text-gray-700 "} ${["manager"].includes(s)?"bg-green-100 text-green-700":""}`,n),children:s})}function G(r){const{onClose:s}=r,n=l.useRef(null),f=l.useRef(null),[d,g]=l.useState(""),[c,a]=l.useState(!1),[h,m]=l.useState(""),{teamId:i}=_();l.useEffect(()=>{m(""),g(""),f?.current?.focus()},[]);const b=async u=>{if(u.preventDefault(),a(!0),m(""),d.toUpperCase()!=="LEAVE"){m("Verification text does not match"),a(!1);return}const{response:x,error:v}=await U(`https://api.hnmdevs.com/v1-leave-team/${i}`,{});if(v||!x){a(!1),m(v?.message||"Something went wrong");return}window.location.href="/account?c=tl"},j=()=>{a(!1),m(""),g(""),s()};return R(n,j),e.jsx("div",{className:"popup fixed left-0 right-0 top-0 z-50 flex h-full items-center justify-center overflow-y-auto overflow-x-hidden bg-black/50",children:e.jsx("div",{className:"relative h-full w-full max-w-md p-4 md:h-auto",children:e.jsxs("div",{ref:n,className:"popup-body relative rounded-lg bg-white p-4 shadow-sm",children:[e.jsx("h2",{className:"text-2xl font-semibold text-black",children:"Leave Team"}),e.jsx("p",{className:"text-gray-500",children:"You will lose access to the team, the roadmaps and progress of other team members."}),e.jsx("p",{className:"-mb-2 mt-3 text-base font-medium text-black",children:'Please type "leave" to confirm.'}),e.jsxs("form",{onSubmit:b,children:[e.jsxs("div",{className:"my-4",children:[e.jsx("input",{ref:f,type:"text",name:"leave-team",id:"leave-team",className:"mt-2 block w-full rounded-md border border-gray-300 px-3 py-2 outline-hidden placeholder:text-gray-400 focus:border-gray-400",placeholder:'Type "leave" to confirm',required:!0,autoFocus:!0,value:d,onInput:u=>g(u.target.value)}),h&&e.jsx("p",{className:"mt-2 rounded-lg bg-red-100 p-2 text-red-700",children:h})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",disabled:c,onClick:j,className:"grow cursor-pointer rounded-lg bg-gray-200 py-2 text-center",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:c||d.toUpperCase()!=="LEAVE",className:"grow cursor-pointer rounded-lg bg-red-500 py-2 text-white disabled:opacity-40",children:c?"Please wait ..":"Leave Team"})]})]})]})})})}function X(r){const[s,n]=l.useState(!1);return e.jsxs(e.Fragment,{children:[s&&e.jsx(G,{onClose:()=>{n(!1)}}),e.jsx("button",{onClick:()=>{n(!0)},className:"flex h-7 min-w-[95px] items-center justify-center rounded-md border border-gray-200 bg-gray-50 px-2 py-1.5 text-sm font-medium leading-none text-red-600",children:"Leave team"})]})}function H(r){const{onClose:s,onUpdated:n,member:f}=r,d=l.useRef(null),[g,c]=l.useState(f.role),[a,h]=l.useState(!1),[m,i]=l.useState(""),{teamId:b}=_(),j=async x=>{x.preventDefault(),h(!0),i("");const{response:v,error:w}=await V(`https://api.hnmdevs.com/v1-update-member-role/${b}/${f._id}`,{role:g});if(w||!v){h(!1),i(w?.message||"Something went wrong");return}h(!1),n()},u=()=>{h(!1),i(""),s()};return R(d,u),e.jsx("div",{className:"popup fixed left-0 right-0 top-0 z-50 flex h-full items-center justify-center overflow-y-auto overflow-x-hidden bg-black/50",children:e.jsx("div",{className:"relative h-full w-full max-w-md p-4 md:h-auto",children:e.jsxs("div",{ref:d,className:"popup-body relative rounded-lg bg-white p-4 shadow-sm",children:[e.jsx("h3",{className:"mb-1.5 text-xl font-medium sm:text-2xl",children:"Update Role"}),e.jsx("p",{className:"mb-3 hidden text-sm leading-none text-gray-400 sm:block",children:"Select the role to update for this member"}),e.jsxs("form",{onSubmit:j,children:[e.jsxs("div",{className:"my-4 mt-0 flex flex-col gap-2 sm:mt-4",children:[e.jsx("span",{className:"mt-2 block w-full rounded-md bg-gray-100 p-2",children:f.invitedEmail}),e.jsx("div",{className:"flex h-[42px] w-full flex-col",children:e.jsx(z,{className:"h-full w-full",selectedRole:g,setSelectedRole:c})}),m&&e.jsx("p",{className:" rounded-md border border-red-300 bg-red-50 p-2 text-sm text-red-700",children:m})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",disabled:a,onClick:u,className:"grow cursor-pointer rounded-lg bg-gray-200 py-2 text-center",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:a||!g,className:"grow cursor-pointer rounded-lg bg-black py-2 text-center text-white disabled:opacity-40",children:a?"Please wait ..":"Update Role"})]})]})]})})})}function J({member:r,onUpdateMember:s,onDeleteMember:n,onResendInvite:f,isDisabled:d=!1,onSendProgressReminder:g,allowProgressReminder:c=!1,allowUpdateRole:a=!0}){const h=l.useRef(null),[m,i]=l.useState(!1),[b,j]=l.useState(!1);R(h,()=>{i(!1)});const u=[...a?[{name:"Update Role",handleClick:()=>{s(),i(!1)}}]:[],...c?[{name:"Send Progress Reminder",handleClick:()=>{g(),i(!1)}}]:[],...["invited"].includes(r.status)?[{name:"Resend Invite",handleClick:()=>{f(),i(!1)}}]:[],{name:"Delete",handleClick:()=>{n(),i(!1)}}];return e.jsxs("div",{className:"relative",children:[e.jsx("button",{disabled:d,onClick:()=>i(!m),className:"ml-2 flex items-center opacity-60 transition-opacity hover:opacity-100 disabled:cursor-not-allowed disabled:opacity-30",children:e.jsx(q,{className:"h-4 w-4"})}),m&&e.jsx("div",{ref:h,className:"align-right absolute right-0 top-full z-50 mt-1 w-[200px] rounded-md bg-slate-800 px-2 py-2 text-white shadow-md",children:e.jsx("ul",{children:u.map((x,v)=>e.jsx("li",{children:e.jsx("button",{onClick:x.handleClick,disabled:b,className:"flex w-full cursor-pointer items-center rounded-sm p-2 text-sm font-medium text-slate-100 hover:bg-slate-700",children:x.name})},v))})})]})}function I(r){const{member:s,index:n,onResendInvite:f,onUpdateMember:d,canManageCurrentTeam:g,userId:c,onDeleteMember:a,onSendProgressReminder:h,canViewProgress:m=!0}=r,i=M(F),b=M(L),j=m&&!s.hasProgress&&s.status==="joined",u=b&&!s.hasProgress&&s.status==="joined"&&s.userId!==c,x=i?.personalProgressOnly&&i.role==="member"&&String(s._id)!==i.memberId;return e.jsxs("div",{className:`flex items-center justify-between gap-2 p-3 ${n===0?"":"border-t"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:s.avatar?`https://dodrc8eu8m09s.cloudfront.net/avatars/${s.avatar}`:"/images/default-avatar.png",alt:s.name||"",className:"hidden h-10 w-10 rounded-full sm:block"}),e.jsxs("div",{children:[e.jsx("div",{className:"mb-1 flex items-center gap-2 sm:hidden",children:e.jsx($,{role:s.role})}),e.jsxs("div",{className:"flex items-center",children:[e.jsxs("h3",{className:"inline-grid grid-cols-[auto_auto_auto] items-center font-medium",children:[e.jsx("a",{href:`/team/member?t=${s.teamId}&m=${s._id}`,className:E("truncate",x?"pointer-events-none cursor-default no-underline":""),onClick:v=>{x&&v.preventDefault()},"aria-disabled":x,children:s.name}),j&&e.jsx("span",{className:"ml-2 rounded-full bg-red-400 px-2 py-0.5 text-xs font-normal text-white",children:"No Progress"}),s.userId===c&&e.jsx("span",{className:"ml-2 hidden text-xs font-normal text-blue-500 sm:inline",children:"You"})]}),e.jsxs("div",{className:"ml-2 flex items-center gap-0.5",children:[s.status==="invited"&&e.jsx("span",{className:"rounded-full bg-yellow-100 px-2 py-0.5 text-xs text-yellow-700",children:"Invited"}),s.status==="rejected"&&e.jsx("span",{className:"rounded-full bg-red-100 px-2 py-0.5 text-xs text-red-700",children:"Rejected"})]})]}),e.jsx("p",{className:"truncate text-sm text-gray-500",children:s.invitedEmail})]})]}),e.jsxs("div",{className:"flex shrink-0 items-center text-sm",children:[e.jsx("span",{className:"hidden sm:block",children:e.jsx($,{role:s.role})}),g&&e.jsx(J,{allowUpdateRole:s.status!=="rejected",allowProgressReminder:u,onResendInvite:f,onSendProgressReminder:h,onDeleteMember:a,isDisabled:s.userId===c,onUpdateMember:d,member:s})]})]})}const T=200;function be(){const{t:r}=A(),s=Y(),n=M(L),[f,d]=l.useState(),[g,c]=l.useState(!1),[a,h]=l.useState([]),[m,i]=l.useState(),b=O();async function j(){const{response:t,error:o}=await C(`https://api.hnmdevs.com/v1-get-team/${r}`);if(o||!t){s.error(o?.message||"Something went wrong");return}t&&i(t)}async function u(){const{response:t,error:o}=await C(`https://api.hnmdevs.com/v1-get-team-member-list/${r}`);if(o||!t){s.error(o?.message||"Failed to load team member list");return}h(t)}l.useEffect(()=>{r&&Promise.all([j(),u()]).finally(()=>{p.set("")})},[r]);async function x(t,o){p.set("Deleting member");const{response:N,error:y}=await U(`https://api.hnmdevs.com/v1-delete-member/${t}/${o}`,{});if(y||!N){s.error(y?.message||"Something went wrong");return}s.success("Member has been deleted"),await u()}async function v(t,o){p.set("Resending Invite");const{response:N,error:y}=await k(`https://api.hnmdevs.com/v1-resend-invite/${t}/${o}`,{});if(y||!N){s.error(y?.message||"Something went wrong");return}s.success("Invite has been sent")}async function w(t,o){p.set("Sending Reminder");const{response:N,error:y}=await k(`https://api.hnmdevs.com/v1-send-progress-reminder/${t}/${o}`,{});if(y||!N){s.error(y?.message||"Something went wrong");return}s.success("Reminder has been sent")}const D=a.filter(t=>t.status==="joined"),S=a.filter(t=>t.status==="invited"),P=a.filter(t=>t.status==="rejected");return e.jsxs("div",{children:[f&&e.jsx(H,{member:f,onUpdated:()=>{p.set("Refreshing members"),u().finally(()=>{p.set("")}),d(void 0),s.success("Member has been updated")},onClose:()=>{d(void 0)}}),g&&e.jsx(B,{onInvited:()=>{s.success("Invite sent"),u().then(()=>null),c(!1)},onClose:()=>{c(!1)}}),e.jsxs("div",{children:[e.jsxs("div",{className:"rounded-md border",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 border-b p-3",children:[e.jsxs("p",{className:"hidden text-sm sm:block",children:[a.length," people in the team."]}),e.jsxs("p",{className:"block text-sm sm:hidden",children:[a.length," members"]}),e.jsx(X,{teamId:m?._id})]}),D.map((t,o)=>e.jsx(I,{member:t,index:o,teamId:r,userId:b?.id,canViewProgress:n||!m?.personalProgressOnly||String(t.userId)===b?.id,onResendInvite:()=>{v(r,t._id).finally(()=>{p.set("")})},canManageCurrentTeam:n,onDeleteMember:()=>{x(r,t._id).finally(()=>{p.set("")})},onUpdateMember:()=>{d(t)},onSendProgressReminder:()=>{w(r,t._id).finally(()=>{p.set("")})}},o))]}),S.length>0&&e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"text-xs uppercase text-gray-400",children:"Invited Members"}),e.jsx("div",{className:"mt-2 rounded-md border",children:S.map((t,o)=>e.jsx(I,{member:t,index:o,teamId:r,userId:b?.id,canViewProgress:!1,onResendInvite:()=>{v(r,t._id).finally(()=>{p.set("")})},canManageCurrentTeam:n,onDeleteMember:()=>{x(r,t._id).finally(()=>{p.set("")})},onUpdateMember:()=>{d(t)},onSendProgressReminder:()=>{w(r,t._id).finally(()=>{p.set("")})}},o))})]}),P.length>0&&e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"text-xs uppercase text-gray-400",children:"Rejected Invites"}),e.jsx("div",{className:"mt-2 rounded-b-sm rounded-t-md border",children:P.map((t,o)=>e.jsx(I,{member:t,index:o,teamId:r,canViewProgress:!1,userId:b?.id,onResendInvite:()=>{v(r,t._id).finally(()=>{p.set("")})},canManageCurrentTeam:n,onDeleteMember:()=>{x(r,t._id).finally(()=>{p.set("")})},onUpdateMember:()=>{d(t)},onSendProgressReminder:()=>{w(r,t._id).finally(()=>{p.set("")})}},o))})]})]}),n&&e.jsx("div",{className:"mt-4",children:e.jsx("button",{disabled:a.length>=T,onClick:()=>c(!0),className:"block w-full rounded-md border border-dashed border-gray-300 py-2 text-sm transition-colors hover:border-gray-600 hover:bg-gray-50 focus:outline-0",children:"+ Invite Member"})}),a.length>=T&&n&&e.jsx("p",{className:"mt-2 rounded-lg bg-red-100 p-2 text-red-700",children:"You have reached the maximum number of members in a team. Please reach out to us if you need more."})]})}export{be as TeamMembersPage};
