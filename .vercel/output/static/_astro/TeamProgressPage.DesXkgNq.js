import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{u as w}from"./index.BlfZEqDn.js";import{r as g}from"./index.Z3BHPS3u.js";import{u as P}from"./use-auth.Bw1nhFr_.js";import{u as R}from"./use-toast.BdCcSTJE.js";import{g as C,s as I}from"./browser.3c2kCsRM.js";import{a as $}from"./http.BJhNQusg.js";import{p as T}from"./page.DyYQD7MX.js";import{a as S}from"./team.D9_M1CfW.js";import{E as _}from"./external-link.J5OYJvOa.js";import{M as E,a as A}from"./MemberCustomProgressModal.BPMGp1mi.js";import{c as y}from"./classname.y9b8gBZq.js";import"./js.cookie.Cz0CWeBA.js";import"./jwt.1xGNZsvU.js";import"./toast.DlejBBdi.js";import"./index.3whys8t3.js";import"./fp.esm.CznIeghd.js";import"./index.BHh4vvK5.js";import"./createLucideIcon.BSLrQS80.js";/* empty css                       *//* empty css                       */import"./index.gjAxZpWu.js";import"./Spinner.CPY-6wbR.js";import"./use-outside-click.DYGsxgbd.js";import"./use-keydown.r409VyJJ.js";import"./resource-progress.DnX2IG6-.js";import"./roadmap.DwTTnFhR.js";import"./dom.B_TnKQIa.js";import"./index.Dgut0sTl.js";import"./vue.BIhB9hsv.js";import"./transition.MUZrSsh7.js";import"./head.CbjsIJ-A.js";import"./x.BOdyWiWF.js";function G(l){const{onShowResourceProgress:o}=l,{members:c,resourceTitle:h,resourceId:b,isCustomResource:d,roadmapSlug:i}=l.roadmap,{t:a}=C(),u=P(),[n,x]=g.useState(!1),s=d?`/r/${i}`:`/${b}?t=${a}`;return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex h-full min-h-[270px] flex-col rounded-md border",children:[e.jsx("div",{className:"flex items-center gap-3 border-b p-3",children:e.jsxs("div",{className:"flex min-w-0 grow items-center justify-between",children:[e.jsx("h3",{className:"truncate font-medium",children:h}),e.jsx("a",{href:s,className:"group mb-0.5 flex shrink-0 items-center justify-between text-base font-medium leading-none text-black",target:"_blank",children:e.jsx(_,{className:"h-4 w-4 opacity-20 transition-opacity group-hover:opacity-100"})})]})}),e.jsxs("div",{className:"relative flex grow flex-col space-y-2 p-3",children:[(n?c:c.slice(0,4)).map(t=>{const j=u?.email===t?.member?.email;return t.progress?e.jsxs("button",{className:`group relative w-full overflow-hidden rounded-md border p-2 hover:border-gray-300 hover:text-black focus:outline-hidden ${j?"border-green-500 hover:border-green-600":""}`,onClick:()=>{o(t.member,t.progress?.resourceId)},children:[e.jsxs("span",{className:"relative z-10 flex items-center justify-between gap-1 text-sm",children:[e.jsxs("span",{className:"inline-grid grid-cols-[20px_auto] gap-3",children:[e.jsx("img",{src:t.member.avatar?`https://dodrc8eu8m09s.cloudfront.net/avatars/${t.member.avatar}`:"/images/default-avatar.png",alt:t.member.name||"",className:"h-5 w-5 shrink-0 rounded-full"}),e.jsx("span",{className:"inline-grid grid-cols-[auto_32px] items-center",children:e.jsx("span",{className:"mr-[5px] truncate",children:t?.member?.name})})]}),e.jsxs("span",{className:"shrink-0 text-xs text-gray-400",children:[t?.progress?.done," / ",t?.progress?.total]})]}),e.jsx("span",{className:`absolute inset-0 ${j?"bg-green-100 group-hover:bg-green-200":"bg-gray-100 group-hover:bg-gray-200"}`,style:{width:`${t?.progress?.done/t?.progress?.total*100}%`}})]},t?.member._id):null}),c.length>4&&!n&&e.jsxs("button",{onClick:()=>x(!0),className:"text-sm text-gray-400 underline",children:["+ ",c.length-4," more"]}),n&&e.jsx("button",{onClick:()=>x(!1),className:"text-sm text-gray-400 underline",children:"- Show less"}),c.length===0&&e.jsx("div",{className:"text-sm text-gray-500",children:"No progress"})]})]})})}function L(l){const{member:o,onShowResourceProgress:c,isMyProgress:h=!1,teamId:b}=l,d=w(S),i=o?.progress?.sort((s,t)=>t.done-s.done),[a,u]=g.useState(!1),n=d?.personalProgressOnly&&d.role==="member"&&String(o._id)!==d.memberId,x=`/team/member?t=${b}&m=${o._id}`;return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex h-full min-h-[270px] flex-col overflow-hidden rounded-md border",children:[e.jsxs("div",{className:"relative flex items-center gap-3 border-b p-3",children:[e.jsx("img",{src:o.avatar?`https://dodrc8eu8m09s.cloudfront.net/avatars/${o.avatar}`:"/images/default-avatar.png",alt:o.name||"",className:"h-8 min-h-[32px] w-8 min-w-[32px] rounded-full"}),e.jsxs("div",{className:"inline-grid w-full",children:[!h&&e.jsx("a",{href:x,className:y("truncate font-medium",n?"pointer-events-none cursor-default no-underline":""),onClick:s=>{n&&s.preventDefault()},"aria-disabled":n,children:o.name}),h&&e.jsxs("div",{className:"inline-grid grid-cols-[auto_32px] items-center gap-1.5",children:[e.jsx("a",{href:x,className:y("truncate font-medium",n?"pointer-events-none cursor-default no-underline":""),onClick:s=>{n&&s.preventDefault()},"aria-disabled":n,children:o.name}),e.jsx("span",{className:"rounded-md bg-red-500 px-1 py-0.5 text-xs text-white",children:"You"})]}),e.jsx("p",{className:"truncate text-sm text-gray-500",children:o.email})]})]}),e.jsxs("div",{className:"relative flex grow flex-col space-y-2 p-3",children:[(a?i:i.slice(0,4)).map(s=>e.jsxs("button",{onClick:()=>c(s.resourceId,s.isCustomResource),className:"group relative overflow-hidden rounded-md border p-2 hover:border-gray-300 hover:text-black focus:outline-hidden",children:[e.jsxs("span",{className:"relative z-10 flex items-center justify-between text-sm",children:[e.jsx("span",{className:"inline-grid",children:e.jsx("span",{className:"truncate",children:s.resourceTitle})}),e.jsxs("span",{className:"ml-1.5 shrink-0 text-xs text-gray-400",children:[s.done," / ",s.total]})]}),e.jsx("span",{className:"absolute inset-0 bg-gray-100 group-hover:bg-gray-200",style:{width:`${s.done/s.total*100}%`}})]},s.resourceId)),i.length>4&&!a&&e.jsxs("button",{onClick:()=>u(!0),className:"text-sm text-gray-400 underline",children:["+ ",i.length-4," more"]}),a&&e.jsx("button",{onClick:()=>u(!1),className:"text-sm text-gray-400 underline",children:"- Show less"}),i.length===0&&e.jsx("div",{className:"text-sm text-gray-500",children:"No progress"})]})]},o._id)})}const D=[{label:"Members",value:"member"},{label:"Roadmaps",value:"roadmap"}];function be(){const{t:l,gb:o}=C(),[c,h]=g.useState(!0),b=R(),d=w(S),i=P(),[a,u]=g.useState(),[n,x]=g.useState([]),[s,t]=g.useState(o||"member");async function j(){const{response:r,error:p}=await $(`https://api.roadmap.sh/v1-get-team-progress/${l}`);if(p||!r){b.error(p?.message||"Failed to get team progress");return}x(r.sort((m,f)=>m.email===i?.email?-1:f.email===i?.email?1:0))}g.useEffect(()=>{l&&j().then(()=>{T.set(""),h(!1)})},[l]),g.useEffect(()=>{s&&I({gb:s})},[s]);const N=[];for(const r of d?.roadmaps||[]){let p=!1;const m=[];for(const f of n){const v=f.progress.find(M=>M.resourceId===r);v&&(v.isCustomResource&&!p&&(p=!0),m.push({member:f,progress:v}))}m.length&&N.push({resourceId:r,resourceTitle:m?.[0].progress?.resourceTitle||"",resourceType:"roadmap",roadmapSlug:m?.[0].progress?.roadmapSlug,members:m,isCustomResource:p})}if(!l){window.location.href="/";return}if(c)return null;const k=a&&!a.isCustomResource?E:A;return e.jsxs("div",{children:[a&&e.jsx(k,{member:a.member,teamId:l,resourceId:a.resourceId,resourceType:"roadmap",isCustomResource:a.isCustomResource,onClose:()=>{u(void 0)},onShowMyProgress:()=>{u({resourceId:a.resourceId,member:n.find(r=>r.email===i?.email),isCustomResource:a.isCustomResource})}}),e.jsx("div",{className:"flex items-center gap-2",children:D.map(r=>e.jsx("button",{className:`rounded-md border p-1 px-2 text-sm ${s===r.value?"border-gray-400 bg-gray-200":""}`,onClick:()=>t(r.value),children:r.label},r.value))}),e.jsxs("div",{className:"mt-6",children:[s==="roadmap"&&e.jsx("div",{className:"grid gap-4 sm:grid-cols-2",children:N.map(r=>e.jsx(G,{roadmap:r,onShowResourceProgress:(p,m)=>{u({resourceId:m,member:p,isCustomResource:r.isCustomResource})}},r.resourceId))}),s==="member"&&e.jsx("div",{className:"grid gap-4 sm:grid-cols-2",children:n.map(r=>d?.role!=="member"||!d?.personalProgressOnly||r.email===i?.email?e.jsx(L,{member:r,teamId:l,isMyProgress:r?.email===i?.email,onShowResourceProgress:(m,f)=>{u({resourceId:m,member:r,isCustomResource:f})}},r._id):null)})]})]})}export{be as TeamProgressPage};
