import{c as T}from"./createLucideIcon.BSLrQS80.js";import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{c as F}from"./classname.y9b8gBZq.js";import{U as E}from"./user-round.D2mOPNuO.js";import{B as D}from"./bot.CQ2bIWO6.js";import{P as B,a as _,b as q}from"./Popover.j-Qljcb0.js";import{r as t}from"./index.Z3BHPS3u.js";import{u as H,q as j}from"./query-client.zrB8z_yM.js";import{b as A,l as Q,g as V,U as W,d as J,C as X,e as O,f as U,a as $}from"./ListChatHistory.B5hG0Bws.js";import{i as z}from"./jwt.1xGNZsvU.js";import{b as K}from"./billing.Dog7Gwv_.js";import{s as Y}from"./popup.CdCAhVM2.js";import{L as M}from"./loader-circle.DfB4mNyf.js";import{u as Z}from"./useMutation.BxVH4XRI.js";import{M as ee}from"./Modal.NtjGPDbq.js";import{M as R}from"./message-circle.C1uJbl19.js";import{a as se}from"./query-http.Bohx3EqF.js";import{u as te}from"./use-toast.BdCcSTJE.js";import{S as ae}from"./Spinner.CPY-6wbR.js";import{X as re}from"./x.BOdyWiWF.js";/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"10",x2:"10",y1:"15",y2:"9",key:"c1nkhi"}],["line",{x1:"14",x2:"14",y1:"15",y2:"9",key:"h65svq"}]],Pe=T("circle-pause",oe);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]],ne=T("history",ie);function Fe(d){const{role:r,html:a,jsx:i,isIntro:h=!1}=d;return e.jsx("div",{className:F("flex flex-col rounded-lg",r==="user"?"bg-gray-300/30":"bg-yellow-500/30"),children:e.jsxs("div",{className:"flex items-start gap-2.5 p-3",children:[e.jsx("div",{className:F("flex size-6 shrink-0 items-center justify-center rounded-full",r==="user"?"bg-gray-200 text-black":"bg-yellow-400 text-black"),children:r==="user"?e.jsx(E,{className:"size-4 stroke-[2.5]"}):e.jsx(D,{className:"size-4 stroke-[2.5]"})}),!!i&&i,!!a&&e.jsx("div",{className:"course-content course-ai-content prose prose-sm mt-0.5 w-full max-w-[calc(100%-38px)] overflow-hidden text-sm",dangerouslySetInnerHTML:{__html:a}})]})})}function He(d){const{roadmapId:r,activeChatHistoryId:a,activeChatHistoryTitle:i,onChatHistoryClick:h,onDelete:n,onUpgrade:m}=d,[f,c]=t.useState(!1),[u,o]=t.useState(!0),[k,y]=t.useState(""),{data:N,isLoading:b}=H(K(),j),g=N?.status==="active",{data:x,hasNextPage:P,fetchNextPage:S,isFetchingNextPage:v,isLoading:I}=A({...Q({roadmapId:r,query:k}),enabled:!!r&&z()&&f&&g},j);t.useEffect(()=>{g||o(!1)},[g]),t.useEffect(()=>{!x||b||o(!1)},[x,b]);const C=t.useMemo(()=>{const l=x?.pages?.flatMap(p=>p.data);return V(l??[])},[x?.pages]),L=Object.values(C??{}).every(l=>l.histories.length===0);return e.jsxs(B,{open:f,onOpenChange:l=>{if(!z()){Y();return}c(l)},children:[e.jsxs(_,{className:"flex items-center justify-center gap-2 rounded-md bg-gray-200 px-3 py-1.5 text-xs text-gray-900 hover:bg-gray-300 hover:text-black",children:[e.jsx(ne,{className:"size-3.5"}),i||"Chat History"]}),e.jsxs(q,{className:"z-[999] flex max-h-[400px] w-80 flex-col overflow-hidden p-0 shadow-lg",align:"end",sideOffset:4,children:[u&&e.jsx("div",{className:"flex items-center justify-center py-10",children:e.jsx(M,{className:"size-6 animate-spin stroke-[2.5] text-gray-400"})}),!u&&!g&&e.jsx(W,{className:"mt-0 px-10 py-10",onUpgrade:()=>{c(!1),m?.()}}),!u&&g&&e.jsxs(e.Fragment,{children:[e.jsx(J,{onSearch:y,isLoading:I,className:"mt-0",inputClassName:"border-x-0 border-t-0 border-b border-b-gray-200 rounded-none focus:border-b-gray-200"}),e.jsxs("div",{className:"scrollbar-track-transparent scrollbar-thin scrollbar-thumb-gray-300 grow space-y-4 overflow-y-auto p-2 pt-4",children:[L&&e.jsx("div",{className:"flex items-center justify-center py-10",children:e.jsx("p",{className:"text-sm text-gray-500",children:"No chat history"})}),Object.entries(C??{}).map(([l,p])=>p.histories.length===0?null:e.jsx(X,{title:p.title,histories:p.histories,activeChatHistoryId:a,onChatHistoryClick:w=>{c(!1),h(w)},onDelete:w=>{c(!1),n?.(w)}},l)),P&&e.jsx("div",{className:"mt-4",children:e.jsxs("button",{className:"flex w-full items-center justify-center gap-2 text-sm text-gray-500 hover:text-black",onClick:()=>{S()},disabled:v,children:[v&&e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"h-4 w-4 animate-spin"}),"Loading more..."]}),!v&&"Load More"]})})]})]})]})]})}function le(d){const{roadmapTitle:r,defaultValues:a,className:i="",onSubmit:h,isLoading:n}=d,[m,f]=t.useState(a?.expertise??""),c=["Finding a job","Learning for fun","Building a side project","Switching careers","Getting a promotion","Filling knowledge gaps","Other"],u=()=>{if(!a?.goal)return"";for(const s of c.slice(0,-1))if(a.goal.startsWith(s))return s;return"Other"},[o,k]=t.useState(u()),[y,N]=t.useState(a?.goal??""),[b,g]=t.useState(a?.commit??""),[x,P]=t.useState(a?.about??""),S=t.useId(),v=t.useId(),I=t.useId(),C=t.useId(),L=t.useId(),l=t.useRef(null),p=s=>{k(s),s==="Other"?(N(""),setTimeout(()=>{l.current?.focus()},0)):N(s)},w=s=>{s.preventDefault(),h({expertise:m,goal:y,commit:b,about:x})},G=!!m&&!!y&&!!b;return e.jsxs("form",{onSubmit:w,className:F("space-y-5",i),children:[e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("label",{className:"text-sm font-medium text-gray-700",htmlFor:S,children:["Rate your expertise in ",r,":"]}),e.jsxs(O,{id:S,value:m,defaultValue:m,onChange:s=>f(s.target.value),className:"h-[40px] border-gray-300 text-sm focus:border-gray-500 focus:ring-1 focus:ring-gray-500",children:[e.jsx("option",{value:"",children:"Select your expertise"}),["No experience (just starting out)","Beginner (less than 1 year of experience)","Intermediate (1-3 years of experience)","Expert (3-5 years of experience)","Master (5+ years of experience)"].map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",htmlFor:I,children:"What is your goal?"}),e.jsxs(O,{id:I,value:o,onChange:s=>p(s.target.value),className:"h-[40px] border-gray-300 text-sm focus:border-gray-500 focus:ring-1 focus:ring-gray-500",children:[e.jsx("option",{value:"",children:"Select your goal"}),c.map(s=>e.jsx("option",{value:s,children:s},s))]}),o==="Other"&&e.jsx("textarea",{ref:l,id:v,className:"block min-h-24 w-full resize-none rounded-lg border border-gray-300 bg-white px-4 py-3 text-sm outline-none placeholder:text-gray-400 focus:border-gray-500 focus:ring-1 focus:ring-gray-500",placeholder:"e.g. need to find a job as soon as possible",value:y,onChange:s=>N(s.target.value)})]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",htmlFor:C,children:"How many hours per week can you commit to learning?"}),e.jsx("input",{id:C,className:"block h-[40px] w-full resize-none rounded-lg border border-gray-300 bg-white px-4 text-sm outline-none placeholder:text-gray-400 focus:border-gray-500 focus:ring-1 focus:ring-gray-500",placeholder:"e.g. 10 hours per week",value:b,onChange:s=>g(s.target.value)})]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",htmlFor:L,children:"Tell us about yourself (optional but recommended)"}),e.jsx("textarea",{id:L,className:"block min-h-24 w-full resize-none rounded-lg border border-gray-300 bg-white px-4 py-3 text-sm outline-none placeholder:text-gray-400 focus:border-gray-500 focus:ring-1 focus:ring-gray-500",placeholder:"e.g. I'm a frontend developer with experience in React, looking to expand my backend skills...",value:x,onChange:s=>P(s.target.value)})]}),e.jsx("button",{disabled:n||!G,type:"submit",className:"mt-6 flex h-11 w-full items-center justify-center gap-2 rounded-lg bg-black px-6 py-2 text-sm text-white transition-all hover:bg-gray-900 disabled:pointer-events-none disabled:opacity-50",children:n?e.jsx(M,{className:"size-4 animate-spin stroke-[2.5]"}):e.jsx(e.Fragment,{children:a?e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"size-4"}),"Update Information"]}):e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"size-4"}),"Start Chatting"]})})})]})}function Me(d){const{roadmapId:r,onClose:a}=d,i=te(),{data:h}=H($(r),j),{data:n,isLoading:m}=H(U(r),j),{mutate:f,isPending:c}=Z({mutationFn:async o=>se("/v1-set-user-persona",{...o,roadmapId:r}),onError:o=>{i.error(o?.message||"Something went wrong")},onSuccess:()=>{a()},onSettled:()=>j.invalidateQueries(U(r))},j),u=h?.json.title??"";return e.jsxs(ee,{onClose:a,wrapperClassName:"max-w-[450px]",bodyClassName:"p-4",children:[e.jsx("button",{onClick:a,className:"absolute top-2.5 right-2.5 inline-flex items-center rounded-lg bg-transparent p-1.5 text-sm text-gray-400 hover:bg-gray-200 hover:text-gray-900",children:e.jsx(re,{className:"h-5 w-5"})}),m&&e.jsxs("div",{className:"absolute inset-0 z-50 flex h-full flex-row items-center justify-center gap-3 bg-white",children:[e.jsx(ae,{isDualRing:!1,className:"h-4 w-4"}),e.jsx("p",{className:"text-base text-gray-500",children:"Loading..."})]}),e.jsxs("div",{className:"mb-4 text-left",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Tell us more about yourself"}),e.jsx("p",{className:"mt-1 text-sm text-balance text-gray-500",children:"We'll use this information to help you get the best out of the AI Tutor."})]}),e.jsx(le,{className:"space-y-4",roadmapTitle:u,defaultValues:{expertise:n?.expertise??"",goal:n?.goal??"",commit:n?.commit??"",about:n?.about??""},onSubmit:o=>{if(!o?.goal?.trim()){i.error("Please describe your goal");return}if(!o?.commit?.trim()){i.error("Please enter how many hours per week you can commit to learning");return}f(o)},isLoading:c},n?"loaded":"loading")]})}export{Pe as C,ne as H,He as R,Me as U,Fe as a,le as b};
