import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{q as f,u as y}from"./query-client.zrB8z_yM.js";import{r as o}from"./index.Z3BHPS3u.js";import{g as w,s as P,d as j}from"./browser.3c2kCsRM.js";import{i as N}from"./jwt.1xGNZsvU.js";import{s as C}from"./popup.CdCAhVM2.js";import{l as A}from"./ai-guide.DNmruq-p.js";import{A as L,a as S}from"./AITutorTallMessage.BWFj9o8p.js";import{U}from"./UpgradeAccountModal.fZmxo5nD.js";import{P as _}from"./Pagination.DomnIFR-.js";import{u as I}from"./use-outside-click.DYGsxgbd.js";import{u as q}from"./use-keydown.r409VyJJ.js";import{u as k}from"./use-toast.BdCcSTJE.js";import{u as E}from"./useMutation.BxVH4XRI.js";import{b as G}from"./query-http.BQfMbvYq.js";import{E as T}from"./ellipsis-vertical.Di0fjBX0.js";import{A as F}from"./arrow-up-right.CWJoE-FU.js";import{T as O}from"./trash-2.CIQaIo_h.js";import{u as D}from"./billing.D5yrowA9.js";import{a as M}from"./ai-course.DbIkPj3f.js";import{A as R}from"./AIUsageWarning.DeVtS8bX.js";import{L as B}from"./loader-circle.DfB4mNyf.js";import{B as $}from"./book-open.Dsgc4gH7.js";import"./js.cookie.Cz0CWeBA.js";import"./markdown.CL3gtrVM.js";import"./preload-helper.BlTxHScW.js";import"./use-debounce.CXZLeMbB.js";import"./search.CUAljTEc.js";import"./createLucideIcon.BSLrQS80.js";import"./Modal.NtjGPDbq.js";import"./classname.y9b8gBZq.js";import"./x.BOdyWiWF.js";import"./UpdatePlanConfirmation.CPFKRCnq.js";import"./VerifyUpgrade.ButUjaV5.js";import"./circle-check-big.CnV0y9bI.js";import"./zap.BNbCfd_G.js";import"./message-circle.C1uJbl19.js";import"./map.DuWy2ZcB.js";import"./number.DnDLgi2j.js";import"./ellipsis.BcvtAoad.js";import"./toast.DlejBBdi.js";import"./index.3whys8t3.js";import"./fp.esm.CznIeghd.js";function z(n){const{guideSlug:r,onDeleted:d}=n,u=k(),s=o.useRef(null),[a,m]=o.useState(!1),[h,g]=o.useState(!1),{mutate:x,isPending:l}=E({mutationFn:async()=>G(`/v1-delete-ai-guide/${r}`),onSuccess:()=>{u.success("Guide deleted"),f.invalidateQueries({predicate:t=>t.queryKey?.[0]==="user-ai-guides"}),d?.()},onError:t=>{u.error(t?.message||"Failed to delete guide")}},f);return I(s,()=>{m(!1)}),q("Escape",()=>{m(!1)}),e.jsxs("div",{className:"relative h-full",ref:s,children:[e.jsx("button",{className:"h-full text-gray-400 hover:text-gray-700",onClick:t=>{t.stopPropagation(),m(!a)},children:e.jsx(T,{size:16})}),a&&e.jsxs("div",{className:"absolute top-8 right-0 z-10 w-48 overflow-hidden rounded-md border border-gray-200 bg-white shadow-lg",children:[e.jsxs("a",{href:`/ai/guide/${r}`,className:"flex w-full items-center gap-1.5 p-2 text-sm font-medium text-gray-500 hover:bg-gray-100 hover:text-black disabled:cursor-not-allowed disabled:opacity-70",children:[e.jsx(F,{className:"h-3.5 w-3.5"}),"View Guide"]}),!h&&e.jsx("button",{className:"flex w-full items-center gap-1.5 p-2 text-sm font-medium text-gray-500 hover:bg-gray-100 hover:text-black disabled:cursor-not-allowed disabled:opacity-70",onClick:()=>g(!0),disabled:l,children:l?"Deleting...":e.jsxs(e.Fragment,{children:[e.jsx(O,{className:"h-3.5 w-3.5"}),"Delete Guide"]})}),h&&e.jsxs("span",{className:"flex w-full items-center justify-between gap-1.5 p-2 text-sm font-medium text-gray-500 hover:bg-gray-100 hover:text-black disabled:cursor-not-allowed disabled:opacity-70",children:["Are you sure?",e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{g(!1),x()},disabled:l,className:"text-red-500 underline hover:text-red-800",children:"Yes"}),e.jsx("button",{onClick:()=>g(!1),className:"text-red-500 underline hover:text-red-800",children:"No"})]})]})]})]})}function K(n){const{guide:r,showActions:d=!0}=n;return e.jsxs("div",{className:"relative flex flex-grow flex-col",children:[e.jsx("a",{href:`/ai/guide/${r.slug}`,className:"group relative flex h-full min-h-[120px] w-full flex-col overflow-hidden rounded-lg border border-gray-200 bg-white p-3 text-left hover:border-gray-300 hover:bg-gray-50 sm:p-4",children:e.jsxs("div",{className:"relative max-h-[180px] min-h-[140px] overflow-y-hidden sm:max-h-[200px] sm:min-h-[160px]",children:[e.jsx("div",{className:"prose prose-sm prose-pre:bg-gray-100 [&_h1]:hidden [&_h1:first-child]:block [&_h1:first-child]:text-base [&_h1:first-child]:leading-[1.35] [&_h1:first-child]:font-bold [&_h1:first-child]:text-pretty sm:[&_h1:first-child]:text-lg [&_h2]:hidden [&_h3]:hidden [&_h4]:hidden [&_h5]:hidden [&_h6]:hidden",dangerouslySetInnerHTML:{__html:r.html}}),e.jsx("div",{className:"absolute inset-x-0 bottom-0 h-12 bg-gradient-to-t from-white to-transparent group-hover:from-gray-50 sm:h-16"})]})}),d&&r.slug&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx(z,{guideSlug:r.slug})})]})}function Ge(){const[n,r]=o.useState(!0),[d,u]=o.useState(!1),[s,a]=o.useState({perPage:"21",currPage:"1",query:""}),{isPaidUser:m,isLoading:h}=D(),{data:g,isLoading:x}=y(M(),f),l=g?.guide,{data:t,isFetching:v}=y(A(s),f);o.useEffect(()=>{r(!1)},[t]);const b=t?.data??[];o.useEffect(()=>{const i=w();a({...s,currPage:i?.p||"1",query:i?.q||""})},[]),o.useEffect(()=>{s?.currPage!=="1"||s?.query!==""?P({p:s?.currPage||"1",q:s?.query||""}):(j("p"),j("q"))},[s]);const c=N(),p=v||n||h||x;return e.jsxs(e.Fragment,{children:[d&&e.jsx(U,{onClose:()=>u(!1)}),e.jsx(L,{value:s?.query||"",onChange:i=>{a({...s,query:i,currPage:"1"})},disabled:p,placeholder:"Search guides..."}),p&&e.jsxs("p",{className:"mb-4 flex flex-row items-center gap-2 text-sm text-gray-500",children:[e.jsx(B,{className:"h-4 w-4 animate-spin"}),"Loading your guides..."]}),!p&&e.jsxs(e.Fragment,{children:[e.jsx(R,{type:"guide",totalCount:t?.totalCount,isPaidUser:m,usedCount:l?.used,limitCount:l?.limit,onUpgrade:()=>u(!0)}),c&&!p&&b.length>0&&e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("div",{className:"grid grid-cols-1 gap-2 md:grid-cols-2 xl:grid-cols-3",children:b.map(i=>e.jsx(K,{guide:i},i._id))}),e.jsx(_,{totalCount:t?.totalCount||0,totalPages:t?.totalPages||0,currPage:Number(t?.currPage||1),perPage:Number(t?.perPage||10),onPageChange:i=>{a({...s,currPage:String(i)})},className:"rounded-lg border border-gray-200 bg-white p-4"})]}),!p&&b.length===0&&e.jsx(S,{title:c?"No guides found":"Sign up or login",subtitle:c?"You haven't generated any guides yet.":"Takes 2s to sign up and generate your first guide.",icon:$,buttonText:c?"Create your first guide":"Sign up or login",onButtonClick:()=>{c?window.location.href="/ai":C()}})]})]})}export{Ge as UserGuidesList};
