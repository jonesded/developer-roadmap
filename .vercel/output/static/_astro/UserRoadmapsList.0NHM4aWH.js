import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{q as x,u as y}from"./query-client.zrB8z_yM.js";import{r as o}from"./index.Z3BHPS3u.js";import{g as w,s as P,d as j}from"./browser.3c2kCsRM.js";import{A as N,a as C}from"./AITutorTallMessage.BWFj9o8p.js";import{U as A}from"./UpgradeAccountModal.BrBqMRqO.js";import{P as L}from"./Pagination.DomnIFR-.js";import{i as S}from"./jwt.1xGNZsvU.js";import{s as U}from"./popup.CdCAhVM2.js";import{l as R}from"./ai-roadmap.lQN55fhB.js";import{g as q}from"./date.2wIYh-wy.js";import{c as I}from"./classname.y9b8gBZq.js";import{u as k}from"./use-outside-click.DYGsxgbd.js";import{u as E}from"./use-keydown.r409VyJJ.js";import{u as T}from"./use-toast.BdCcSTJE.js";import{u as F}from"./useMutation.BxVH4XRI.js";import{b as O}from"./query-http.DnxAGGjD.js";import{E as D}from"./ellipsis-vertical.Di0fjBX0.js";import{P as B}from"./play.-yCdF7S0.js";import{T as M}from"./trash-2.CIQaIo_h.js";import{C as $}from"./calendar.DJD-aIIP.js";import{a as z}from"./ai-course.JYmLWeiN.js";import{u as K}from"./billing.D4Dkc83P.js";import{A as Q}from"./AIUsageWarning.DeVtS8bX.js";import{L as V}from"./loader-circle.DfB4mNyf.js";import{B as Y}from"./book-open.Dsgc4gH7.js";import"./use-debounce.CXZLeMbB.js";import"./search.CUAljTEc.js";import"./createLucideIcon.BSLrQS80.js";import"./Modal.NtjGPDbq.js";import"./x.BOdyWiWF.js";import"./UpdatePlanConfirmation.DdkG8Ov0.js";import"./VerifyUpgrade.CWI1EYmA.js";import"./circle-check-big.CnV0y9bI.js";import"./zap.BNbCfd_G.js";import"./message-circle.C1uJbl19.js";import"./map.DuWy2ZcB.js";import"./number.DnDLgi2j.js";import"./ellipsis.BcvtAoad.js";import"./js.cookie.Cz0CWeBA.js";import"./ai.DmXEK0i3.js";import"./index.browser.OxPLOBIU.js";import"./index.Dgut0sTl.js";import"./chat.C-0TRz4N.js";import"./toast.DlejBBdi.js";import"./index.3whys8t3.js";import"./fp.esm.CznIeghd.js";function W(d){const{roadmapSlug:t,onDeleted:l}=d,i=T(),a=o.useRef(null),[n,p]=o.useState(!1),[f,c]=o.useState(!1),{mutate:h,isPending:m}=F({mutationFn:async()=>O(`/v1-delete-ai-roadmap/${t}`),onSuccess:()=>{i.success("Roadmap deleted"),x.invalidateQueries({predicate:s=>s.queryKey?.[0]==="user-ai-roadmaps"}),l?.()},onError:s=>{i.error(s?.message||"Failed to delete roadmap")}},x);return k(a,()=>{p(!1)}),E("Escape",()=>{p(!1)}),e.jsxs("div",{className:"relative h-full",ref:a,children:[e.jsx("button",{className:"h-full text-gray-400 hover:text-gray-700",onClick:s=>{s.stopPropagation(),p(!n)},children:e.jsx(D,{size:16})}),n&&e.jsxs("div",{className:"absolute top-8 right-0 z-10 w-48 overflow-hidden rounded-md border border-gray-200 bg-white shadow-lg",children:[e.jsxs("a",{href:`/ai-roadmaps/${t}`,className:"flex w-full items-center gap-1.5 p-2 text-sm font-medium text-gray-500 hover:bg-gray-100 hover:text-black disabled:cursor-not-allowed disabled:opacity-70",children:[e.jsx(B,{className:"h-3.5 w-3.5"}),"Visit Roadmap"]}),!f&&e.jsx("button",{className:"flex w-full items-center gap-1.5 p-2 text-sm font-medium text-gray-500 hover:bg-gray-100 hover:text-black disabled:cursor-not-allowed disabled:opacity-70",onClick:()=>c(!0),disabled:m,children:m?"Deleting...":e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"h-3.5 w-3.5"}),"Delete Roadmap"]})}),f&&e.jsxs("span",{className:"flex w-full items-center justify-between gap-1.5 p-2 text-sm font-medium text-gray-500 hover:bg-gray-100 hover:text-black disabled:cursor-not-allowed disabled:opacity-70",children:["Are you sure?",e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{c(!1),h()},disabled:m,className:"text-red-500 underline hover:text-red-800",children:"Yes"}),e.jsx("button",{onClick:()=>c(!1),className:"text-red-500 underline hover:text-red-800",children:"No"})]})]})]})]})}function _(d){const{roadmap:t,variant:l="row",showActions:i=!0}=d,a=q(t?.updatedAt);return e.jsxs("div",{className:"relative flex flex-grow",children:[e.jsxs("a",{href:`/ai-roadmaps/${t.slug}`,className:I("group relative flex h-full w-full gap-3 overflow-hidden rounded-lg border border-gray-200 bg-white p-4 text-left transition-all hover:border-gray-300 hover:bg-gray-50 sm:gap-4",l==="column"&&"flex-col",l==="row"&&"sm:flex-col sm:items-start"),children:[e.jsx("div",{className:"min-w-0 flex-1",children:e.jsx("h3",{className:"line-clamp-2 text-base font-semibold text-balance text-gray-900",children:t.title})}),e.jsx("div",{className:"flex items-center gap-4 sm:gap-4",children:e.jsxs("div",{className:"items-center text-xs text-gray-600 flex",children:[e.jsx($,{className:"mr-1 h-3.5 w-3.5"}),e.jsx("span",{children:a})]})})]}),i&&t.slug&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx(W,{roadmapSlug:t.slug})})]})}function ze(){const[d,t]=o.useState(!0),[l,i]=o.useState(!1),[a,n]=o.useState({perPage:"21",currPage:"1",query:""}),{isPaidUser:p,isLoading:f}=K(),{data:c,isLoading:h}=y(z(),x),m=c?.roadmap,{data:s,isFetching:v}=y(R(a),x);o.useEffect(()=>{t(!1)},[s]);const b=s?.data??[];o.useEffect(()=>{const r=w();n({...a,currPage:r?.p||"1",query:r?.q||""})},[]),o.useEffect(()=>{a?.currPage!=="1"||a?.query!==""?P({p:a?.currPage||"1",q:a?.query||""}):(j("p"),j("q"))},[a]);const u=S(),g=v||d||f||h;return e.jsxs(e.Fragment,{children:[l&&e.jsx(A,{onClose:()=>i(!1)}),e.jsx(N,{value:a?.query||"",onChange:r=>{n({...a,query:r,currPage:"1"})},placeholder:"Search Roadmaps...",disabled:g}),g&&e.jsxs("p",{className:"mb-4 flex flex-row items-center gap-2 text-sm text-gray-500",children:[e.jsx(V,{className:"h-4 w-4 animate-spin"}),"Loading your roadmaps..."]}),!g&&e.jsxs(e.Fragment,{children:[e.jsx(Q,{type:"roadmap",totalCount:s?.totalCount,isPaidUser:p,usedCount:m?.used,limitCount:m?.limit,onUpgrade:()=>i(!0)}),u&&!g&&b.length>0&&e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("div",{className:"grid grid-cols-1 gap-2 md:grid-cols-2 xl:grid-cols-3",children:b.map(r=>e.jsx(_,{variant:"column",roadmap:r},r._id))}),e.jsx(L,{totalCount:s?.totalCount||0,totalPages:s?.totalPages||0,currPage:Number(s?.currPage||1),perPage:Number(s?.perPage||10),onPageChange:r=>{n({...a,currPage:String(r)})},className:"rounded-lg border border-gray-200 bg-white p-4"})]}),!g&&b.length===0&&e.jsx(C,{title:u?"No roadmaps found":"Sign up or login",subtitle:u?"You haven't generated any roadmaps yet.":"Takes 2s to sign up and generate your first roadmap.",icon:Y,buttonText:u?"Create your first roadmap":"Sign up or login",onButtonClick:()=>{u?window.location.href="/ai":U()}})]})]})}export{ze as UserRoadmapsList};
