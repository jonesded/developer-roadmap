import{n as m}from"./index.browser.OxPLOBIU.js";import{r as C}from"./chat.C-0TRz4N.js";import{a as g,q as O}from"./query-client.zrB8z_yM.js";import{a as S}from"./ai-course.m2sFB2uK.js";import{h}from"./query-http.Bohx3EqF.js";import{i as Q}from"./jwt.1xGNZsvU.js";async function F(i){const{term:a,format:f,quizSlug:e,onLoadingChange:n,onError:u,isForce:t=!1,prompt:o,onDetailsChange:l,onFinish:p,questionAndAnswers:y,onStreamingChange:c,onQuestionsChange:w}=i;n?.(!0),c?.(!1);try{let r=null;if(e&&t?r=await fetch(`undefined/v1-regenerate-ai-quiz/${e}`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({prompt:o})}):r=await fetch("undefined/v1-generate-ai-quiz",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({keyword:a,format:f,isForce:t,customPrompt:o,questionAndAnswers:y}),credentials:"include"}),!r.ok){const s=await r.json();console.error("Error generating quiz:",s?.message||"Something went wrong"),n?.(!1),u?.(s?.message||"Something went wrong");return}const d=r.body;if(!d){console.error("Failed to get stream from response"),u?.("Something went wrong"),n?.(!1);return}n?.(!1),c?.(!0),await C(d,{onMessage:async s=>{const z=q(s);w?.(z)},onMessageEnd:async s=>{O.invalidateQueries(S()),c?.(!1)},onDetails:async s=>{if(!s?.quizId||!s?.quizSlug)throw new Error("Invalid details");l?.(s)}}),p?.()}catch(r){u?.(r?.message||"Something went wrong"),console.error("Error in quiz generation:",r),n?.(!1),c?.(!1)}}function q(i){const a=[],f=i.split(`
`);let e=null,n=null;const u=()=>{e&&(e.type==="mcq"&&(e.options=e.options.sort(()=>Math.random()-.5)),a.push(e),e=null)};for(const t of f)if(t)if(t.startsWith("###"))u(),e={id:m(),title:t.slice(3).trim(),type:"open-ended",options:[]},n="question";else if(t.startsWith("##")){if(!e)continue;e.answerExplanation=t.slice(2).trim(),n="explanation"}else if(t.startsWith("#")){u();const o=t.slice(1).trim();e={id:m(),title:o,type:"mcq",options:[]},n="question"}else if(t.startsWith("-")){if(!e)continue;const o=t.slice(1).trim(),l=o.startsWith("*"),p=o.slice(l?1:0).trim();e.options.push({id:m(),title:p,isCorrect:l}),n="option"}else{if(!e)continue;if(n==="question")e.title+=`
${t}`;else if(n==="explanation")e.answerExplanation=(e?.answerExplanation||"")+`
${t}`;else if(n==="option"){const o=e.options.at(-1);o&&(o.title+=`
${t}`)}}return u(),a}function P(i){return g({queryKey:["ai-quiz",i],queryFn:async()=>{const a=await h(`/v1-get-ai-quiz/${i}`);return{...a,questions:q(a.content)}},enabled:!!i})}function W(i={perPage:"21",currPage:"1",query:""}){return g({queryKey:["user-ai-quizzes",i],queryFn:()=>h("/v1-list-user-ai-quizzes",i),enabled:!!Q()})}export{P as a,F as g,W as l};
