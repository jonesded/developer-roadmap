import{n as m}from"./index.browser.OxPLOBIU.js";import{r as C}from"./chat.C-0TRz4N.js";import{a as d,q as O}from"./query-client.zrB8z_yM.js";import{a as S}from"./ai-course.JYmLWeiN.js";import{h}from"./query-http.DnxAGGjD.js";import{i as Q}from"./jwt.1xGNZsvU.js";async function F(i){const{term:a,format:p,quizSlug:e,onLoadingChange:n,onError:l,isForce:t=!1,prompt:s,onDetailsChange:u,onFinish:f,questionAndAnswers:y,onStreamingChange:c,onQuestionsChange:w}=i;n?.(!0),c?.(!1);try{let r=null;if(e&&t?r=await fetch(`https://api.hnmdevs.com/v1-regenerate-ai-quiz/${e}`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({prompt:s})}):r=await fetch("https://api.hnmdevs.com/v1-generate-ai-quiz",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({keyword:a,format:p,isForce:t,customPrompt:s,questionAndAnswers:y}),credentials:"include"}),!r.ok){const o=await r.json();console.error("Error generating quiz:",o?.message||"Something went wrong"),n?.(!1),l?.(o?.message||"Something went wrong");return}const g=r.body;if(!g){console.error("Failed to get stream from response"),l?.("Something went wrong"),n?.(!1);return}n?.(!1),c?.(!0),await C(g,{onMessage:async o=>{const z=q(o);w?.(z)},onMessageEnd:async o=>{O.invalidateQueries(S()),c?.(!1)},onDetails:async o=>{if(!o?.quizId||!o?.quizSlug)throw new Error("Invalid details");u?.(o)}}),f?.()}catch(r){l?.(r?.message||"Something went wrong"),console.error("Error in quiz generation:",r),n?.(!1),c?.(!1)}}function q(i){const a=[],p=i.split(`
`);let e=null,n=null;const l=()=>{e&&(e.type==="mcq"&&(e.options=e.options.sort(()=>Math.random()-.5)),a.push(e),e=null)};for(const t of p)if(t)if(t.startsWith("###"))l(),e={id:m(),title:t.slice(3).trim(),type:"open-ended",options:[]},n="question";else if(t.startsWith("##")){if(!e)continue;e.answerExplanation=t.slice(2).trim(),n="explanation"}else if(t.startsWith("#")){l();const s=t.slice(1).trim();e={id:m(),title:s,type:"mcq",options:[]},n="question"}else if(t.startsWith("-")){if(!e)continue;const s=t.slice(1).trim(),u=s.startsWith("*"),f=s.slice(u?1:0).trim();e.options.push({id:m(),title:f,isCorrect:u}),n="option"}else{if(!e)continue;if(n==="question")e.title+=`
${t}`;else if(n==="explanation")e.answerExplanation=(e?.answerExplanation||"")+`
${t}`;else if(n==="option"){const s=e.options.at(-1);s&&(s.title+=`
${t}`)}}return l(),a}function P(i){return d({queryKey:["ai-quiz",i],queryFn:async()=>{const a=await h(`/v1-get-ai-quiz/${i}`);return{...a,questions:q(a.content)}},enabled:!!i})}function W(i={perPage:"21",currPage:"1",query:""}){return d({queryKey:["user-ai-quizzes",i],queryFn:()=>h("/v1-list-user-ai-quizzes",i),enabled:!!Q()})}export{P as a,F as g,W as l};
