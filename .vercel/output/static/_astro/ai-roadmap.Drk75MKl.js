import{a as c,q as F}from"./query-client.zrB8z_yM.js";import{h as p}from"./query-http.Bohx3EqF.js";import{g as u}from"./ai.DmXEK0i3.js";import{generateAIRoadmapFromText as l,renderFlowJSON as f}from"./index.Dgut0sTl.js";import{a as A}from"./ai-course.m2sFB2uK.js";import{r as I}from"./chat.C-0TRz4N.js";import{i as R}from"./jwt.1xGNZsvU.js";function J(e){return c({queryKey:["ai-roadmap",e],queryFn:async()=>{const o=await p(`/v1-get-ai-roadmap/${e}`);u(o.data);const{nodes:m,edges:n}=l(),s=(await f()).outerHTML;return{...o,svgHtml:s}},enabled:!!e})}async function M(e){const{term:o,roadmapSlug:m,onLoadingChange:n,onError:t,isForce:s=!1,prompt:d,onDetailsChange:y,onFinish:h,questionAndAnswers:w,onRoadmapSvgChange:S,onStreamingChange:i}=e;n?.(!0),i?.(!1);try{let r=null;if(m&&s?r=await fetch(`undefined/v1-regenerate-ai-roadmap/${m}`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({prompt:d})}):r=await fetch("undefined/v1-generate-ai-roadmap",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({term:o,isForce:s,customPrompt:d,questionAndAnswers:w}),credentials:"include"}),!r.ok){const a=await r.json();console.error("Error generating course:",a?.message||"Something went wrong"),n?.(!1),t?.(a?.message||"Something went wrong");return}const g=r.body;if(!g){console.error("Failed to get stream from response"),t?.("Something went wrong"),n?.(!1);return}n?.(!1),i?.(!0),await I(g,{onMessage:async a=>{const v=u(a),{nodes:q,edges:C}=l(v),O=await f({nodes:q,edges:C});S?.(O)},onMessageEnd:async()=>{F.invalidateQueries(A()),i?.(!1)},onDetails:async a=>{if(!a?.roadmapId||!a?.roadmapSlug)throw new Error("Invalid details");y?.(a)}}),h?.()}catch(r){t?.(r?.message||"Something went wrong"),console.error("Error in course generation:",r),n?.(!1),i?.(!1)}}function N(e={perPage:"21",currPage:"1",query:""}){return c({queryKey:["user-ai-roadmaps",e],queryFn:()=>p("/v1-list-user-ai-roadmaps",e),enabled:!!R()})}export{J as a,M as g,N as l};
