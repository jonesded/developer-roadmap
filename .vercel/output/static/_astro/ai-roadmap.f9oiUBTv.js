import{a as p,q as F}from"./query-client.zrB8z_yM.js";import{h as c}from"./query-http.BQfMbvYq.js";import{g as l}from"./ai.DmXEK0i3.js";import{generateAIRoadmapFromText as u,renderFlowJSON as f}from"./index.Dgut0sTl.js";import{a as A}from"./ai-course.DbIkPj3f.js";import{r as I}from"./chat.C-0TRz4N.js";import{i as R}from"./jwt.1xGNZsvU.js";function J(e){return p({queryKey:["ai-roadmap",e],queryFn:async()=>{const t=await c(`/v1-get-ai-roadmap/${e}`);l(t.data);const{nodes:m,edges:o}=u(),s=(await f()).outerHTML;return{...t,svgHtml:s}},enabled:!!e})}async function M(e){const{term:t,roadmapSlug:m,onLoadingChange:o,onError:n,isForce:s=!1,prompt:g,onDetailsChange:h,onFinish:y,questionAndAnswers:w,onRoadmapSvgChange:S,onStreamingChange:i}=e;o?.(!0),i?.(!1);try{let a=null;if(m&&s?a=await fetch(`https://api.roadmap.sh/v1-regenerate-ai-roadmap/${m}`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({prompt:g})}):a=await fetch("https://api.roadmap.sh/v1-generate-ai-roadmap",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({term:t,isForce:s,customPrompt:g,questionAndAnswers:w}),credentials:"include"}),!a.ok){const r=await a.json();console.error("Error generating course:",r?.message||"Something went wrong"),o?.(!1),n?.(r?.message||"Something went wrong");return}const d=a.body;if(!d){console.error("Failed to get stream from response"),n?.("Something went wrong"),o?.(!1);return}o?.(!1),i?.(!0),await I(d,{onMessage:async r=>{const v=l(r),{nodes:q,edges:C}=u(v),O=await f({nodes:q,edges:C});S?.(O)},onMessageEnd:async()=>{F.invalidateQueries(A()),i?.(!1)},onDetails:async r=>{if(!r?.roadmapId||!r?.roadmapSlug)throw new Error("Invalid details");h?.(r)}}),y?.()}catch(a){n?.(a?.message||"Something went wrong"),console.error("Error in course generation:",a),o?.(!1),i?.(!1)}}function N(e={perPage:"21",currPage:"1",query:""}){return p({queryKey:["user-ai-roadmaps",e],queryFn:()=>c("/v1-list-user-ai-roadmaps",e),enabled:!!R()})}export{J as a,M as g,N as l};
