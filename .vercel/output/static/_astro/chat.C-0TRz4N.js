const h={message:"0",details:"d"},m=10;function E(a,o){const s=new Uint8Array(o);let r=0;for(const t of a)s.set(t,r),r+=t.length;return a.length=0,s}async function k(a,{onMessage:o,onMessageEnd:s,onDetails:r}){const t=a.getReader(),p=new TextDecoder("utf-8"),c=[];let i=0,d="";for(;;){const{value:n}=await t.read();if(n&&(c.push(n),i+=n.length,n[n.length-1]!==m))continue;if(c.length===0)break;const w=E(c,i);i=0;const g=p.decode(w,{stream:!0}).split(`
`).filter(e=>e!=="").map(e=>{const l=e.indexOf(":");if(l===-1)throw new Error("Invalid line: "+e+". No separator found.");const f=e.slice(0,l),u=e.slice(l+1);switch(f){case h.message:return{type:"message",content:JSON.parse(u)};case h.details:return{type:"details",content:JSON.parse(u)};default:throw new Error("Invalid prefix: "+f)}});for(const e of g)e.type==="message"?(d+=e.content,await o?.(d)):e.type==="details"&&await r?.(e.content)}await s?.(d),t.releaseLock()}export{k as r};
