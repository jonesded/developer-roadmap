import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as u}from"./index.Z3BHPS3u.js";import{c as w}from"./classname.y9b8gBZq.js";import{u as we,b as ve}from"./billing.D4Dkc83P.js";import{U as oe}from"./UpgradeAccountModal.BrBqMRqO.js";import{E as Ue}from"./ErrorIcon.BTBCVae1.js";import{u as le}from"./useMutation.BxVH4XRI.js";import{r as ie,c as xe,b as $e,g as ge,d as _e}from"./ai.DmXEK0i3.js";import{i as O,r as Ne,g as De}from"./jwt.1xGNZsvU.js";import{a as Qe,m as Ge}from"./markdown.CL3gtrVM.js";import{c as qe,a as ke}from"./query-http.DnxAGGjD.js";import{s as K}from"./slugger.rj1cS6co.js";import{g as ne,a as ce}from"./ai-course.JYmLWeiN.js";import{q as G,u as te}from"./query-client.zrB8z_yM.js";/* empty css                        */import{u as Ce}from"./use-outside-click.DYGsxgbd.js";import{M as Se,U as We}from"./UpdatePreferences.BwR7wPIz.js";import{s as ee}from"./popup.CdCAhVM2.js";import{S as re}from"./square-pen.CCkK4Twl.js";import{R as Ae}from"./refresh-ccw.C3KtdZ75.js";import{c as X}from"./createLucideIcon.BSLrQS80.js";import{F as Me}from"./frown.DZolOWqV.js";import{L as J}from"./loader-circle.DfB4mNyf.js";import{C as de}from"./chevron-left.DdnmjL-W.js";import{C as me}from"./chevron-right.B-RYTm0N.js";import{C as Ve}from"./circle-x.BL3YVBBU.js";import{C as He}from"./circle.D81F4kBU.js";import{R as Be,a as Ke,b as Je,A as Xe}from"./AICourseLessonChat.B9dL22TW.js";import{L as Ye}from"./lock.C0C-BW9S.js";import{M as Le}from"./message-circle.C1uJbl19.js";import{X as ae}from"./x.BOdyWiWF.js";import{C as Ie}from"./check.DflWYpXj.js";import{g as ze}from"./number.DnDLgi2j.js";import{I as Ze}from"./info.Cr2knUfd.js";import{G as es}from"./gift.C1ExsHI3.js";import{C as Pe}from"./CheckIcon.D4OhQ5l1.js";import{C as ss}from"./chevron-down.pBq1owZr.js";import{A as ts}from"./AILimitsPopup.BeTRJ95q.js";/* empty css                        */import{generateAIRoadmapFromText as he,renderFlowJSON as fe}from"./index.Dgut0sTl.js";import{r as pe}from"./dom.B_TnKQIa.js";import{r as be}from"./resource-progress.Ow4RVjGh.js";import{M as rs}from"./Modal.NtjGPDbq.js";import{u as ns}from"./use-toast.BdCcSTJE.js";import{C as as}from"./copy.CgTXj779.js";import{u as os}from"./use-auth.Bw1nhFr_.js";import{M as ls}from"./menu.B2j5jEPR.js";import{M as is}from"./map.DuWy2ZcB.js";import{C as cs}from"./circle-alert.DQNBwVc5.js";/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ds=[["path",{d:"M12 21V7",key:"gj6g52"}],["path",{d:"m16 12 2 2 4-4",key:"mdajum"}],["path",{d:"M22 6V4a1 1 0 0 0-1-1h-5a4 4 0 0 0-4 4 4 4 0 0 0-4-4H3a1 1 0 0 0-1 1v13a1 1 0 0 0 1 1h6a3 3 0 0 1 3 3 3 3 0 0 1 3-3h6a1 1 0 0 0 1-1v-1.3",key:"8arnkb"}]],Ee=X("book-open-check",ds);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ms=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],us=X("circle-check",ms);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xs=[["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M8.35 2.69A10 10 0 0 1 21.3 15.65",key:"1pfsoa"}],["path",{d:"M19.08 19.08A10 10 0 1 1 4.92 4.92",key:"1ablyi"}]],gs=X("circle-off",xs);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hs=[["path",{d:"M14 2v6a2 2 0 0 0 .245.96l5.51 10.08A2 2 0 0 1 18 22H6a2 2 0 0 1-1.755-2.96l5.51-10.08A2 2 0 0 0 10 8V2",key:"18mbvz"}],["path",{d:"M6.453 15h11.094",key:"3shlmq"}],["path",{d:"M8.5 2h7",key:"csnxdl"}]],fs=X("flask-conical",hs);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ps=[["circle",{cx:"12",cy:"18",r:"3",key:"1mpf1b"}],["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["circle",{cx:"18",cy:"6",r:"3",key:"1h7g24"}],["path",{d:"M18 9v2c0 .6-.4 1-1 1H7c-.6 0-1-.4-1-1V9",key:"1uq4wg"}],["path",{d:"M12 12v3",key:"158kv8"}]],ue=X("git-fork",ps);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bs=[["path",{d:"M20.5 14.9A9 9 0 0 0 9.1 3.5",key:"1iebmn"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M5.6 5.6C3 8.3 2.2 12.5 4 16l-2 6 6-2c3.4 1.8 7.6 1.1 10.3-1.7",key:"1ov8ce"}]],Fe=X("message-circle-off",bs);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ys=[["path",{d:"M20 7h-9",key:"3s1dr2"}],["path",{d:"M14 17H5",key:"gfn3mx"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]],js=X("settings-2",ys);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ws=[["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M12 3v3",key:"1n5kay"}],["path",{d:"M18 6a2 2 0 0 1 1.387.56l2.307 2.22a1 1 0 0 1 0 1.44l-2.307 2.22A2 2 0 0 1 18 13H6a2 2 0 0 1-1.387-.56l-2.306-2.22a1 1 0 0 1 0-1.44l2.306-2.22A2 2 0 0 1 6 6z",key:"gqqp9m"}]],vs=X("signpost",ws);function Ns(b){const{onRegenerateLesson:s,isForkable:l,onForkCourse:o}=b,[n,x]=u.useState(!1),[c,d]=u.useState(!1),[m,g]=u.useState(!1),j=u.useRef(null);return Ce(j,()=>x(!1)),e.jsxs(e.Fragment,{children:[c&&e.jsx(oe,{onClose:()=>{d(!1)}}),m&&e.jsx(Se,{title:"Give AI more context",description:"Pass additional information to the AI to generate a lesson.",onClose:()=>g(!1),onSubmit:N=>{if(g(!1),!O()){ee();return}if(l){o();return}s(N)}}),e.jsxs("div",{className:"relative flex items-center lg:mr-1",ref:j,children:[e.jsx("button",{className:w("rounded-full p-1 text-gray-400 hover:text-black",{"text-black":n}),onClick:()=>x(!n),children:e.jsx(re,{className:"text-current",size:16,strokeWidth:2.5})}),n&&e.jsxs("div",{className:"absolute top-full right-0 min-w-[170px] overflow-hidden rounded-md border border-gray-200 bg-white",children:[e.jsxs("button",{onClick:()=>{if(x(!1),!O()){ee();return}if(l){o();return}s()},className:"flex w-full items-center gap-2.5 px-3 py-2 text-left text-sm text-gray-600 hover:bg-gray-100",children:[e.jsx(Ae,{size:16,className:"text-gray-400",strokeWidth:2.5}),"Regenerate"]}),e.jsxs("button",{onClick:()=>{if(x(!1),!O()){ee();return}if(l){o();return}g(!0)},className:"flex w-full items-center gap-2.5 px-3 py-2 text-left text-sm text-gray-600 hover:bg-gray-100",children:[e.jsx(re,{size:16,className:"text-gray-400",strokeWidth:2.5}),"Modify Prompt"]})]})]})]})}function ks(b){const{courseSlug:s,activeModuleIndex:l,activeLessonIndex:o}=b,[n,x]=u.useState([]),[c,d]=u.useState(!1),[m,g]=u.useState(!1),[j,N]=u.useState(!1),[k,h]=u.useState(""),y=u.useMemo(()=>new AbortController,[l,o]),f=async()=>{if(g(!0),h(""),!O()){g(!1),h("Please login to generate course content");return}const a=await fetch(`https://api.hnmdevs.com/v1-generate-ai-course-lesson-question/${s}`,{method:"POST",headers:{"Content-Type":"application/json"},signal:y.signal,credentials:"include",body:JSON.stringify({moduleIndex:l,lessonIndex:o})});if(!a.ok){const i=await a.json();h(i?.message||"Something went wrong"),g(!1),i.status===401&&(Ne(),window.location.reload());return}if(!a.body){g(!1),h("No response body received");return}try{const i=a.body.getReader();g(!1),N(!0),await ie(i,{onStream:async r=>{if(y.signal.aborted)return;const t=xe(r);x(t)},onStreamEnd:async r=>{if(y.signal.aborted)return;const t=xe(r);x(t),N(!1)}})}catch(i){h(i instanceof Error?i.message:"Something went wrong"),g(!1),N(!1)}};return e.jsxs("div",{className:"mt-10 flex flex-col gap-4",children:[!c&&e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("button",{className:w("group flex shrink-0 items-center gap-2 rounded-xl border border-gray-200 bg-white px-6 py-3 text-sm font-medium text-gray-700 transition-all hover:border-black hover:bg-gray-50 hover:text-gray-900",{"bg-gray-100 text-gray-900":c}),onClick:()=>{j||m||(c?d(!1):(d(!0),f()))},children:[e.jsx(fs,{className:"size-5 shrink-0 transition-transform group-hover:scale-110"}),e.jsx("span",{children:"Test My Knowledge"})]})}),k&&e.jsxs("div",{className:"flex min-h-[200px] flex-col items-center justify-center gap-3 rounded-xl bg-red-50/80 p-6 text-red-500",children:[e.jsx(Me,{className:"size-12 shrink-0"}),e.jsx("span",{className:"text-center font-semibold",children:k})]}),!k&&c&&e.jsx(Cs,{isLoading:m,isGenerating:j,questions:n})]})}function Cs(b){const{isLoading:s,isGenerating:l,questions:o}=b,[n,x]=u.useState({}),[c,d]=u.useState(!1),[m,g]=u.useState(0),j=o[m],N=function(a,i){x(r=>{const t={...r},p=j.options.filter(v=>v.isCorrect).length>1;return n[a]?.includes(i)?t[a]=t[a].filter(v=>v!==i):p?t[a]=[...t[a]||[],i]:t[a]=[i],t})},k=u.useCallback(()=>{if(m===o.length-1){d(!0),g(0);return}g(m+1)},[m,o,c]),h=u.useCallback(()=>{g(a=>Math.max(a-1,0))},[o]),y=u.useCallback(()=>{x({}),d(!1),g(0)},[]),f=u.useMemo(()=>c?o.filter(a=>{const i=n[a.id],r=a.options.filter(t=>t.isCorrect).map(t=>t.id);return r.length===i?.length&&r.every(t=>i?.includes(t))}).length:0,[o,n,c]);return s||!o.length?e.jsx("div",{className:"flex h-[306px] w-full items-center justify-center rounded-lg border p-5 text-black",children:e.jsx(J,{className:"size-8 animate-spin stroke-[2.5] text-gray-400"})}):e.jsx(Ss,{counter:m+1,totalQuestions:o.length,correctAnswerCount:f,isLoading:l,question:j,onOptionSelectChange:N,selectedOptionIds:n[j.id],submitted:c,onNext:k,onPrevious:h,onTryAgain:y})}function Ss(b){const{totalQuestions:s,correctAnswerCount:l,counter:o,isLoading:n,question:x,onOptionSelectChange:c,selectedOptionIds:d,submitted:m=!1,onNext:g,onPrevious:j,onTryAgain:N}=b,{id:k,title:h,options:y}=x,f=y.filter(p=>p.isCorrect).length>1,a=y.filter(p=>p.isCorrect).map(p=>p.id),i=a.length===d?.length&&a.every(p=>d?.includes(p)),r=m&&!i,t=m&&i;return e.jsxs("div",{className:w("relative w-full overflow-hidden rounded-xl border text-black transition-all",{"border-red-400":r,"border-green-500":t}),children:[e.jsxs("div",{className:"flex items-center gap-4 rounded-t-xl border-b bg-linear-to-r from-gray-50 to-white p-5",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-700",children:["Question ",o," of ",s]}),e.jsx("div",{className:"h-2 flex-1 rounded-full bg-gray-100",children:e.jsx("div",{className:"h-full rounded-full bg-black transition-all duration-300",style:{width:`${o/s*100}%`}})}),m&&e.jsx("span",{className:w("rounded-full px-3 py-1 text-xs font-medium",{"bg-red-500 text-white":r,"bg-green-500 text-white":t}),children:r?"Wrong":"Correct"})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("h3",{className:"mx-2 text-balance text-xl font-medium",children:[h," ",f?"(Select Multiple)":""]}),e.jsx("div",{className:"mt-6 flex flex-col gap-0.5",children:y.map((p,C)=>{let v="default";return m?p.isCorrect?v="correct":d?.includes(p.id)&&(v="wrong"):d?.includes(p.id)&&(v="selected"),e.jsx(As,{title:p.title,status:v,onSelect:()=>c?.(k,p.id),submitted:m},C)})}),e.jsxs("div",{className:"mt-6 flex w-full items-center justify-between px-2",children:[e.jsx("div",{className:"text-gray-600",children:m?e.jsxs("span",{className:"flex items-center gap-2",children:["You got ",l," out of ",s," correct.",e.jsx("button",{className:"relative rounded-md bg-black px-3 py-1 text-xs font-medium uppercase tracking-wider text-white transition-colors hover:bg-black/80",onClick:N,children:"Try again"})]}):e.jsx("span",{children:"Answer all questions to submit"})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{className:"group flex h-10 items-center justify-center gap-1 rounded-lg border border-gray-200 p-2 pr-4 text-sm text-black transition-all hover:border-black hover:bg-black hover:text-white focus:outline-hidden max-sm:pr-2",onClick:j,children:[e.jsx(de,{className:"size-5 shrink-0 transition-transform group-hover:-translate-x-0.5"}),e.jsx("span",{className:"max-sm:hidden",children:"Previous"})]}),e.jsxs("button",{className:"group flex h-10 items-center justify-center gap-1 rounded-lg border border-gray-200 p-2 pl-4 text-sm text-black transition-all hover:border-black hover:bg-black hover:text-white focus:outline-hidden max-sm:pl-2",onClick:g,children:[e.jsx("span",{className:"max-sm:hidden",children:"Next"}),e.jsx(me,{className:"size-5 shrink-0 transition-transform group-hover:translate-x-0.5"})]})]})]})]}),n&&e.jsx("div",{className:"absolute bg-white right-3 top-3 flex h-8 items-center justify-center gap-1 rounded-lg border border-gray-200 p-2 text-sm text-black hover:bg-black hover:text-white focus:outline-hidden",children:e.jsx(J,{className:"size-5 animate-spin text-gray-400"})})]})}function As(b){const{title:s,status:l="default",onSelect:o,submitted:n=!1}=b;return e.jsxs("button",{onClick:o,className:w("group flex items-start gap-3 rounded-xl p-4 text-base transition-all disabled:cursor-not-allowed",l==="selected"&&"bg-black text-white",l==="wrong"&&n&&"bg-red-100 text-red-800",l==="correct"&&n&&"bg-green-100 text-green-800",l==="default"&&"bg-white hover:bg-gray-50",n&&l!=="correct"&&"opacity-40"),disabled:n,children:[e.jsxs("span",{className:"mt-[2px]",children:[l==="wrong"&&n&&e.jsx(Ve,{className:"size-5"}),l==="correct"&&n&&e.jsx(us,{className:"size-5"}),(l==="selected"||l==="default")&&e.jsx(He,{className:"size-5"})]}),e.jsx("p",{className:"text-left",children:s})]})}function Oe(b){const{className:s}=b;return e.jsx("div",{className:w("mx-auto mb-10 mt-5 text-center text-sm text-gray-400",s),children:"AI can make mistakes, check important info."})}function Te(b){const{className:s}=b;return e.jsxs("div",{className:w("mt-8 min-h-[402px] rounded-xl border border-gray-200/50 bg-gradient-to-br from-gray-50 to-gray-100/50 p-12 backdrop-blur-sm","flex flex-col items-center justify-center",s),children:[e.jsx(Ye,{className:"size-8 stroke-[1.5] text-gray-600"}),e.jsxs("div",{className:"mt-5 mb-4 flex flex-col items-center gap-0.5 text-center",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-700",children:"Login Required"}),e.jsx("p",{className:"text-sm text-balance leading-relaxed text-gray-500",children:"Please login to access the content and all the features of the AI Tutor."})]}),e.jsx("button",{onClick:()=>ee(),className:"rounded-full bg-black px-6 py-2 text-sm font-medium text-white transition-all duration-300 hover:opacity-80 hover:shadow-md active:scale-[0.98] active:transform",children:"Login to Continue"})]})}function ye(b){const s=b.match(/=START_QUESTIONS=(.*?)=END_QUESTIONS=/);return s?s[1].split("@@"):[]}function Ms(b){const{courseSlug:s,progress:l=[],creatorId:o,activeModuleIndex:n,totalModules:x,currentModuleTitle:c,activeLessonIndex:d,totalLessons:m,currentLessonTitle:g,onGoToPrevLesson:j,onGoToNextLesson:N,onUpgrade:k,isAIChatsOpen:h,setIsAIChatsOpen:y,isForkable:f,onForkCourse:a}=b,[i,r]=u.useState(!0),[t,p]=u.useState(!1),[C,v]=u.useState(""),[A,P]=u.useState([]),[Y,_]=u.useState(""),M=`${K(String(n))}-${K(String(d))}`,D=l?.includes(M),[I,T]=u.useState([{role:"assistant",content:"Hey, I am your AI instructor. How can I help you today? 🤖",isDefault:!0}]),{isPaidUser:E}=we(),R=u.useMemo(()=>new AbortController,[n,d]),U=async(W,se)=>{if(r(!0),v(""),_(""),!O()){r(!1),v("Please login to generate course content");return}if(!c||!g){r(!1),v("Invalid module title or lesson title");return}const H=await fetch(`https://api.hnmdevs.com/v1-generate-ai-course-lesson/${s}`,{method:"POST",headers:{"Content-Type":"application/json"},signal:R.signal,credentials:"include",body:JSON.stringify({moduleIndex:n,lessonIndex:d,isForce:W,customPrompt:se})});if(!H.ok){const S=await H.json();v(S?.message||"Something went wrong"),r(!1),S.status===401&&(Ne(),window.location.reload());return}if(!H.body){r(!1),v("No response body received");return}try{const S=H.body.getReader();r(!1),p(!0),await ie(S,{onStream:async F=>{if(R.signal.aborted)return;const Q=ye(F);P(Q);const $=F.replace(/=START_QUESTIONS=.*?=END_QUESTIONS=/,"");_(Ge($,!1))},onStreamEnd:async F=>{if(R.signal.aborted)return;const Q=ye(F);P(Q);const $=F.replace(/=START_QUESTIONS=.*?=END_QUESTIONS=/,""),B=await Qe($).catch(Z=>(console.error(Z),$));_(B),G.invalidateQueries(ce()),p(!1)}})}catch(S){v(S instanceof Error?S.message:"Something went wrong"),r(!1)}},{mutate:z,isPending:L}=le({mutationFn:()=>qe(`/v1-toggle-done-ai-lesson/${s}`,{moduleIndex:n,lessonIndex:d}),onSuccess:W=>{G.setQueryData(ne({aiCourseSlug:s}).queryKey,W)}},G);u.useEffect(()=>{U()},[c,g]),u.useEffect(()=>()=>{R.abort()},[R]);const V=n===x-1&&d===m-1||t||i,q=n===0&&d===0||t||i;return e.jsx("div",{className:"h-full",children:e.jsxs(Be,{direction:"horizontal",children:[e.jsx(Ke,{defaultSize:h?70:100,minSize:40,id:"course-text-content",className:"h-full overflow-y-scroll! bg-white",order:1,children:e.jsx("div",{className:"relative mx-auto max-w-5xl",children:e.jsxs("div",{className:"bg-white p-8 pb-0 max-lg:px-4 max-lg:pt-3",children:[(t||i)&&e.jsx("div",{className:"absolute top-6 right-6 flex items-center justify-center",children:e.jsx(J,{size:18,strokeWidth:3,className:"animate-spin text-gray-400/70"})}),e.jsxs("div",{className:"mb-4 flex justify-between max-sm:flex-col-reverse",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:["Lesson ",d+1," of ",m]}),!t&&!i&&e.jsxs("div",{className:"top-2 right-2 mb-3 flex items-center gap-2 max-sm:justify-end md:absolute lg:top-6 lg:right-6",children:[e.jsx("button",{onClick:()=>y(!h),className:"rounded-full p-1 text-gray-400 hover:text-black max-lg:hidden",children:h?e.jsx(Fe,{className:"size-4 stroke-[2.5]"}):e.jsx(Le,{className:"size-4 stroke-[2.5]"})}),e.jsx(Ns,{onRegenerateLesson:W=>{U(!0,W)},isForkable:f,onForkCourse:a}),f&&e.jsxs("button",{onClick:a,className:"flex items-center gap-1.5 rounded-full border bg-gray-100 py-1 pr-4 pl-3 text-sm text-black hover:bg-gray-200 disabled:opacity-50 max-lg:text-xs",children:[e.jsx(ue,{className:"size-3.5"}),"Fork Course"]}),e.jsx("button",{disabled:i||L,className:w("flex items-center gap-1.5 rounded-full bg-black py-1 pr-3 pl-2 text-sm text-white hover:bg-gray-800 disabled:opacity-50 max-lg:text-xs",D?"bg-red-500 hover:bg-red-600":"bg-green-500 hover:bg-green-600"),onClick:()=>{if(!O()){ee();return}if(f){a();return}z()},children:L?e.jsxs(e.Fragment,{children:[e.jsx(J,{size:16,strokeWidth:3,className:"animate-spin text-white"}),"Please wait ..."]}):e.jsx(e.Fragment,{children:D?e.jsxs(e.Fragment,{children:[e.jsx(ae,{size:16}),"Mark as Undone"]}):e.jsxs(e.Fragment,{children:[e.jsx(Ie,{size:16}),"Mark as Done"]})})})]})]}),e.jsx("h1",{className:"mb-6 text-3xl font-semibold text-balance max-lg:mb-3 max-lg:text-xl",children:g?.replace(/^Lesson\s*?\d+[\.:]\s*/,"")}),!C&&O()&&e.jsx("div",{className:"course-content prose prose-lg prose-headings:mb-3 prose-headings:mt-8 prose-blockquote:font-normal prose-pre:rounded-2xl prose-pre:text-lg prose-li:my-1 prose-thead:border-zinc-800 prose-tr:border-zinc-800 max-lg:prose-h2:mt-3 max-lg:prose-h2:text-lg max-lg:prose-h3:text-base max-lg:prose-pre:px-3 max-lg:prose-pre:text-sm mt-8 max-w-full text-black max-lg:mt-4 max-lg:text-base",dangerouslySetInnerHTML:{__html:Y}}),C&&O()&&e.jsx("div",{className:"mt-8 flex min-h-[300px] items-center justify-center rounded-xl bg-red-50/80",children:C.includes("reached the limit")?e.jsxs("div",{className:"flex max-w-sm flex-col items-center text-center",children:[e.jsx("h2",{className:"text-xl font-semibold text-red-600",children:"Limit reached"}),e.jsxs("p",{className:"my-3 text-red-600",children:["You have reached the AI usage limit for today.",!E&&e.jsx(e.Fragment,{children:"Please upgrade your account to continue."}),E&&e.jsx(e.Fragment,{children:" Please wait until tomorrow to continue."})]}),!E&&e.jsx("button",{onClick:()=>{k()},className:"rounded-full bg-red-600 px-4 py-1 text-white hover:bg-red-700",children:"Upgrade Account"})]}):e.jsx("p",{className:"text-red-600",children:C})}),!O()&&e.jsx(Te,{}),!i&&!t&&!C&&e.jsx(ks,{courseSlug:s,activeModuleIndex:n,activeLessonIndex:d}),e.jsxs("div",{className:"mt-8 flex items-center justify-between",children:[e.jsxs("button",{onClick:j,disabled:q,className:w("flex items-center rounded-full px-4 py-2 disabled:opacity-50 max-lg:px-3 max-lg:py-1.5 max-lg:text-sm",q?"cursor-not-allowed text-gray-400":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:[e.jsx(de,{size:16,className:"mr-2"}),"Previous"," ",e.jsx("span",{className:"hidden lg:inline",children:" Lesson"})]}),e.jsx("div",{children:e.jsx("button",{onClick:()=>{if(!O()){N();return}D?N():z(void 0,{onSuccess:()=>{N()}})},disabled:V||L,className:w("flex items-center rounded-full px-4 py-2 disabled:opacity-50 max-lg:px-3 max-lg:py-1.5 max-lg:text-sm",V?"cursor-not-allowed text-gray-400":"bg-gray-800 text-white hover:bg-gray-700"),children:L?e.jsxs(e.Fragment,{children:[e.jsx(J,{size:16,strokeWidth:3,className:"animate-spin text-white"}),"Please wait ..."]}):e.jsxs(e.Fragment,{children:["Next"," ",e.jsx("span",{className:"hidden lg:inline",children:" Lesson"}),e.jsx(me,{size:16,className:"ml-2"})]})})})]}),e.jsx(Oe,{})]})})}),h&&e.jsxs(e.Fragment,{children:[e.jsx(Je,{withHandle:!1,className:"max-lg:hidden"}),e.jsx(Xe,{courseSlug:s,moduleTitle:c,lessonTitle:g,onUpgradeClick:k,courseAIChatHistory:I,setCourseAIChatHistory:T,isDisabled:t||i||L,isGeneratingLesson:t||i,defaultQuestions:A,onClose:()=>y(!1),isAIChatsOpen:h,setIsAIChatsOpen:y})]})]})})}function je(b){const{onUpgrade:s,onShowLimits:l}=b,{data:o,isLoading:n}=te(ce(),G),{data:x,isLoading:c}=te(ve(),G);if(!O())return null;if(n||!o||c||!x)return e.jsx("div",{className:"hidden h-[38px] w-[208.09px] animate-pulse rounded-lg border border-gray-200 bg-gray-200 lg:block"});const{used:d,limit:m}=o,g=ze(d,m),j=x.status==="active";return e.jsxs(e.Fragment,{children:[!j&&e.jsxs("button",{className:"mr-1 flex items-center gap-1 text-sm font-medium underline underline-offset-2 lg:hidden",onClick:()=>l(),children:[e.jsx(Ze,{className:"size-4"}),g,"% limit used"]}),!j&&e.jsxs("button",{onClick:()=>{l()},className:"relative hidden h-full min-h-[38px] cursor-pointer items-center overflow-hidden rounded-lg border border-gray-300 px-3 py-1.5 text-sm hover:bg-gray-50 lg:flex",children:[e.jsxs("span",{className:"relative z-10",children:[g,"% of the daily limit used"]}),e.jsx("div",{className:"absolute inset-0 h-full bg-gray-200/80",style:{width:`${g}%`}})]}),!j&&e.jsxs("button",{className:"hidden items-center justify-center gap-1 rounded-md bg-yellow-400 px-4 py-1 text-sm font-medium underline-offset-2 hover:bg-yellow-500 lg:flex",onClick:()=>s(),children:[e.jsx(es,{className:"size-4"}),"Upgrade"]})]})}function Ls(){return e.jsx("div",{className:"h-[28px] w-[28px] animate-pulse rounded-full bg-gray-200"})}function Is(b){const{percentage:s,children:l,isVisible:o=!0,isActive:n=!1,isLoading:x=!1}=b,c=2*Math.PI*13,d=`${c}`,m=c-s/100*c;return e.jsxs("div",{className:"relative flex h-[28px] w-[28px] shrink-0 items-center justify-center",children:[o&&!x&&e.jsx("svg",{className:"absolute h-full w-full -rotate-90",children:e.jsx("circle",{cx:"14",cy:"14",r:"13",stroke:"currentColor",strokeWidth:"1.75",fill:"none",className:w("text-gray-400/70",{"text-black":n}),style:{strokeDasharray:d,strokeDashoffset:m,transition:"stroke-dashoffset 0.3s ease"}})}),!x&&l,x&&e.jsx(Ls,{})]})}function zs(b){const{course:s,courseSlug:l,activeModuleIndex:o,setActiveModuleIndex:n,activeLessonIndex:x,setActiveLessonIndex:c,setSidebarOpen:d,setViewMode:m,expandedModules:g,setExpandedModules:j,isLoading:N}=b,k=s.done||[],h=f=>{j(a=>{if(a[f])return{...a,[f]:!1};const i={};return s.modules.forEach((r,t)=>{i[t]=!1}),i[f]=!0,i})},y=k||[];return e.jsx("nav",{className:"bg-gray-100",children:s.modules.map((f,a)=>{const i=f.lessons.length,r=f.lessons.filter((v,A)=>{const P=`${K(String(a))}-${K(String(A))}`;return y.includes(P)}).length,t=Math.round(r/i*100),p=g[a],C=r===i;return e.jsxs("div",{className:"rounded-md",children:[e.jsxs("button",{onClick:()=>h(a),className:w("relative z-10 flex w-full cursor-pointer flex-row items-center gap-2 border-b border-b-gray-200 bg-white px-2 py-3 text-base text-gray-600 hover:bg-gray-100",o===a?"text-gray-900":"text-gray-700",a===0&&"pt-4"),children:[e.jsxs("div",{className:"flex min-w-0 flex-1 items-center gap-2",children:[e.jsx("div",{className:"shrink-0",children:e.jsx(Is,{percentage:t,isVisible:!C,isActive:p,isLoading:N,children:e.jsxs("span",{className:w("flex size-[21px] shrink-0 items-center justify-center rounded-full bg-gray-400/70 text-xs font-semibold text-white",{"bg-black":p,"bg-green-600":C}),children:[!C&&a+1,C&&e.jsx(Ie,{className:"size-3 stroke-3 text-white"})]})})}),e.jsx("span",{className:"flex flex-1 items-center break-words text-left text-sm leading-relaxed",children:f.title?.replace(/^Module\s*?\d+[\.:]\s*/,"")})]}),e.jsx("div",{className:"ml-auto self-center",children:g[a]?e.jsx(ss,{size:16,className:"shrink-0"}):e.jsx(me,{size:16,className:"shrink-0"})})]}),g[a]&&e.jsx("div",{className:"flex flex-col border-b border-b-gray-200 bg-gray-100",children:f.lessons.map((v,A)=>{const P=`${K(String(a))}-${K(String(A))}`,Y=y.includes(P);return e.jsxs("button",{onClick:()=>{n(a),c(A),j(_=>{const M={};return s.modules.forEach((D,I)=>{M[I]=!1}),M[a]=!0,M}),d(!1),m("module")},className:w("flex w-full cursor-pointer items-center gap-2.5 py-3 pl-3.5 pr-2 text-left text-sm leading-normal",o===a&&x===A?"bg-gray-200 text-black":"text-gray-600 hover:bg-gray-200/70"),children:[Y?e.jsx(Pe,{additionalClasses:w("size-[18px] relative bg-white rounded-full top-[2px] shrink-0 text-green-600",{"text-black":o===a&&x===A})}):e.jsx("span",{className:w("flex size-[18px] shrink-0 items-center justify-center rounded-full bg-gray-400/70 text-xs font-semibold text-white",{"bg-black":o===a&&x===A}),children:A+1}),e.jsx("span",{className:"break-words",children:v?.replace(/^Lesson\s*?\d+[\.:]\s*/,"")})]},P)})})]},a)})})}function Ps(b){const{onRegenerateOutline:s,isForkable:l,onForkCourse:o,courseSlug:n}=b,[x,c]=u.useState(!1),[d,m]=u.useState(!1),[g,j]=u.useState(!1),[N,k]=u.useState(!1),h=u.useRef(null);Ce(h,()=>c(!1));const{data:y}=te(ne({aiCourseSlug:n}),G),{mutate:f,isPending:a}=le({mutationFn:r=>ke(`/v1-update-ai-course-preferences/${n}`,{questionAndAnswers:r}),onSuccess:(r,t)=>{G.setQueryData(ne({aiCourseSlug:n}).queryKey,p=>p&&{...p,questionAndAnswers:t}),k(!1),c(!1),s()}},G),i=y?.questionAndAnswers&&y.questionAndAnswers.length>0;return e.jsxs(e.Fragment,{children:[d&&e.jsx(oe,{onClose:()=>{m(!1)}}),g&&e.jsx(Se,{onClose:()=>j(!1),onSubmit:r=>{if(j(!1),l){o();return}s(r)}}),N&&e.jsx(We,{onClose:()=>k(!1),questionAndAnswers:y?.questionAndAnswers,term:y?.keyword||"",format:"course",onUpdatePreferences:r=>{f(r)},isUpdating:a}),e.jsxs("div",{ref:h,className:"relative flex items-stretch",children:[e.jsx("button",{className:w("rounded-md px-2.5 text-gray-400 hover:text-black",{"text-black":x}),onClick:()=>c(!x),children:e.jsx(re,{className:"text-current",size:16,strokeWidth:2.5})}),x&&e.jsxs("div",{className:"absolute top-full right-0 min-w-[190px] translate-y-1 overflow-hidden rounded-md border border-gray-200 bg-white shadow-md",children:[i&&e.jsxs("button",{onClick:()=>{if(c(!1),l){o();return}k(!0)},className:"flex w-full items-center gap-2.5 px-3 py-2 text-left text-sm text-gray-600 hover:bg-gray-100",children:[e.jsx(js,{size:16,className:"text-gray-400",strokeWidth:2.5}),"Preferences"]}),e.jsxs("button",{onClick:()=>{if(c(!1),l){o();return}s()},className:"flex w-full items-center gap-2.5 px-3 py-2 text-left text-sm text-gray-600 hover:bg-gray-100",children:[e.jsx(Ae,{size:16,className:"text-gray-400",strokeWidth:2.5}),"Regenerate"]}),e.jsxs("button",{onClick:()=>{if(c(!1),l){o();return}j(!0)},className:"flex w-full items-center gap-2.5 px-3 py-2 text-left text-sm text-gray-600 hover:bg-gray-100",children:[e.jsx(re,{size:16,className:"text-gray-400",strokeWidth:2.5}),"Modify Prompt"]})]})]})]})}function Re(b){const{course:s,isLoading:l,onRegenerateOutline:o,viewMode:n,setViewMode:x,isForkable:c,onForkCourse:d,courseSlug:m}=b;return e.jsxs("div",{className:w("relative mb-1 flex items-start justify-between border-b border-gray-100 p-6 max-lg:p-3",l&&"striped-loader"),children:[e.jsx("div",{className:"max-lg:hidden",children:e.jsx("h2",{className:"mb-1 text-2xl font-bold text-balance max-lg:text-lg max-lg:leading-tight",children:s.title||"Loading course .."})}),e.jsx("div",{className:"absolute top-3 right-3 flex gap-2 max-lg:relative max-lg:top-0 max-lg:right-0 max-lg:w-full max-lg:flex-row-reverse max-lg:justify-between",children:!l&&e.jsxs(e.Fragment,{children:[e.jsx(Ps,{onRegenerateOutline:o,isForkable:c,onForkCourse:d,courseSlug:m}),e.jsxs("div",{className:"mr-1 flex rounded-lg border border-gray-200 bg-white p-0.5",children:[e.jsxs("button",{onClick:()=>x("outline"),className:w("flex items-center gap-1 rounded-md px-2 py-1 text-sm transition-colors",n==="outline"?"bg-gray-200 text-gray-900":"text-gray-500 hover:text-gray-900"),children:[e.jsx(Ee,{className:w("size-4",n==="outline"&&"text-gray-900")}),e.jsx("span",{children:"Outline"})]}),e.jsxs("button",{onClick:()=>{x("roadmap")},className:w("flex items-center gap-1 rounded-md px-2 py-1 text-sm transition-colors",n==="roadmap"?"bg-gray-200 text-gray-900":"text-gray-500 hover:text-gray-900"),children:[e.jsx(vs,{className:w("size-4",n==="roadmap"&&"text-gray-900")}),e.jsx("span",{children:"Map"})]})]})]})})]})}function Es(b){const{course:s,isLoading:l,onRegenerateOutline:o,setActiveModuleIndex:n,setActiveLessonIndex:x,setSidebarOpen:c,setViewMode:d,setExpandedModules:m,viewMode:g,isForkable:j,onForkCourse:N,courseSlug:k}=b,h=s.done||[];return e.jsxs("div",{className:"mx-auto rounded-xl border border-gray-200 bg-white shadow-xs lg:max-w-5xl",children:[e.jsx(Re,{course:s,isLoading:l,onRegenerateOutline:o,viewMode:g,setViewMode:d,isForkable:j,onForkCourse:N,courseSlug:k}),s.title?e.jsx("div",{className:"flex flex-col p-6 max-lg:mt-0.5 max-lg:p-4",children:s.modules.map((y,f)=>e.jsxs("div",{className:"mb-5 pb-4 last:border-0 last:pb-0 max-lg:mb-2",children:[e.jsx("h2",{className:"mb-4 text-xl font-bold text-gray-800 max-lg:mb-2 max-lg:text-lg max-lg:leading-tight",children:y.title}),e.jsx("div",{className:"divide-y divide-gray-100",children:y.lessons.map((a,i)=>{const r=`${K(String(f))}-${K(String(i))}`,t=h.includes(r);return e.jsxs("div",{className:"flex cursor-pointer items-center gap-2 px-2 py-2.5 transition-colors hover:bg-gray-100 max-lg:px-0 max-lg:py-1.5",onClick:()=>{n(f),x(i),m(p=>{const C={};return s.modules.forEach((v,A)=>{C[A]=!1}),C[f]=!0,C}),c(!1),d("module")},children:[!t&&e.jsx("span",{className:w("flex size-6 shrink-0 items-center justify-center rounded-full bg-gray-200 text-sm font-medium text-gray-800 max-lg:size-5 max-lg:text-xs"),children:i+1}),t&&e.jsx(Pe,{additionalClasses:"size-6 shrink-0 text-green-500"}),e.jsx("p",{className:"flex-1 truncate text-base text-gray-800 max-lg:text-sm",children:a.replace(/^Lesson\s*?\d+[\.:]\s*/,"")}),e.jsxs("span",{className:"text-sm font-medium text-gray-700 max-lg:hidden",children:[t?"View":"Start"," →"]})]},r)})})]},f))}):e.jsx("div",{className:"flex h-64 items-center justify-center",children:e.jsx(J,{size:36,className:"animate-spin text-gray-300"})})]})}function Fs(b){const{done:s=[],courseSlug:l,course:o,isLoading:n,onRegenerateOutline:x,setActiveModuleIndex:c,setActiveLessonIndex:d,setViewMode:m,setExpandedModules:g,onUpgradeClick:j,viewMode:N,isForkable:k,onForkCourse:h}=b,y=u.useRef(null),[f,a]=u.useState([]),[i,r]=u.useState(!1),[t,p]=u.useState(null),{data:C,isLoading:v}=te(ve(),G),A=C?.status==="active",P=async _=>{if(!O()){r(!1);return}try{const M=await fetch(`https://api.hnmdevs.com/v1-generate-ai-course-roadmap/${_}`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include"});if(!M.ok){const I=await M.json();console.error("Error generating course roadmap:",I?.message||"Something went wrong"),p(I?.message||"Something went wrong"),r(!1);return}const D=M.body?.getReader();if(!D){console.error("Failed to get reader from response"),p("Something went wrong"),r(!1);return}r(!0),await $e(D,{onStream:async I=>{const T=ge(I,!0),{nodes:E,edges:R}=he(T),U=await fe({nodes:E,edges:R});pe(y.current,U)},onStreamEnd:async I=>{const T=ge(I,!0),{nodes:E,edges:R}=he(T),U=await fe({nodes:E,edges:R});pe(y.current,U),a(T),r(!1),s.forEach(L=>{be(L,"done")});const z=T.filter(L=>L.type==="topic");for(const L of z){const V=L.id;(L?.children?.every(W=>s.includes(W.id))??!1)&&be(V,"done")}}})}catch(M){console.error("Error generating course roadmap:",M),p("Something went wrong"),r(!1)}};u.useEffect(()=>{l&&P(l)},[]);const Y=u.useCallback(_=>{if(i)return;const D=_.target?.closest("g")||{},I=D?.dataset?.nodeId,T=D?.dataset?.type;if(!I||!T)return null;if(T==="topic"){const U=f.filter(z=>z.type==="topic").findIndex(z=>z.id===I);g(z=>{const L={};return f.forEach((V,q)=>{L[q]=!1}),L[U]=!0,L}),c(U),d(0),m("module");return}if(T!=="subtopic")return null;const[E,R]=I.split("-").map(Number);g(U=>{const z={};return f.forEach((L,V)=>{z[V]=!1}),z[E]=!0,z}),c(E),d(R),m("module")},[f,g,c,d,m]);return e.jsxs("div",{className:"relative overflow-hidden mx-auto min-h-[500px] rounded-xl border border-gray-200 bg-white shadow-xs lg:max-w-5xl",children:[e.jsx(Re,{course:o,isLoading:n,onRegenerateOutline:_=>{m("outline"),x(_)},viewMode:N,setViewMode:m,isForkable:k,onForkCourse:h,courseSlug:l}),n&&e.jsx("div",{className:"absolute inset-0 flex h-full w-full items-center justify-center",children:e.jsx(J,{className:"h-10 w-10 animate-spin stroke-[3px]"})}),!O()&&e.jsx(Te,{className:"-mt-1 -mb-2 rounded-none border-none"}),t&&!i&&!O()&&e.jsxs("div",{className:"absolute inset-0 flex h-full w-full flex-col items-center justify-center",children:[e.jsx(Me,{className:"size-20 text-red-500"}),e.jsx("p",{className:"mx-auto mt-5 max-w-[250px] text-center text-base text-balance text-red-500",children:t||"Something went wrong"}),!A&&(t||"")?.includes("limit")&&e.jsx("button",{onClick:j,className:"mt-5 rounded-full bg-red-600 px-4 py-1 text-white hover:bg-red-700",children:"Upgrade Account"})]}),e.jsx("div",{id:"resource-svg-wrap",ref:y,onClick:Y,className:"px-4 pb-2"})]})}function Os(b){const{creatorId:s,onForkCourse:l,className:o=""}=b,n=De();return!n||!s||n?.id===s?null:e.jsxs("div",{className:w("mx-auto mb-3.5 flex max-w-5xl items-center justify-between gap-2 rounded-lg bg-yellow-200 p-3 text-black lg:-mt-2.5",o),children:[e.jsx("p",{className:"text-sm text-balance",children:"Fork the course to track progress and make changes to the course."}),e.jsxs("button",{className:"flex shrink-0 items-center gap-2 rounded-md hover:bg-yellow-500 bg-yellow-400 px-3 py-1.5 text-sm text-black",onClick:l,children:[e.jsx(ue,{className:"size-3.5"}),"Fork Course"]})]})}function Ts(b){const{onClose:s,courseSlug:l}=b,o=ns(),[n,x]=u.useState(!1),{mutate:c}=le({mutationFn:async()=>(x(!0),ke(`https://api.hnmdevs.com/v1-fork-ai-course/${l}`,{})),onSuccess(d){window.location.href=`/ai/${d.slug}`},onError(d){o.error(d?.message||"Failed to fork course"),x(!1)}},G);return e.jsx(rs,{onClose:n?()=>{}:s,wrapperClassName:"h-auto items-start max-w-md w-full",overlayClassName:"items-start md:items-center",children:e.jsxs("div",{className:"relative flex flex-col items-center p-8",children:[e.jsx("div",{className:"p-4",children:e.jsx(as,{className:"size-12 text-gray-300",strokeWidth:1.5})}),e.jsxs("div",{className:"mt-6 text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Fork Course"}),e.jsx("p",{className:"mt-3 text-center leading-relaxed text-balance text-gray-600",children:"Create a copy of this course to track your progress and make changes to suit your learning style."})]}),e.jsxs("div",{className:"mt-8 grid w-full grid-cols-2 gap-3",children:[e.jsx("button",{disabled:n,onClick:s,className:"flex items-center justify-center gap-2 rounded-lg border border-gray-200 px-4 py-2.5 font-medium text-gray-700 transition-all hover:border-gray-300 hover:bg-gray-50 disabled:cursor-not-allowed disabled:opacity-50",children:"Cancel"}),e.jsx("button",{disabled:n,className:"flex hover:opacity-80 items-center justify-center gap-2 rounded-lg bg-black px-4 py-2.5 font-medium text-white transition-all hover:bg-gray-900 disabled:cursor-not-allowed disabled:opacity-50",onClick:()=>c(),children:n?e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"size-4 animate-spin"}),e.jsx("span",{children:"Forking..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"size-4"}),e.jsx("span",{children:"Fork Course"})]})})]})]})})}function Pt(b){const{course:s,courseSlug:l,isLoading:o,error:n,onRegenerateOutline:x,creatorId:c}=b,[d,m]=u.useState(!1),[g,j]=u.useState(!1),[N,k]=u.useState(!0),[h,y]=u.useState(0),[f,a]=u.useState(0),[i,r]=u.useState(!1),[t,p]=u.useState("outline"),[C,v]=u.useState(!1),{isPaidUser:A}=we(),P=os(),Y=s.done||[],[_,M]=u.useState({}),D=()=>{if(h>=s.modules.length)return;const S=h+1;y(S),a(0),M(F=>{const Q={};return s.modules.forEach(($,B)=>{Q[B]=!1}),Q[S]=!0,Q})},I=()=>{const S=s.modules[h];S&&f<S.lessons.length-1?a(f+1):D()},T=()=>{if(f>0){a(f-1);return}const S=s.modules[h-1];if(!S)return;const F=h-1;y(F),a(S.lessons.length-1),M(Q=>{const $={};return s.modules.forEach((B,Z)=>{$[Z]=!1}),$[F]=!0,$})},E=s.modules[h],R=E?.lessons[f],U=s.modules.length,z=E?.lessons.length||0,L=s.modules.reduce((S,F)=>S+F.lessons.length,0),V=(s?.done||[]).length,q=ze(V,L),W=e.jsxs(e.Fragment,{children:[d&&e.jsx(oe,{onClose:()=>m(!1)}),g&&e.jsx(ts,{onClose:()=>j(!1),onUpgrade:()=>{j(!1),m(!0)}})]});if(u.useEffect(()=>{window&&window?.innerWidth<1024&&N&&k(!1)},[]),n&&!o){const S=n.includes("limit"),F=n.includes("not exist");let Q=e.jsx(Ue,{additionalClasses:"mb-4 size-16"}),$="Error occurred",B=n;S?(Q=e.jsx(cs,{className:"mb-4 size-16 text-yellow-500"}),$="Limit Reached",B="You have reached the daily AI usage limit. Please upgrade your account to continue."):F&&(Q=e.jsx(gs,{className:"mb-4 size-16 text-gray-300"}),$="Course Not Found",B="The course you are looking for does not exist. Why not create your own course?");const Z=S&&!A;return e.jsxs(e.Fragment,{children:[W,e.jsxs("div",{className:"flex h-screen flex-col items-center justify-center px-4 text-center",children:[Q,e.jsx("h1",{className:"mb-2 text-2xl font-bold",children:$}),e.jsx("p",{className:"max-w-sm text-balance text-gray-500",children:B}),Z&&e.jsxs("div",{className:"my-5",children:[e.jsx("button",{onClick:()=>m(!0),className:"rounded-md bg-yellow-400 px-6 py-2 text-sm font-medium text-black hover:bg-yellow-500",children:"Upgrade to remove Limits"}),e.jsx("p",{className:"mt-5 text-sm text-black",children:e.jsx("a",{href:"/ai",className:"font-medium underline underline-offset-2",children:"Back to AI Tutor"})})]}),(F||!Z)&&e.jsx("div",{className:"my-5",children:e.jsx("a",{href:"/ai",className:"hover:bg-opacity-80 rounded-md bg-black px-6 py-2 text-sm font-medium text-white",children:"Create a course with AI"})})]})]})}const se=t==="module",H=!!P?.id&&P.id!==c;return e.jsxs("section",{className:"flex h-screen grow flex-col overflow-hidden bg-gray-50",children:[W,e.jsx("div",{className:"border-b border-gray-200 bg-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between px-4 py-2",children:[e.jsxs("a",{href:"/ai",onClick:S=>{se&&(S.preventDefault(),p("outline"))},className:"flex flex-row items-center gap-1.5 text-sm font-medium text-gray-700 hover:text-gray-900","aria-label":"Back to generator",children:[e.jsx(de,{className:"size-4",strokeWidth:2.5}),"Back"," ",e.jsx("span",{className:"hidden lg:inline",children:se?"to Outline":"to AI Tutor"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[!o&&e.jsx("div",{className:"flex flex-row lg:hidden",children:e.jsx(je,{onUpgrade:()=>m(!0),onShowLimits:()=>j(!0)})}),t==="module"&&e.jsx("button",{onClick:()=>k(!N),className:"flex items-center justify-center text-gray-400 shadow-xs transition-colors hover:bg-gray-50 hover:text-gray-900 lg:hidden",children:N?e.jsx(Fe,{size:17,strokeWidth:3}):e.jsx(Le,{size:17,strokeWidth:3})}),e.jsx("button",{onClick:()=>r(!i),className:"flex items-center justify-center text-gray-400 shadow-xs transition-colors hover:bg-gray-50 hover:text-gray-900 lg:hidden",children:i?e.jsx(ae,{size:17,strokeWidth:3}):e.jsx(ls,{size:17,strokeWidth:3})})]})]})}),e.jsxs("header",{className:"flex items-center justify-between border-b border-gray-200 bg-white px-6 max-lg:py-4 lg:h-[80px]",children:[e.jsx("div",{className:"flex items-center",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("h1",{className:"text-xl leading-tight! font-bold text-balance text-gray-900 max-lg:mb-0.5 max-lg:text-lg",children:s.title||"Loading Course..."}),e.jsxs("div",{className:"mt-1 flex flex-row items-center gap-2 text-sm text-gray-600 max-lg:text-xs",children:[e.jsxs("span",{className:"font-medium",children:[U," modules"]}),e.jsx("span",{className:"text-gray-400",children:"•"}),e.jsxs("span",{className:"font-medium",children:[L," lessons"]}),t==="module"&&e.jsxs("span",{className:"flex flex-row items-center gap-1 lg:hidden",children:[e.jsx("span",{className:"text-gray-400",children:"•"}),e.jsx("button",{className:"underline underline-offset-2",onClick:()=>{M({}),p("outline")},children:"View outline"})]}),q>0&&!o&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-gray-400",children:"•"}),e.jsxs("span",{className:"font-medium text-green-600",children:[q,"% complete"]})]})]})]})}),!o&&e.jsx("div",{className:"flex gap-2",children:e.jsx("div",{className:"hidden gap-2 lg:flex",children:e.jsx(je,{onUpgrade:()=>m(!0),onShowLimits:()=>j(!0)})})})]}),e.jsxs("div",{className:"flex flex-1 overflow-hidden",children:[e.jsxs("aside",{className:w("fixed inset-y-0 left-0 z-20 w-80 transform overflow-y-auto border-r border-gray-200 bg-white transition-transform duration-200 ease-in-out lg:relative lg:mt-0 lg:translate-x-0",i?"translate-x-0":"-translate-x-full"),children:[e.jsxs("div",{className:w("relative flex min-h-[40px] items-center justify-between border-b border-gray-200 px-3",o&&"striped-loader bg-gray-50"),children:[!o&&e.jsxs("div",{className:"flex w-full items-center justify-between text-xs text-black",children:[e.jsxs("span",{children:[e.jsxs("span",{className:"relative z-10 rounded-full bg-yellow-400 px-1.5 py-0.5",children:[q,"%"]})," ",e.jsx("span",{className:"relative z-10",children:"Completed"})]}),e.jsx("span",{style:{width:`${q}%`},className:w("absolute top-0 bottom-0 left-0","bg-gray-200/50")}),e.jsxs("div",{className:"flex gap-0 rounded-md bg-white p-0.5",children:[e.jsxs("button",{onClick:()=>{M({}),p("outline")},className:w("flex items-center gap-1 rounded-sm px-2 py-1 text-xs transition-colors",t==="outline"?"bg-gray-200 text-gray-900":"text-gray-600 hover:bg-gray-50"),children:[e.jsx(Ee,{size:14}),"Outline"]}),e.jsxs("button",{onClick:()=>{M({}),p("roadmap")},className:w("flex items-center gap-1 rounded-sm px-2 py-1 text-xs transition-colors",t==="roadmap"?"bg-gray-200 text-gray-900":"text-gray-600 hover:bg-gray-50"),children:[e.jsx(is,{size:14}),"Map"]})]})]}),e.jsx("button",{onClick:()=>r(!1),className:"rounded-md p-1 hover:bg-gray-100 lg:hidden",children:e.jsx(ae,{size:18})})]}),e.jsx(zs,{course:s,courseSlug:l,activeModuleIndex:t==="module"?h:void 0,setActiveModuleIndex:y,activeLessonIndex:t==="module"?f:void 0,setActiveLessonIndex:a,setSidebarOpen:r,viewMode:t,setViewMode:p,expandedModules:_,setExpandedModules:M,isLoading:o})]}),e.jsxs("main",{className:w("flex-1 overflow-y-scroll p-6 transition-all duration-200 ease-in-out max-lg:p-3",i?"lg:ml-0":"",t==="module"?"flex flex-col overflow-hidden p-0 max-lg:p-0":""),children:[H&&l&&(t==="outline"||t==="roadmap")&&e.jsx(Os,{creatorId:c,onForkCourse:()=>{v(!0)}}),C&&e.jsx(Ts,{onClose:()=>{v(!1)},courseSlug:l}),t==="module"&&e.jsx(Ms,{courseSlug:l,creatorId:c,progress:Y,activeModuleIndex:h,totalModules:U,currentModuleTitle:E?.title||"",activeLessonIndex:f,totalLessons:z,currentLessonTitle:R||"",onGoToPrevLesson:T,onGoToNextLesson:I,onUpgrade:()=>m(!0),isAIChatsOpen:N,setIsAIChatsOpen:k,isForkable:H,onForkCourse:()=>{v(!0)}},`${l}-${h}-${f}`),t==="outline"&&e.jsx(Es,{course:s,isLoading:o,onRegenerateOutline:x,setActiveModuleIndex:y,setActiveLessonIndex:a,setSidebarOpen:r,setViewMode:p,setExpandedModules:M,viewMode:t,isForkable:H,onForkCourse:()=>{v(!0)},courseSlug:l}),t==="roadmap"&&!o&&e.jsx(Fs,{done:s.done,courseSlug:l,course:s,isLoading:o,onRegenerateOutline:x,setActiveModuleIndex:y,setActiveLessonIndex:a,setViewMode:p,setExpandedModules:M,onUpgradeClick:()=>m(!0),viewMode:t,isForkable:H,onForkCourse:()=>{v(!0)}}),e.jsx(Oe,{className:t==="module"?"hidden":""})]},`${l}-${t}`)]}),i&&e.jsx("div",{className:"fixed inset-0 z-10 bg-gray-900/50 lg:hidden",onClick:()=>r(!1)})]})}async function Et(b){const{term:s,slug:l,onCourseIdChange:o,onCourseSlugChange:n,onCourseChange:x,onLoadingChange:c,onError:d,onCreatorIdChange:m,isForce:g=!1,prompt:j,src:N="search",questionAndAnswers:k}=b;c?.(!0),x?.({title:"",modules:[],done:[]},""),d?.("");try{let h=null;if(l&&g?h=await fetch(`https://api.hnmdevs.com/v1-regenerate-ai-course/${l}`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({isForce:g,customPrompt:j})}):h=await fetch("https://api.hnmdevs.com/v1-generate-ai-course",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({keyword:s,isForce:g,customPrompt:j,questionAndAnswers:k,src:N}),credentials:"include"}),!h.ok){const r=await h.json();console.error("Error generating course:",r?.message||"Something went wrong"),c?.(!1),d?.(r?.message||"Something went wrong");return}const y=h.body?.getReader();if(!y){console.error("Failed to get reader from response"),d?.("Something went wrong"),c?.(!1);return}const f=new RegExp("@COURSEID:(\\w+)@"),a=new RegExp(/@COURSESLUG:([\w-]+)@/),i=new RegExp("@CREATORID:(\\w+)@");await ie(y,{onStream:async r=>{if(r.includes("@COURSEID")||r.includes("@COURSESLUG")){const t=r.match(f),p=r.match(a),C=r.match(i),v=t?.[1]||"",A=p?.[1]||"",P=C?.[1]||"";A&&window.history.replaceState({courseId:v,courseSlug:A,term:s},"",`${origin}/ai/${A}`),r=r.replace(f,"").replace(a,"").replace(i,""),o?.(v),n?.(A),m?.(P)}try{const t=_e(r);x?.(t,r)}catch(t){console.error("Error parsing streamed course content:",t)}},onStreamEnd:async r=>{r=r.replace(f,"").replace(a,"").replace(i,""),c?.(!1),G.invalidateQueries(ce())}})}catch(h){d?.(h?.message||"Something went wrong"),console.error("Error in course generation:",h),c?.(!1)}}export{Pt as A,Et as g};
