<!DOCTYPE html><html lang="en"> <head><meta charset="UTF-8"><meta name="generator" content="Astro v5.7.13"><meta name="commit" content="https://github.com/jonesded/developer-roadmap/commit/undefined"><title>Building a BitTorrent Client - roadmap.sh</title><meta name="description" content="Learn everything you need to know about BitTorrent by writing a client in Go"><meta name="keywords" content="roadmap, hnm devs, developer roadmaps, developer roadmap, how to become a developer, frontend developer roadmap, frontend developer roadmap 2024, frontend developer roadmap 2025, backend developer roadmap, backend developer roadmap 2024, backend developer roadmap 2025, full stack developer roadmap, full stack developer roadmap 2024, full stack developer roadmap 2025, sre roadmap, sre roadmap 2024, sre roadmap 2025, devops roadmap, devops roadmap 2024, devops roadmap 2025, devops engineer roadmap, devops engineer roadmap 2024, devops engineer roadmap 2025, android developer roadmap, android developer roadmap 2024, android developer roadmap 2025, database administrator roadmap, database administrator roadmap 2024, database administrator roadmap 2025, blockchain developer roadmap, blockchain developer roadmap 2024, blockchain developer roadmap 2025, qa roadmap, qa roadmap 2024, qa roadmap 2025, qa engineer roadmap, qa engineer roadmap 2024, qa engineer roadmap 2025, software architect roadmap, software architect roadmap 2024, software architect roadmap 2025, asp.net core developer roadmap, asp.net core developer roadmap 2024, asp.net core developer roadmap 2025, react developer roadmap, react developer roadmap 2024, react developer roadmap 2025, angular developer roadmap, angular developer roadmap 2024, angular developer roadmap 2025, vue developer roadmap, vue developer roadmap 2024, vue developer roadmap 2025, node.js developer roadmap, node.js developer roadmap 2024, node.js developer roadmap 2025, javascript developer roadmap, javascript developer roadmap 2024, javascript developer roadmap 2025, python developer roadmap, python developer roadmap 2024, python developer roadmap 2025, go developer roadmap, go developer roadmap 2024, go developer roadmap 2025, java developer roadmap, java developer roadmap 2024, java developer roadmap 2025, design system roadmap, design system roadmap 2024, design system roadmap 2025, software design roadmap, software design roadmap 2024, software design roadmap 2025, graphql roadmap, graphql roadmap 2024, graphql roadmap 2025, ux design roadmap, ux design roadmap 2024, ux design roadmap 2025, terraform developer roadmap, terraform developer roadmap 2024, terraform developer roadmap 2025, sql developer roadmap, sql developer roadmap 2024, sql developer roadmap 2025, spring boot developer roadmap, spring boot developer roadmap 2024, spring boot developer roadmap 2025, php developer roadmap, php developer roadmap 2024, php developer roadmap 2025, ios developer roadmap, ios developer roadmap 2024, ios developer roadmap 2025, game developer roadmap, game developer roadmap 2024, game developer roadmap 2025, flutter developer roadmap, flutter developer roadmap 2024, flutter developer roadmap 2025, data analyst roadmap, data analyst roadmap 2024, data analyst roadmap 2025, aws developer roadmap, aws developer roadmap 2024, aws developer roadmap 2025, cyber security specialist roadmap, cyber security specialist roadmap 2024, cyber security specialist roadmap 2025, ai developer roadmap, ai developer roadmap 2024, ai developer roadmap 2025, ai engineer roadmap, ai engineer roadmap 2024, ai engineer roadmap 2025, ai data scientist roadmap, ai data scientist roadmap 2024, ai data scientist roadmap 2025"><meta name="viewport" content="width=device-width, user-scalable=yes, initial-scale=1.0, maximum-scale=3.0, minimum-scale=1.0"><meta http-equiv="Content-Language" content="en"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:creator" content="@kamrify"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta property="og:image" content="https://roadmap.sh/og/guide/torrent-client"><meta property="og:image:alt" content="roadmap.sh"><meta property="og:site_name" content="roadmap.sh"><meta property="og:title" content="Building a BitTorrent Client - roadmap.sh"><meta property="og:description" content="Learn everything you need to know about BitTorrent by writing a client in Go"><meta property="og:type" content="website"><meta property="og:url" content="https://hnmdevs.com/guides/torrent-client"><link rel="canonical" href="https://blog.jse.li/posts/torrent/"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="apple-mobile-web-app-title" content="roadmap.sh"><meta name="application-name" content="roadmap.sh"><meta name="ahrefs-site-verification" content="04588b1b3d0118b4f973fa24f9df38ca6300d152cc26529a639e9a34d09c9880"><link rel="apple-touch-icon" sizes="180x180" href="/manifest/apple-touch-icon.png"><meta name="msapplication-TileColor" content="#101010"><meta name="theme-color" content="#848a9a"><link rel="manifest" href="/manifest/manifest.json"><link rel="icon" type="image/png" sizes="32x32" href="/manifest/icon32.png"><link rel="icon" type="image/png" sizes="16x16" href="/manifest/icon16.png"><link rel="shortcut icon" href="/manifest/favicon.ico" type="image/x-icon"><link rel="icon" href="/manifest/favicon.ico" type="image/x-icon"><link rel="preconnect" href="https://www.google-analytics.com/"><link rel="preconnect" href="https://api.roadmap.sh/"><!-- Google Tag Manager Start --><script>
      (function (w, d, s, l, i) {
        w[l] = w[l] || [];
        w[l].push({ 'gtm.start': new Date().getTime(), event: 'gtm.js' });
        var f = d.getElementsByTagName(s)[0],
          j = d.createElement(s),
          dl = l != 'dataLayer' ? '&l=' + l : '';
        j.async = true;
        j.src = 'https://www.googletagmanager.com/gtm.js?id=' + i + dl;
        f.parentNode.insertBefore(j, f);
      })(window, document, 'script', 'dataLayer', 'GTM-T66KC7S8');
    </script><!-- Google Tag Manager End --><script type="module" src="/_astro/Analytics.astro_astro_type_script_index_0_lang.CcEpoYr4.js"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=G-EZHDT2S2LF"></script> <script>
    // @ts-nocheck
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-EZHDT2S2LF');
</script><script async src="https://securepubads.g.doubleclick.net/tag/js/gpt.js"></script> <script async>
  const ignoredPages = [
    'login',
    'signup',
    'best-practices',
    'guides',
    'videos',
    'roadmaps',
    'community',
    'start-here',
    'ai-roadmaps',
    'ai',
    'teams',
    'about',
    'account',
    'projects',
    'questions',
    'guides',
    'advertise',
  ];

  function sanitizeSettingValue(value) {
    return (
      String(value)
        .trim()
        // Remove characters forbidden at https://support.google.com/admanager/answer/10020177.
        .replace(/'|\\|'|=|!|#|\*|~|;|\^|\(|\)|<|>|\[|\]|,|&/g, '')
        // Extra spaces aren't forbidden, but rarely desired.
        .replace(/\s+/, ' ')
        // The + sign is also forbidden, but is being replaced with 'and' instead.
        .replace('+', 'and')
        // Maximum length of 40 for values.
        .substring(0, 40)
    );
  }

  const page = window.location.pathname;
  const pageParts = page.split('/').filter(Boolean);

  const isRoadmapPage =
    pageParts.length === 1 && !ignoredPages.includes(pageParts[0]);
  const isBestPracticesPage =
    pageParts.length === 2 && pageParts[0] === 'best-practices';

  let adSettings = {};
  if (isRoadmapPage) {
    adSettings = {
      post_id: sanitizeSettingValue(pageParts[0]),
      page_type: 'roadmap',
      category: ['roadmap', sanitizeSettingValue(pageParts[0])],
    };
  } else if (isBestPracticesPage) {
    adSettings = {
      post_id: sanitizeSettingValue(pageParts[1]),
      page_type: 'best-practice',
      category: ['best-practice', sanitizeSettingValue(pageParts[1])],
    };
  }

  // @ts-nocheck
  window.googletag = window.googletag || { cmd: [] };
  googletag.cmd.push(function () {
    // Always use non-personalized ads
    googletag.pubads().setPrivacySettings({
      restrictDataProcessing: true,
      nonPersonalizedAds: true,
    });

    // Define ad slot and enable services
    googletag
      .defineSlot(
        '/22873384501/roadmap',
        ['fluid'],
        'div-gpt-ad-1742391132948-0',
      )
      .addService(googletag.pubads());

    // Set targeting for all ad slots on the page.
    for (let key in adSettings) {
      if (adSettings.hasOwnProperty(key)) {
        googletag.pubads().setTargeting(key, adSettings[key]);
      }
    }

    googletag.pubads().enableSingleRequest();
    googletag.enableServices();

    googletag.pubads().addEventListener('slotRenderEnded', function (e) {
      if (!e.isEmpty) {
        return;
      }

      const slotId = e.slot.getSlotElementId();
      if (!slotId) {
        return;
      }

      // If empty, hide the ad slot after a small delay.
      setTimeout(() => {
        const adContainer = document.getElementById(slotId);
        if (adContainer) {
          adContainer.style.display = 'none';
        }
      }, 1800);
    });
  });
</script><!-- OneTrust Cookies Consent Notice start for roadmap.sh --><script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" type="text/javascript" charset="UTF-8" data-domain-script="01977e0e-9a37-7b4a-aad2-8cf9247d94b6"></script> <script type="text/javascript">
  function OptanonWrapper() {}
</script> <!-- OneTrust Cookies Consent Notice end for roadmap.sh --><script type="text/javascript">
  (function (c, l, a, r, i, t, y) {
    c[a] =
      c[a] ||
      function () {
        (c[a].q = c[a].q || []).push(arguments);
      };
    t = l.createElement(r);
    t.async = 1;
    t.src = 'https://www.clarity.ms/tag/' + i;
    y = l.getElementsByTagName(r)[0];
    y.parentNode.insertBefore(t, y);
  })(window, document, 'clarity', 'script', 'qcw723i36o');
</script><script>
  // @ts-nocheck
  !(function (w, d) {
    if (!w.rdt) {
      var p = (w.rdt = function () {
        p.sendEvent
          ? p.sendEvent.apply(p, arguments)
          : p.callQueue.push(arguments);
      });
      p.callQueue = [];
      var t = d.createElement('script');
      (t.src = 'https://www.redditstatic.com/ads/pixel.js'), (t.async = !0);
      var s = d.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(t, s);
    }
  })(window, document);
  rdt('init', 'a2_ghq8846qpphp');
  rdt('track', 'PageVisit');
</script><script type="text/javascript" id="hs-script-loader" async defer src="//js.hs-scripts.com/46095657.js?businessUnitId=2306992"></script><script async defer src="https://b174.roadmap.sh/script.js"></script><link rel="stylesheet" href="/_astro/billing.BjcgZc0E.css"><script>window.va = window.va || function () { (window.vaq = window.vaq || []).push(arguments); };
		var script = document.createElement('script');
		script.defer = true;
		script.src = '/_vercel/insights/script.js';
		var head = document.querySelector('head');
		head.appendChild(script);
	</script></head> <body class="flex min-h-screen flex-col"> <!-- Google Tag Manager (noscript) --> <noscript> <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T66KC7S8" height="0" width="0" style="display:none;visibility:hidden"></iframe> </noscript> <!-- End Google Tag Manager (noscript) -->  <style>astro-island,astro-slot,astro-static-slot{display:contents}</style><script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).load=e;window.dispatchEvent(new Event("astro:load"));})();;(()=>{var A=Object.defineProperty;var g=(i,o,a)=>o in i?A(i,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[o]=a;var d=(i,o,a)=>g(i,typeof o!="symbol"?o+"":o,a);{let i={0:t=>m(t),1:t=>a(t),2:t=>new RegExp(t),3:t=>new Date(t),4:t=>new Map(a(t)),5:t=>new Set(a(t)),6:t=>BigInt(t),7:t=>new URL(t),8:t=>new Uint8Array(t),9:t=>new Uint16Array(t),10:t=>new Uint32Array(t),11:t=>1/0*t},o=t=>{let[l,e]=t;return l in i?i[l](e):void 0},a=t=>t.map(o),m=t=>typeof t!="object"||t===null?t:Object.fromEntries(Object.entries(t).map(([l,e])=>[l,o(e)]));class y extends HTMLElement{constructor(){super(...arguments);d(this,"Component");d(this,"hydrator");d(this,"hydrate",async()=>{var b;if(!this.hydrator||!this.isConnected)return;let e=(b=this.parentElement)==null?void 0:b.closest("astro-island[ssr]");if(e){e.addEventListener("astro:hydrate",this.hydrate,{once:!0});return}let c=this.querySelectorAll("astro-slot"),n={},h=this.querySelectorAll("template[data-astro-template]");for(let r of h){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("data-astro-template")||"default"]=r.innerHTML,r.remove())}for(let r of c){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("name")||"default"]=r.innerHTML)}let p;try{p=this.hasAttribute("props")?m(JSON.parse(this.getAttribute("props"))):{}}catch(r){let s=this.getAttribute("component-url")||"<unknown>",v=this.getAttribute("component-export");throw v&&(s+=` (export ${v})`),console.error(`[hydrate] Error parsing props for component ${s}`,this.getAttribute("props"),r),r}let u;await this.hydrator(this)(this.Component,p,n,{client:this.getAttribute("client")}),this.removeAttribute("ssr"),this.dispatchEvent(new CustomEvent("astro:hydrate"))});d(this,"unmount",()=>{this.isConnected||this.dispatchEvent(new CustomEvent("astro:unmount"))})}disconnectedCallback(){document.removeEventListener("astro:after-swap",this.unmount),document.addEventListener("astro:after-swap",this.unmount,{once:!0})}connectedCallback(){if(!this.hasAttribute("await-children")||document.readyState==="interactive"||document.readyState==="complete")this.childrenConnectedCallback();else{let e=()=>{document.removeEventListener("DOMContentLoaded",e),c.disconnect(),this.childrenConnectedCallback()},c=new MutationObserver(()=>{var n;((n=this.lastChild)==null?void 0:n.nodeType)===Node.COMMENT_NODE&&this.lastChild.nodeValue==="astro:end"&&(this.lastChild.remove(),e())});c.observe(this,{childList:!0}),document.addEventListener("DOMContentLoaded",e)}}async childrenConnectedCallback(){let e=this.getAttribute("before-hydration-url");e&&await import(e),this.start()}async start(){let e=JSON.parse(this.getAttribute("opts")),c=this.getAttribute("client");if(Astro[c]===void 0){window.addEventListener(`astro:${c}`,()=>this.start(),{once:!0});return}try{await Astro[c](async()=>{let n=this.getAttribute("renderer-url"),[h,{default:p}]=await Promise.all([import(this.getAttribute("component-url")),n?import(n):()=>()=>{}]),u=this.getAttribute("component-export")||"default";if(!u.includes("."))this.Component=h[u];else{this.Component=h;for(let f of u.split("."))this.Component=this.Component[f]}return this.hydrator=p,this.hydrate},e,this)}catch(n){console.error(`[astro-island] Error hydrating ${this.getAttribute("component-url")}`,n)}}attributeChangedCallback(){this.hydrate()}}d(y,"observedAttributes",["props"]),customElements.get("astro-island")||customElements.define("astro-island",y)}})();</script><astro-island uid="ZURVaX" prefix="r12" component-url="/_astro/CourseAnnouncement.BkFOHY7G.js" component-export="CourseAnnouncement" renderer-url="/_astro/client.DWEMtbU6.js" props="{}" ssr client="load" opts="{&quot;name&quot;:&quot;CourseAnnouncement&quot;,&quot;value&quot;:true}" await-children><div class="sticky top-0 z-91 overflow-hidden transition-[height] duration-300 h-0"><a href="/courses/sql" class="flex items-center bg-yellow-400 py-1.5"><span class="container mx-auto flex items-center justify-start gap-2 text-center sm:justify-center sm:gap-4"><span class="flex items-center gap-1.5 text-xs font-medium text-black md:text-base"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-database hidden h-4 w-4 shrink-0 text-black sm:block" aria-hidden="true"><ellipse cx="12" cy="5" rx="9" ry="3"></ellipse><path d="M3 5V19A9 3 0 0 0 21 19V5"></path><path d="M3 12A9 3 0 0 0 21 12"></path></svg><span class="hidden sm:block">Master SQL with our new premium course</span><span class="block sm:hidden">Announcing our SQL course</span></span><span class="items-center gap-1.5 rounded-full bg-black px-2 py-0.5 text-xs font-medium tracking-wide text-white uppercase hover:bg-zinc-800 sm:px-3 sm:py-1"><span class="mr-1.5 hidden sm:inline">Start Learning</span><span class="mr-1.5 inline sm:hidden">Visit</span><span class="">→</span></span></span></a><button type="button" class="absolute top-1/2 right-3.5 -translate-y-1/2 rounded-lg px-1.5 py-1.5 text-gray-500 hover:bg-yellow-500 hover:text-gray-700"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x h-4 w-4" aria-hidden="true"><path d="M18 6 6 18"></path><path d="m6 6 12 12"></path></svg></button></div><!--astro:end--></astro-island>   <div class="bg-slate-900 py-5 text-white sm:py-8"> <nav class="container flex items-center justify-between"> <div class="flex items-center gap-5"> <a class="flex items-center text-lg font-medium text-white" href="/" aria-label="HNM Devs"> <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 283 283" fill="#000" xmlns:v="https://vecta.io/nano"><path fill="#fff" d="M0 39C0 17.46 17.46 0 39 0h205c21.539 0 39 17.46 39 39v205c0 21.539-17.461 39-39 39H39c-21.54 0-39-17.461-39-39V39Z"></path><path d="M121.215 210.72c-1.867.56-4.854 1.12-8.96 1.68-3.92.56-8.027.84-12.32.84-4.107 0-7.84-.28-11.2-.84-3.174-.56-5.88-1.68-8.12-3.36s-4.014-3.92-5.32-6.72c-1.12-2.987-1.68-6.813-1.68-11.48v-84c0-4.293.746-7.933 2.24-10.92 1.68-3.173 4.013-5.973 7-8.4s6.626-4.573 10.92-6.44c4.48-2.053 9.24-3.827 14.28-5.32a106.176 106.176 0 0 1 15.68-3.36 95.412 95.412 0 0 1 16.24-1.4c8.96 0 16.053 1.773 21.28 5.32 5.226 3.36 7.84 8.96 7.84 16.8 0 2.613-.374 5.227-1.12 7.84-.747 2.427-1.68 4.667-2.8 6.72a133.1 133.1 0 0 0-12.04.56c-4.107.373-8.12.933-12.04 1.68s-7.654 1.587-11.2 2.52c-3.36.747-6.254 1.68-8.68 2.8v95.48zm45.172-22.4c0-7.84 2.426-14.373 7.28-19.6s11.48-7.84 19.88-7.84 15.026 2.613 19.88 7.84 7.28 11.76 7.28 19.6-2.427 14.373-7.28 19.6-11.48 7.84-19.88 7.84-15.027-2.613-19.88-7.84-7.28-11.76-7.28-19.6z"></path></svg> </a> <a href="/ai" class="group relative inline text-gray-400 hover:text-white sm:hidden">
AI Tutor
</a> <!-- Desktop navigation items --> <div class="hidden gap-5 sm:flex sm:items-center"> <astro-island uid="1ceDnR" prefix="r16" component-url="/_astro/NavigationDropdown.Dl-JRBNw.js" component-export="NavigationDropdown" renderer-url="/_astro/client.DWEMtbU6.js" props="{}" ssr client="load" opts="{&quot;name&quot;:&quot;NavigationDropdown&quot;,&quot;value&quot;:true}" await-children><div class="relative flex items-center"><button class="text-gray-400 hover:text-white" aria-label="Open Navigation Dropdown" aria-expanded="false"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-menu h-5 w-5" aria-hidden="true"><path d="M4 12h16"></path><path d="M4 18h16"></path><path d="M4 6h16"></path></svg></button><div class="pointer-events-none invisible absolute left-0 top-full z-90 mt-2 w-48 min-w-[320px] -translate-y-1 rounded-lg bg-slate-800 py-2 opacity-0 shadow-xl transition-all duration-100" role="menu"><a href="/courses/sql" class="group flex items-center gap-3 px-4 py-2.5 text-gray-400 transition-colors hover:bg-slate-700" role="menuitem"><span class="flex h-[40px] w-[40px] items-center justify-center rounded-full bg-slate-600 transition-colors group-hover:bg-slate-500 group-hover:text-slate-100"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-database inline-block h-5 w-5" aria-hidden="true"><ellipse cx="12" cy="5" rx="9" ry="3"></ellipse><path d="M3 5V19A9 3 0 0 0 21 19V5"></path><path d="M3 12A9 3 0 0 0 21 12"></path></svg></span><span class="flex flex-col"><span class="font-medium text-slate-300 transition-colors group-hover:text-slate-100">SQL Course<!-- --> <span class="text-[10px] font-bold text-black py-0.5 uppercase tracking-wider bg-yellow-400 rounded-full px-1.5 relative -top-0.5">New</span></span><span class="text-sm">Our premium SQL course</span></span></a><a href="/get-started" class="group flex items-center gap-3 px-4 py-2.5 text-gray-400 transition-colors hover:bg-slate-700" role="menuitem"><span class="flex h-[40px] w-[40px] items-center justify-center rounded-full bg-slate-600 transition-colors group-hover:bg-slate-500 group-hover:text-slate-100"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-right inline-block h-5 w-5" aria-hidden="true"><path d="M5 12h14"></path><path d="m12 5 7 7-7 7"></path></svg></span><span class="flex flex-col"><span class="font-medium text-slate-300 transition-colors group-hover:text-slate-100">Get Started<!-- --> </span><span class="text-sm">Pick a path and get started</span></span></a><a href="/projects" class="group flex items-center gap-3 px-4 py-2.5 text-gray-400 transition-colors hover:bg-slate-700" role="menuitem"><span class="flex h-[40px] w-[40px] items-center justify-center rounded-full bg-slate-600 transition-colors group-hover:bg-slate-500 group-hover:text-slate-100"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-folder-kanban inline-block h-5 w-5" aria-hidden="true"><path d="M4 20h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.93a2 2 0 0 1-1.66-.9l-.82-1.2A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13c0 1.1.9 2 2 2Z"></path><path d="M8 10v4"></path><path d="M12 10v2"></path><path d="M16 10v6"></path></svg></span><span class="flex flex-col"><span class="font-medium text-slate-300 transition-colors group-hover:text-slate-100">Projects<!-- --> </span><span class="text-sm">Skill-up with real-world projects</span></span></a><a href="/guides" class="group flex items-center gap-3 px-4 py-2.5 text-gray-400 transition-colors hover:bg-slate-700" role="menuitem"><span class="flex h-[40px] w-[40px] items-center justify-center rounded-full bg-slate-600 transition-colors group-hover:bg-slate-500 group-hover:text-slate-100"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-book-open-text inline-block h-5 w-5" aria-hidden="true"><path d="M12 7v14"></path><path d="M16 12h2"></path><path d="M16 8h2"></path><path d="M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z"></path><path d="M6 12h2"></path><path d="M6 8h2"></path></svg></span><span class="flex flex-col"><span class="font-medium text-slate-300 transition-colors group-hover:text-slate-100">Guides<!-- --> </span><span class="text-sm">In-depth articles and tutorials</span></span></a><a href="/teams" class="group flex items-center gap-3 px-4 py-2.5 text-gray-400 transition-colors hover:bg-slate-700" role="menuitem"><span class="flex h-[40px] w-[40px] items-center justify-center rounded-full bg-slate-600 transition-colors group-hover:bg-slate-500 group-hover:text-slate-100"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-users inline-block h-5 w-5" aria-hidden="true"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path><path d="M16 3.128a4 4 0 0 1 0 7.744"></path><path d="M22 21v-2a4 4 0 0 0-3-3.87"></path><circle cx="9" cy="7" r="4"></circle></svg></span><span class="flex flex-col"><span class="font-medium text-slate-300 transition-colors group-hover:text-slate-100">Teams<!-- --> </span><span class="text-sm">Collaborate with your team</span></span></a><a href="/advertise" class="group flex items-center gap-3 px-4 py-2.5 text-gray-400 transition-colors hover:bg-slate-700" role="menuitem"><span class="flex h-[40px] w-[40px] items-center justify-center rounded-full bg-slate-600 transition-colors group-hover:bg-slate-500 group-hover:text-slate-100"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-menu inline-block h-5 w-5" aria-hidden="true"><path d="M4 12h16"></path><path d="M4 18h16"></path><path d="M4 6h16"></path></svg></span><span class="flex flex-col"><span class="font-medium text-slate-300 transition-colors group-hover:text-slate-100">Advertise<!-- --> </span><span class="text-sm">Promote your product or service</span></span></a></div></div><!--astro:end--></astro-island> <astro-island uid="ZxkGTv" prefix="r17" component-url="/_astro/RoadmapDropdownMenu.KNH2CB9y.js" component-export="RoadmapDropdownMenu" renderer-url="/_astro/client.DWEMtbU6.js" props="{}" ssr client="load" opts="{&quot;name&quot;:&quot;RoadmapDropdownMenu&quot;,&quot;value&quot;:true}" await-children><div class="relative flex items-center"><button class="text-gray-400 hover:text-white" aria-label="Open Navigation Dropdown" aria-expanded="false"><span>Roadmaps<!-- --> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-down inline-block h-3 w-3" aria-hidden="true"><path d="m6 9 6 6 6-6"></path></svg></span></button><div class="pointer-events-none invisible absolute top-full left-0 z-90 mt-2 w-48 min-w-[320px] -translate-y-1 rounded-lg bg-slate-800 py-2 opacity-0 shadow-xl transition-all duration-100" role="menu"><a href="/roadmaps" class="group flex items-center gap-3 px-4 py-2.5 transition-colors mx-2 mb-1 rounded-md border border-slate-600 bg-slate-700 pl-2.5 text-gray-200 hover:bg-slate-600" role="menuitem"><span class="flex h-[40px] w-[40px] items-center justify-center rounded-full transition-colors group-hover:bg-slate-500 group-hover:text-slate-100 bg-slate-500 text-slate-100"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-map inline-block h-5 w-5" aria-hidden="true"><path d="M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z"></path><path d="M15 5.764v15"></path><path d="M9 3.236v15"></path></svg></span><span class="flex flex-col"><span class="font-medium transition-colors group-hover:text-slate-100 text-white">Official Roadmaps<!-- --> </span><span class="text-sm">Made by subject matter experts</span></span></a><a href="/ai?format=roadmap" class="group flex items-center gap-3 px-4 py-2.5 text-gray-400 transition-colors hover:bg-slate-700" role="menuitem"><span class="flex h-[40px] w-[40px] items-center justify-center rounded-full bg-slate-600 transition-colors group-hover:bg-slate-500 group-hover:text-slate-100"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-sparkles inline-block h-5 w-5" aria-hidden="true"><path d="M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z"></path><path d="M20 3v4"></path><path d="M22 5h-4"></path><path d="M4 17v2"></path><path d="M5 18H3"></path></svg></span><span class="flex flex-col"><span class="font-medium text-slate-300 transition-colors group-hover:text-slate-100">AI Roadmaps<!-- --> </span><span class="text-sm">Generate roadmaps with AI</span></span></a><a href="/community" class="group flex items-center gap-3 px-4 py-2.5 text-gray-400 transition-colors hover:bg-slate-700" role="menuitem"><span class="flex h-[40px] w-[40px] items-center justify-center rounded-full bg-slate-600 transition-colors group-hover:bg-slate-500 group-hover:text-slate-100"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-globe inline-block h-5 w-5" aria-hidden="true"><circle cx="12" cy="12" r="10"></circle><path d="M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20"></path><path d="M2 12h20"></path></svg></span><span class="flex flex-col"><span class="font-medium text-slate-300 transition-colors group-hover:text-slate-100">Community Roadmaps<!-- --> </span><span class="text-sm">Made by community members</span></span></a></div></div><!--astro:end--></astro-island> <astro-island uid="Z1GJm6f" prefix="r18" component-url="/_astro/AIDropdownMenu.DCLM770k.js" component-export="AIDropdownMenu" renderer-url="/_astro/client.DWEMtbU6.js" props="{}" ssr client="load" opts="{&quot;name&quot;:&quot;AIDropdownMenu&quot;,&quot;value&quot;:true}" await-children><div class="relative flex items-center"><button class="text-gray-400 hover:text-white" aria-label="Open Navigation Dropdown" aria-expanded="false"><span class="group relative flex items-center gap-1 hover:text-white">AI Tutor<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-down inline-block h-3 w-3" aria-hidden="true"><path d="m6 9 6 6 6-6"></path></svg></span></button><div class="pointer-events-none invisible absolute top-full left-0 z-90 mt-2 w-48 min-w-[320px] -translate-y-1 rounded-lg bg-slate-800 py-2 opacity-0 shadow-xl transition-all duration-100" role="menu"><a href="/ai" class="group flex items-center gap-3 px-4 py-2.5 text-gray-400 transition-colors hover:bg-slate-700" role="menuitem"><span class="flex h-[40px] w-[40px] items-center justify-center rounded-full bg-slate-600 transition-colors group-hover:bg-slate-500 group-hover:text-slate-100"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-plus inline-block h-5 w-5" aria-hidden="true"><path d="M5 12h14"></path><path d="M12 5v14"></path></svg></span><span class="flex flex-col"><span class="font-medium text-slate-300 transition-colors group-hover:text-slate-100">Create with AI<!-- --> </span><span class="text-sm">Learn something new with AI</span></span></a><a href="/ai/quiz" class="group flex items-center gap-3 px-4 py-2.5 text-gray-400 transition-colors hover:bg-slate-700" role="menuitem"><span class="flex h-[40px] w-[40px] items-center justify-center rounded-full bg-slate-600 transition-colors group-hover:bg-slate-500 group-hover:text-slate-100"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-swords inline-block h-5 w-5" aria-hidden="true"><polyline points="14.5 17.5 3 6 3 3 6 3 17.5 14.5"></polyline><line x1="13" x2="19" y1="19" y2="13"></line><line x1="16" x2="20" y1="16" y2="20"></line><line x1="19" x2="21" y1="21" y2="19"></line><polyline points="14.5 6.5 18 3 21 3 21 6 17.5 9.5"></polyline><line x1="5" x2="9" y1="14" y2="18"></line><line x1="7" x2="4" y1="17" y2="20"></line><line x1="3" x2="5" y1="19" y2="21"></line></svg></span><span class="flex flex-col"><span class="font-medium text-slate-300 transition-colors group-hover:text-slate-100">Test my Skills<!-- --> </span><span class="text-sm">Test your skills with AI</span></span></a><a href="/ai/chat" class="group flex items-center gap-3 px-4 py-2.5 text-gray-400 transition-colors hover:bg-slate-700" role="menuitem"><span class="flex h-[40px] w-[40px] items-center justify-center rounded-full bg-slate-600 transition-colors group-hover:bg-slate-500 group-hover:text-slate-100"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-message-circle inline-block h-5 w-5" aria-hidden="true"><path d="M7.9 20A9 9 0 1 0 4 16.1L2 22Z"></path></svg></span><span class="flex flex-col"><span class="font-medium text-slate-300 transition-colors group-hover:text-slate-100">Ask AI Tutor<!-- --> </span><span class="text-sm">Career, resume guidance, and more</span></span></a><a href="/ai/roadmap-chat" class="group flex items-center gap-3 px-4 py-2.5 text-gray-400 transition-colors hover:bg-slate-700" role="menuitem"><span class="flex h-[40px] w-[40px] items-center justify-center rounded-full bg-slate-600 transition-colors group-hover:bg-slate-500 group-hover:text-slate-100"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-map inline-block h-5 w-5" aria-hidden="true"><path d="M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z"></path><path d="M15 5.764v15"></path><path d="M9 3.236v15"></path></svg></span><span class="flex flex-col"><span class="font-medium text-slate-300 transition-colors group-hover:text-slate-100">Roadmap Chat<!-- --> </span><span class="text-sm">Chat with AI Tutor about a roadmap</span></span></a></div></div><!--astro:end--></astro-island> <script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).only=e;window.dispatchEvent(new Event("astro:only"));})();</script><astro-island uid="27Okme" component-url="/_astro/UpgradeProButton.Bf6cPqyW.js" component-export="UpgradeProButton" renderer-url="/_astro/client.DWEMtbU6.js" props="{}" ssr client="only" opts="{&quot;name&quot;:&quot;UpgradeProButton&quot;,&quot;value&quot;:&quot;react&quot;}"></astro-island> </div> </div> <ul class="hidden h-8 w-[172px] items-center justify-end gap-5 sm:flex"> <li data-guest-required class="hidden"> <a href="/login" class="text-gray-400 hover:text-white">Login</a> </li> <li class="flex items-center gap-2"> <astro-island uid="ZBGkSR" component-url="/_astro/AccountStreak.C5iwNbja.js" component-export="AccountStreak" renderer-url="/_astro/client.DWEMtbU6.js" props="{}" ssr client="only" opts="{&quot;name&quot;:&quot;AccountStreak&quot;,&quot;value&quot;:&quot;react&quot;}"></astro-island> <astro-island uid="2hUg8c" component-url="/_astro/AccountDropdown.j6PP4KM4.js" component-export="AccountDropdown" renderer-url="/_astro/client.DWEMtbU6.js" props="{}" ssr client="only" opts="{&quot;name&quot;:&quot;AccountDropdown&quot;,&quot;value&quot;:&quot;react&quot;}"></astro-island> <a data-guest-required class="flex hidden h-8 w-28 cursor-pointer items-center justify-center rounded-full bg-linear-to-r from-blue-500 to-blue-700 px-4 py-2 text-sm font-medium text-white hover:from-blue-500 hover:to-blue-600" href="/signup"> <span>Sign Up</span> </a> </li> </ul> <!-- Mobile Navigation Button --> <button class="block cursor-pointer text-gray-400 hover:text-gray-50 sm:hidden" aria-label="Menu" data-show-mobile-nav> <svg class="h-5 w-5" viewBox="0 0 24 24" focusable="false" aria-hidden="true">
  <path fill="currentColor" d="M 3 5 A 1.0001 1.0001 0 1 0 3 7 L 21 7 A 1.0001 1.0001 0 1 0 21 5 L 3 5 z M 3 11 A 1.0001 1.0001 0 1 0 3 13 L 21 13 A 1.0001 1.0001 0 1 0 21 11 L 3 11 z M 3 17 A 1.0001 1.0001 0 1 0 3 19 L 21 19 A 1.0001 1.0001 0 1 0 21 17 L 3 17 z"></path>
</svg> </button> <!-- Mobile Navigation Items --> <div class="fixed top-0 right-0 bottom-0 left-0 z-40 flex hidden items-center bg-slate-900" data-mobile-nav> <button data-close-mobile-nav class="absolute top-6 right-6 block cursor-pointer text-gray-400 hover:text-gray-50" aria-label="Close Menu"> <svg aria-hidden="true" class="w-5 h-5" fill="#c6c7c7" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
  <path fill-rule="evenodd"
        d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
        clipRule="evenodd"></path>
</svg> </button> <ul class="flex w-full flex-col items-center gap-2 md:gap-3"> <li> <a href="/roadmaps" class="text-xl hover:text-blue-300 md:text-lg">
Roadmaps
</a> </li> <li> <a href="/ai" class="text-xl hover:text-blue-300 md:text-lg">
AI Tutor
</a> </li> <li> <a href="/guides" class="text-xl hover:text-blue-300 md:text-lg">
Guides
</a> </li> <!-- Links for logged in users --> <li data-auth-required class="hidden"> <a href="/account" class="text-xl hover:text-blue-300 md:text-lg">
Account
</a> </li> <li data-auth-required class="hidden"> <button data-logout-button class="text-xl text-red-300 hover:text-red-400 md:text-lg">
Logout
</button> </li> <li> <a data-guest-required href="/login" class="hidden text-xl text-white md:text-lg">
Login
</a> </li> <li> <a data-guest-required href="/signup" class="hidden text-xl text-green-300 hover:text-green-400 md:text-lg">
Sign Up
</a> </li> </ul> </div> </nav> </div> <script type="module" src="/_astro/Navigation.astro_astro_type_script_index_0_lang.DJCjCueH.js"></script>   <article class="lg:grid lg:max-w-full lg:grid-cols-[1fr_minmax(0,700px)_1fr]"> <div class="sticky top-0 lg:relative bg-linear-to-r from-gray-50 py-0 lg:col-start-3 lg:col-end-4 lg:row-start-1"> <astro-island uid="ZRQOh8" prefix="r22" component-url="/_astro/RelatedGuides.Bojw9AjP.js" component-export="RelatedGuides" renderer-url="/_astro/client.DWEMtbU6.js" props="{&quot;relatedTitle&quot;:[0],&quot;relatedGuides&quot;:[0,{}]}" ssr client="load" opts="{&quot;name&quot;:&quot;RelatedGuides&quot;,&quot;value&quot;:true}"></astro-island> <astro-island uid="Z8CKH6" prefix="r23" component-url="/_astro/TableOfContent.CA_NsO7k.js" component-export="TableOfContent" renderer-url="/_astro/client.DWEMtbU6.js" props="{&quot;toc&quot;:[1,[[0,{&quot;depth&quot;:[0,2],&quot;slug&quot;:[0,&quot;finding-peers&quot;],&quot;text&quot;:[0,&quot;Finding peers&quot;],&quot;children&quot;:[1,[[0,{&quot;depth&quot;:[0,3],&quot;slug&quot;:[0,&quot;parsing-a-torrent-file&quot;],&quot;text&quot;:[0,&quot;Parsing a .torrent file&quot;]}],[0,{&quot;depth&quot;:[0,3],&quot;slug&quot;:[0,&quot;retrieving-peers-from-the-tracker&quot;],&quot;text&quot;:[0,&quot;Retrieving peers from the tracker&quot;]}],[0,{&quot;depth&quot;:[0,3],&quot;slug&quot;:[0,&quot;parsing-the-tracker-response&quot;],&quot;text&quot;:[0,&quot;Parsing the tracker response&quot;]}]]]}],[0,{&quot;depth&quot;:[0,2],&quot;slug&quot;:[0,&quot;downloading-from-peers&quot;],&quot;text&quot;:[0,&quot;Downloading from peers&quot;],&quot;children&quot;:[1,[]]}],[0,{&quot;depth&quot;:[0,2],&quot;slug&quot;:[0,&quot;start-a-tcp-connection&quot;],&quot;text&quot;:[0,&quot;Start a TCP connection&quot;],&quot;children&quot;:[1,[[0,{&quot;depth&quot;:[0,3],&quot;slug&quot;:[0,&quot;complete-the-handshake&quot;],&quot;text&quot;:[0,&quot;Complete the handshake&quot;]}],[0,{&quot;depth&quot;:[0,3],&quot;slug&quot;:[0,&quot;send-and-receive-messages&quot;],&quot;text&quot;:[0,&quot;Send and receive messages&quot;]}],[0,{&quot;depth&quot;:[0,3],&quot;slug&quot;:[0,&quot;putting-it-all-together&quot;],&quot;text&quot;:[0,&quot;Putting it all together&quot;]}]]]}],[0,{&quot;depth&quot;:[0,2],&quot;slug&quot;:[0,&quot;this-isnt-the-full-story&quot;],&quot;text&quot;:[0,&quot;This isn’t the full story&quot;],&quot;children&quot;:[1,[]]}]]]}" ssr client="load" opts="{&quot;name&quot;:&quot;TableOfContent&quot;,&quot;value&quot;:true}" await-children><div class="relative min-w-[250px] px-5 pt-0 max-lg:min-w-full max-lg:max-w-full max-lg:border-none max-lg:px-0 lg:pt-5 top-0 lg:sticky!"><h4 class="text-lg font-medium max-lg:hidden">In this article</h4><button class="flex w-full items-center justify-between gap-2 bg-gray-300 px-3 py-2 text-sm font-medium lg:hidden">Table of Contents<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-down transform transition-transform" aria-hidden="true"><path d="m6 9 6 6 6-6"></path></svg></button><ol class="mt-0.5 space-y-0 max-lg:absolute max-lg:top-full max-lg:mt-0 max-lg:w-full max-lg:bg-white max-lg:shadow-sm hidden lg:block"><li><a href="#finding-peers" class="text-sm text-gray-500 no-underline hover:text-black max-lg:block max-lg:border-b max-lg:px-3 max-lg:py-1">Finding peers</a><ol class="my-0 ml-4 mt-1 space-y-0 max-lg:ml-0 max-lg:mt-0 max-lg:list-none"><li><a href="#parsing-a-torrent-file" class="text-sm text-gray-500 no-underline hover:text-black max-lg:block max-lg:border-b max-lg:px-3 max-lg:py-1 max-lg:pl-8">Parsing a .torrent file</a></li><li><a href="#retrieving-peers-from-the-tracker" class="text-sm text-gray-500 no-underline hover:text-black max-lg:block max-lg:border-b max-lg:px-3 max-lg:py-1 max-lg:pl-8">Retrieving peers from the tracker</a></li><li><a href="#parsing-the-tracker-response" class="text-sm text-gray-500 no-underline hover:text-black max-lg:block max-lg:border-b max-lg:px-3 max-lg:py-1 max-lg:pl-8">Parsing the tracker response</a></li></ol></li><li><a href="#downloading-from-peers" class="text-sm text-gray-500 no-underline hover:text-black max-lg:block max-lg:border-b max-lg:px-3 max-lg:py-1">Downloading from peers</a></li><li><a href="#start-a-tcp-connection" class="text-sm text-gray-500 no-underline hover:text-black max-lg:block max-lg:border-b max-lg:px-3 max-lg:py-1">Start a TCP connection</a><ol class="my-0 ml-4 mt-1 space-y-0 max-lg:ml-0 max-lg:mt-0 max-lg:list-none"><li><a href="#complete-the-handshake" class="text-sm text-gray-500 no-underline hover:text-black max-lg:block max-lg:border-b max-lg:px-3 max-lg:py-1 max-lg:pl-8">Complete the handshake</a></li><li><a href="#send-and-receive-messages" class="text-sm text-gray-500 no-underline hover:text-black max-lg:block max-lg:border-b max-lg:px-3 max-lg:py-1 max-lg:pl-8">Send and receive messages</a></li><li><a href="#putting-it-all-together" class="text-sm text-gray-500 no-underline hover:text-black max-lg:block max-lg:border-b max-lg:px-3 max-lg:py-1 max-lg:pl-8">Putting it all together</a></li></ol></li><li><a href="#this-isnt-the-full-story" class="text-sm text-gray-500 no-underline hover:text-black max-lg:block max-lg:border-b max-lg:px-3 max-lg:py-1">This isn’t the full story</a></li></ol></div><!--astro:end--></astro-island> </div> <div class="col-start-2 col-end-3 row-start-1 mx-auto max-w-[700px] py-5 sm:py-10 lg:border-r"> <div class="container prose prose-xl prose-h2:mb-3 prose-h2:mt-10 prose-h2:scroll-mt-5 prose-h2:text-balance prose-h2:text-3xl prose-h3:mt-2 prose-h4:text-2xl prose-h3:scroll-mt-5 prose-h3:text-balance prose-h4:text-balance prose-h5:text-balance prose-h5:font-medium prose-blockquote:font-normal prose-code:bg-transparent prose-img:mt-1 sm:prose-h2:scroll-mt-10 sm:prose-h3:scroll-mt-10">  <h1 class="mb-3 text-balance text-4xl font-bold"> Building a BitTorrent Client </h1> <p class="my-0 flex items-center justify-start text-sm text-gray-400"> <a href="/authors/jesse-li" class="inline-flex items-center font-medium underline-offset-2 hover:text-gray-600 hover:underline"> <img alt="Jesse Li" src="/authors/jesse.png" class="mb-0 mr-2 inline h-5 w-5 rounded-full"> Jesse Li </a> <span class="mx-2 hidden sm:inline">&middot;</span> <a class="hidden underline-offset-2 hover:text-gray-600 sm:inline" href="https://github.com/kamranahmedse/developer-roadmap/tree/master/src/data/guides/torrent-client.md" target="_blank">
Improve this Guide
</a> </p> <p>BitTorrent is a protocol for downloading and distributing files across the Internet. In contrast with the traditional client/server relationship, in which downloaders connect to a central server (for example: watching a movie on Netflix, or loading the web page you’re reading now), participants in the BitTorrent network, called <strong>peers</strong>, download pieces of files from <em>each other</em>—this is what makes it a <strong>peer-to-peer</strong> protocol. In this article we will investigate how this works, and build our own client that can find peers and exchange data between them.</p>
<p><img src="/guides/torrent-client/client-server-p2p.png" alt="diagram showing the difference between client/server (all clients connecting to one server) and peer-to-peer (peers connecting to each other) relationships"></p>
<p>The protocol evolved organically over the past 20 years, and various people and organizations added extensions for features like encryption, private torrents, and new ways of finding peers. We’ll be implementing the <a href="https://www.bittorrent.org/beps/bep_0003.html" rel="noopener noreferrer nofollow" target="_blank">original spec</a> from 2001 to keep this a weekend-sized project.</p>
<p>I’ll be using a <a href="https://cdimage.debian.org/debian-cd/current/amd64/bt-cd/#indexlist" rel="noopener noreferrer nofollow" target="_blank">Debian ISO</a> file as my guinea pig because it’s big, but not huge, at 350MB. As a popular Linux distribution, there will be lots of fast and cooperative peers for us to connect to. And we’ll avoid the legal and ethical issues related to downloading pirated content.</p>
<h2 id="finding-peers">Finding peers</h2>
<p>Here’s a problem: we want to download a file with BitTorrent, but it’s a peer-to-peer protocol and we have no idea where to find peers to download it from. This is a lot like moving to a new city and trying to make friends—maybe we’ll hit up a local pub or a meetup group! Centralized locations like these are the big idea behind trackers, which are central servers that introduce peers to each other. They’re just web servers running over HTTP, and you can find Debian’s at <code>http://bttracker.debian.org:6969/</code>.</p>
<p><img src="/guides/torrent-client/trackers.png" alt="illustration of a desktop computer and laptop sitting at a pub"></p>
<p>Of course, these central servers are liable to get raided by the feds if they facilitate peers exchanging illegal content. You may remember reading about trackers like TorrentSpy, Popcorn Time, and Kickass Torrents getting seized and shut down. New methods cut out the middleman by making even <strong>peer discovery</strong> a distributed process. We won’t be implementing them, but if you’re interested, some terms you can research are <strong>DHT</strong>, <strong>PEX</strong>, and <strong>magnet links</strong>.</p>
<h3 id="parsing-a-torrent-file">Parsing a .torrent file</h3>
<p>A .torrent file describes the contents of a torrentable file and information for connecting to a tracker. It’s all we need in order to kickstart the process of downloading a torrent. Debian’s .torrent file looks like this:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="markdown"><code><span class="line"><span style="color:#F8F8F2">d8:announce41:http://bttracker.debian.org:6969/announce7:comment35:"Debian CD from cdimage.debian.org"13:creation datei1573903810e9:httpseedsl145:https://cdimage.debian.org/cdimage/release/10.2.0//srv/cdbuilder.debian.org/dst/deb-cd/weekly-builds/amd64/iso-cd/debian-10.2.0-amd64-netinst.iso145:https://cdimage.debian.org/cdimage/archive/10.2.0//srv/cdbuilder.debian.org/dst/deb-cd/weekly-builds/amd64/iso-cd/debian-10.2.0-amd64-netinst.isoe4:infod6:lengthi351272960e4:name31:debian-10.2.0-amd64-netinst.iso12:piece lengthi262144e6:pieces26800:�����PS�^�� (binary blob of the hashes of each piece)ee</span></span></code></pre>
<p>That mess is encoded in a format called <strong>Bencode</strong> (pronounced <em>bee-encode</em>), and we’ll need to decode it.</p>
<p>Bencode can encode roughly the same types of structures as JSON—strings, integers, lists, and dictionaries. Bencoded data is not as human-readable/writable as JSON, but it can efficiently handle binary data and it’s really simple to parse from a stream. Strings come with a length prefix, and look like <code>4:spam</code>. Integers go between <em>start</em> and <em>end</em> markers, so <code>7</code> would encode to <code>i7e</code>. Lists and dictionaries work in a similar way: <code>l4:spami7ee</code> represents <code>['spam', 7]</code>, while <code>d4:spami7ee</code> means <code>{spam: 7}</code>.</p>
<p>In a prettier format, our .torrent file looks like this:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="markdown"><code><span class="line"><span style="color:#F8F8F2">d</span></span>
<span class="line"><span style="color:#F8F8F2">8:announce</span></span>
<span class="line"><span style="color:#F8F8F2">41:http://bttracker.debian.org:6969/announce</span></span>
<span class="line"><span style="color:#F8F8F2">7:comment</span></span>
<span class="line"><span style="color:#F8F8F2">35:"Debian CD from cdimage.debian.org"</span></span>
<span class="line"><span style="color:#F8F8F2">13:creation date</span></span>
<span class="line"><span style="color:#F8F8F2">i1573903810e</span></span>
<span class="line"><span style="color:#F8F8F2">4:info</span></span>
<span class="line"><span style="color:#F8F8F2">d</span></span>
<span class="line"><span style="color:#F8F8F2">6:length</span></span>
<span class="line"><span style="color:#F8F8F2">i351272960e</span></span>
<span class="line"><span style="color:#F8F8F2">4:name</span></span>
<span class="line"><span style="color:#F8F8F2">31:debian-10.2.0-amd64-netinst.iso</span></span>
<span class="line"><span style="color:#F8F8F2">12:piece length</span></span>
<span class="line"><span style="color:#F8F8F2">i262144e</span></span>
<span class="line"><span style="color:#F8F8F2">6:pieces</span></span>
<span class="line"><span style="color:#F8F8F2">26800:�����PS�^�� (binary blob of the hashes of each piece)</span></span>
<span class="line"><span style="color:#F8F8F2">e</span></span>
<span class="line"><span style="color:#F8F8F2">e</span></span></code></pre>
<p>In this file, we can spot the URL of the tracker, the creation date (as a Unix timestamp), the name and size of the file, and a big binary blob containing the SHA-1 hashes of each <strong>piece</strong>, which are equally-sized parts of the file we want to download. The exact size of a piece varies between torrents, but they are usually somewhere between 256KB and 1MB. This means that a large file might be made up of <em>thousands</em> of pieces. We’ll download these pieces from our peers, check them against the hashes from our torrent file, assemble them together, and boom, we’ve got a file!</p>
<p><img src="/guides/torrent-client/pieces.png" alt="&#x22;illustration of a file being cut with scissors into multiple pieces, starting with piece 0"></p>
<p>This mechanism allows us to verify the integrity of each piece as we go. It makes BitTorrent resistant to accidental corruption or intentional <strong>torrent poisoning</strong>. Unless an attacker is capable of breaking SHA-1 with a preimage attack, we will get exactly the content we asked for.</p>
<p>It would be really fun to write a bencode parser, but parsing isn’t our focus today. But I found Fredrik Lundh’s <a href="https://effbot.org/zone/bencode.htm" rel="noopener noreferrer nofollow" target="_blank">50 line parser</a> to be especially illuminating. For this project, I used <a href="https://github.com/jackpal/bencode-go" rel="noopener noreferrer nofollow" target="_blank">github.com/jackpal/bencode-go</a>:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="go"><code><span class="line"><span style="color:#FF79C6">import</span><span style="color:#F8F8F2"> (</span></span>
<span class="line"><span style="color:#E9F284">	"</span><span style="color:#F1FA8C">github.com/jackpal/bencode-go</span><span style="color:#E9F284">"</span></span>
<span class="line"><span style="color:#F8F8F2">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">type</span><span style="color:#8BE9FD;font-style:italic"> bencodeInfo</span><span style="color:#FF79C6"> struct</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">	Pieces      </span><span style="color:#8BE9FD;font-style:italic">string</span><span style="color:#E9F284"> `</span><span style="color:#F1FA8C">bencode:"pieces"</span><span style="color:#E9F284">`</span></span>
<span class="line"><span style="color:#F8F8F2">	PieceLength </span><span style="color:#8BE9FD;font-style:italic">int</span><span style="color:#E9F284">    `</span><span style="color:#F1FA8C">bencode:"piece length"</span><span style="color:#E9F284">`</span></span>
<span class="line"><span style="color:#F8F8F2">	Length      </span><span style="color:#8BE9FD;font-style:italic">int</span><span style="color:#E9F284">    `</span><span style="color:#F1FA8C">bencode:"length"</span><span style="color:#E9F284">`</span></span>
<span class="line"><span style="color:#F8F8F2">	Name        </span><span style="color:#8BE9FD;font-style:italic">string</span><span style="color:#E9F284"> `</span><span style="color:#F1FA8C">bencode:"name"</span><span style="color:#E9F284">`</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">type</span><span style="color:#8BE9FD;font-style:italic"> bencodeTorrent</span><span style="color:#FF79C6"> struct</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">	Announce </span><span style="color:#8BE9FD;font-style:italic">string</span><span style="color:#E9F284">      `</span><span style="color:#F1FA8C">bencode:"announce"</span><span style="color:#E9F284">`</span></span>
<span class="line"><span style="color:#F8F8F2">	Info     </span><span style="color:#8BE9FD;font-style:italic">bencodeInfo</span><span style="color:#E9F284"> `</span><span style="color:#F1FA8C">bencode:"info"</span><span style="color:#E9F284">`</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">// Open parses a torrent file</span></span>
<span class="line"><span style="color:#FF79C6">func</span><span style="color:#50FA7B"> Open</span><span style="color:#F8F8F2">(</span><span style="color:#FFB86C;font-style:italic">r</span><span style="color:#8BE9FD;font-style:italic"> io</span><span style="color:#F8F8F2">.</span><span style="color:#8BE9FD;font-style:italic">Reader</span><span style="color:#F8F8F2">) (</span><span style="color:#FF79C6">*</span><span style="color:#8BE9FD;font-style:italic">bencodeTorrent</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD;font-style:italic">error</span><span style="color:#F8F8F2">) {</span></span>
<span class="line"><span style="color:#F8F8F2">	bto </span><span style="color:#FF79C6">:=</span><span style="color:#8BE9FD;font-style:italic"> bencodeTorrent</span><span style="color:#F8F8F2">{}</span></span>
<span class="line"><span style="color:#F8F8F2">	err </span><span style="color:#FF79C6">:=</span><span style="color:#F8F8F2"> bencode.</span><span style="color:#50FA7B">Unmarshal</span><span style="color:#F8F8F2">(r, </span><span style="color:#FF79C6">&#x26;</span><span style="color:#F8F8F2">bto)</span></span>
<span class="line"><span style="color:#FF79C6">	if</span><span style="color:#F8F8F2"> err </span><span style="color:#FF79C6">!=</span><span style="color:#BD93F9"> nil</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">		return</span><span style="color:#BD93F9"> nil</span><span style="color:#F8F8F2">, err</span></span>
<span class="line"><span style="color:#F8F8F2">	}</span></span>
<span class="line"><span style="color:#FF79C6">	return</span><span style="color:#FF79C6"> &#x26;</span><span style="color:#F8F8F2">bto, </span><span style="color:#BD93F9">nil</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre>
<p>Because I like to keep my structures relatively flat, and I like to keep my application structs separate from my serialization structs, I exported a different, flatter struct named <code>TorrentFile</code> and wrote a few helper functions to convert between the two.</p>
<p>Notably, I split <code>pieces</code> (previously a string) into a slice of hashes (each <code>[20]byte</code>) so that I can easily access individual hashes later. I also computed the SHA-1 hash of the entire bencoded <code>info</code> dict (the one which contained the name, size, and piece hashes). We know this as the <strong>infohash</strong> and it uniquely identifies files when we talk to trackers and peers. More on this later.</p>
<p><img src="/guides/torrent-client/info-hash.png" alt="a name tag saying &#x27;Hello my name is 86d4c80024a469be4c50bc5a102cf71780310074&#x27;"></p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="go"><code><span class="line"><span style="color:#FF79C6">type</span><span style="color:#8BE9FD;font-style:italic"> TorrentFile</span><span style="color:#FF79C6"> struct</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">	Announce    </span><span style="color:#8BE9FD;font-style:italic">string</span></span>
<span class="line"><span style="color:#F8F8F2">	InfoHash    [</span><span style="color:#BD93F9">20</span><span style="color:#F8F8F2">]</span><span style="color:#8BE9FD;font-style:italic">byte</span></span>
<span class="line"><span style="color:#F8F8F2">	PieceHashes [][</span><span style="color:#BD93F9">20</span><span style="color:#F8F8F2">]</span><span style="color:#8BE9FD;font-style:italic">byte</span></span>
<span class="line"><span style="color:#F8F8F2">	PieceLength </span><span style="color:#8BE9FD;font-style:italic">int</span></span>
<span class="line"><span style="color:#F8F8F2">	Length      </span><span style="color:#8BE9FD;font-style:italic">int</span></span>
<span class="line"><span style="color:#F8F8F2">	Name        </span><span style="color:#8BE9FD;font-style:italic">string</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">func</span><span style="color:#F8F8F2"> (</span><span style="color:#FFB86C;font-style:italic">bto </span><span style="color:#FF79C6">*</span><span style="color:#8BE9FD;font-style:italic">bencodeTorrent</span><span style="color:#F8F8F2">) </span><span style="color:#50FA7B">toTorrentFile</span><span style="color:#F8F8F2">() (</span><span style="color:#FF79C6">*</span><span style="color:#8BE9FD;font-style:italic">TorrentFile</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD;font-style:italic">error</span><span style="color:#F8F8F2">) {</span></span>
<span class="line"><span style="color:#6272A4">	// ...</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre>
<h3 id="retrieving-peers-from-the-tracker">Retrieving peers from the tracker</h3>
<p>Now that we have information about the file and its tracker, let’s talk to the tracker to <strong>announce</strong> our presence as a peer and to retrieve a list of other peers. We just need to make a GET request to the <code>announce</code> URL supplied in the .torrent file, with a few query parameters:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="go"><code><span class="line"><span style="color:#FF79C6">func</span><span style="color:#F8F8F2"> (</span><span style="color:#FFB86C;font-style:italic">t </span><span style="color:#FF79C6">*</span><span style="color:#8BE9FD;font-style:italic">TorrentFile</span><span style="color:#F8F8F2">) </span><span style="color:#50FA7B">buildTrackerURL</span><span style="color:#F8F8F2">(</span><span style="color:#FFB86C;font-style:italic">peerID</span><span style="color:#F8F8F2"> [</span><span style="color:#BD93F9">20</span><span style="color:#F8F8F2">]</span><span style="color:#8BE9FD;font-style:italic">byte</span><span style="color:#F8F8F2">, </span><span style="color:#FFB86C;font-style:italic">port</span><span style="color:#8BE9FD;font-style:italic"> uint16</span><span style="color:#F8F8F2">) (</span><span style="color:#8BE9FD;font-style:italic">string</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD;font-style:italic">error</span><span style="color:#F8F8F2">) {</span></span>
<span class="line"><span style="color:#F8F8F2">	base, err </span><span style="color:#FF79C6">:=</span><span style="color:#F8F8F2"> url.</span><span style="color:#50FA7B">Parse</span><span style="color:#F8F8F2">(t.Announce)</span></span>
<span class="line"><span style="color:#FF79C6">	if</span><span style="color:#F8F8F2"> err </span><span style="color:#FF79C6">!=</span><span style="color:#BD93F9"> nil</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">		return</span><span style="color:#E9F284"> ""</span><span style="color:#F8F8F2">, err</span></span>
<span class="line"><span style="color:#F8F8F2">	}</span></span>
<span class="line"><span style="color:#F8F8F2">	params </span><span style="color:#FF79C6">:=</span><span style="color:#8BE9FD;font-style:italic"> url</span><span style="color:#F8F8F2">.</span><span style="color:#8BE9FD;font-style:italic">Values</span><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#E9F284">		"</span><span style="color:#F1FA8C">info_hash</span><span style="color:#E9F284">"</span><span style="color:#F8F8F2">:  []</span><span style="color:#8BE9FD;font-style:italic">string</span><span style="color:#F8F8F2">{</span><span style="color:#8BE9FD;font-style:italic">string</span><span style="color:#F8F8F2">(t.InfoHash[:])},</span></span>
<span class="line"><span style="color:#E9F284">		"</span><span style="color:#F1FA8C">peer_id</span><span style="color:#E9F284">"</span><span style="color:#F8F8F2">:    []</span><span style="color:#8BE9FD;font-style:italic">string</span><span style="color:#F8F8F2">{</span><span style="color:#8BE9FD;font-style:italic">string</span><span style="color:#F8F8F2">(peerID[:])},</span></span>
<span class="line"><span style="color:#E9F284">		"</span><span style="color:#F1FA8C">port</span><span style="color:#E9F284">"</span><span style="color:#F8F8F2">:       []</span><span style="color:#8BE9FD;font-style:italic">string</span><span style="color:#F8F8F2">{strconv.</span><span style="color:#50FA7B">Itoa</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">int</span><span style="color:#F8F8F2">(Port))},</span></span>
<span class="line"><span style="color:#E9F284">		"</span><span style="color:#F1FA8C">uploaded</span><span style="color:#E9F284">"</span><span style="color:#F8F8F2">:   []</span><span style="color:#8BE9FD;font-style:italic">string</span><span style="color:#F8F8F2">{</span><span style="color:#E9F284">"</span><span style="color:#F1FA8C">0</span><span style="color:#E9F284">"</span><span style="color:#F8F8F2">},</span></span>
<span class="line"><span style="color:#E9F284">		"</span><span style="color:#F1FA8C">downloaded</span><span style="color:#E9F284">"</span><span style="color:#F8F8F2">: []</span><span style="color:#8BE9FD;font-style:italic">string</span><span style="color:#F8F8F2">{</span><span style="color:#E9F284">"</span><span style="color:#F1FA8C">0</span><span style="color:#E9F284">"</span><span style="color:#F8F8F2">},</span></span>
<span class="line"><span style="color:#E9F284">		"</span><span style="color:#F1FA8C">compact</span><span style="color:#E9F284">"</span><span style="color:#F8F8F2">:    []</span><span style="color:#8BE9FD;font-style:italic">string</span><span style="color:#F8F8F2">{</span><span style="color:#E9F284">"</span><span style="color:#F1FA8C">1</span><span style="color:#E9F284">"</span><span style="color:#F8F8F2">},</span></span>
<span class="line"><span style="color:#E9F284">		"</span><span style="color:#F1FA8C">left</span><span style="color:#E9F284">"</span><span style="color:#F8F8F2">:       []</span><span style="color:#8BE9FD;font-style:italic">string</span><span style="color:#F8F8F2">{strconv.</span><span style="color:#50FA7B">Itoa</span><span style="color:#F8F8F2">(t.Length)},</span></span>
<span class="line"><span style="color:#F8F8F2">	}</span></span>
<span class="line"><span style="color:#F8F8F2">	base.RawQuery </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> params.</span><span style="color:#50FA7B">Encode</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#FF79C6">	return</span><span style="color:#F8F8F2"> base.</span><span style="color:#50FA7B">String</span><span style="color:#F8F8F2">(), </span><span style="color:#BD93F9">nil</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre>
<p>The important ones:</p>
<ul>
<li><strong>info_hash</strong>: Identifies the <em>file</em> we’re trying to download. It’s the infohash we calculated earlier from the bencoded <code>info</code> dict. The tracker will use this to figure out which peers to show us.</li>
<li><strong>peer_id</strong>: A 20 byte name to identify <em>ourselves</em> to trackers and peers. We’ll just generate 20 random bytes for this. Real BitTorrent clients have IDs like <code>-TR2940-k8hj0wgej6ch</code> which identify the client software and version—in this case, TR2940 stands for Transmission client 2.94.</li>
</ul>
<p><img src="/guides/torrent-client/info-hash-peer-id.png" alt="a file with a name tag saying &#x27;info_hash&#x27; and a person with a name tag &#x27;peer_id&#x27;"></p>
<h3 id="parsing-the-tracker-response">Parsing the tracker response</h3>
<p>We get back a bencoded response:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="markdown"><code><span class="line"><span style="color:#F8F8F2">d</span></span>
<span class="line"><span style="color:#F8F8F2">8:interval</span></span>
<span class="line"><span style="color:#F8F8F2">i900e</span></span>
<span class="line"><span style="color:#F8F8F2">5:peers</span></span>
<span class="line"><span style="color:#F8F8F2">252:(another long binary blob)</span></span>
<span class="line"><span style="color:#F8F8F2">e</span></span></code></pre>
<p><code>Interval</code> tells us how often we’re supposed to connect to the tracker again to refresh our list of peers. A value of 900 means we should reconnect every 15 minutes (900 seconds).</p>
<p><code>Peers</code> is another long binary blob containing the IP addresses of each peer. It’s made out of <strong>groups of six bytes</strong>. The first four bytes in each group represent the peer’s IP address—each byte represents a number in the IP. The last two bytes represent the port, as a big-endian <code>uint16</code>. <strong>Big-endian</strong>, or <strong>network order</strong>, means that we can interpret a group of bytes as an integer by just squishing them together left to right. For example, the bytes <code>0x1A</code>, <code>0xE1</code> make <code>0x1AE1</code>, or 6881 in decimal.</p>
<p><img src="/guides/torrent-client/address.png" alt="diagram showing how 192, 0, 2, 123, 0x1A, 0xE1 can be interpreted as 192.0.1.123:6881"></p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="go"><code><span class="line"><span style="color:#6272A4">// Peer encodes connection information for a peer</span></span>
<span class="line"><span style="color:#FF79C6">type</span><span style="color:#8BE9FD;font-style:italic"> Peer</span><span style="color:#FF79C6"> struct</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">	IP   </span><span style="color:#8BE9FD;font-style:italic">net</span><span style="color:#F8F8F2">.</span><span style="color:#8BE9FD;font-style:italic">IP</span></span>
<span class="line"><span style="color:#F8F8F2">	Port </span><span style="color:#8BE9FD;font-style:italic">uint16</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">// Unmarshal parses peer IP addresses and ports from a buffer</span></span>
<span class="line"><span style="color:#FF79C6">func</span><span style="color:#50FA7B"> Unmarshal</span><span style="color:#F8F8F2">(</span><span style="color:#FFB86C;font-style:italic">peersBin</span><span style="color:#F8F8F2"> []</span><span style="color:#8BE9FD;font-style:italic">byte</span><span style="color:#F8F8F2">) ([]</span><span style="color:#8BE9FD;font-style:italic">Peer</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD;font-style:italic">error</span><span style="color:#F8F8F2">) {</span></span>
<span class="line"><span style="color:#FF79C6">	const</span><span style="color:#BD93F9"> peerSize</span><span style="color:#FF79C6"> =</span><span style="color:#BD93F9"> 6</span><span style="color:#6272A4"> // 4 for IP, 2 for port</span></span>
<span class="line"><span style="color:#F8F8F2">	numPeers </span><span style="color:#FF79C6">:=</span><span style="color:#50FA7B"> len</span><span style="color:#F8F8F2">(peersBin) </span><span style="color:#FF79C6">/</span><span style="color:#F8F8F2"> peerSize</span></span>
<span class="line"><span style="color:#FF79C6">	if</span><span style="color:#50FA7B"> len</span><span style="color:#F8F8F2">(peersBin)</span><span style="color:#FF79C6">%</span><span style="color:#F8F8F2">peerSize </span><span style="color:#FF79C6">!=</span><span style="color:#BD93F9"> 0</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">		err </span><span style="color:#FF79C6">:=</span><span style="color:#F8F8F2"> fmt.</span><span style="color:#50FA7B">Errorf</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">"</span><span style="color:#F1FA8C">Received malformed peers</span><span style="color:#E9F284">"</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#FF79C6">		return</span><span style="color:#BD93F9"> nil</span><span style="color:#F8F8F2">, err</span></span>
<span class="line"><span style="color:#F8F8F2">	}</span></span>
<span class="line"><span style="color:#F8F8F2">	peers </span><span style="color:#FF79C6">:=</span><span style="color:#50FA7B"> make</span><span style="color:#F8F8F2">([]</span><span style="color:#8BE9FD;font-style:italic">Peer</span><span style="color:#F8F8F2">, numPeers)</span></span>
<span class="line"><span style="color:#FF79C6">	for</span><span style="color:#F8F8F2"> i </span><span style="color:#FF79C6">:=</span><span style="color:#BD93F9"> 0</span><span style="color:#F8F8F2">; i </span><span style="color:#FF79C6">&#x3C;</span><span style="color:#F8F8F2"> numPeers; i</span><span style="color:#FF79C6">++</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">		offset </span><span style="color:#FF79C6">:=</span><span style="color:#F8F8F2"> i </span><span style="color:#FF79C6">*</span><span style="color:#F8F8F2"> peerSize</span></span>
<span class="line"><span style="color:#F8F8F2">		peers[i].IP </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> net.</span><span style="color:#50FA7B">IP</span><span style="color:#F8F8F2">(peersBin[offset : offset</span><span style="color:#FF79C6">+</span><span style="color:#BD93F9">4</span><span style="color:#F8F8F2">])</span></span>
<span class="line"><span style="color:#F8F8F2">		peers[i].Port </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> binary.BigEndian.</span><span style="color:#50FA7B">Uint16</span><span style="color:#F8F8F2">(peersBin[offset</span><span style="color:#FF79C6">+</span><span style="color:#BD93F9">4</span><span style="color:#F8F8F2"> : offset</span><span style="color:#FF79C6">+</span><span style="color:#BD93F9">6</span><span style="color:#F8F8F2">])</span></span>
<span class="line"><span style="color:#F8F8F2">	}</span></span>
<span class="line"><span style="color:#FF79C6">	return</span><span style="color:#F8F8F2"> peers, </span><span style="color:#BD93F9">nil</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre>
<h2 id="downloading-from-peers">Downloading from peers</h2>
<p>Now that we have a list of peers, it’s time to connect with them and start downloading pieces! We can break down the process into a few steps. For each peer, we want to:</p>
<ol>
<li>Start a TCP connection with the peer. This is like starting a phone call.</li>
<li>Complete a two-way BitTorrent <strong>handshake</strong>. <em>“Hello?” “Hello.”</em></li>
<li>Exchange <strong>messages</strong> to download <strong>pieces</strong>. <em>“I’d like piece #231 please.”</em></li>
</ol>
<h2 id="start-a-tcp-connection">Start a TCP connection</h2>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="go"><code><span class="line"><span style="color:#F8F8F2">conn, err </span><span style="color:#FF79C6">:=</span><span style="color:#F8F8F2"> net.</span><span style="color:#50FA7B">DialTimeout</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">"</span><span style="color:#F1FA8C">tcp</span><span style="color:#E9F284">"</span><span style="color:#F8F8F2">, peer.</span><span style="color:#50FA7B">String</span><span style="color:#F8F8F2">(), </span><span style="color:#BD93F9">3</span><span style="color:#FF79C6">*</span><span style="color:#F8F8F2">time.Second)</span></span>
<span class="line"><span style="color:#FF79C6">if</span><span style="color:#F8F8F2"> err </span><span style="color:#FF79C6">!=</span><span style="color:#BD93F9"> nil</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">	return</span><span style="color:#BD93F9"> nil</span><span style="color:#F8F8F2">, err</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre>
<p>I set a timeout so that I don’t waste too much time on peers that aren’t going to let me connect. For the most part, it’s a pretty standard TCP connection.</p>
<h3 id="complete-the-handshake">Complete the handshake</h3>
<p>We’ve just set up a connection with a peer, but we want to do a handshake to validate our assumptions that the peer</p>
<ul>
<li>can communicate using the BitTorrent protocol</li>
<li>is able to understand and respond to our messages</li>
<li>has the file that we want, or at least knows what we’re talking about</li>
</ul>
<p><img src="/guides/torrent-client/handshake.png" alt="Two computers communicating. One asks &#x27;do you speak BitTorrent and have this file?&#x27; and the other replies &#x27;I speak BitTorrent and have that file&#x27;"></p>
<p>My father told me that the secret to a good handshake is a firm grip and eye contact. The secret to a good BitTorrent handshake is that it’s made up of five parts:</p>
<ol>
<li>The length of the protocol identifier, which is always 19 (0x13 in hex)</li>
<li>The protocol identifier, called the <strong>pstr</strong> which is always <code>BitTorrent protocol</code></li>
<li>Eight <strong>reserved bytes</strong>, all set to 0. We’d flip some of them to 1 to indicate that we support certain <a href="http://www.bittorrent.org/beps/bep_0010.html" rel="noopener noreferrer nofollow" target="_blank">extensions</a>. But we don’t, so we’ll keep them at 0.</li>
<li>The <strong>infohash</strong> that we calculated earlier to identify which file we want</li>
<li>The <strong>Peer ID</strong> that we made up to identify ourselves</li>
</ol>
<p>Put together, a handshake string might look like this:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="markdown"><code><span class="line"><span style="color:#F8F8F2">\x13BitTorrent protocol\x00\x00\x00\x00\x00\x00\x00\x00\x86\xd4\xc8\x00\x24\xa4\x69\xbe\x4c\x50\xbc\x5a\x10\x2c\xf7\x17\x80\x31\x00\x74-TR2940-k8hj0wgej6ch</span></span></code></pre>
<p>After we send a handshake to our peer, we should receive a handshake back in the same format. The infohash we get back should match the one we sent so that we know that we’re talking about the same file. If everything goes as planned, we’re good to go. If not, we can sever the connection because there’s something wrong. <em>“Hello?” “这是谁？ 你想要什么？” “Okay, wow, wrong number.”</em></p>
<p>In our code, let’s make a struct to represent a handshake, and write a few methods for serializing and reading them:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="go"><code><span class="line"><span style="color:#6272A4">// A Handshake is a special message that a peer uses to identify itself</span></span>
<span class="line"><span style="color:#FF79C6">type</span><span style="color:#8BE9FD;font-style:italic"> Handshake</span><span style="color:#FF79C6"> struct</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">	Pstr     </span><span style="color:#8BE9FD;font-style:italic">string</span></span>
<span class="line"><span style="color:#F8F8F2">	InfoHash [</span><span style="color:#BD93F9">20</span><span style="color:#F8F8F2">]</span><span style="color:#8BE9FD;font-style:italic">byte</span></span>
<span class="line"><span style="color:#F8F8F2">	PeerID   [</span><span style="color:#BD93F9">20</span><span style="color:#F8F8F2">]</span><span style="color:#8BE9FD;font-style:italic">byte</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">// Serialize serializes the handshake to a buffer</span></span>
<span class="line"><span style="color:#FF79C6">func</span><span style="color:#F8F8F2"> (</span><span style="color:#FFB86C;font-style:italic">h </span><span style="color:#FF79C6">*</span><span style="color:#8BE9FD;font-style:italic">Handshake</span><span style="color:#F8F8F2">) </span><span style="color:#50FA7B">Serialize</span><span style="color:#F8F8F2">() []</span><span style="color:#8BE9FD;font-style:italic">byte</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">	buf </span><span style="color:#FF79C6">:=</span><span style="color:#50FA7B"> make</span><span style="color:#F8F8F2">([]</span><span style="color:#8BE9FD;font-style:italic">byte</span><span style="color:#F8F8F2">, </span><span style="color:#50FA7B">len</span><span style="color:#F8F8F2">(h.Pstr)</span><span style="color:#FF79C6">+</span><span style="color:#BD93F9">49</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">	buf[</span><span style="color:#BD93F9">0</span><span style="color:#F8F8F2">] </span><span style="color:#FF79C6">=</span><span style="color:#8BE9FD;font-style:italic"> byte</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">len</span><span style="color:#F8F8F2">(h.Pstr))</span></span>
<span class="line"><span style="color:#F8F8F2">	curr </span><span style="color:#FF79C6">:=</span><span style="color:#BD93F9"> 1</span></span>
<span class="line"><span style="color:#F8F8F2">	curr </span><span style="color:#FF79C6">+=</span><span style="color:#50FA7B"> copy</span><span style="color:#F8F8F2">(buf[curr:], h.Pstr)</span></span>
<span class="line"><span style="color:#F8F8F2">	curr </span><span style="color:#FF79C6">+=</span><span style="color:#50FA7B"> copy</span><span style="color:#F8F8F2">(buf[curr:], </span><span style="color:#50FA7B">make</span><span style="color:#F8F8F2">([]</span><span style="color:#8BE9FD;font-style:italic">byte</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">8</span><span style="color:#F8F8F2">)) </span><span style="color:#6272A4">// 8 reserved bytes</span></span>
<span class="line"><span style="color:#F8F8F2">	curr </span><span style="color:#FF79C6">+=</span><span style="color:#50FA7B"> copy</span><span style="color:#F8F8F2">(buf[curr:], h.InfoHash[:])</span></span>
<span class="line"><span style="color:#F8F8F2">	curr </span><span style="color:#FF79C6">+=</span><span style="color:#50FA7B"> copy</span><span style="color:#F8F8F2">(buf[curr:], h.PeerID[:])</span></span>
<span class="line"><span style="color:#FF79C6">	return</span><span style="color:#F8F8F2"> buf</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">// Read parses a handshake from a stream</span></span>
<span class="line"><span style="color:#FF79C6">func</span><span style="color:#50FA7B"> Read</span><span style="color:#F8F8F2">(</span><span style="color:#FFB86C;font-style:italic">r</span><span style="color:#8BE9FD;font-style:italic"> io</span><span style="color:#F8F8F2">.</span><span style="color:#8BE9FD;font-style:italic">Reader</span><span style="color:#F8F8F2">) (</span><span style="color:#FF79C6">*</span><span style="color:#8BE9FD;font-style:italic">Handshake</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD;font-style:italic">error</span><span style="color:#F8F8F2">) {</span></span>
<span class="line"><span style="color:#6272A4">	// Do Serialize(), but backwards</span></span>
<span class="line"><span style="color:#6272A4">	// ...</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre>
<h3 id="send-and-receive-messages">Send and receive messages</h3>
<p>Once we’ve completed the initial handshake, we can send and receive <strong>messages</strong>. Well, not quite—if the other peer isn’t ready to accept messages, we can’t send any until they tell us they’re ready. In this state, we’re considered <strong>choked</strong> by the other peer. They’ll send us an <strong>unchoke</strong> message to let us know that we can begin asking them for data. By default, we assume that we’re choked until proven otherwise.</p>
<p>Once we’ve been unchoked, we can then begin sending <strong>requests</strong> for pieces, and they can send us messages back containing pieces.</p>
<p><img src="/guides/torrent-client/choke.png" alt="&#x22;A cartoon in which person 1 says &#x27;hello I would like piece number—&#x27; and person 2 grabs him by the neck and says &#x27;00 00 00 01 00 (choke)&#x27;"></p>
<h4 id="interpreting-messages">Interpreting messages</h4>
<p>A message has a length, an <strong>ID</strong> and a <strong>payload</strong>. On the wire, it looks like:</p>
<p><img src="/guides/torrent-client/message.png" alt="A message with 4 byte for the length, 1 byte for ID, and an optional payload"></p>
<p>A message starts with a length indicator which tells us how many bytes long the message will be. It’s a 32-bit integer, meaning it’s made out of four bytes smooshed together in big-endian order. The next byte, the <strong>ID</strong>, tells us which type of message we’re receiving—for example, a <code>2</code> byte means “interested.” Finally, the optional <strong>payload</strong> fills out the remaining length of the message.</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="go"><code><span class="line"><span style="color:#FF79C6">type</span><span style="color:#8BE9FD;font-style:italic"> messageID</span><span style="color:#8BE9FD;font-style:italic"> uint8</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">const</span><span style="color:#F8F8F2"> (</span></span>
<span class="line"><span style="color:#BD93F9">	MsgChoke</span><span style="color:#8BE9FD;font-style:italic">         messageID</span><span style="color:#FF79C6"> =</span><span style="color:#BD93F9"> 0</span></span>
<span class="line"><span style="color:#BD93F9">	MsgUnchoke</span><span style="color:#8BE9FD;font-style:italic">       messageID</span><span style="color:#FF79C6"> =</span><span style="color:#BD93F9"> 1</span></span>
<span class="line"><span style="color:#BD93F9">	MsgInterested</span><span style="color:#8BE9FD;font-style:italic">    messageID</span><span style="color:#FF79C6"> =</span><span style="color:#BD93F9"> 2</span></span>
<span class="line"><span style="color:#BD93F9">	MsgNotInterested</span><span style="color:#8BE9FD;font-style:italic"> messageID</span><span style="color:#FF79C6"> =</span><span style="color:#BD93F9"> 3</span></span>
<span class="line"><span style="color:#BD93F9">	MsgHave</span><span style="color:#8BE9FD;font-style:italic">          messageID</span><span style="color:#FF79C6"> =</span><span style="color:#BD93F9"> 4</span></span>
<span class="line"><span style="color:#BD93F9">	MsgBitfield</span><span style="color:#8BE9FD;font-style:italic">      messageID</span><span style="color:#FF79C6"> =</span><span style="color:#BD93F9"> 5</span></span>
<span class="line"><span style="color:#BD93F9">	MsgRequest</span><span style="color:#8BE9FD;font-style:italic">       messageID</span><span style="color:#FF79C6"> =</span><span style="color:#BD93F9"> 6</span></span>
<span class="line"><span style="color:#BD93F9">	MsgPiece</span><span style="color:#8BE9FD;font-style:italic">         messageID</span><span style="color:#FF79C6"> =</span><span style="color:#BD93F9"> 7</span></span>
<span class="line"><span style="color:#BD93F9">	MsgCancel</span><span style="color:#8BE9FD;font-style:italic">        messageID</span><span style="color:#FF79C6"> =</span><span style="color:#BD93F9"> 8</span></span>
<span class="line"><span style="color:#F8F8F2">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">// Message stores ID and payload of a message</span></span>
<span class="line"><span style="color:#FF79C6">type</span><span style="color:#8BE9FD;font-style:italic"> Message</span><span style="color:#FF79C6"> struct</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">	ID      </span><span style="color:#8BE9FD;font-style:italic">messageID</span></span>
<span class="line"><span style="color:#F8F8F2">	Payload []</span><span style="color:#8BE9FD;font-style:italic">byte</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">// Serialize serializes a message into a buffer of the form</span></span>
<span class="line"><span style="color:#6272A4">// &#x3C;length prefix>&#x3C;message ID>&#x3C;payload></span></span>
<span class="line"><span style="color:#6272A4">// Interprets `nil` as a keep-alive message</span></span>
<span class="line"><span style="color:#FF79C6">func</span><span style="color:#F8F8F2"> (</span><span style="color:#FFB86C;font-style:italic">m </span><span style="color:#FF79C6">*</span><span style="color:#8BE9FD;font-style:italic">Message</span><span style="color:#F8F8F2">) </span><span style="color:#50FA7B">Serialize</span><span style="color:#F8F8F2">() []</span><span style="color:#8BE9FD;font-style:italic">byte</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">	if</span><span style="color:#F8F8F2"> m </span><span style="color:#FF79C6">==</span><span style="color:#BD93F9"> nil</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">		return</span><span style="color:#50FA7B"> make</span><span style="color:#F8F8F2">([]</span><span style="color:#8BE9FD;font-style:italic">byte</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">4</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">	}</span></span>
<span class="line"><span style="color:#F8F8F2">	length </span><span style="color:#FF79C6">:=</span><span style="color:#8BE9FD;font-style:italic"> uint32</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">len</span><span style="color:#F8F8F2">(m.Payload) </span><span style="color:#FF79C6">+</span><span style="color:#BD93F9"> 1</span><span style="color:#F8F8F2">) </span><span style="color:#6272A4">// +1 for id</span></span>
<span class="line"><span style="color:#F8F8F2">	buf </span><span style="color:#FF79C6">:=</span><span style="color:#50FA7B"> make</span><span style="color:#F8F8F2">([]</span><span style="color:#8BE9FD;font-style:italic">byte</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">4</span><span style="color:#FF79C6">+</span><span style="color:#F8F8F2">length)</span></span>
<span class="line"><span style="color:#F8F8F2">	binary.BigEndian.</span><span style="color:#50FA7B">PutUint32</span><span style="color:#F8F8F2">(buf[</span><span style="color:#BD93F9">0</span><span style="color:#F8F8F2">:</span><span style="color:#BD93F9">4</span><span style="color:#F8F8F2">], length)</span></span>
<span class="line"><span style="color:#F8F8F2">	buf[</span><span style="color:#BD93F9">4</span><span style="color:#F8F8F2">] </span><span style="color:#FF79C6">=</span><span style="color:#8BE9FD;font-style:italic"> byte</span><span style="color:#F8F8F2">(m.ID)</span></span>
<span class="line"><span style="color:#50FA7B">	copy</span><span style="color:#F8F8F2">(buf[</span><span style="color:#BD93F9">5</span><span style="color:#F8F8F2">:], m.Payload)</span></span>
<span class="line"><span style="color:#FF79C6">	return</span><span style="color:#F8F8F2"> buf</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre>
<p>To read a message from a stream, we just follow the format of a message. We read four bytes and interpret them as a <code>uint32</code> to get the <strong>length</strong> of the message. Then, we read that number of bytes to get the <strong>ID</strong> (the first byte) and the <strong>payload</strong> (the remaining bytes).</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="go"><code><span class="line"><span style="color:#6272A4">// Read parses a message from a stream. Returns `nil` on keep-alive message</span></span>
<span class="line"><span style="color:#FF79C6">func</span><span style="color:#50FA7B"> Read</span><span style="color:#F8F8F2">(</span><span style="color:#FFB86C;font-style:italic">r</span><span style="color:#8BE9FD;font-style:italic"> io</span><span style="color:#F8F8F2">.</span><span style="color:#8BE9FD;font-style:italic">Reader</span><span style="color:#F8F8F2">) (</span><span style="color:#FF79C6">*</span><span style="color:#8BE9FD;font-style:italic">Message</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD;font-style:italic">error</span><span style="color:#F8F8F2">) {</span></span>
<span class="line"><span style="color:#F8F8F2">	lengthBuf </span><span style="color:#FF79C6">:=</span><span style="color:#50FA7B"> make</span><span style="color:#F8F8F2">([]</span><span style="color:#8BE9FD;font-style:italic">byte</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">4</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">	_, err </span><span style="color:#FF79C6">:=</span><span style="color:#F8F8F2"> io.</span><span style="color:#50FA7B">ReadFull</span><span style="color:#F8F8F2">(r, lengthBuf)</span></span>
<span class="line"><span style="color:#FF79C6">	if</span><span style="color:#F8F8F2"> err </span><span style="color:#FF79C6">!=</span><span style="color:#BD93F9"> nil</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">		return</span><span style="color:#BD93F9"> nil</span><span style="color:#F8F8F2">, err</span></span>
<span class="line"><span style="color:#F8F8F2">	}</span></span>
<span class="line"><span style="color:#F8F8F2">	length </span><span style="color:#FF79C6">:=</span><span style="color:#F8F8F2"> binary.BigEndian.</span><span style="color:#50FA7B">Uint32</span><span style="color:#F8F8F2">(lengthBuf)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">	// keep-alive message</span></span>
<span class="line"><span style="color:#FF79C6">	if</span><span style="color:#F8F8F2"> length </span><span style="color:#FF79C6">==</span><span style="color:#BD93F9"> 0</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">		return</span><span style="color:#BD93F9"> nil</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">nil</span></span>
<span class="line"><span style="color:#F8F8F2">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">	messageBuf </span><span style="color:#FF79C6">:=</span><span style="color:#50FA7B"> make</span><span style="color:#F8F8F2">([]</span><span style="color:#8BE9FD;font-style:italic">byte</span><span style="color:#F8F8F2">, length)</span></span>
<span class="line"><span style="color:#F8F8F2">	_, err </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> io.</span><span style="color:#50FA7B">ReadFull</span><span style="color:#F8F8F2">(r, messageBuf)</span></span>
<span class="line"><span style="color:#FF79C6">	if</span><span style="color:#F8F8F2"> err </span><span style="color:#FF79C6">!=</span><span style="color:#BD93F9"> nil</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">		return</span><span style="color:#BD93F9"> nil</span><span style="color:#F8F8F2">, err</span></span>
<span class="line"><span style="color:#F8F8F2">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">	m </span><span style="color:#FF79C6">:=</span><span style="color:#8BE9FD;font-style:italic"> Message</span><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#F8F8F2">		ID:      </span><span style="color:#50FA7B">messageID</span><span style="color:#F8F8F2">(messageBuf[</span><span style="color:#BD93F9">0</span><span style="color:#F8F8F2">]),</span></span>
<span class="line"><span style="color:#F8F8F2">		Payload: messageBuf[</span><span style="color:#BD93F9">1</span><span style="color:#F8F8F2">:],</span></span>
<span class="line"><span style="color:#F8F8F2">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">	return</span><span style="color:#FF79C6"> &#x26;</span><span style="color:#F8F8F2">m, </span><span style="color:#BD93F9">nil</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre>
<h4 id="bitfields">Bitfields</h4>
<p>One of the most interesting types of message is the <strong>bitfield</strong>, which is a data structure that peers use to efficiently encode which pieces they are able to send us. A bitfield looks like a byte array, and to check which pieces they have, we just need to look at the positions of the <em>bits</em> set to 1. You can think of it like the digital equivalent of a coffee shop loyalty card. We start with a blank card of all <code>0</code>, and flip bits to <code>1</code> to mark their positions as “stamped.”</p>
<p><img src="/guides/torrent-client/bitfield.png" alt="a coffee shop loyalty card with eight slots, with stamps on the first four slots and a stamp on the second to last slot, represented as 11110010"></p>
<p>By working with <em>bits</em> instead of <em>bytes</em>, this data structure is super compact. We can stuff information about eight pieces in the space of a single byte—the size of a <code>bool</code>. The tradeoff is that accessing values becomes a little more tricky. The smallest unit of memory that computers can address are bytes, so to get to our bits, we have to do some bitwise manipulation:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="go"><code><span class="line"><span style="color:#6272A4">// A Bitfield represents the pieces that a peer has</span></span>
<span class="line"><span style="color:#FF79C6">type</span><span style="color:#8BE9FD;font-style:italic"> Bitfield</span><span style="color:#F8F8F2"> []</span><span style="color:#8BE9FD;font-style:italic">byte</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">// HasPiece tells if a bitfield has a particular index set</span></span>
<span class="line"><span style="color:#FF79C6">func</span><span style="color:#F8F8F2"> (</span><span style="color:#FFB86C;font-style:italic">bf </span><span style="color:#8BE9FD;font-style:italic">Bitfield</span><span style="color:#F8F8F2">) </span><span style="color:#50FA7B">HasPiece</span><span style="color:#F8F8F2">(</span><span style="color:#FFB86C;font-style:italic">index</span><span style="color:#8BE9FD;font-style:italic"> int</span><span style="color:#F8F8F2">) </span><span style="color:#8BE9FD;font-style:italic">bool</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">	byteIndex </span><span style="color:#FF79C6">:=</span><span style="color:#F8F8F2"> index </span><span style="color:#FF79C6">/</span><span style="color:#BD93F9"> 8</span></span>
<span class="line"><span style="color:#F8F8F2">	offset </span><span style="color:#FF79C6">:=</span><span style="color:#F8F8F2"> index </span><span style="color:#FF79C6">%</span><span style="color:#BD93F9"> 8</span></span>
<span class="line"><span style="color:#FF79C6">	return</span><span style="color:#F8F8F2"> bf[byteIndex]</span><span style="color:#FF79C6">>></span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">7</span><span style="color:#FF79C6">-</span><span style="color:#F8F8F2">offset)</span><span style="color:#FF79C6">&#x26;</span><span style="color:#BD93F9">1</span><span style="color:#FF79C6"> !=</span><span style="color:#BD93F9"> 0</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">// SetPiece sets a bit in the bitfield</span></span>
<span class="line"><span style="color:#FF79C6">func</span><span style="color:#F8F8F2"> (</span><span style="color:#FFB86C;font-style:italic">bf </span><span style="color:#8BE9FD;font-style:italic">Bitfield</span><span style="color:#F8F8F2">) </span><span style="color:#50FA7B">SetPiece</span><span style="color:#F8F8F2">(</span><span style="color:#FFB86C;font-style:italic">index</span><span style="color:#8BE9FD;font-style:italic"> int</span><span style="color:#F8F8F2">) {</span></span>
<span class="line"><span style="color:#F8F8F2">	byteIndex </span><span style="color:#FF79C6">:=</span><span style="color:#F8F8F2"> index </span><span style="color:#FF79C6">/</span><span style="color:#BD93F9"> 8</span></span>
<span class="line"><span style="color:#F8F8F2">	offset </span><span style="color:#FF79C6">:=</span><span style="color:#F8F8F2"> index </span><span style="color:#FF79C6">%</span><span style="color:#BD93F9"> 8</span></span>
<span class="line"><span style="color:#F8F8F2">	bf[byteIndex] </span><span style="color:#FF79C6">|=</span><span style="color:#BD93F9"> 1</span><span style="color:#FF79C6"> &#x3C;&#x3C;</span><span style="color:#F8F8F2"> (</span><span style="color:#BD93F9">7</span><span style="color:#FF79C6"> -</span><span style="color:#F8F8F2"> offset)</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre>
<h3 id="putting-it-all-together">Putting it all together</h3>
<p>We now have all the tools we need to download a torrent: we have a list of peers obtained from the tracker, and we can communicate with them by dialing a TCP connection, initiating a handshake, and sending and receiving messages. Our last big problems are handling the <strong>concurrency</strong> involved in talking to multiple peers at once, and managing the <strong>state</strong> of our peers as we interact with them. These are both classically Hard problems.</p>
<h4 id="managing-concurrency-channels-as-queues">Managing concurrency: channels as queues</h4>
<p>In Go, we <a href="https://blog.golang.org/share-memory-by-communicating" rel="noopener noreferrer nofollow" target="_blank">share memory by communicating</a>, and we can think of a Go channel as a cheap thread-safe queue.</p>
<p>We’ll set up two channels to synchronize our concurrent workers: one for dishing out work (pieces to download) between peers, and another for collecting downloaded pieces. As downloaded pieces come in through the results channel, we can copy them into a buffer to start assembling our complete file.</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="go"><code><span class="line"><span style="color:#6272A4">// Init queues for workers to retrieve work and send results</span></span>
<span class="line"><span style="color:#F8F8F2">workQueue </span><span style="color:#FF79C6">:=</span><span style="color:#50FA7B"> make</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">chan</span><span style="color:#FF79C6"> *</span><span style="color:#8BE9FD;font-style:italic">pieceWork</span><span style="color:#F8F8F2">, </span><span style="color:#50FA7B">len</span><span style="color:#F8F8F2">(t.PieceHashes))</span></span>
<span class="line"><span style="color:#F8F8F2">results </span><span style="color:#FF79C6">:=</span><span style="color:#50FA7B"> make</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">chan</span><span style="color:#FF79C6"> *</span><span style="color:#8BE9FD;font-style:italic">pieceResult</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#FF79C6">for</span><span style="color:#F8F8F2"> index, hash </span><span style="color:#FF79C6">:=</span><span style="color:#FF79C6"> range</span><span style="color:#F8F8F2"> t.PieceHashes {</span></span>
<span class="line"><span style="color:#F8F8F2">	length </span><span style="color:#FF79C6">:=</span><span style="color:#F8F8F2"> t.</span><span style="color:#50FA7B">calculatePieceSize</span><span style="color:#F8F8F2">(index)</span></span>
<span class="line"><span style="color:#F8F8F2">	workQueue </span><span style="color:#FF79C6">&#x3C;-</span><span style="color:#FF79C6"> &#x26;</span><span style="color:#8BE9FD;font-style:italic">pieceWork</span><span style="color:#F8F8F2">{index, hash, length}</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">// Start workers</span></span>
<span class="line"><span style="color:#FF79C6">for</span><span style="color:#F8F8F2"> _, peer </span><span style="color:#FF79C6">:=</span><span style="color:#FF79C6"> range</span><span style="color:#F8F8F2"> t.Peers {</span></span>
<span class="line"><span style="color:#FF79C6">	go</span><span style="color:#F8F8F2"> t.</span><span style="color:#50FA7B">startDownloadWorker</span><span style="color:#F8F8F2">(peer, workQueue, results)</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">// Collect results into a buffer until full</span></span>
<span class="line"><span style="color:#F8F8F2">buf </span><span style="color:#FF79C6">:=</span><span style="color:#50FA7B"> make</span><span style="color:#F8F8F2">([]</span><span style="color:#8BE9FD;font-style:italic">byte</span><span style="color:#F8F8F2">, t.Length)</span></span>
<span class="line"><span style="color:#F8F8F2">donePieces </span><span style="color:#FF79C6">:=</span><span style="color:#BD93F9"> 0</span></span>
<span class="line"><span style="color:#FF79C6">for</span><span style="color:#F8F8F2"> donePieces </span><span style="color:#FF79C6">&#x3C;</span><span style="color:#50FA7B"> len</span><span style="color:#F8F8F2">(t.PieceHashes) {</span></span>
<span class="line"><span style="color:#F8F8F2">	res </span><span style="color:#FF79C6">:=</span><span style="color:#FF79C6"> &#x3C;-</span><span style="color:#F8F8F2">results</span></span>
<span class="line"><span style="color:#F8F8F2">	begin, end </span><span style="color:#FF79C6">:=</span><span style="color:#F8F8F2"> t.</span><span style="color:#50FA7B">calculateBoundsForPiece</span><span style="color:#F8F8F2">(res.index)</span></span>
<span class="line"><span style="color:#50FA7B">	copy</span><span style="color:#F8F8F2">(buf[begin:end], res.buf)</span></span>
<span class="line"><span style="color:#F8F8F2">	donePieces</span><span style="color:#FF79C6">++</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"><span style="color:#50FA7B">close</span><span style="color:#F8F8F2">(workQueue)</span></span></code></pre>
<p>We’ll spawn a worker goroutine for each peer we’ve received from the tracker. It’ll connect and handshake with the peer, and then start retrieving work from the <code>workQueue</code>, attempting to download it, and sending downloaded pieces back through the <code>results</code> channel.</p>
<p><img src="/guides/torrent-client/download.png" alt="a flow chart of the download strategy"></p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="go"><code><span class="line"><span style="color:#FF79C6">func</span><span style="color:#F8F8F2"> (</span><span style="color:#FFB86C;font-style:italic">t </span><span style="color:#FF79C6">*</span><span style="color:#8BE9FD;font-style:italic">Torrent</span><span style="color:#F8F8F2">) </span><span style="color:#50FA7B">startDownloadWorker</span><span style="color:#F8F8F2">(</span><span style="color:#FFB86C;font-style:italic">peer</span><span style="color:#8BE9FD;font-style:italic"> peers</span><span style="color:#F8F8F2">.</span><span style="color:#8BE9FD;font-style:italic">Peer</span><span style="color:#F8F8F2">, </span><span style="color:#FFB86C;font-style:italic">workQueue</span><span style="color:#FF79C6"> chan</span><span style="color:#FF79C6"> *</span><span style="color:#8BE9FD;font-style:italic">pieceWork</span><span style="color:#F8F8F2">, </span><span style="color:#FFB86C;font-style:italic">results</span><span style="color:#FF79C6"> chan</span><span style="color:#FF79C6"> *</span><span style="color:#8BE9FD;font-style:italic">pieceResult</span><span style="color:#F8F8F2">) {</span></span>
<span class="line"><span style="color:#F8F8F2">	c, err </span><span style="color:#FF79C6">:=</span><span style="color:#F8F8F2"> client.</span><span style="color:#50FA7B">New</span><span style="color:#F8F8F2">(peer, t.PeerID, t.InfoHash)</span></span>
<span class="line"><span style="color:#FF79C6">	if</span><span style="color:#F8F8F2"> err </span><span style="color:#FF79C6">!=</span><span style="color:#BD93F9"> nil</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">		log.</span><span style="color:#50FA7B">Printf</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">"</span><span style="color:#F1FA8C">Could not handshake with </span><span style="color:#BD93F9">%s</span><span style="color:#F1FA8C">. Disconnecting</span><span style="color:#FF79C6">\n</span><span style="color:#E9F284">"</span><span style="color:#F8F8F2">, peer.IP)</span></span>
<span class="line"><span style="color:#FF79C6">		return</span></span>
<span class="line"><span style="color:#F8F8F2">	}</span></span>
<span class="line"><span style="color:#FF79C6">	defer</span><span style="color:#F8F8F2"> c.Conn.</span><span style="color:#50FA7B">Close</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">	log.</span><span style="color:#50FA7B">Printf</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">"</span><span style="color:#F1FA8C">Completed handshake with </span><span style="color:#BD93F9">%s</span><span style="color:#FF79C6">\n</span><span style="color:#E9F284">"</span><span style="color:#F8F8F2">, peer.IP)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">	c.</span><span style="color:#50FA7B">SendUnchoke</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">	c.</span><span style="color:#50FA7B">SendInterested</span><span style="color:#F8F8F2">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">	for</span><span style="color:#F8F8F2"> pw </span><span style="color:#FF79C6">:=</span><span style="color:#FF79C6"> range</span><span style="color:#F8F8F2"> workQueue {</span></span>
<span class="line"><span style="color:#FF79C6">		if</span><span style="color:#FF79C6"> !</span><span style="color:#F8F8F2">c.Bitfield.</span><span style="color:#50FA7B">HasPiece</span><span style="color:#F8F8F2">(pw.index) {</span></span>
<span class="line"><span style="color:#F8F8F2">			workQueue </span><span style="color:#FF79C6">&#x3C;-</span><span style="color:#F8F8F2"> pw </span><span style="color:#6272A4">// Put piece back on the queue</span></span>
<span class="line"><span style="color:#FF79C6">			continue</span></span>
<span class="line"><span style="color:#F8F8F2">		}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">		// Download the piece</span></span>
<span class="line"><span style="color:#F8F8F2">		buf, err </span><span style="color:#FF79C6">:=</span><span style="color:#50FA7B"> attemptDownloadPiece</span><span style="color:#F8F8F2">(c, pw)</span></span>
<span class="line"><span style="color:#FF79C6">		if</span><span style="color:#F8F8F2"> err </span><span style="color:#FF79C6">!=</span><span style="color:#BD93F9"> nil</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">			log.</span><span style="color:#50FA7B">Println</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">"</span><span style="color:#F1FA8C">Exiting</span><span style="color:#E9F284">"</span><span style="color:#F8F8F2">, err)</span></span>
<span class="line"><span style="color:#F8F8F2">			workQueue </span><span style="color:#FF79C6">&#x3C;-</span><span style="color:#F8F8F2"> pw </span><span style="color:#6272A4">// Put piece back on the queue</span></span>
<span class="line"><span style="color:#FF79C6">			return</span></span>
<span class="line"><span style="color:#F8F8F2">		}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">		err </span><span style="color:#FF79C6">=</span><span style="color:#50FA7B"> checkIntegrity</span><span style="color:#F8F8F2">(pw, buf)</span></span>
<span class="line"><span style="color:#FF79C6">		if</span><span style="color:#F8F8F2"> err </span><span style="color:#FF79C6">!=</span><span style="color:#BD93F9"> nil</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">			log.</span><span style="color:#50FA7B">Printf</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">"</span><span style="color:#F1FA8C">Piece #</span><span style="color:#BD93F9">%d</span><span style="color:#F1FA8C"> failed integrity check</span><span style="color:#FF79C6">\n</span><span style="color:#E9F284">"</span><span style="color:#F8F8F2">, pw.index)</span></span>
<span class="line"><span style="color:#F8F8F2">			workQueue </span><span style="color:#FF79C6">&#x3C;-</span><span style="color:#F8F8F2"> pw </span><span style="color:#6272A4">// Put piece back on the queue</span></span>
<span class="line"><span style="color:#FF79C6">			continue</span></span>
<span class="line"><span style="color:#F8F8F2">		}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">		c.</span><span style="color:#50FA7B">SendHave</span><span style="color:#F8F8F2">(pw.index)</span></span>
<span class="line"><span style="color:#F8F8F2">		results </span><span style="color:#FF79C6">&#x3C;-</span><span style="color:#FF79C6"> &#x26;</span><span style="color:#8BE9FD;font-style:italic">pieceResult</span><span style="color:#F8F8F2">{pw.index, buf}</span></span>
<span class="line"><span style="color:#F8F8F2">	}</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre>
<h4 id="managing-state">Managing state</h4>
<p>We’ll keep track of each peer in a struct, and modify that struct as we read messages. It’ll include data like how much we’ve downloaded from the peer, how much we’ve requested from them, and whether we’re choked. If we wanted to scale this further, we could formalize this as a finite state machine. But a struct and a switch are good enough for now.</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="go"><code><span class="line"><span style="color:#FF79C6">type</span><span style="color:#8BE9FD;font-style:italic"> pieceProgress</span><span style="color:#FF79C6"> struct</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">	index      </span><span style="color:#8BE9FD;font-style:italic">int</span></span>
<span class="line"><span style="color:#F8F8F2">	client     </span><span style="color:#FF79C6">*</span><span style="color:#8BE9FD;font-style:italic">client</span><span style="color:#F8F8F2">.</span><span style="color:#8BE9FD;font-style:italic">Client</span></span>
<span class="line"><span style="color:#F8F8F2">	buf        []</span><span style="color:#8BE9FD;font-style:italic">byte</span></span>
<span class="line"><span style="color:#F8F8F2">	downloaded </span><span style="color:#8BE9FD;font-style:italic">int</span></span>
<span class="line"><span style="color:#F8F8F2">	requested  </span><span style="color:#8BE9FD;font-style:italic">int</span></span>
<span class="line"><span style="color:#F8F8F2">	backlog    </span><span style="color:#8BE9FD;font-style:italic">int</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">func</span><span style="color:#F8F8F2"> (</span><span style="color:#FFB86C;font-style:italic">state </span><span style="color:#FF79C6">*</span><span style="color:#8BE9FD;font-style:italic">pieceProgress</span><span style="color:#F8F8F2">) </span><span style="color:#50FA7B">readMessage</span><span style="color:#F8F8F2">() </span><span style="color:#8BE9FD;font-style:italic">error</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">	msg, err </span><span style="color:#FF79C6">:=</span><span style="color:#F8F8F2"> state.client.</span><span style="color:#50FA7B">Read</span><span style="color:#F8F8F2">() </span><span style="color:#6272A4">// this call blocks</span></span>
<span class="line"><span style="color:#FF79C6">	switch</span><span style="color:#F8F8F2"> msg.ID {</span></span>
<span class="line"><span style="color:#FF79C6">	case</span><span style="color:#F8F8F2"> message.MsgUnchoke:</span></span>
<span class="line"><span style="color:#F8F8F2">		state.client.Choked </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> false</span></span>
<span class="line"><span style="color:#FF79C6">	case</span><span style="color:#F8F8F2"> message.MsgChoke:</span></span>
<span class="line"><span style="color:#F8F8F2">		state.client.Choked </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> true</span></span>
<span class="line"><span style="color:#FF79C6">	case</span><span style="color:#F8F8F2"> message.MsgHave:</span></span>
<span class="line"><span style="color:#F8F8F2">		index, err </span><span style="color:#FF79C6">:=</span><span style="color:#F8F8F2"> message.</span><span style="color:#50FA7B">ParseHave</span><span style="color:#F8F8F2">(msg)</span></span>
<span class="line"><span style="color:#F8F8F2">		state.client.Bitfield.</span><span style="color:#50FA7B">SetPiece</span><span style="color:#F8F8F2">(index)</span></span>
<span class="line"><span style="color:#FF79C6">	case</span><span style="color:#F8F8F2"> message.MsgPiece:</span></span>
<span class="line"><span style="color:#F8F8F2">		n, err </span><span style="color:#FF79C6">:=</span><span style="color:#F8F8F2"> message.</span><span style="color:#50FA7B">ParsePiece</span><span style="color:#F8F8F2">(state.index, state.buf, msg)</span></span>
<span class="line"><span style="color:#F8F8F2">		state.downloaded </span><span style="color:#FF79C6">+=</span><span style="color:#F8F8F2"> n</span></span>
<span class="line"><span style="color:#F8F8F2">		state.backlog</span><span style="color:#FF79C6">--</span></span>
<span class="line"><span style="color:#F8F8F2">	}</span></span>
<span class="line"><span style="color:#FF79C6">	return</span><span style="color:#BD93F9"> nil</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre>
<h4 id="time-to-make-requests">Time to make requests!</h4>
<p>Files, pieces, and piece hashes aren’t the full story—we can go further by breaking down pieces into <strong>blocks</strong>. A block is a part of a piece, and we can fully define a block by the <strong>index</strong> of the piece it’s part of, its byte <strong>offset</strong> within the piece, and its <strong>length</strong>. When we make requests for data from peers, we are actually requesting <em>blocks</em>. A block is usually 16KB large, meaning that a single 256 KB piece might actually require 16 requests.</p>
<p>A peer is supposed to sever the connection if they receive a request for a block larger than 16KB. However, based on my experience, they’re often perfectly happy to satisfy requests up to 128KB. I only got moderate gains in overall speed with larger block sizes, so it’s probably better to stick with the spec.</p>
<h4 id="pipelining">Pipelining</h4>
<p>Network round-trips are expensive, and requesting each block one by one will absolutely thank the performance of our download. Therefore, it’s important to <strong>pipeline</strong> our requests such that we keep up a constant pressure of some number of unfulfilled requests. This can increase the throughput of our connection by an order of magnitude.</p>
<p><img src="/guides/torrent-client/pipelining.png" alt="Two email threads simulating peer connections. The thread on the left shows a request followed by a reply, repeated three times. The thread on the left sends three requests, and receives three replies in quick succession."></p>
<p>Classically, BitTorrent clients kept a queue of five pipelined requests, and that’s the value I’ll be using. I found that increasing it can up to double the speed of a download. Newer clients use an <a href="https://luminarys.com/posts/writing-a-bittorrent-client.html" rel="noopener noreferrer nofollow" target="_blank">adaptive</a> queue size to better accommodate modern network speeds and conditions. This is definitely a parameter worth tweaking, and it’s pretty low hanging fruit for future performance optimization.</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="go"><code><span class="line"><span style="color:#6272A4">// MaxBlockSize is the largest number of bytes a request can ask for</span></span>
<span class="line"><span style="color:#FF79C6">const</span><span style="color:#BD93F9"> MaxBlockSize</span><span style="color:#FF79C6"> =</span><span style="color:#BD93F9"> 16384</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">// MaxBacklog is the number of unfulfilled requests a client can have in its pipeline</span></span>
<span class="line"><span style="color:#FF79C6">const</span><span style="color:#BD93F9"> MaxBacklog</span><span style="color:#FF79C6"> =</span><span style="color:#BD93F9"> 5</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">func</span><span style="color:#50FA7B"> attemptDownloadPiece</span><span style="color:#F8F8F2">(</span><span style="color:#FFB86C;font-style:italic">c</span><span style="color:#FF79C6"> *</span><span style="color:#8BE9FD;font-style:italic">client</span><span style="color:#F8F8F2">.</span><span style="color:#8BE9FD;font-style:italic">Client</span><span style="color:#F8F8F2">, </span><span style="color:#FFB86C;font-style:italic">pw</span><span style="color:#FF79C6"> *</span><span style="color:#8BE9FD;font-style:italic">pieceWork</span><span style="color:#F8F8F2">) ([]</span><span style="color:#8BE9FD;font-style:italic">byte</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD;font-style:italic">error</span><span style="color:#F8F8F2">) {</span></span>
<span class="line"><span style="color:#F8F8F2">	state </span><span style="color:#FF79C6">:=</span><span style="color:#8BE9FD;font-style:italic"> pieceProgress</span><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#F8F8F2">		index:  pw.index,</span></span>
<span class="line"><span style="color:#F8F8F2">		client: c,</span></span>
<span class="line"><span style="color:#F8F8F2">		buf:    </span><span style="color:#50FA7B">make</span><span style="color:#F8F8F2">([]</span><span style="color:#8BE9FD;font-style:italic">byte</span><span style="color:#F8F8F2">, pw.length),</span></span>
<span class="line"><span style="color:#F8F8F2">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">	// Setting a deadline helps get unresponsive peers unstuck.</span></span>
<span class="line"><span style="color:#6272A4">	// 30 seconds is more than enough time to download a 262 KB piece</span></span>
<span class="line"><span style="color:#F8F8F2">	c.Conn.</span><span style="color:#50FA7B">SetDeadline</span><span style="color:#F8F8F2">(time.</span><span style="color:#50FA7B">Now</span><span style="color:#F8F8F2">().</span><span style="color:#50FA7B">Add</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">30</span><span style="color:#FF79C6"> *</span><span style="color:#F8F8F2"> time.Second))</span></span>
<span class="line"><span style="color:#FF79C6">	defer</span><span style="color:#F8F8F2"> c.Conn.</span><span style="color:#50FA7B">SetDeadline</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">time</span><span style="color:#F8F8F2">.</span><span style="color:#8BE9FD;font-style:italic">Time</span><span style="color:#F8F8F2">{}) </span><span style="color:#6272A4">// Disable the deadline</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">	for</span><span style="color:#F8F8F2"> state.downloaded </span><span style="color:#FF79C6">&#x3C;</span><span style="color:#F8F8F2"> pw.length {</span></span>
<span class="line"><span style="color:#6272A4">		// If unchoked, send requests until we have enough unfulfilled requests</span></span>
<span class="line"><span style="color:#FF79C6">		if</span><span style="color:#FF79C6"> !</span><span style="color:#F8F8F2">state.client.Choked {</span></span>
<span class="line"><span style="color:#FF79C6">			for</span><span style="color:#F8F8F2"> state.backlog </span><span style="color:#FF79C6">&#x3C;</span><span style="color:#F8F8F2"> MaxBacklog </span><span style="color:#FF79C6">&#x26;&#x26;</span><span style="color:#F8F8F2"> state.requested </span><span style="color:#FF79C6">&#x3C;</span><span style="color:#F8F8F2"> pw.length {</span></span>
<span class="line"><span style="color:#F8F8F2">				blockSize </span><span style="color:#FF79C6">:=</span><span style="color:#F8F8F2"> MaxBlockSize</span></span>
<span class="line"><span style="color:#6272A4">				// Last block might be shorter than the typical block</span></span>
<span class="line"><span style="color:#FF79C6">				if</span><span style="color:#F8F8F2"> pw.length</span><span style="color:#FF79C6">-</span><span style="color:#F8F8F2">state.requested </span><span style="color:#FF79C6">&#x3C;</span><span style="color:#F8F8F2"> blockSize {</span></span>
<span class="line"><span style="color:#F8F8F2">					blockSize </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> pw.length </span><span style="color:#FF79C6">-</span><span style="color:#F8F8F2"> state.requested</span></span>
<span class="line"><span style="color:#F8F8F2">				}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">				err </span><span style="color:#FF79C6">:=</span><span style="color:#F8F8F2"> c.</span><span style="color:#50FA7B">SendRequest</span><span style="color:#F8F8F2">(pw.index, state.requested, blockSize)</span></span>
<span class="line"><span style="color:#FF79C6">				if</span><span style="color:#F8F8F2"> err </span><span style="color:#FF79C6">!=</span><span style="color:#BD93F9"> nil</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">					return</span><span style="color:#BD93F9"> nil</span><span style="color:#F8F8F2">, err</span></span>
<span class="line"><span style="color:#F8F8F2">				}</span></span>
<span class="line"><span style="color:#F8F8F2">				state.backlog</span><span style="color:#FF79C6">++</span></span>
<span class="line"><span style="color:#F8F8F2">				state.requested </span><span style="color:#FF79C6">+=</span><span style="color:#F8F8F2"> blockSize</span></span>
<span class="line"><span style="color:#F8F8F2">			}</span></span>
<span class="line"><span style="color:#F8F8F2">		}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">		err </span><span style="color:#FF79C6">:=</span><span style="color:#F8F8F2"> state.</span><span style="color:#50FA7B">readMessage</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#FF79C6">		if</span><span style="color:#F8F8F2"> err </span><span style="color:#FF79C6">!=</span><span style="color:#BD93F9"> nil</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">			return</span><span style="color:#BD93F9"> nil</span><span style="color:#F8F8F2">, err</span></span>
<span class="line"><span style="color:#F8F8F2">		}</span></span>
<span class="line"><span style="color:#F8F8F2">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">	return</span><span style="color:#F8F8F2"> state.buf, </span><span style="color:#BD93F9">nil</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre>
<h4 id="maingo">main.go</h4>
<p>This is a short one. We’re almost there.</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="go"><code><span class="line"><span style="color:#FF79C6">package</span><span style="color:#8BE9FD;font-style:italic"> main</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">import</span><span style="color:#F8F8F2"> (</span></span>
<span class="line"><span style="color:#E9F284">	"</span><span style="color:#F1FA8C">log</span><span style="color:#E9F284">"</span></span>
<span class="line"><span style="color:#E9F284">	"</span><span style="color:#F1FA8C">os</span><span style="color:#E9F284">"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E9F284">	"</span><span style="color:#F1FA8C">github.com/veggiedefender/torrent-client/torrentfile</span><span style="color:#E9F284">"</span></span>
<span class="line"><span style="color:#F8F8F2">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">func</span><span style="color:#50FA7B"> main</span><span style="color:#F8F8F2">() {</span></span>
<span class="line"><span style="color:#F8F8F2">	inPath </span><span style="color:#FF79C6">:=</span><span style="color:#F8F8F2"> os.Args[</span><span style="color:#BD93F9">1</span><span style="color:#F8F8F2">]</span></span>
<span class="line"><span style="color:#F8F8F2">	outPath </span><span style="color:#FF79C6">:=</span><span style="color:#F8F8F2"> os.Args[</span><span style="color:#BD93F9">2</span><span style="color:#F8F8F2">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">	tf, err </span><span style="color:#FF79C6">:=</span><span style="color:#F8F8F2"> torrentfile.</span><span style="color:#50FA7B">Open</span><span style="color:#F8F8F2">(inPath)</span></span>
<span class="line"><span style="color:#FF79C6">	if</span><span style="color:#F8F8F2"> err </span><span style="color:#FF79C6">!=</span><span style="color:#BD93F9"> nil</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">		log.</span><span style="color:#50FA7B">Fatal</span><span style="color:#F8F8F2">(err)</span></span>
<span class="line"><span style="color:#F8F8F2">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">	err </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> tf.</span><span style="color:#50FA7B">DownloadToFile</span><span style="color:#F8F8F2">(outPath)</span></span>
<span class="line"><span style="color:#FF79C6">	if</span><span style="color:#F8F8F2"> err </span><span style="color:#FF79C6">!=</span><span style="color:#BD93F9"> nil</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">		log.</span><span style="color:#50FA7B">Fatal</span><span style="color:#F8F8F2">(err)</span></span>
<span class="line"><span style="color:#F8F8F2">	}</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre>
<script id="asciicast-xqRSB0Jec8RN91Zt89rbb9PcL" src="https://asciinema.org/a/xqRSB0Jec8RN91Zt89rbb9PcL.js" async></script>
<h2 id="this-isnt-the-full-story">This isn’t the full story</h2>
<p>For brevity, I included only a few of the important snippets of code. Notably, I left out all the glue code, parsing, unit tests, and the boring parts that build character. View my <a href="https://github.com/veggiedefender/torrent-client" rel="noopener noreferrer nofollow" target="_blank">full implementation</a> if you’re interested.</p>  </div> </div> </article>    <div></div>  <div class="border-b border-t bg-white py-6 text-left sm:py-16 sm:text-center"> <div class="container max-w-[650px]!"> <p class="text-2xl font-bold sm:text-5xl">Join the Community</p> <p class="my-2.5 text-sm leading-relaxed text-gray-600 sm:my-5 sm:text-lg">
roadmap.sh is the <a href="https://github.com/search?o=desc&q=stars%3A%3E100000&s=stars&type=Repositories" target="_blank" class="font-medium text-gray-600 underline underline-offset-2 hover:text-black">6th most starred project on GitHub</a> and is visited by hundreds of thousands of developers every month.
</p> <div class="mt-5 grid grid-cols-1 justify-between gap-2 divide-x-0 sm:my-11 sm:grid-cols-3 sm:gap-0 sm:divide-x mb-4 sm:mb-0"> <div class="flex items-start sm:items-center justify-start flex-col sm:justify-center sm:gap-0 gap-2 sm:bg-transparent sm:rounded-none rounded-xl p-0 sm:p-4 mb-3 sm:mb-0"> <p class="flex items-center text-sm text-blue-500 sm:flex"> <span class="rounded-md bg-blue-500 px-1 text-white">Rank 6th</span>
&nbsp;out of 28M!
</p>   <div class="flex flex-row items-center sm:flex-col my-1 sm:my-0"> <p class="my-0 sm:my-4 mr-1 sm:mr-0 text-base font-bold sm:w-auto sm:text-5xl"> 332K </p> <p class="mb-0 mt-0 text-base sm:text-xs tracking-wide text-black sm:-mt-3 sm:mb-5"> GitHub Stars </p> </div> <a href="https://github.com/kamranahmedse/developer-roadmap" target="_blank" class="group mt-0 flex flex-col items-center rounded-lg border border-black bg-white px-3 py-2 text-sm hover:bg-black hover:text-white"> <div class="mb-0.5 flex items-center font-semibold"> <svg class="-ml-1 fill-current" focusable="false" width="14" height="15" viewBox="0 0 14 15" xmlns="http://www.w3.org/2000/svg">
  <path d="M6.99999 11.1515L2.88574 13.4545L3.80449 8.82984L0.342407 5.6285L5.02482 5.07317L6.99999 0.791504L8.97516 5.07317L13.6576 5.6285L10.1955 8.82984L11.1142 13.4545L6.99999 11.1515Z"></path>
</svg> <span class="ml-1.5 hover:block">Star us on GitHub</span> </div> <span class="text-xs text-gray-500 group-hover:text-gray-100">
Help us reach #1
</span> </a>   </div> <div class="flex items-start sm:items-center justify-start flex-col sm:justify-center sm:gap-0 gap-2 sm:bg-transparent sm:rounded-none rounded-xl p-0 sm:p-4 mb-3 sm:mb-0">  <p class="flex items-center text-sm text-blue-500 sm:flex"> <span class="mr-1.5 rounded-md bg-blue-500 px-1 text-white">+90k</span>
every month
</p>  <div class="flex flex-row items-center sm:flex-col my-1 sm:my-0"> <p class="my-0 sm:my-4 mr-1 sm:mr-0 text-base font-bold sm:w-auto sm:text-5xl"> +2.1M </p> <p class="mb-0 mt-0 text-base sm:text-xs tracking-wide text-black sm:-mt-3 sm:mb-5"> Registered Users </p> </div>  <a href="/signup" class="group mt-0 flex flex-col items-center rounded-lg border border-black bg-white px-3 py-2 text-sm hover:bg-black hover:text-white"> <div class="mb-0.5 flex items-center font-semibold"> <svg data-v-f24af897 xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" strokeLinejoin="round" class="-ml-1 h-[15px] fill-current"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M22 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg> <span class="ml-1 hover:block">Register yourself</span> </div> <span class="text-xs text-gray-500 group-hover:text-gray-100">
Commit to your growth
</span> </a>  </div> <div class="flex items-start sm:items-center justify-start flex-col sm:justify-center sm:gap-0 gap-2 sm:bg-transparent sm:rounded-none rounded-xl p-0 sm:p-4 mb-3 sm:mb-0">   <p class="flex items-center text-sm text-blue-500 sm:flex"> <span class="mr-1.5 rounded-md bg-blue-500 px-1 text-white">+2k</span>
every month
</p> <div class="flex flex-row items-center sm:flex-col my-1 sm:my-0"> <p class="my-0 sm:my-4 mr-1 sm:mr-0 text-base font-bold sm:w-auto sm:text-5xl"> 39K </p> <p class="mb-0 mt-0 text-base sm:text-xs tracking-wide text-black sm:-mt-3 sm:mb-5"> Discord Members </p> </div>   <a href="https://roadmap.sh/discord" target="_blank" class="group mt-0 flex flex-col items-center rounded-lg border border-black bg-white px-3 py-2 text-sm hover:bg-black hover:text-white"> <div class="mb-0.5 flex items-center font-semibold"> <svg width="20" height="15" viewBox="0 0 20 15" fill="none" xmlns="http://www.w3.org/2000/svg" class="-ml-1 h-[13px] fill-current">
<g clip-path="url(#clip0_1303_4)">
<path d="M2.79481 1.71886C2.80349 1.70994 2.81651 1.70101 2.82953 1.68762C3.86686 0.830474 5.25576 0.392973 6.23667 0.183152C7.20455 -0.0266694 8.17242 0.540293 8.48492 1.50012C8.48925 1.51798 8.49792 1.53136 8.5023 1.54922C6.87467 1.71886 5.42067 2.17869 4.24013 2.89744C3.93196 3.08494 3.83214 3.49565 4.01443 3.81708C4.13596 4.0269 4.35296 4.14298 4.57434 4.14298C4.68717 4.14298 4.80438 4.11172 4.90855 4.04923C6.23667 3.23672 7.9988 2.80815 9.99967 2.80815C12.0005 2.80815 13.7627 3.23672 15.0908 4.04923C15.4033 4.23673 15.8026 4.13404 15.9849 3.81708C16.1672 3.49565 16.0674 3.08494 15.7592 2.89744C14.5787 2.17869 13.1247 1.71886 11.4971 1.54922C11.5014 1.53136 11.5101 1.51798 11.5144 1.50012C11.8269 0.540293 12.7948 -0.0266694 13.7627 0.183152C14.7436 0.392973 16.1325 0.830474 17.1698 1.68762C17.1828 1.70101 17.1958 1.70994 17.2045 1.71886C18.1681 2.63851 19.9476 7.31707 19.9476 11.5671C19.9476 11.6831 19.9215 11.7947 19.8651 11.8974C18.8061 13.8126 16.3104 14.5135 15.2818 14.7233C15.1559 14.7501 15.03 14.7635 14.9042 14.7635C14.2879 14.7635 13.6933 14.4599 13.3243 13.9331L13.0986 13.6162C15.3339 13.0715 16.4797 12.0894 16.5448 12.0314C16.8183 11.7903 16.853 11.3707 16.6186 11.0894C16.3842 10.8082 15.9763 10.7724 15.7028 11.009C15.6681 11.0403 13.754 12.6341 9.99967 12.6341C6.22796 12.6341 4.31392 11.0269 4.29655 11.009C4.02311 10.7724 3.61078 10.8082 3.38075 11.0939C3.15071 11.3751 3.1811 11.7947 3.45453 12.0314C3.51964 12.0894 4.66546 13.0715 6.90071 13.6162L6.67501 13.9331C6.30609 14.4599 5.71146 14.7635 5.09517 14.7635C4.9693 14.7635 4.84342 14.7501 4.71755 14.7233C3.68891 14.5135 1.19325 13.8126 0.134222 11.8974C0.0777986 11.7947 0.0517578 11.6831 0.0517578 11.5671C0.0517578 7.31707 1.83127 2.63851 2.79481 1.71886ZM12.8078 10.3573C13.6368 10.3573 14.3096 9.56707 14.3096 8.58941C14.3096 7.61171 13.6368 6.82156 12.8078 6.82156C11.9745 6.82156 11.3018 7.61171 11.3018 8.58941C11.3018 9.56707 11.9745 10.3573 12.8078 10.3573ZM7.20455 10.393C8.04221 10.393 8.72363 9.59386 8.72363 8.60724C8.72363 7.62067 8.04221 6.82156 7.20455 6.82156C6.36251 6.82156 5.68542 7.62067 5.68542 8.60724C5.68542 9.59386 6.36251 10.393 7.20455 10.393Z" fill="currentColor"></path>
</g>
<defs>
<clipPath id="clip0_1303_4">
<rect width="20" height="15" fill="currentColor"></rect>
</clipPath>
</defs>
</svg> <span class="ml-1 hover:block">Join on Discord</span> </div> <span class="text-xs text-gray-500 group-hover:text-gray-100">
Join the community
</span> </a> </div> </div> </div> </div>  <div class="bg-slate-900 py-6 pb-10 text-white sm:py-16"> <div class="container"> <p class="mb-8 flex flex-col justify-center gap-0 font-medium text-gray-400 sm:mb-16 sm:flex-row sm:gap-4"> <a class="border-b border-b-gray-700 px-2 py-1.5 transition-colors hover:text-white sm:border-b-0 sm:px-0 sm:py-0" href="/roadmaps">Roadmaps</a> <a class="border-b border-b-gray-700 px-2 py-1.5 transition-colors hover:text-white sm:border-b-0 sm:px-0 sm:py-0" href="/best-practices">Best Practices</a> <a class="border-b border-b-gray-700 px-2 py-1.5 transition-colors hover:text-white sm:border-b-0 sm:px-0 sm:py-0" href="/guides">Guides</a> <a class="border-b border-b-gray-700 px-2 py-1.5 transition-colors hover:text-white sm:border-b-0 sm:px-0 sm:py-0" href="/videos">Videos</a> <a class="border-b border-b-gray-700 px-2 py-1.5 transition-colors hover:text-white sm:border-b-0 sm:px-0 sm:py-0" href="/about">FAQs</a> <a class="px-2 py-1.5 transition-colors hover:text-white sm:border-b-0 sm:px-0 sm:py-0" href="https://youtube.com/theroadmap?sub_confirmation=1" target="_blank">YouTube</a> </p> <div class="flex flex-col justify-between gap-8 lg:flex-row lg:gap-2"> <div class="max-w-[425px]"> <p class="text-md flex items-center"> <a class="inline-flex items-center text-lg font-medium text-white transition-colors hover:text-gray-400" href="/"> <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 283 283" fill="#000" xmlns:v="https://vecta.io/nano"><path fill="#fff" d="M0 39C0 17.46 17.46 0 39 0h205c21.539 0 39 17.46 39 39v205c0 21.539-17.461 39-39 39H39c-21.54 0-39-17.461-39-39V39Z"></path><path d="M121.215 210.72c-1.867.56-4.854 1.12-8.96 1.68-3.92.56-8.027.84-12.32.84-4.107 0-7.84-.28-11.2-.84-3.174-.56-5.88-1.68-8.12-3.36s-4.014-3.92-5.32-6.72c-1.12-2.987-1.68-6.813-1.68-11.48v-84c0-4.293.746-7.933 2.24-10.92 1.68-3.173 4.013-5.973 7-8.4s6.626-4.573 10.92-6.44c4.48-2.053 9.24-3.827 14.28-5.32a106.176 106.176 0 0 1 15.68-3.36 95.412 95.412 0 0 1 16.24-1.4c8.96 0 16.053 1.773 21.28 5.32 5.226 3.36 7.84 8.96 7.84 16.8 0 2.613-.374 5.227-1.12 7.84-.747 2.427-1.68 4.667-2.8 6.72a133.1 133.1 0 0 0-12.04.56c-4.107.373-8.12.933-12.04 1.68s-7.654 1.587-11.2 2.52c-3.36.747-6.254 1.68-8.68 2.8v95.48zm45.172-22.4c0-7.84 2.426-14.373 7.28-19.6s11.48-7.84 19.88-7.84 15.026 2.613 19.88 7.84 7.28 11.76 7.28 19.6-2.427 14.373-7.28 19.6-11.48 7.84-19.88 7.84-15.027-2.613-19.88-7.84-7.28-11.76-7.28-19.6z"></path></svg> <span class="ml-2">HNM Devs</span> </a> <span class="mx-2 text-gray-400">by</span> <a class="font-regular rounded-md bg-blue-600 px-1.5 py-1 text-sm hover:bg-blue-700" href="https://x.com/hnmdevs" target="_blank"> <span class="hidden sm:inline">@hnmdevs</span> <span class="inline sm:hidden">@hnmdevs</span> </a> </p> <p class="my-4 text-slate-300/60">
Community created roadmaps, best practices, projects, articles,
          resources and journeys to help you choose your path and grow in your
          career.
</p> <div class="text-sm text-gray-400"> <p>
&copy; HNM Devs
<span class="mx-1.5">&middot;</span> <a href="/terms" class="hover:text-white">Terms</a> <span class="mx-1.5">&middot;</span> <a href="/privacy" class="hover:text-white">Privacy</a> <span class="mx-1.5">&middot;</span> <a aria-label="Follow on LinkedIn" href="https://www.linkedin.com/company/hnmdevs" class="hover:text-white" target="_blank"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="inline-block h-5 w-5 fill-current">
    <g clip-path="url(#clip0_2344_20)">
        <path d="M0 0V24H24V0H0ZM8 19H5V8H8V19ZM6.5 6.732C5.534 6.732 4.75 5.942 4.75 4.968C4.75 3.994 5.534 3.204 6.5 3.204C7.466 3.204 8.25 3.994 8.25 4.968C8.25 5.942 7.467 6.732 6.5 6.732ZM20 19H17V13.396C17 10.028 13 10.283 13 13.396V19H10V8H13V9.765C14.397 7.179 20 6.988 20 12.241V19Z" fill="currentColor"></path>
    </g>
    <defs>
        <clipPath id="clip0_2344_20">
            <rect width="24" height="24" rx="2" fill="white"></rect>
        </clipPath>
    </defs>
</svg> </a> <a aria-label="Subscribe to YouTube channel" href="https://youtube.com/hnmdevs?sub_confirmation=1" target="_blank" class="ml-2 hover:text-white"> <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor" xmlns:v="https://vecta.io/nano" class="inline-block h-5 w-5"><path d="M19.615 3.184c-3.604-.246-11.631-.245-15.23 0C.488 3.45.029 5.804 0 12c.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23 0C23.512 20.55 23.971 18.196 24 12c-.029-6.185-.484-8.549-4.385-8.816zM9 16V8l8 3.993L9 16z"></path></svg> </a> <a aria-label="Follow on Twitter" href="https://twitter.com/hnmdevs" target="_blank" class="ml-2 hover:text-white"> <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="100" height="100" viewBox="0 0 50 50" class="inline-block h-5 w-5 fill-current">
<path d="M 6.9199219 6 L 21.136719 26.726562 L 6.2285156 44 L 9.40625 44 L 22.544922 28.777344 L 32.986328 44 L 43 44 L 28.123047 22.3125 L 42.203125 6 L 39.027344 6 L 26.716797 20.261719 L 16.933594 6 L 6.9199219 6 z"></path>
</svg> </a> <a aria-label="Follow on Blusky" href="http://hnmdevs.bsky.social/" target="_blank" class="ml-2 hover:text-white"> <svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" id="Bluesky--Streamline-Simple-Icons" height="24" width="24" class="inline-block h-5 w-5 fill-current"><desc>Bluesky Streamline Icon: https://streamlinehq.com</desc><title>Bluesky</title><path d="M12 10.8c-1.087 -2.114 -4.046 -6.053 -6.798 -7.995C2.566 0.944 1.561 1.266 0.902 1.565 0.139 1.908 0 3.08 0 3.768c0 0.69 0.378 5.65 0.624 6.479 0.815 2.736 3.713 3.66 6.383 3.364 0.136 -0.02 0.275 -0.039 0.415 -0.056 -0.138 0.022 -0.276 0.04 -0.415 0.056 -3.912 0.58 -7.387 2.005 -2.83 7.078 5.013 5.19 6.87 -1.113 7.823 -4.308 0.953 3.195 2.05 9.271 7.733 4.308 4.267 -4.308 1.172 -6.498 -2.74 -7.078a8.741 8.741 0 0 1 -0.415 -0.056c0.14 0.017 0.279 0.036 0.415 0.056 2.67 0.297 5.568 -0.628 6.383 -3.364 0.246 -0.828 0.624 -5.79 0.624 -6.478 0 -0.69 -0.139 -1.861 -0.902 -2.206 -0.659 -0.298 -1.664 -0.62 -4.3 1.24C16.046 4.748 13.087 8.687 12 10.8Z" fill="currentColor" stroke-width="1"></path></svg> </a> </p> </div> </div> <div class="max-w-[340px] text-left lg:text-right"> <a href="https://thenewstack.io" target="_blank"> <img src="/images/tns-sm.png" alt="ThewNewStack" class="my-1.5 mr-auto lg:mr-0 lg:ml-auto" width="200" height="24.8" loading="lazy"> </a> <p class="my-4 text-slate-300/60">
The top DevOps resource for Kubernetes, cloud-native computing, and
          large-scale development and deployment.
</p> <div class="text-sm text-gray-400"> <p> <a href="https://thenewstack.io/category/devops?utm_source=roadmap.sh&utm_medium=Referral&utm_campaign=Footer" target="_blank" class="text-gray-400 hover:text-white">DevOps</a> <span class="mx-1.5">&middot;</span> <a href="https://thenewstack.io/category/kubernetes?utm_source=roadmap.sh&utm_medium=Referral&utm_campaign=Footer" target="_blank" class="text-gray-400 hover:text-white">Kubernetes</a> <span class="mx-1.5">&middot;</span> <a href="https://thenewstack.io/category/cloud-native?utm_source=roadmap.sh&utm_medium=Referral&utm_campaign=Footer" target="_blank" class="text-gray-400 hover:text-white">Cloud-Native</a> </p> </div> </div> </div> <astro-island uid="TcCjc" prefix="r19" component-url="/_astro/CookieSettingsButton.C-tnk8GO.js" component-export="CookieSettingsButton" renderer-url="/_astro/client.DWEMtbU6.js" props="{}" ssr client="load" opts="{&quot;name&quot;:&quot;CookieSettingsButton&quot;,&quot;value&quot;:true}" await-children><div class="mt-12 flex items-center justify-start"><button class="flex items-center gap-2 rounded-md bg-slate-800/80 px-3 py-1.5 text-sm text-gray-400 transition-colors hover:bg-slate-700 hover:text-white"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-cookie h-4 w-4" aria-hidden="true"><path d="M12 2a10 10 0 1 0 10 10 4 4 0 0 1-5-5 4 4 0 0 1-5-5"></path><path d="M8.5 8.5v.01"></path><path d="M16 15.5v.01"></path><path d="M12 12v.01"></path><path d="M11 17v.01"></path><path d="M7 14v.01"></path></svg>Cookie Settings</button></div><!--astro:end--></astro-island> </div> </div>  <script type="module" src="/_astro/Authenticator.astro_astro_type_script_index_0_lang.tx8aIZm1.js"></script>  <script type="module">class n{constructor(){this.triggerPopup=this.triggerPopup.bind(this),this.onDOMLoaded=this.onDOMLoaded.bind(this),this.handleClosePopup=this.handleClosePopup.bind(this),this.handleKeydown=this.handleKeydown.bind(this)}triggerPopup(o){const e=o?.target?.closest("[data-popup]")?.dataset?.popup||"unknown-popup",t=document.querySelector(`#${e}`);if(!t)return;o.preventDefault(),t.classList.remove("hidden"),t.classList.add("flex");const s=t.querySelector("[autofocus]");s&&s.focus()}handleClosePopup(o){const e=o.target,t=e.closest(".popup-body"),s=e.closest(".popup");!e.closest(".popup-close")&&t||s&&(s.classList.add("hidden"),s.classList.remove("flex"))}handleKeydown(o){if(o.key!=="Escape")return;const e=document.querySelector(".popup:not(.hidden)");e&&(e.classList.add("hidden"),e.classList.remove("flex"))}onDOMLoaded(){document.addEventListener("click",this.triggerPopup),document.addEventListener("click",this.handleClosePopup),document.addEventListener("keydown",this.handleKeydown)}init(){window.addEventListener("DOMContentLoaded",this.onDOMLoaded)}}const d=new n;d.init();</script> <div id="login-popup" tabindex="-1" class="hidden bg-black/50 overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 z-999 h-full items-center justify-center popup"> <div class="relative p-4 w-full max-w-md h-full md:h-auto"> <div class="relative bg-white rounded-lg shadow-sm popup-body"> <button type="button" class="absolute top-3 right-2.5 text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm p-1.5 ml-auto inline-flex items-center popup-close"> <svg aria-hidden="true" class="w-5 h-5" fill="#c6c7c7" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
  <path fill-rule="evenodd"
        d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
        clipRule="evenodd"></path>
</svg> <span class="sr-only">Close popup</span> </button> <div class="p-5"> <h3 class="text-2xl mb-0.5 font-medium">  </h3> <p class="mb-4 text-sm font-normal text-gray-800">  </p>  <div class="mb-7 text-center"> <p class="mb-3 text-2xl leading-5 font-semibold text-slate-900">
Login or Signup
</p> <p class="mt-2 text-sm leading-4 text-slate-600">
You must be logged in to perform this action.
</p> </div> <astro-island uid="Z1RhT4M" prefix="r20" component-url="/_astro/AuthenticationForm.DcPQtuUg.js" component-export="AuthenticationForm" renderer-url="/_astro/client.DWEMtbU6.js" props="{}" ssr client="load" opts="{&quot;name&quot;:&quot;AuthenticationForm&quot;,&quot;value&quot;:true}" await-children><div class="flex w-full flex-col gap-2"><button class="inline-flex h-10 w-full items-center justify-center gap-2 rounded-sm border border-slate-300 bg-white p-2 text-sm font-medium text-black outline-hidden hover:border-gray-400 hover:bg-gray-50 focus:ring-2 focus:ring-[#333] focus:ring-offset-1 disabled:cursor-not-allowed disabled:opacity-60"><svg class="h-[18px] w-[18px]" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 98 96"><path fill-rule="evenodd" d="M48.854 0C21.839 0 0 22 0 49.217c0 21.756 13.993 40.172 33.405 46.69 2.427.49 3.316-1.059 3.316-2.362l-.08-9.127c-13.59 2.934-16.42-5.867-16.42-5.867-2.184-5.704-5.42-7.17-5.42-7.17-4.448-3.015.324-3.015.324-3.015 4.934.326 7.523 5.052 7.523 5.052 4.367 7.496 11.404 5.378 14.235 4.074.404-3.178 1.699-5.378 3.074-6.6-10.839-1.141-22.243-5.378-22.243-24.283 0-5.378 1.94-9.778 5.014-13.2-.485-1.222-2.184-6.275.486-13.038 0 0 4.125-1.304 13.426 5.052a46.97 46.97 0 0 1 12.214-1.63c4.125 0 8.33.571 12.213 1.63 9.302-6.356 13.427-5.052 13.427-5.052 2.67 6.763.97 11.816.485 13.038 3.155 3.422 5.015 7.822 5.015 13.2 0 18.905-11.404 23.06-22.324 24.283 1.78 1.548 3.316 4.481 3.316 9.126l-.08 13.526c0 1.304.89 2.853 3.316 2.364 19.412-6.52 33.405-24.935 33.405-46.691C97.707 22 75.788 0 48.854 0z" fill="#24292f"></path></svg>Continue with GitHub</button><button class="inline-flex h-10 w-full items-center justify-center gap-2 rounded-sm border border-slate-300 bg-white p-2 text-sm font-medium text-black outline-hidden hover:border-gray-400 hover:bg-gray-50 focus:ring-2 focus:ring-[#333] focus:ring-offset-1 disabled:cursor-not-allowed disabled:opacity-60"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 90 92" fill="none" class="h-[18px] w-[18px]"><path d="M90 47.1c0-3.1-.3-6.3-.8-9.3H45.9v17.7h24.8c-1 5.7-4.3 10.7-9.2 13.9l14.8 11.5C85 72.8 90 61 90 47.1z" fill="#4280ef"></path><path d="M45.9 91.9c12.4 0 22.8-4.1 30.4-11.1L61.5 69.4c-4.1 2.8-9.4 4.4-15.6 4.4-12 0-22.1-8.1-25.8-18.9L4.9 66.6c7.8 15.5 23.6 25.3 41 25.3z" fill="#34a353"></path><path d="M20.1 54.8c-1.9-5.7-1.9-11.9 0-17.6L4.9 25.4c-6.5 13-6.5 28.3 0 41.2l15.2-11.8z" fill="#f6b704"></path><path d="M45.9 18.3c6.5-.1 12.9 2.4 17.6 6.9L76.6 12C68.3 4.2 57.3 0 45.9.1c-17.4 0-33.2 9.8-41 25.3l15.2 11.8c3.7-10.9 13.8-18.9 25.8-18.9z" fill="#e54335"></path></svg>Continue with Google</button><button class="inline-flex h-10 w-full items-center justify-center gap-2 rounded-sm border border-slate-300 bg-white p-2 text-sm font-medium text-black outline-hidden hover:border-gray-400 focus:ring-2 focus:ring-[#333] focus:ring-offset-1 disabled:cursor-not-allowed disabled:opacity-60"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="h-[18px] w-[18px] text-blue-700"><g clip-path="url(#clip0_2344_20)"><path d="M0 0V24H24V0H0ZM8 19H5V8H8V19ZM6.5 6.732C5.534 6.732 4.75 5.942 4.75 4.968C4.75 3.994 5.534 3.204 6.5 3.204C7.466 3.204 8.25 3.994 8.25 4.968C8.25 5.942 7.467 6.732 6.5 6.732ZM20 19H17V13.396C17 10.028 13 10.283 13 13.396V19H10V8H13V9.765C14.397 7.179 20 6.988 20 12.241V19Z" fill="currentColor"></path></g><defs><clipPath id="clip0_2344_20"><rect width="24" height="24" rx="2" fill="white"></rect></clipPath></defs></svg>Continue with LinkedIn</button></div><div class="flex w-full items-center gap-2 py-6 text-sm text-slate-600"><div class="h-px w-full bg-slate-200"></div>OR<div class="h-px w-full bg-slate-200"></div></div><form class="w-full"><label for="form:«r20R3»" class="sr-only">Email address</label><input id="form:«r20R3»" type="email" autoComplete="email" required="" class="block w-full rounded-lg border border-gray-300 px-3 py-2 shadow-xs outline-hidden placeholder:text-gray-400 focus:ring-2 focus:ring-black focus:ring-offset-1" placeholder="Email Address" name="email" value=""/><label for="form:«r20R3H1»" class="sr-only">Password</label><input id="form:«r20R3H1»" type="password" autoComplete="current-password" required="" class="mt-2 block w-full rounded-lg border border-gray-300 px-3 py-2 shadow-xs outline-hidden placeholder:text-gray-400 focus:ring-2 focus:ring-black focus:ring-offset-1" placeholder="Password" name="password" value=""/><p class="mt-2 mb-3 text-sm text-gray-500"><a href="/forgot-password" class="text-blue-800 hover:text-blue-600">Reset your password?</a></p><button type="submit" class="inline-flex w-full items-center justify-center rounded-lg bg-black p-2 py-3 text-sm font-medium text-white outline-hidden focus:ring-2 focus:ring-black focus:ring-offset-1 disabled:bg-gray-400">Continue</button></form><!--astro:end--></astro-island> <div class="mt-3 w-full rounded-md border py-2 text-center text-sm text-slate-600">
Don't have an account?  <a href="/signup" class="font-medium text-blue-700 hover:text-blue-600 hover:underline">
Sign up
</a> </div> <div class="mt-3 text-left text-xs leading-normal text-gray-500">By continuing to use our services, you acknowledge that you have both read and agree to our<!-- --> <a href="/terms" class="font-medium underline underline-offset-2 hover:text-black">Terms of Service</a> <!-- -->and<!-- --> <a href="/privacy" class="font-medium underline underline-offset-2 hover:text-black">Privacy Policy</a>.</div>  </div> </div> </div> </div>  <astro-island uid="ZPcbbm" component-url="/_astro/Toast.BXdWWnAU.js" component-export="Toaster" renderer-url="/_astro/client.DWEMtbU6.js" props="{}" ssr client="only" opts="{&quot;name&quot;:&quot;Toaster&quot;,&quot;value&quot;:&quot;react&quot;}"></astro-island> <script>(()=>{var l=(n,t)=>{let i=async()=>{await(await n())()},e=typeof t.value=="object"?t.value:void 0,s={timeout:e==null?void 0:e.timeout};"requestIdleCallback"in window?window.requestIdleCallback(i,s):setTimeout(i,s.timeout||200)};(self.Astro||(self.Astro={})).idle=l;window.dispatchEvent(new Event("astro:idle"));})();</script><astro-island uid="1H3NWP" prefix="r13" component-url="/_astro/CommandMenu.CnwD_5VM.js" component-export="CommandMenu" renderer-url="/_astro/client.DWEMtbU6.js" props="{}" ssr client="idle" opts="{&quot;name&quot;:&quot;CommandMenu&quot;,&quot;value&quot;:true}"></astro-island> <astro-island uid="Z1k5cUN" prefix="r14" component-url="/_astro/PageProgress.BKq1I4D-.js" component-export="PageProgress" renderer-url="/_astro/client.DWEMtbU6.js" props="{&quot;initialMessage&quot;:[0,&quot;&quot;]}" ssr client="idle" opts="{&quot;name&quot;:&quot;PageProgress&quot;,&quot;value&quot;:true}"></astro-island> <astro-island uid="weEH5" component-url="/_astro/GlobalUpgradeModal.C3BxcsvE.js" component-export="GlobalUpgradeModal" renderer-url="/_astro/client.DWEMtbU6.js" props="{}" ssr client="only" opts="{&quot;name&quot;:&quot;GlobalUpgradeModal&quot;,&quot;value&quot;:&quot;react&quot;}"></astro-island> <div id="div-gpt-ad-1742391132948-0" class="gam-slot fixed bottom-4 right-4 z-50 h-[160px] w-[350px] cursor-pointer max-md:bottom-0 max-md:right-0 max-md:h-[106px] max-md:w-full"> <script type="module">const t=[];function i(e){const n=window.innerWidth<768?"sm":"lg";e.postMessage(`breakpoint:${n}`,"*")}window.addEventListener("resize",()=>{t.forEach(e=>{i(e)})},{passive:!0});window.addEventListener("message",function(e){if(e.data==="initdfp")t.push(e.source),i(e.source);else if(e.data==="close-ad"){const n=document.getElementById("div-gpt-ad-1742391132948-0");n&&n.remove()}});</script> </div> <script type="module">googletag.cmd.push(function(){if(!googletag.pubads){console.log("googletag.pubads not found");return}googletag.pubads().collapseEmptyDivs(),googletag.pubads().setPrivacySettings({restrictDataProcessing:!0,nonPersonalizedAds:!0}),googletag.display("div-gpt-ad-1742391132948-0")});</script>  <astro-island uid="24XVBn" prefix="r15" component-url="/_astro/PageVisit.DsORPinu.js" component-export="PageVisit" renderer-url="/_astro/client.DWEMtbU6.js" props="{&quot;resourceId&quot;:[0],&quot;resourceType&quot;:[0]}" ssr client="load" opts="{&quot;name&quot;:&quot;PageVisit&quot;,&quot;value&quot;:true}"></astro-island> </body></html>